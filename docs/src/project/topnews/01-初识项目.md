# åˆè¯†é¡¹ç›®

[[toc]]



## é¡¹ç›®ä»‹ç»

![image-20240302135936799](assets/image-20240302135936799.png)



:::tip ğŸ”– èƒ½è®©ä½ æ”¶è·ä»€ä¹ˆ

- ç»¼åˆçŸ¥è¯†çš„è¿ç”¨
  - SpringCloud
  - Nacos
  - Seata
  - Redis
  - Docker
  - Kafka
  - ElasticSearch
- æŠ€æœ¯è§£å†³çš„æ–¹æ¡ˆ
  - åˆ†å¸ƒå¼äº‹åŠ¡
  - åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦
  - å»¶è¿Ÿé˜Ÿåˆ—
  - å¼‚æ­¥çº¿ç¨‹
  - çƒ­æ•°æ®ç»Ÿè®¡
  - è¯„è®ºç³»ç»Ÿ
  - ç‚¹èµç³»ç»Ÿ
- ç¼–ç¨‹æ€æƒ³çš„æå‡
  - ä¸šåŠ¡åˆ†æ
  - è®¾è®¡
  - ç¼–ç 
  - æµ‹è¯•
  - éƒ¨ç½²

:::



**é¡¹ç›®è¯¾ç¨‹å¤§çº²**

![image-20240111142921767](assets/image-20240111142921767.png)

<br/>

### é¡¹ç›®æ¦‚è¿°

éšç€æ™ºèƒ½æ‰‹æœºçš„æ™®åŠï¼Œäººä»¬æ›´åŠ ä¹ æƒ¯äºé€šè¿‡æ‰‹æœºæ¥çœ‹æ–°é—»ã€‚ç”±äºç”Ÿæ´»èŠ‚å¥çš„åŠ å¿«ï¼Œå¾ˆå¤šäººåªèƒ½åˆ©ç”¨ç¢ç‰‡æ—¶é—´æ¥è·å–ä¿¡æ¯ï¼Œå› æ­¤ï¼Œå¯¹äºç§»åŠ¨èµ„è®¯å®¢æˆ·ç«¯çš„éœ€æ±‚ä¹Ÿè¶Šæ¥è¶Šé«˜ã€‚é»‘é©¬å¤´æ¡é¡¹ç›®æ­£æ˜¯åœ¨è¿™æ ·èƒŒæ™¯ä¸‹å¼€å‘å‡ºæ¥ã€‚é»‘é©¬å¤´æ¡é¡¹ç›®é‡‡ç”¨å½“ä¸‹ç«çƒ­çš„å¾®æœåŠ¡+å¤§æ•°æ®æŠ€æœ¯æ¶æ„å®ç°ã€‚æœ¬é¡¹ç›®ä¸»è¦ç€æ‰‹äºè·å–æœ€æ–°æœ€çƒ­æ–°é—»èµ„è®¯ï¼Œé€šè¿‡å¤§æ•°æ®åˆ†æç”¨æˆ·å–œå¥½ç²¾ç¡®æ¨é€å’¨è¯¢æ–°é—»

![image-20240302140036831](assets/image-20240302140036831.png)

<br/>

### é¡¹ç›®æœ¯è¯­

![image-20240302140103805](assets/image-20240302140103805.png)

<br/>

### ä¸šåŠ¡è¯´æ˜

![image-20240302140123224](assets/image-20240302140123224.png)

é¡¹ç›®æ¼”ç¤ºåœ°å€ï¼š

- å¹³å°ç®¡ç†ï¼š[http://heima-admin-java.research.itcast.cn](http://heima-admin-java.research.itcast.cn/)

- è‡ªåª’ä½“ï¼š[http://heime-media-java.research.itcast.cn ](http://heime-media-java.research.itcast.cn/)

- appç«¯ï¼š[http://heima-app-java.research.itcast.cn](http://heima-app-java.research.itcast.cn/)

å¹³å°ç®¡ç†ä¸è‡ªåª’ä½“ä¸ºPCç«¯ï¼Œç”¨ç”µè„‘æµè§ˆå™¨æ‰“å¼€å³å¯ã€‚

<br/>

å…¶ä¸­appç«¯ä¸ºç§»åŠ¨ç«¯ï¼Œæ‰“å¼€æ–¹å¼æœ‰ä¸¤ç§ï¼š

- è°·æ­Œæµè§ˆå™¨æ‰“å¼€ï¼Œè°ƒæˆç§»åŠ¨ç«¯æ¨¡å¼

- æ‰‹æœºæµè§ˆå™¨æ‰“å¼€æˆ–æ‰«æå³ä¾§äºŒç»´ç 

<br/>


### æŠ€æœ¯æ ˆ

![image-20240302140254380](assets/image-20240302140254380.png)

- Spring-Cloud-Gateway : å¾®æœåŠ¡ä¹‹å‰æ¶è®¾çš„ç½‘å…³æœåŠ¡ï¼Œå®ç°æœåŠ¡æ³¨å†Œä¸­çš„APIè¯·æ±‚è·¯ç”±ï¼Œä»¥åŠæ§åˆ¶æµé€Ÿæ§åˆ¶å’Œç†”æ–­å¤„ç†éƒ½æ˜¯å¸¸ç”¨çš„æ¶æ„æ‰‹æ®µï¼Œè€Œè¿™äº›åŠŸèƒ½Gatewayå¤©ç„¶æ”¯æŒ
- è¿ç”¨Spring Bootå¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œæ„å»ºé¡¹ç›®å·¥ç¨‹ï¼›å¹¶ç»“åˆSpring Cloudå…¨å®¶æ¡¶æŠ€æœ¯ï¼Œå®ç°åç«¯ä¸ªäººä¸­å¿ƒã€è‡ªåª’ä½“ã€ç®¡ç†ä¸­å¿ƒç­‰å¾®æœåŠ¡ã€‚
- è¿ç”¨Spring Cloud Alibaba Nacosä½œä¸ºé¡¹ç›®ä¸­çš„æ³¨å†Œä¸­å¿ƒå’Œé…ç½®ä¸­å¿ƒ
- è¿ç”¨mybatis-plusä½œä¸ºæŒä¹…å±‚æå‡å¼€å‘æ•ˆç‡
- è¿ç”¨Kafkaå®Œæˆå†…éƒ¨ç³»ç»Ÿæ¶ˆæ¯é€šçŸ¥ï¼›ä¸å®¢æˆ·ç«¯ç³»ç»Ÿæ¶ˆæ¯é€šçŸ¥ï¼›ä»¥åŠå®æ—¶æ•°æ®è®¡ç®—
- è¿ç”¨Redisç¼“å­˜æŠ€æœ¯ï¼Œå®ç°çƒ­æ•°æ®çš„è®¡ç®—ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- ä½¿ç”¨Mysqlå­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œä»¥ä¿è¯ä¸Šå±‚æ•°æ®æŸ¥è¯¢çš„é«˜æ€§èƒ½
- ä½¿ç”¨Mongoå­˜å‚¨ç”¨æˆ·çƒ­æ•°æ®ï¼Œä»¥ä¿è¯ç”¨æˆ·çƒ­æ•°æ®é«˜æ‰©å±•å’Œé«˜æ€§èƒ½æŒ‡æ ‡
- ä½¿ç”¨Minioä½œä¸ºé™æ€èµ„æºå­˜å‚¨å™¨ï¼Œåœ¨å…¶ä¸Šå®ç°çƒ­é™æ€èµ„æºç¼“å­˜ã€æ·˜æ±°ç­‰åŠŸèƒ½
- è¿ç”¨HbaseæŠ€æœ¯ï¼Œå­˜å‚¨ç³»ç»Ÿä¸­çš„å†·æ•°æ®ï¼Œä¿è¯ç³»ç»Ÿæ•°æ®çš„å¯é æ€§
- è¿ç”¨ESæœç´¢æŠ€æœ¯ï¼Œå¯¹å†·æ•°æ®ã€æ–‡ç« æ•°æ®å»ºç«‹ç´¢å¼•ï¼Œä»¥ä¿è¯å†·æ•°æ®ã€æ–‡ç« æŸ¥è¯¢æ€§èƒ½
- è¿ç”¨AIæŠ€æœ¯ï¼Œæ¥å®Œæˆç³»ç»Ÿè‡ªåŠ¨åŒ–åŠŸèƒ½ï¼Œä»¥æå‡æ•ˆç‡åŠèŠ‚çœæˆæœ¬ã€‚æ¯”å¦‚å®åè®¤è¯è‡ªåŠ¨åŒ–
- PMD&P3C : é™æ€ä»£ç æ‰«æå·¥å…·ï¼Œåœ¨é¡¹ç›®ä¸­æ‰«æé¡¹ç›®ä»£ç ï¼Œæ£€æŸ¥å¼‚å¸¸ç‚¹ã€ä¼˜åŒ–ç‚¹ã€ä»£ç è§„èŒƒç­‰ï¼Œä¸ºå¼€å‘å›¢é˜Ÿæä¾›è§„èŒƒç»Ÿä¸€ï¼Œæå‡é¡¹ç›®ä»£ç è´¨é‡



## å·¥ç¨‹æ­å»º

### å¼€å‘æ¨¡å¼

åœ¨ä¼ä¸šå¼€å‘ä¸­ï¼Œå¾®æœåŠ¡é¡¹ç›®éå¸¸åºå¤§ï¼Œå¾€å¾€æœ‰åå‡ ä¸ªï¼Œç”šè‡³æ•°åä¸ªï¼Œæ•°ç™¾ä¸ªå¾®æœåŠ¡ã€‚è€Œè¿™äº›å¾®æœåŠ¡ä¹Ÿä¼šäº¤ç»™ä¸åŒçš„å¼€å‘ç»„å»å®Œæˆå¼€å‘ã€‚ä½ å¯èƒ½åªå‚ä¸å…¶ä¸­çš„æŸå‡ ä¸ªå¾®æœåŠ¡å¼€å‘ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š

å¦‚æœæˆ‘çš„å¾®æœåŠ¡éœ€è¦è®¿é—®å…¶å®ƒå¾®æœåŠ¡æ€ä¹ˆåŠï¼Ÿ

éš¾é“è¯´æˆ‘éœ€è¦æŠŠæ‰€æœ‰çš„å¾®æœåŠ¡éƒ½éƒ¨ç½²åˆ°è‡ªå·±çš„ç”µè„‘å—ï¼Ÿ

<br/>

å¾ˆæ˜æ˜¾ï¼Œè¿™æ ·åšæ˜¯ä¸ç°å®çš„ã€‚ç¬¬ä¸€ï¼Œä¸æ˜¯æ‰€æœ‰çš„ä»£ç ä½ éƒ½æœ‰è®¿é—®çš„æƒé™ï¼›ç¬¬äºŒï¼Œä½ çš„ç”µè„‘å¯èƒ½æ— æ³•è¿è¡Œè¿™æ•°åã€æ•°ç™¾çš„å¾®æœåŠ¡ã€‚

<br/>

å› æ­¤ï¼Œä¼ä¸šå¾€å¾€ä¼šæä¾›ä¸€ä¸ªé€šç”¨çš„å…¬å…±å¼€å‘ã€æµ‹è¯•ç¯å¢ƒï¼Œåœ¨å…¶ä¸­éƒ¨ç½²å¾ˆå¤šå…¬å…±æœåŠ¡ï¼Œä»¥åŠå…¶å®ƒå›¢é˜Ÿå¼€å‘å¥½çš„ã€å¼€å‘ä¸­çš„å¾®æœåŠ¡ã€‚

è€Œæˆ‘ä»¬å¤§å¤šæ•°æƒ…å†µä¸‹åªåœ¨æœ¬åœ°è¿è¡Œæ­£åœ¨å¼€å‘çš„å¾®æœåŠ¡ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ä¸€äº›å…¶å®ƒçš„æµ‹è¯•æ‰‹æ®µï¼š

- å•å…ƒæµ‹è¯•ï¼šæµ‹è¯•æœ€å°çš„å¯æµ‹è¯•å•å…ƒ
- é›†æˆæµ‹è¯•ï¼šéªŒè¯æŸäº›åŠŸèƒ½æ¥å£ï¼Œæ˜¯å¦èƒ½ä¸å…¶å®ƒå¾®æœåŠ¡æ­£ç¡®äº¤äº’
- ç»„ä»¶æµ‹è¯•ï¼šéªŒè¯å¾®æœåŠ¡ç»„ä»¶
- ç«¯å¯¹ç«¯è”è°ƒï¼šéªŒè¯æ•´ä¸ªç³»ç»Ÿ

<br/>

> **å•å…ƒæµ‹è¯•**

å•å…ƒæµ‹è¯•ä¸€èˆ¬æ˜¯åœ¨é¡¹ç›®çš„testç›®å½•ä¸‹è‡ªå·±ç¼–å†™çš„æµ‹è¯•ï¼Œå¯ä»¥é’ˆå¯¹å…·ä½“åˆ°æ¯ä¸€ä¸ªæ–¹æ³•çš„æµ‹è¯•ã€‚

<br/>

> **é›†æˆæµ‹è¯•**

æ¥å£å¼€å‘å®Œæˆåï¼Œå¯èƒ½éœ€è¦è°ƒç”¨å…¶å®ƒå¾®æœåŠ¡æ¥å£ï¼Œæ­¤æ—¶å¯ä»¥è°ƒç”¨å¼€å‘ç¯å¢ƒä¸­çš„å…¶å®ƒå¾®æœåŠ¡ï¼Œæµ‹è¯•æ¥å£åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

<br/>

> **ç»„ä»¶æµ‹è¯•**

å°†è‡ªå·±å›¢é˜Ÿå¼€å‘çš„å¾®æœåŠ¡éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒï¼Œä½œä¸ºä¸€ä¸ªå¾®æœåŠ¡ç»„ä»¶ï¼Œä¸å¼€å‘ç¯å¢ƒä¸­çš„å…¶å®ƒå¾®æœåŠ¡è”è°ƒï¼Œæµ‹è¯•æ•´ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

<br/>

> **ç«¯å¯¹ç«¯æµ‹è¯•**

åœ¨æµ‹è¯•ç¯å¢ƒéƒ¨ç½²å‰ç«¯ã€åç«¯å¾®æœåŠ¡ç¾¤ï¼Œç›´æ¥è¿›è¡Œå‰åç«¯çš„è”è°ƒæµ‹è¯•ã€‚

<br/>

å½“ç„¶ï¼Œå®é™…ä¸­æˆ‘ä»¬å¯ä»¥æŠŠé›†æˆæµ‹è¯•ä¸ç»„ä»¶æµ‹è¯•åˆå¹¶ï¼Œå¼€å‘å®Œæˆåç›´æ¥ä¸å¼€å‘ç¯å¢ƒçš„å…¶å®ƒå¾®æœåŠ¡è”è°ƒï¼Œæµ‹è¯•æœåŠ¡å·¥ä½œçŠ¶æ€ã€‚

![img](assets/20240302144451213.png)





### å¯¼å…¥è™šæ‹Ÿæœº

ä¸ºäº†æ¨¡æ‹Ÿä¼ä¸šä¸­çš„å¼€å‘ç¯å¢ƒï¼Œæˆ‘ä»¬åˆ©ç”¨è™šæ‹Ÿæœºæ­å»ºäº†ä¸€å¥—å¼€å‘ç¯å¢ƒï¼Œå…¶ä¸­éƒ¨ç½²äº†å¼€å‘å¸¸ç”¨çš„ç»„ä»¶ï¼š

<br/>

**æœåŠ¡ç»„ä»¶**

- Nacosï¼šæœåŠ¡æ³¨å†Œä¸é…ç½®
- Seataï¼šåˆ†å¸ƒå¼äº‹åŠ¡ç³»ç»Ÿ
- XXL-JOBï¼šåˆ†å¸ƒå¼ä»»åŠ¡ç³»ç»Ÿ
- MySQLï¼šæ•°æ®åº“
- Redisï¼šç¼“å­˜åº“
- ELKï¼šç´¢å¼•åº“
- Kafkaï¼šæ¶ˆæ¯é˜Ÿåˆ—


<br/>

**æŒç»­é›†æˆ**

- Gogsï¼šGitç§æœï¼Œä»£ç ç®¡ç†ä»“åº“
- Jenkinsï¼šè‡ªåŠ¨éƒ¨ç½²ä¸æŒç»­é›†æˆ

<br/>

å¯¼å…¥æ–¹å¼æœ‰ä¸‰ç§ï¼Œä»ç®€å•åˆ°å¤æ‚ï¼Œéƒ½èƒ½å®ç°åŒæ ·çš„æ•ˆæœ

- æ–¹å¼ä¸€ï¼šä¸‹è½½å®Œæ•´è™šæ‹Ÿæœºå¹¶å¯¼å…¥ï¼Œå‚è€ƒæ–‡æ¡£[ã€Šè™šæ‹Ÿæœºå¯¼å…¥ã€‹](00-è™šæ‹Ÿæœºå¯¼å…¥.md)
- æ–¹å¼äºŒï¼šä¸‹è½½åŸºç¡€ DockerCompose æ–‡ä»¶ï¼ŒDockeré•œåƒå‹ç¼©åŒ…ï¼Œæ•°æ®å‹ç¼©åŒ…ï¼Œåˆ©ç”¨è„šæœ¬ä¸€ä»¶éƒ¨ç½²ã€‚å‚è€ƒæ–‡æ¡£[ã€Šè‡ªå®šä¹‰éƒ¨ç½²ã€‹](00-è‡ªå®šä¹‰éƒ¨ç½².md)
- æ–¹å¼ä¸‰ï¼šé€šè¿‡ Docker å¯åŠ¨è„šæœ¬ï¼Œå¯¹æœåŠ¡ç»„ä»¶å’ŒæŒç»­é›†æˆåŠŸèƒ½è¿›è¡Œéƒ¨ç½²å’Œé…ç½®ï¼Œè™½ç„¶ç¹çï¼Œä½†æ˜¯èƒ½å¯¹ç¯å¢ƒéƒ¨ç½²æœ‰ç€æ¸…æ™°çš„è®¤è¯†ã€‚å‚è€ƒæ–‡æ¡£[ã€Šè‡ªå®šä¹‰æœåŠ¡ã€‹](00-è‡ªå®šä¹‰æœåŠ¡.md)

<br/>

**é…ç½®æœ¬æœº Hosts**

ä¸ºäº†æ¨¡æ‹Ÿä½¿ç”¨åŸŸåè®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°é…ç½® Hosts

```sh
192.168.150.102 git.hmtt.com
192.168.150.102 jenkins.hmtt.com
192.168.150.102 mq.hmtt.com
192.168.150.102 nacos.hmtt.com
192.168.150.102 xxljob.hmtt.com
192.168.150.102 es.hmtt.com
192.168.150.102 api.hmtt.com
192.168.150.102 www.hmtt.com
192.168.150.102 manage.hmtt.com
```

:::warning ğŸ’¡æ³¨æ„

- åœ¨ Mac/Linux ç³»ç»Ÿä¸­ hosts æ–‡ä»¶ç›®å½•ä¸º  `/etc/hosts`
- åœ¨ Windows ç³»ç»Ÿä¸­ hosts æ–‡ä»¶ç›®å½•ä¸º `C:\WINDOWS\system32\drivers\etc`

:::



//todo

æˆ‘ä»¬è®¿é—®ä¸Šè¿°åŸŸåæ—¶ï¼Œè¯·æ±‚å®é™…æ˜¯å‘é€åˆ°äº†è™šæ‹Ÿæœºï¼Œè€Œè™šæ‹Ÿæœºä¸­çš„Nginxä¼šå¯¹è¿™äº›åŸŸååšåå‘ä»£ç†ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½è¯·æ±‚åˆ°å¯¹åº”çš„ç»„ä»¶äº†ï¼š

![img](assets/20240302163716574.png)

åœ¨æµè§ˆå™¨ä¸­è¾“å…¥å¯¹åº”åŸŸåï¼Œå³å¯æŸ¥çœ‹åˆ°å¯¹åº”æœåŠ¡ï¼Œä¾‹å¦‚Gitç§æœåœ°å€ï¼šhttp://git.tianji.com

![img](assets/20240302163716516.png)

æ¯ä¸ªåŸŸåå¯¹åº”çš„æœåŠ¡åˆ—è¡¨å¦‚ä¸‹ï¼š

| åç§°             | åŸŸå               | è´¦å·         | ç«¯å£  |
| :--------------- | :----------------- | :----------- | :---- |
| Gitç§æœ          | git.tianji.com     | tjxt/123321  | 10880 |
| JenkinsæŒç»­é›†æˆ  | jenkins.tianji.com | root/123     | 18080 |
| RabbitMQ         | mq.tianji.com      | tjxt/123321  | 15672 |
| Nacosæ§åˆ¶å°      | nacos.tianji.com   | nacos/nacos  | 8848  |
| xxl-jobæ§åˆ¶å°    | xxljob.tianji.com  | admin/123456 | 8880  |
| ESçš„Kibanaæ§åˆ¶å° | es.tianji.com      | -            | 5601  |
| å¾®æœåŠ¡ç½‘å…³       | api.tianji.com     | -            | 10010 |
| ç”¨æˆ·ç«¯å…¥å£       | www.tianji.com     | -            | 18081 |
| ç®¡ç†ç«¯å…¥å£       | manage.tianji.com  | -            | 18082 |

åŒæ ·ï¼Œæˆ‘ä»¬è®¿é—®ç”¨æˆ·ç«¯æˆ–è€…ç®¡ç†ç«¯é¡µé¢æ—¶ï¼Œä¹Ÿä¼šè¢«Nginxåå‘ä»£ç†ï¼š

![img](assets/20240302163716537.png)

å½“æˆ‘ä»¬è®¿é—®www.tianji.comæ—¶ï¼Œè¯·æ±‚ä¼šè¢«ä»£ç†åˆ°è™šæ‹Ÿæœºä¸­çš„` /usr/local/src/tj-portal`ç›®å½•ä¸­çš„é™æ€èµ„æº

å½“é¡µé¢è®¿é—®api.tianji.comæ—¶ï¼Œè¯·æ±‚ä¼šè¢«ä»£ç†åˆ°è™šæ‹Ÿæœºä¸­çš„ç½‘å…³æœåŠ¡ã€‚



### é¡¹ç›®éƒ¨ç½²

//todo



## é¡¹ç›®è§„èŒƒ

ç†Ÿæ‚‰é¡¹ç›®çš„ç¬¬ä¸€æ­¥æ˜¯ç†Ÿæ‚‰é¡¹ç›®çš„ç»“æ„ã€ç”¨åˆ°çš„æŠ€æœ¯ã€ç¼–ç çš„ä¸€äº›è§„èŒƒç­‰ã€‚

<br/>

### é¡¹ç›®ç»“æ„

æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹é¡¹ç›®ç»“æ„ï¼Œç›®å‰ä¼ä¸šå¾®æœåŠ¡å¼€å‘é¡¹ç›®ç»“æ„æœ‰ä¸¤ç§æ¨¡å¼ï¼š

- 1ï¼‰é¡¹ç›®ä¸‹çš„æ¯ä¸€ä¸ªå¾®æœåŠ¡ï¼Œéƒ½åˆ›å»ºä¸ºä¸€ä¸ªç‹¬ç«‹çš„Projectï¼Œæœ‰ç‹¬ç«‹çš„Gitä»“åº“ï¼Œå°½å¯èƒ½é™ä½è€¦åˆ
- 2ï¼‰é¡¹ç›®åˆ›å»ºä¸€ä¸ªProjectï¼Œé¡¹ç›®ä¸‹çš„æ¯ä¸€ä¸ªå¾®æœåŠ¡éƒ½æ˜¯ä¸€ä¸ªModuleï¼Œæ–¹ä¾¿ç®¡ç†

æ–¹æ¡ˆä¸€æ›´é€‚åˆäºå¤§å‹é¡¹ç›®ï¼Œæ¶æ„æ›´ä¸ºå¤æ‚ï¼Œç®¡ç†å’Œç»´æŠ¤æˆæœ¬éƒ½æ¯”è¾ƒé«˜ï¼›

æ–¹æ¡ˆäºŒæ›´é€‚åˆä¸­å°å‹é¡¹ç›®ï¼Œæ¶æ„æ›´ä¸ºç®€å•ï¼Œç®¡ç†å’Œç»´æŠ¤æˆæœ¬éƒ½æ¯”è¾ƒä½ï¼›

<br/>

å¤©æœºå­¦å ‚é‡‡ç”¨çš„æ­£æ˜¯ç¬¬äºŒç§æ¨¡å¼ï¼Œç»“æ„å¦‚å›¾

![image-20240302164428890](assets/image-20240302164428890.png)

<br/>

**ç½‘å…³å·¥ç¨‹ç»“æ„**

![image-20240111143245290](assets/image-20240111143245290.png)

**æœåŠ¡å·¥ç¨‹ç»“æ„**

todo



è¯¦ç»†ç»“æ„è¯´æ˜

```sh
heima-leadnews
â”œâ”€â”€ heima-leadnews-basic
â”‚Â Â  â”œâ”€â”€ heima-leadnews-minio
â”‚Â Â  â””â”€â”€ heima-leadnews-seata
â”œâ”€â”€ heima-leadnews-common
â”œâ”€â”€ heima-leadnews-feign-api
â”œâ”€â”€ heima-leadnews-gateway
â”‚Â Â  â”œâ”€â”€ heima-leadnews-admin-gateway
â”‚Â Â  â”œâ”€â”€ heima-leadnews-app-gateway
â”‚Â Â  â””â”€â”€ heima-leadnews-wemedia-gateway
â”œâ”€â”€ heima-leadnews-model
â”œâ”€â”€ heima-leadnews-service
â”‚Â Â  â”œâ”€â”€ heima-leadnews-admin
â”‚Â Â  â”œâ”€â”€ heima-leadnews-article
â”‚Â Â  â”œâ”€â”€ heima-leadnews-behavior
â”‚Â Â  â”œâ”€â”€ heima-leadnews-comment
â”‚Â Â  â”œâ”€â”€ heima-leadnews-schedule
â”‚Â Â  â”œâ”€â”€ heima-leadnews-search
â”‚Â Â  â”œâ”€â”€ heima-leadnews-user
â”‚Â Â  â””â”€â”€ heima-leadnews-wemedia
â”œâ”€â”€ heima-leadnews-test
â””â”€â”€ heima-leadnews-utils
```





### ç†Ÿæ‚‰é¡¹ç›®

#### å®ä½“ç±»

åœ¨å¤©æœºå­¦å ‚é¡¹ç›®ä¸­ï¼Œæ‰€æœ‰å®ä½“ç±»æŒ‰ç…§æ‰€å¤„é¢†åŸŸä¸åŒï¼Œåˆ’åˆ†ä¸º4ç§ä¸åŒç±»å‹ï¼š

- DTOï¼šæ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œåœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é—´ä¼ é€’æ•°æ®ï¼Œä¾‹å¦‚å¾®æœåŠ¡ä¹‹é—´çš„è¯·æ±‚å‚æ•°å’Œè¿”å›å€¼ã€å‰ç«¯æäº¤çš„è¡¨å•
- POï¼šæŒä¹…å±‚å¯¹è±¡ï¼Œä¸æ•°æ®åº“è¡¨ä¸€ä¸€å¯¹åº”ï¼Œä½œä¸ºæŸ¥è¯¢æ•°æ®åº“æ—¶çš„è¿”å›å€¼
- VOï¼šè§†å›¾å¯¹è±¡ï¼Œè¿”å›ç»™å‰ç«¯ç”¨äºå°è£…é¡µé¢å±•ç¤ºçš„æ•°æ®
- QUERYï¼šæŸ¥è¯¢å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯ç”¨äºå°è£…å¤æ‚æŸ¥è¯¢æ¡ä»¶

ä¾‹å¦‚ï¼štodo



#### ä¾èµ–æ³¨å…¥



#### å¼‚å¸¸å¤„ç†

å…¨å±€å¼‚å¸¸æ–¹æ³•

![image-20240302165331594](assets/image-20240302165331594.png)

åœ¨é¡¹ç›®è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæˆ–è€…ä¸šåŠ¡ä»£ç æµç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°å„ç§ç±»å‹å¼‚å¸¸ï¼Œä¸ºäº†åŠ ä»¥åŒºåˆ†ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€äº›æšä¸¾ç±»å‹å¯¹åº”ä¸åŒåœºæ™¯ï¼š

```java
public enum AppHttpCodeEnum {
    // æˆåŠŸæ®µ0
    SUCCESS(200, "æ“ä½œæˆåŠŸ"),

    // ç™»å½•æ®µ1~50
    NEED_LOGIN(1, "éœ€è¦ç™»å½•åæ“ä½œ"),
    LOGIN_PASSWORD_ERROR(2, "å¯†ç é”™è¯¯"),

    // TOKEN50~100
    TOKEN_INVALID(50, "æ— æ•ˆçš„TOKEN"),
    TOKEN_EXPIRE(51, "TOKENå·²è¿‡æœŸ"),
    TOKEN_REQUIRE(52, "TOKENæ˜¯å¿…é¡»çš„"),

    // SIGNéªŒç­¾ 100~120
    SIGN_INVALID(100, "æ— æ•ˆçš„SIGN"),
    SIG_TIMEOUT(101, "SIGNå·²è¿‡æœŸ"),

    // å‚æ•°é”™è¯¯ 500~1000
    PARAM_REQUIRE(500, "ç¼ºå°‘å‚æ•°"),
    PARAM_INVALID(501, "æ— æ•ˆå‚æ•°"),
    PARAM_IMAGE_FORMAT_ERROR(502, "å›¾ç‰‡æ ¼å¼æœ‰è¯¯"),
    SERVER_ERROR(503, "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"),

    // æ•°æ®é”™è¯¯ 1000~2000
    DATA_EXIST(1000, "æ•°æ®å·²ç»å­˜åœ¨"),
    AP_USER_DATA_NOT_EXIST(1001, "ApUseræ•°æ®ä¸å­˜åœ¨"),
    DATA_NOT_EXIST(1002, "æ•°æ®ä¸å­˜åœ¨"),

    // æ•°æ®é”™è¯¯ 3000~3500
    NO_OPERATOR_AUTH(3000, "æ— æƒé™æ“ä½œ"),
    NEED_ADMIND(3001, "éœ€è¦ç®¡ç†å‘˜æƒé™"),
    MATERIASL_REFERENCE_FAIL(501, "ç´ æå¼•ç”¨å¤±æ•ˆ"),
    DELETE_FILE_INVALID(501, "æ–‡ä»¶åˆ é™¤å¤±è´¥"),
    DELETE_NEWS_INVALID(501, "æ–‡ç« å·²ç»ä¸Šæ¶ï¼Œä¸èƒ½åˆ é™¤"),
    ;

    int code;
    String errorMessage;

    AppHttpCodeEnum(int code, String errorMessage) {
        this.code = code;
        this.errorMessage = errorMessage;
    }

    public int getCode() {
        return code;
    }

    public String getErrorMessage() {
        return errorMessage;
    }
}
```

åœ¨å¼€å‘ä¸šåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‡ºç°å¯¹åº”ç±»å‹çš„é—®é¢˜ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨è¿™äº›è‡ªå®šä¹‰å¼‚å¸¸ã€‚

<br/>

å½“å¾®æœåŠ¡æŠ›å‡ºè¿™äº›å¼‚å¸¸æ—¶ï¼Œéœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ç±»ï¼ŒåŒæ ·åœ¨ `heima-leadnews-common` æ¨¡å—ä¸­å®šä¹‰äº†ï¼š

```java
@ControllerAdvice  //æ§åˆ¶å™¨å¢å¼ºç±»
@Slf4j
public class ExceptionCatch {

    /**
     * å¤„ç†ä¸å¯æ§å¼‚å¸¸
     *
     * @param e
     * @return
     */
    @ExceptionHandler(Exception.class)
    @ResponseBody
    public ResponseResult exception(Exception e) {
        e.printStackTrace();
        log.error("catch exception:{}", e.getMessage());

        return ResponseResult.errorResult(AppHttpCodeEnum.SERVER_ERROR);
    }

    /**
     * å¤„ç†å¯æ§å¼‚å¸¸  è‡ªå®šä¹‰å¼‚å¸¸
     *
     * @param e
     * @return
     */
    @ExceptionHandler(CustomException.class)
    @ResponseBody
    public ResponseResult exception(CustomException e) {
        log.error("catch exception:{}", e);
        return ResponseResult.errorResult(e.getAppHttpCodeEnum());
    }
}

```



### æ¥å£å·¥å…· 

#### Postman

Postmanæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç½‘é¡µè°ƒè¯•ä¸å‘é€ç½‘é¡µHTTPè¯·æ±‚çš„Chromeæ’ä»¶ã€‚postmanè¢«500ä¸‡å¼€å‘è€…å’Œè¶…100,000å®¶å…¬å¸ç”¨äºæ¯æœˆè®¿é—®1.3äº¿ä¸ªAPIã€‚

å®˜æ–¹ç½‘å€ï¼šhttps://www.postman.com/

è§£å‹èµ„æ–™æ–‡ä»¶å¤¹ä¸­çš„è½¯ä»¶ï¼Œå®‰è£…å³å¯

![image-20210413162511873](assets/image-20210413162511873.png)

é€šå¸¸çš„æ¥å£æµ‹è¯•æŸ¥çœ‹è¯·æ±‚å’Œå“åº”ï¼Œä¸‹é¢æ˜¯ç™»å½•è¯·æ±‚çš„æµ‹è¯•

![image-20210413162558657](assets/image-20210413162558657.png)



#### Swagger

å‰ååˆ†ç¦»å¼€å‘ï¼šé¡¹ç›®åŸºäºå‰åç«¯åˆ†ç¦»çš„æ¶æ„è¿›è¡Œå¼€å‘ï¼Œå‰åç«¯åˆ†ç¦»æ¶æ„ä¸Šæ€»ä½“ä¸ŠåŒ…æ‹¬å‰ç«¯å’ŒæœåŠ¡å™¨ï¼Œé€šå¸¸æ˜¯å¤šäººåä½œå¼€å‘ã€‚

![image-20240111143216722](assets/image-20240111143216722.png)

ç®€ä»‹

Swagger æ˜¯ä¸€ä¸ªè§„èŒƒå’Œå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºç”Ÿæˆã€æè¿°ã€è°ƒç”¨å’Œå¯è§†åŒ– RESTful é£æ ¼çš„ Web æœåŠ¡(<https://swagger.io/>)ã€‚ å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š

1. ä½¿å¾—å‰åç«¯åˆ†ç¦»å¼€å‘æ›´åŠ æ–¹ä¾¿ï¼Œæœ‰åˆ©äºå›¢é˜Ÿåä½œ

2. æ¥å£çš„æ–‡æ¡£åœ¨çº¿è‡ªåŠ¨ç”Ÿæˆï¼Œé™ä½åç«¯å¼€å‘äººå‘˜ç¼–å†™æ¥å£æ–‡æ¡£çš„è´Ÿæ‹…

3. åŠŸèƒ½æµ‹è¯•

   Springå·²ç»å°†Swaggerçº³å…¥è‡ªèº«çš„æ ‡å‡†ï¼Œå»ºç«‹äº†Spring-swaggeré¡¹ç›®ï¼Œç°åœ¨å«Springfoxã€‚é€šè¿‡åœ¨é¡¹ç›®ä¸­å¼•å…¥Springfox ï¼Œå³å¯éå¸¸ç®€å•å¿«æ·çš„ä½¿ç”¨Swaggerã€‚

(2)SpringBooté›†æˆSwagger

- å¼•å…¥ä¾èµ–,åœ¨heima-leadnews-modelå’Œheima-leadnews-commonæ¨¡å—ä¸­å¼•å…¥è¯¥ä¾èµ–

  ```xml
  <dependency>
      <groupId>io.springfox</groupId>
      <artifactId>springfox-swagger2</artifactId>
  </dependency>
  <dependency>
      <groupId>io.springfox</groupId>
      <artifactId>springfox-swagger-ui</artifactId>
  </dependency>
  ```

åªéœ€è¦åœ¨heima-leadnews-commonä¸­è¿›è¡Œé…ç½®å³å¯ï¼Œå› ä¸ºå…¶ä»–å¾®æœåŠ¡å·¥ç¨‹éƒ½ç›´æ¥æˆ–é—´æ¥ä¾èµ–å³å¯ã€‚

- åœ¨heima-leadnews-commonå·¥ç¨‹ä¸­æ·»åŠ ä¸€ä¸ªé…ç½®ç±»

æ–°å¢ï¼šcom.heima.common.swagger.SwaggerConfiguration

```java
package com.heima.common.swagger;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.Contact;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@Configuration
@EnableSwagger2
public class SwaggerConfiguration {

   @Bean
   public Docket buildDocket() {
      return new Docket(DocumentationType.SWAGGER_2)
              .apiInfo(buildApiInfo())
              .select()
              // è¦æ‰«æçš„API(Controller)åŸºç¡€åŒ…
              .apis(RequestHandlerSelectors.basePackage("com.heima"))
              .paths(PathSelectors.any())
              .build();
   }

   private ApiInfo buildApiInfo() {
      Contact contact = new Contact("é»‘é©¬ç¨‹åºå‘˜","","");
      return new ApiInfoBuilder()
              .title("é»‘é©¬å¤´æ¡-å¹³å°ç®¡ç†APIæ–‡æ¡£")
              .description("é»‘é©¬å¤´æ¡åå°api")
              .contact(contact)
              .version("1.0.0").build();
   }
}
```

åœ¨heima-leadnews-commonæ¨¡å—ä¸­çš„resourcesç›®å½•ä¸­æ–°å¢ä»¥ä¸‹ç›®å½•å’Œæ–‡ä»¶

æ–‡ä»¶ï¼šresources/META-INF/Spring.factories

```java
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
  com.heima.common.swagger.SwaggerConfiguration
```

ï¼ˆ3ï¼‰Swaggerå¸¸ç”¨æ³¨è§£

åœ¨Javaç±»ä¸­æ·»åŠ Swaggerçš„æ³¨è§£å³å¯ç”ŸæˆSwaggeræ¥å£æ–‡æ¡£ï¼Œå¸¸ç”¨Swaggeræ³¨è§£å¦‚ä¸‹ï¼š

â€‹	@Apiï¼šä¿®é¥°æ•´ä¸ªç±»ï¼Œæè¿°Controllerçš„ä½œç”¨

â€‹	@ApiOperationï¼šæè¿°ä¸€ä¸ªç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ–è€…è¯´ä¸€ä¸ªæ¥å£

â€‹	@ApiParamï¼šå•ä¸ªå‚æ•°çš„æè¿°ä¿¡æ¯

â€‹	@ApiModelï¼šç”¨å¯¹è±¡æ¥æ¥æ”¶å‚æ•°

â€‹	@ApiModelPropertyï¼šç”¨å¯¹è±¡æ¥æ”¶å‚æ•°æ—¶ï¼Œæè¿°å¯¹è±¡çš„ä¸€ä¸ªå­—æ®µ

â€‹	@ApiResponseï¼šHTTPå“åº”å…¶ä¸­1ä¸ªæè¿°

â€‹	@ApiResponsesï¼šHTTPå“åº”æ•´ä½“æè¿°

â€‹	@ApiIgnoreï¼šä½¿ç”¨è¯¥æ³¨è§£å¿½ç•¥è¿™ä¸ªAPI

â€‹	@ApiError ï¼šå‘ç”Ÿé”™è¯¯è¿”å›çš„ä¿¡æ¯

â€‹	@ApiImplicitParamï¼šä¸€ä¸ªè¯·æ±‚å‚æ•°

â€‹	@ApiImplicitParamsï¼šå¤šä¸ªè¯·æ±‚å‚æ•°çš„æè¿°ä¿¡æ¯



@ApiImplicitParamå±æ€§ï¼š

| å±æ€§         | å–å€¼   | ä½œç”¨                                          |
| ------------ | ------ | --------------------------------------------- |
| paramType    |        | æŸ¥è¯¢å‚æ•°ç±»å‹                                  |
|              | path   | ä»¥åœ°å€çš„å½¢å¼æäº¤æ•°æ®                          |
|              | query  | ç›´æ¥è·Ÿå‚æ•°å®Œæˆè‡ªåŠ¨æ˜ å°„èµ‹å€¼                    |
|              | body   | ä»¥æµçš„å½¢å¼æäº¤ ä»…æ”¯æŒPOST                     |
|              | header | å‚æ•°åœ¨request headers é‡Œè¾¹æäº¤                |
|              | form   | ä»¥formè¡¨å•çš„å½¢å¼æäº¤ ä»…æ”¯æŒPOST               |
| dataType     |        | å‚æ•°çš„æ•°æ®ç±»å‹ åªä½œä¸ºæ ‡å¿—è¯´æ˜ï¼Œå¹¶æ²¡æœ‰å®é™…éªŒè¯ |
|              | Long   |                                               |
|              | String |                                               |
| name         |        | æ¥æ”¶å‚æ•°å                                    |
| value        |        | æ¥æ”¶å‚æ•°çš„æ„ä¹‰æè¿°                            |
| required     |        | å‚æ•°æ˜¯å¦å¿…å¡«                                  |
|              | true   | å¿…å¡«                                          |
|              | false  | éå¿…å¡«                                        |
| defaultValue |        | é»˜è®¤å€¼                                        |



#### Knife4j

(1)ç®€ä»‹

knife4jæ˜¯ä¸ºJava MVCæ¡†æ¶é›†æˆSwaggerç”ŸæˆApiæ–‡æ¡£çš„å¢å¼ºè§£å†³æ–¹æ¡ˆ,å‰èº«æ˜¯swagger-bootstrap-ui,å–åkni4jæ˜¯å¸Œæœ›å®ƒèƒ½åƒä¸€æŠŠåŒ•é¦–ä¸€æ ·å°å·§,è½»é‡,å¹¶ä¸”åŠŸèƒ½å¼ºæ‚!

giteeåœ°å€ï¼šhttps://gitee.com/xiaoym/knife4j

å®˜æ–¹æ–‡æ¡£ï¼šhttps://doc.xiaominfo.com/

æ•ˆæœæ¼”ç¤ºï¼šhttp://knife4j.xiaominfo.com/doc.html

(2)æ ¸å¿ƒåŠŸèƒ½

è¯¥UIå¢å¼ºåŒ…ä¸»è¦åŒ…æ‹¬ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ï¼šæ–‡æ¡£è¯´æ˜ å’Œ åœ¨çº¿è°ƒè¯•

- æ–‡æ¡£è¯´æ˜ï¼šæ ¹æ®Swaggerçš„è§„èŒƒè¯´æ˜ï¼Œè¯¦ç»†åˆ—å‡ºæ¥å£æ–‡æ¡£çš„è¯´æ˜ï¼ŒåŒ…æ‹¬æ¥å£åœ°å€ã€ç±»å‹ã€è¯·æ±‚ç¤ºä¾‹ã€è¯·æ±‚å‚æ•°ã€å“åº”ç¤ºä¾‹ã€å“åº”å‚æ•°ã€å“åº”ç ç­‰ä¿¡æ¯ï¼Œä½¿ç”¨swagger-bootstrap-uièƒ½æ ¹æ®è¯¥æ–‡æ¡£è¯´æ˜ï¼Œå¯¹è¯¥æ¥å£çš„ä½¿ç”¨æƒ…å†µä¸€ç›®äº†ç„¶ã€‚
- åœ¨çº¿è°ƒè¯•ï¼šæä¾›åœ¨çº¿æ¥å£è”è°ƒçš„å¼ºå¤§åŠŸèƒ½ï¼Œè‡ªåŠ¨è§£æå½“å‰æ¥å£å‚æ•°,åŒæ—¶åŒ…å«è¡¨å•éªŒè¯ï¼Œè°ƒç”¨å‚æ•°å¯è¿”å›æ¥å£å“åº”å†…å®¹ã€headersã€Curlè¯·æ±‚å‘½ä»¤å®ä¾‹ã€å“åº”æ—¶é—´ã€å“åº”çŠ¶æ€ç ç­‰ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘è€…åœ¨çº¿è°ƒè¯•ï¼Œè€Œä¸å¿…é€šè¿‡å…¶ä»–æµ‹è¯•å·¥å…·æµ‹è¯•æ¥å£æ˜¯å¦æ­£ç¡®,ç®€ä»‹ã€å¼ºå¤§ã€‚
- ä¸ªæ€§åŒ–é…ç½®ï¼šé€šè¿‡ä¸ªæ€§åŒ–uié…ç½®é¡¹ï¼Œå¯è‡ªå®šä¹‰UIçš„ç›¸å…³æ˜¾ç¤ºä¿¡æ¯
- ç¦»çº¿æ–‡æ¡£ï¼šæ ¹æ®æ ‡å‡†è§„èŒƒï¼Œç”Ÿæˆçš„åœ¨çº¿markdownç¦»çº¿æ–‡æ¡£ï¼Œå¼€å‘è€…å¯ä»¥è¿›è¡Œæ‹·è´ç”Ÿæˆmarkdownæ¥å£æ–‡æ¡£ï¼Œé€šè¿‡å…¶ä»–ç¬¬ä¸‰æ–¹markdownè½¬æ¢å·¥å…·è½¬æ¢æˆhtmlæˆ–pdfï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ”¾å¼ƒswagger2markdownç»„ä»¶
- æ¥å£æ’åºï¼šè‡ª1.8.5åï¼Œuiæ”¯æŒäº†æ¥å£æ’åºåŠŸèƒ½ï¼Œä¾‹å¦‚ä¸€ä¸ªæ³¨å†ŒåŠŸèƒ½ä¸»è¦åŒ…å«äº†å¤šä¸ªæ­¥éª¤,å¯ä»¥æ ¹æ®swagger-bootstrap-uiæä¾›çš„æ¥å£æ’åºè§„åˆ™å®ç°æ¥å£çš„æ’åºï¼ŒstepåŒ–æ¥å£æ“ä½œï¼Œæ–¹ä¾¿å…¶ä»–å¼€å‘è€…è¿›è¡Œæ¥å£å¯¹æ¥

(3)å¿«é€Ÿé›†æˆ

- åœ¨heima-leadnews-commonæ¨¡å—ä¸­çš„`pom.xml`æ–‡ä»¶ä¸­å¼•å…¥`knife4j`çš„ä¾èµ–,å¦‚ä¸‹ï¼š

```xml
<dependency>
     <groupId>com.github.xiaoymin</groupId>
     <artifactId>knife4j-spring-boot-starter</artifactId>
</dependency>
```

- åˆ›å»ºSwaggeré…ç½®æ–‡ä»¶

åœ¨heima-leadnews-commonæ¨¡å—ä¸­æ–°å»ºé…ç½®ç±»

æ–°å»ºSwaggerçš„é…ç½®æ–‡ä»¶`SwaggerConfiguration.java`æ–‡ä»¶,åˆ›å»ºspringfoxæä¾›çš„Docketåˆ†ç»„å¯¹è±¡,ä»£ç å¦‚ä¸‹ï¼š

```java
package com.heima.common.knife4j;

import com.github.xiaoymin.knife4j.spring.annotations.EnableKnife4j;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Import;
import springfox.bean.validators.configuration.BeanValidatorPluginsConfiguration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@Configuration
@EnableSwagger2
@EnableKnife4j
@Import(BeanValidatorPluginsConfiguration.class)
public class Swagger2Configuration {

    @Bean(value = "defaultApi2")
    public Docket defaultApi2() {
        Docket docket=new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo())
                //åˆ†ç»„åç§°
                .groupName("1.0")
                .select()
                //è¿™é‡ŒæŒ‡å®šControlleræ‰«æåŒ…è·¯å¾„
                .apis(RequestHandlerSelectors.basePackage("com.heima"))
                .paths(PathSelectors.any())
                .build();
        return docket;
    }
    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("é»‘é©¬å¤´æ¡APIæ–‡æ¡£")
                .description("é»‘é©¬å¤´æ¡APIæ–‡æ¡£")
                .version("1.0")
                .build();
    }
}
```

ä»¥ä¸Šæœ‰ä¸¤ä¸ªæ³¨è§£éœ€è¦ç‰¹åˆ«è¯´æ˜ï¼Œå¦‚ä¸‹è¡¨ï¼š

| æ³¨è§£              | è¯´æ˜                                                         |
| ----------------- | ------------------------------------------------------------ |
| `@EnableSwagger2` | è¯¥æ³¨è§£æ˜¯Springfox-swaggeræ¡†æ¶æä¾›çš„ä½¿ç”¨Swaggeræ³¨è§£ï¼Œè¯¥æ³¨è§£å¿…é¡»åŠ  |
| `@EnableKnife4j`  | è¯¥æ³¨è§£æ˜¯`knife4j`æä¾›çš„å¢å¼ºæ³¨è§£,Uiæä¾›äº†ä¾‹å¦‚åŠ¨æ€å‚æ•°ã€å‚æ•°è¿‡æ»¤ã€æ¥å£æ’åºç­‰å¢å¼ºåŠŸèƒ½,å¦‚æœä½ æƒ³ä½¿ç”¨è¿™äº›å¢å¼ºåŠŸèƒ½å°±å¿…é¡»åŠ è¯¥æ³¨è§£ï¼Œå¦åˆ™å¯ä»¥ä¸ç”¨åŠ  |

- æ·»åŠ é…ç½®

åœ¨Spring.factoriesä¸­æ–°å¢é…ç½®

```java
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
  com.heima.common.exception.ExceptionCatch,\
  com.heima.common.knife4j.Swagger2Configuration, \
  com.heima.common.swagger.SwaggerConfiguration
```

- è®¿é—®

åœ¨æµè§ˆå™¨è¾“å…¥åœ°å€ï¼šhttp://127.0.0.1:51801/doc.html





### é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶æç¤º



### è¯·æ±‚é“¾è·¯



### é˜…è¯»æºç 



### è¿œç¨‹è°ƒè¯•



### åˆ†æ”¯ç®¡ç†

ä¸€èˆ¬æˆ‘ä»¬ä¸å»ºè®®å¤§å®¶ç›´æ¥åœ¨Devåˆ†æ”¯ç›´æ¥ä¿®æ”¹ä»£ç ã€‚åœ¨ä¼ä¸šä¸­éƒ½æœ‰ä¸€å¥—åˆ†æ”¯ç®¡ç†æœºåˆ¶ï¼Œç§°ä¸ºGitFlowï¼Œå¤§æ¦‚å¦‚å›¾æ‰€ç¤ºï¼š

![img](assets/20240302205540285.png)

è¯´æ˜ï¼š

- **Master**ï¼šä¸»åˆ†æ”¯ï¼Œç”¨äºæ­£å¼å‘å¸ƒçš„åˆ†æ”¯ã€‚ä¸å¯ç›´æ¥åŸºäºè¯¥åˆ†æ”¯æäº¤ã€‚åªæœ‰ç»è¿‡ä¸¥æ ¼å®¡æ ¸æµ‹è¯•åçš„Developæˆ–Hotfixåˆ†æ”¯å¯ä»¥åˆå¹¶åˆ°master
- **Develop**ï¼šå¼€å‘åˆ†æ”¯ï¼Œä»Masteråˆ›å»ºå¾—æ¥ã€‚åŠŸèƒ½å¼€å‘çš„åŸºç¡€åˆ†æ”¯ã€‚
- **Feature**ï¼šåŠŸèƒ½åˆ†æ”¯ï¼Œä»Developåˆ†æ”¯åˆ›å»ºå¾—æ¥ã€‚å¼€å‘æµ‹è¯•å®Œæˆåä¼šåˆå¹¶åˆ°Developåˆ†æ”¯ã€‚
- **Release**ï¼šé¢„å‘å¸ƒåˆ†æ”¯ï¼Œå½“Developä¸Šç§¯ç´¯äº†ä¸€å®šçš„åŠŸèƒ½ç‰¹æ€§åï¼Œä»Developåˆ†æ”¯åˆ›å»ºä¸€ä¸ªReleaseåˆ†æ”¯ï¼Œåšä¸€äº›å‘å¸ƒå‰çš„å‡†å¤‡å·¥ä½œï¼Œä¸å¯å¼€å‘åŠŸèƒ½ã€‚æœ€ç»ˆåˆå¹¶åˆ°Masteråˆ†æ”¯å’ŒDevelopåˆ†æ”¯ã€‚
- **Hotfix**ï¼šçƒ­ä¿®å¤åˆ†æ”¯ï¼Œå½“Masterå‡ºç°ç´§æ€¥BUGæ—¶ï¼ŒåŸºäºMasterä¸´æ—¶åˆ›å»ºçš„åˆ†æ”¯ï¼Œä¿®å¤å®Œæˆååˆå¹¶åˆ°Developå’ŒMasteråˆ†æ”¯ã€‚

åœ¨å’±ä»¬é¡¹ç›®ä¸­ï¼Œmasteråˆ†æ”¯ç”¨æ¥ç»™å¤§å®¶æä¾›å®Œæ•´ç‰ˆæœ¬ä»£ç äº†ï¼Œè€Œlesson-initåˆ†æ”¯ä½œä¸ºåˆå§‹åŒ–åˆ†æ”¯ã€‚å› æ­¤ä¸€èˆ¬ä¸ä½¿ç”¨masteråˆ†æ”¯ï¼Œè€Œæ˜¯æŠŠlesson-initå½“åšmasteråˆ†æ”¯æ¥ç”¨ã€‚å¼€å‘ç”¨çš„devåˆ†æ”¯å°±ç­‰äºGitFlowä¸­çš„Developåˆ†æ”¯ã€‚

å› æ­¤ï¼Œè¿™é‡Œå»ºè®®å¤§å®¶åœ¨devåˆ†æ”¯åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªHotfixåˆ†æ”¯ï¼Œç”¨ä»¥ä¿®æ”¹BUGï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤æ¥åˆ›å»ºè¯¥åˆ†æ”¯ï¼š

```sh
git checkout -b hotfix-delete-order-error
```



### æµ‹è¯•éƒ¨ç½²



## ç”¨æˆ·ç™»å½•

### éœ€æ±‚åˆ†æ

![image-20240111143042938](assets/image-20240111143042938.png)

- ç”¨æˆ·ç‚¹å‡»**å¼€å§‹ä½¿ç”¨**

  ç™»å½•åçš„ç”¨æˆ·æƒé™è¾ƒå¤§ï¼Œå¯ä»¥æŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥æ“ä½œï¼ˆç‚¹èµï¼Œå…³æ³¨ï¼Œè¯„è®ºï¼‰

- ç”¨æˆ·ç‚¹å‡»**ä¸ç™»å½•ï¼Œå…ˆçœ‹çœ‹**

  æ¸¸å®¢åªæœ‰æŸ¥çœ‹çš„æƒé™



### æ•°æ®ç»“æ„

å…³äºappç«¯ç”¨æˆ·ç›¸å…³çš„å†…å®¹è¾ƒå¤šï¼Œå¯ä»¥å•ç‹¬è®¾ç½®ä¸€ä¸ªåº“ leadnews_user

![image-20240111143059751](assets/image-20240111143059751.png)

ç™»å½•éœ€è¦ç”¨åˆ°çš„æ˜¯ap_userè¡¨ï¼Œè¡¨ç»“æ„å¦‚ä¸‹ï¼š

![image-20240302210750625](assets/image-20240302210750625.png)
æ‰§è¡Œ leadnews_user çš„ SQL è„šæœ¬

```sql
CREATE DATABASE IF NOT EXISTS leadnews_user DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE leadnews_user;
SET NAMES utf8;


SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for ap_user
-- ----------------------------
DROP TABLE IF EXISTS `ap_user`;
CREATE TABLE `ap_user` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
  `salt` varchar(32) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'å¯†ç ã€é€šä¿¡ç­‰åŠ å¯†ç›',
  `name` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'ç”¨æˆ·å',
  `password` varchar(32) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'å¯†ç ,md5åŠ å¯†',
  `phone` varchar(11) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'æ‰‹æœºå·',
  `image` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'å¤´åƒ',
  `sex` tinyint(1) unsigned DEFAULT NULL COMMENT 'æ€§åˆ«ï¼š0 ç”· ï¼›1 å¥³ï¼›æœªçŸ¥',
  `is_certification` tinyint(1) unsigned DEFAULT NULL COMMENT 'æ˜¯å¦è®¤è¯ï¼š0 æœªï¼›1 æ˜¯',
  `is_identity_authentication` tinyint(1) DEFAULT NULL COMMENT 'æ˜¯å¦èº«ä»½è®¤è¯',
  `status` tinyint(1) unsigned DEFAULT NULL COMMENT 'çŠ¶æ€ï¼š0 æ­£å¸¸ï¼›1é”å®š',
  `flag` tinyint(1) unsigned DEFAULT NULL COMMENT 'ç”¨æˆ·ç±»å‹ï¼š0 æ™®é€šç”¨æˆ·ï¼›1 è‡ªåª’ä½“äººï¼›2 å¤§V',
  `created_time` datetime DEFAULT NULL COMMENT 'æ³¨å†Œæ—¶é—´',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='APPç”¨æˆ·ä¿¡æ¯è¡¨';

-- ----------------------------
-- Records of ap_user
-- ----------------------------
INSERT INTO `ap_user` VALUES ('1', 'abc', 'zhangsan', 'abc', '13511223453', null, '1', null, null, '1', '1', '2020-03-19 23:22:07');
INSERT INTO `ap_user` VALUES ('2', 'abc', 'lisi', 'abc', '13511223454', '', '1', null, null, '1', '1', '2020-03-19 23:22:07');
INSERT INTO `ap_user` VALUES ('3', 'sdsa', 'wangwu', 'wangwu', '13511223455', null, null, null, null, null, '1', null);
INSERT INTO `ap_user` VALUES ('4', '123abc', 'admin', '81e158e10201b6d7aee6e35eaf744796', '13511223456', null, '1', null, null, '1', '1', '2020-03-30 16:36:32');
INSERT INTO `ap_user` VALUES ('5', '123', 'suwukong', 'suwukong', '13511223458', null, '1', null, null, '1', '1', '2020-08-01 11:09:57');
INSERT INTO `ap_user` VALUES ('6', null, null, null, null, null, null, null, null, null, null, null);

-- ----------------------------
-- Table structure for ap_user_fan
-- ----------------------------
DROP TABLE IF EXISTS `ap_user_fan`;
CREATE TABLE `ap_user_fan` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
  `user_id` int(11) unsigned DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
  `fans_id` int(11) unsigned DEFAULT NULL COMMENT 'ç²‰ä¸ID',
  `fans_name` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'ç²‰ä¸æ˜µç§°',
  `level` tinyint(1) unsigned DEFAULT NULL COMMENT 'ç²‰ä¸å¿ å®åº¦ï¼š0 æ­£å¸¸ï¼›1 æ½œåŠ›è‚¡ï¼›2 å‹‡å£«ï¼›3 é“æ†ï¼›4 è€é“',
  `created_time` datetime DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `is_display` tinyint(1) unsigned DEFAULT NULL COMMENT 'æ˜¯å¦å¯è§æˆ‘åŠ¨æ€',
  `is_shield_letter` tinyint(1) unsigned DEFAULT NULL COMMENT 'æ˜¯å¦å±è”½ç§ä¿¡',
  `is_shield_comment` tinyint(1) unsigned DEFAULT NULL COMMENT 'æ˜¯å¦å±è”½è¯„è®º',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='APPç”¨æˆ·ç²‰ä¸ä¿¡æ¯è¡¨';

-- ----------------------------
-- Records of ap_user_fan
-- ----------------------------

-- ----------------------------
-- Table structure for ap_user_follow
-- ----------------------------
DROP TABLE IF EXISTS `ap_user_follow`;
CREATE TABLE `ap_user_follow` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
  `user_id` int(11) unsigned DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
  `follow_id` int(11) unsigned DEFAULT NULL COMMENT 'å…³æ³¨ä½œè€…ID',
  `follow_name` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'ç²‰ä¸æ˜µç§°',
  `level` tinyint(1) unsigned DEFAULT NULL COMMENT 'å…³æ³¨åº¦ï¼š0 å¶å°”æ„Ÿå…´è¶£ï¼›1 ä¸€èˆ¬ï¼›2 ç»å¸¸ï¼›3 é«˜åº¦',
  `is_notice` tinyint(1) unsigned DEFAULT NULL COMMENT 'æ˜¯å¦åŠ¨æ€é€šçŸ¥',
  `created_time` datetime DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='APPç”¨æˆ·å…³æ³¨ä¿¡æ¯è¡¨';

-- ----------------------------
-- Records of ap_user_follow
-- ----------------------------

-- ----------------------------
-- Table structure for ap_user_realname
-- ----------------------------
DROP TABLE IF EXISTS `ap_user_realname`;
CREATE TABLE `ap_user_realname` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®',
  `user_id` int(11) unsigned DEFAULT NULL COMMENT 'è´¦å·ID',
  `name` varchar(20) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT 'ç”¨æˆ·åç§°',
  `idno` varchar(20) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'èµ„æºåç§°',
  `font_image` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'æ­£é¢ç…§ç‰‡',
  `back_image` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'èƒŒé¢ç…§ç‰‡',
  `hold_image` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'æ‰‹æŒç…§ç‰‡',
  `live_image` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'æ´»ä½“ç…§ç‰‡',
  `status` tinyint(1) unsigned DEFAULT NULL COMMENT 'çŠ¶æ€ï¼š0 åˆ›å»ºä¸­ï¼›1 å¾…å®¡æ ¸ï¼›2 å®¡æ ¸å¤±è´¥ï¼›9 å®¡æ ¸é€šè¿‡',
  `reason` varchar(50) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'æ‹’ç»åŸå› ',
  `created_time` datetime DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `submited_time` datetime DEFAULT NULL COMMENT 'æäº¤æ—¶é—´',
  `updated_time` datetime DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='APPå®åè®¤è¯ä¿¡æ¯è¡¨';

-- ----------------------------
-- Records of ap_user_realname
-- ----------------------------
INSERT INTO `ap_user_realname` VALUES ('1', '1', 'zhangsan', '512335455602781278', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbHSAQlqFAAXIZNzAq9E126.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbF6AR16RAAZB2e1EsOg460.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbDeAH2qoAAbD_WiUJfk745.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9ba9qANVEdAAS25KJlEVE291.jpg', '9', '', '2019-07-30 14:34:28', '2019-07-30 14:34:30', '2019-07-12 06:48:04');
INSERT INTO `ap_user_realname` VALUES ('2', '2', 'lisi', '512335455602781279', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbHSAQlqFAAXIZNzAq9E126.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbF6AR16RAAZB2e1EsOg460.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbDeAH2qoAAbD_WiUJfk745.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9ba9qANVEdAAS25KJlEVE291.jpg', '1', '', '2019-07-11 17:21:18', '2019-07-11 17:21:20', '2019-07-12 06:48:04');
INSERT INTO `ap_user_realname` VALUES ('3', '3', 'wangwu6666', '512335455602781276', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbHSAQlqFAAXIZNzAq9E126.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbF6AR16RAAZB2e1EsOg460.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbDeAH2qoAAbD_WiUJfk745.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9ba9qANVEdAAS25KJlEVE291.jpg', '9', '', '2019-07-11 17:21:18', '2019-07-11 17:21:20', '2019-07-12 06:48:04');
INSERT INTO `ap_user_realname` VALUES ('5', '5', 'suwukong', '512335455602781279', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbHSAQlqFAAXIZNzAq9E126.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbF6AR16RAAZB2e1EsOg460.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9bbDeAH2qoAAbD_WiUJfk745.jpg', 'http://161.189.111.227/group1/M00/00/00/rBFwgF9ba9qANVEdAAS25KJlEVE291.jpg', '1', '', '2020-08-01 11:10:31', '2020-08-01 11:10:34', '2020-08-01 11:10:36');
```

<br/>

### æœåŠ¡æ­å»º

`heima-leadnews-service` ä¾èµ–ä¿¡æ¯è¯´æ˜

![image-20240302211502869](assets/image-20240302211502869.png)

<br/>

åœ¨ `heima-leadnews-service` ä¸‹åˆ›å»ºå·¥ç¨‹ `heima-leadnews-user`

![image-20240303160018768](assets/image-20240303160018768.png)

åœ¨å¤©æœºå­¦å ‚é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Mybatisä½œä¸ºæŒä¹…å±‚æ¡†æ¶ï¼Œå¹¶ä¸”å¼•å…¥äº†MybatisPlusæ¥ç®€åŒ–å¼€å‘ã€‚å› æ­¤ï¼Œåœ¨åˆ›å»ºæ®åº“ä»¥åï¼Œå°±éœ€è¦åˆ›å»ºå¯¹åº”çš„å®ä½“ç±»ã€mapperã€serviceç­‰ã€‚

è¿™äº›ä»£ç æ ¼å¼å›ºå®šï¼Œç¼–å†™èµ·æ¥åˆæ¯”è¾ƒè´¹æ—¶ã€‚å¥½åœ¨IDEAä¸­æä¾›äº†ä¸€ä¸ªMPæ’ä»¶ï¼Œå¯ä»¥ç”Ÿæˆè¿™äº›é‡å¤ä»£ç ï¼š

![image-20240303160210260](assets/image-20240303160210260.png)

å®‰è£…å®Œæˆä»¥åï¼Œæˆ‘ä»¬åœ¨èœå•æ çš„ Other ä¸‹çš„ Config Database ä¸­é…ç½®ä¸€ä¸‹æ•°æ®åº“åœ°å€ï¼š

![image-20240303161235199](assets/image-20240303161235199.png)

ç„¶ååœ¨ Other ä¸‹çš„ Code Generatorä¸‹è®¾ç½®é¡¹ç›®åç§°ï¼ŒåŒ…åç§°

![image-20240303162505102](assets/image-20240303162505102.png)

ç‚¹å‡» `code generator`  è‡ªåŠ¨ç”Ÿæˆä»£ç 

<div align="center">
  <img src="./assets/image-20240303164848058.png" alt="image-20240303164848058" style="zoom:40%;" align=center  />
</div>

ç„¶åæ˜¯é…ç½®æ–‡ä»¶ï¼š`bootstrap.yml`

```YAML
server:
  port: 51801
spring:
  profiles:
    active: dev
  application:
    name: leadnews-user
  cloud:
    nacos:
      config:
        file-extension: yaml
        shared-configs:
          - data-id: shared-mybatis.yaml

hmtt:
  jdbc:
    database: leadnews_user

# è®¾ç½®Mapperæ¥å£æ‰€å¯¹åº”çš„XMLæ–‡ä»¶ä½ç½®ï¼Œå¦‚æœä½ åœ¨Mapperæ¥å£ä¸­æœ‰è‡ªå®šä¹‰æ–¹æ³•ï¼Œéœ€è¦è¿›è¡Œè¯¥é…ç½®
mybatis-plus:
  mapper-locations: classpath*:mapper/*.xml
  # è®¾ç½®åˆ«ååŒ…æ‰«æè·¯å¾„ï¼Œé€šè¿‡è¯¥å±æ€§å¯ä»¥ç»™åŒ…ä¸­çš„ç±»æ³¨å†Œåˆ«å
  type-aliases-package: com.heima.model.user.pojos
```

æ¥ç€æ˜¯`bootstrap-dev.yml`:

```YAML
spring:
  cloud:
    nacos:
      server-addr: 192.168.150.102:8848
      discovery:
        namespace: dbf4a6ae-0292-4e73-ae38-0df835b183c1
        group: DEFAULT_GROUP
        ip: 192.168.150.102
logging:
  level:
    com.heima: debug
```

ç„¶åæ˜¯`bootstrap-local.yml`:

```YAML
spring:
  cloud:
    nacos:
      server-addr: 192.168.150.102:8848
      discovery:
        namespace: dbf4a6ae-0292-4e73-ae38-0df835b183c1
        group: DEFAULT_GROUP
        ip: 192.168.150.1
logging:
  level:
    com.heima: debug
```

æ–°å»ºä¸€ä¸ªå¯åŠ¨ç±»ï¼š

```Java
package com.heima.user;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;


@SpringBootApplication
@EnableDiscoveryClient
@MapperScan("com.heima.user.mapper")
public class UserApplication {

    public static void main(String[] args) {
        SpringApplication.run(UserApplication.class,args);
    }
}
```

å°† pojos ä¸‹çš„å®ä½“ç±»ç§»åŠ¨åˆ° `heima-leadnews-model` ä¸‹ï¼Œæœ€ç»ˆç›®å½•ç»“æ„å¦‚ä¸‹

<div align="center">
  <img src="./assets/image-20240303170124080.png" alt="image-20240303170124080" style="zoom:30%;" />
</div>

ä¸ºäº†æ–¹ä¾¿æœ¬åœ°å¯åŠ¨æµ‹è¯•ï¼Œæœ€åç»™ `heima-leadnews-user` æ·»åŠ ä¸€ä¸ªSpringBootå¯åŠ¨é¡¹ï¼š

![image-20240303170225863](assets/image-20240303170225863.png)

### æ¥å£å®šä¹‰

|          | **è¯´æ˜**                 |
| -------- | ------------------------ |
| æ¥å£è·¯å¾„ | /api/v1/login/login_auth |
| è¯·æ±‚æ–¹å¼ | POST                     |
| å‚æ•°     | LoginDto                 |
| å“åº”ç»“æœ | ResponseResult           |

```java
@Data
public class LoginDto {

    /**
     * æ‰‹æœºå·
     */
    @ApiModelProperty(value="æ‰‹æœºå·",required = true)
    private String phone;

    /**
     * å¯†ç 
     */
    @ApiModelProperty(value="å¯†ç ",required = true)
    private String password;
}
```



### æ€è·¯åˆ†æ

MD5æ˜¯ä¸å¯é€†åŠ å¯†ï¼Œä½†æ˜¯ MD5 ç›¸åŒçš„å¯†ç æ¯æ¬¡åŠ å¯†éƒ½ä¸€æ ·ï¼Œä¸å¤ªå®‰å…¨ï¼Œå¯ä»¥æš´åŠ›ç ´è§£ã€‚æ‰€ä»¥åœ¨ MD5 çš„åŸºç¡€ä¸Šæ‰‹åŠ¨åŠ ç› ï¼ˆsaltï¼‰ å¤„ç†ã€‚

**æ³¨å†Œ**

![image-20240302210951019](assets/image-20240302210951019.png)

<br/>

**ç™»å½•**

![image-20240302211219772](assets/image-20240302211219772.png)

å…·ä½“æµç¨‹

![image-20240303172407119](assets/image-20240303172407119.png)

1. ç”¨æˆ·è¾“å…¥äº†ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•ï¼Œæ ¡éªŒæˆåŠŸåè¿”å›jwt(åŸºäºå½“å‰ç”¨æˆ·çš„idç”Ÿæˆ)
2. ç”¨æˆ·æ¸¸å®¢ç™»å½•ï¼Œç”Ÿæˆjwtè¿”å›(åŸºäºé»˜è®¤å€¼0ç”Ÿæˆ)



### å…·ä½“å®ç°

:::details

åœ¨ `heima-leadnews-model` ä¸‹åˆ›å»º `user.dtos` åŒ…

```java
package com.heima.model.user.dtos;

import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

@Data
public class LoginDto {

    /**
     * æ‰‹æœºå·
     */
    @ApiModelProperty(value="æ‰‹æœºå·",required = true)
    private String phone;

    /**
     * å¯†ç 
     */
    @ApiModelProperty(value="å¯†ç ",required = true)
    private String password;
}
```

<br/>

**æ§åˆ¶å±‚**

```java
package com.heima.user.controller.v1;

import com.heima.model.common.dtos.ResponseResult;
import com.heima.model.user.dtos.LoginDto;
import com.heima.user.service.ApUserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/api/v1/login")
public class ApUserLoginController {

    @Autowired
    private ApUserService apUserService;

    @PostMapping("/login_auth")
    public ResponseResult login(@RequestBody LoginDto dto) {
        return apUserService.login(dto);
    }
}
```

<br/>

**ä¸šåŠ¡å±‚**

```java
package com.heima.user.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.heima.model.common.dtos.ResponseResult;
import com.heima.model.user.dtos.LoginDto;
import com.heima.model.user.pojos.ApUser;

public interface ApUserService extends IService<ApUser>{

    /**
     * appç«¯ç™»å½•
     * @param dto
     * @return
     */
    public ResponseResult login(LoginDto dto);
   
}
```

<br/>

**å®ç°ç±»**

```java
package com.heima.user.service.impl;

import com.baomidou.mybatisplus.core.toolkit.Wrappers;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.heima.model.common.dtos.ResponseResult;
import com.heima.model.common.enums.AppHttpCodeEnum;
import com.heima.model.user.dtos.LoginDto;
import com.heima.model.user.pojos.ApUser;
import com.heima.user.mapper.ApUserMapper;
import com.heima.user.service.IApUserService;
import com.heima.utils.common.AppJwtUtil;
import org.apache.commons.lang3.StringUtils;
import org.springframework.stereotype.Service;
import org.springframework.util.DigestUtils;

import java.util.HashMap;
import java.util.Map;


@Service
public class ApUserServiceImpl extends ServiceImpl<ApUserMapper, ApUser> implements IApUserService {

    @Override
    public ResponseResult login(LoginDto dto) {

        //1.æ­£å¸¸ç™»å½•ï¼ˆæ‰‹æœºå·+å¯†ç ç™»å½•ï¼‰
        if (!StringUtils.isBlank(dto.getPhone()) && !StringUtils.isBlank(dto.getPassword())) {
            //1.1æŸ¥è¯¢ç”¨æˆ·
            ApUser apUser = getOne(Wrappers.<ApUser>lambdaQuery().eq(ApUser::getPhone, dto.getPhone()));
            if (apUser == null) {
                return ResponseResult.errorResult(AppHttpCodeEnum.DATA_NOT_EXIST,"ç”¨æˆ·ä¸å­˜åœ¨");
            }

            //1.2 æ¯”å¯¹å¯†ç 
            String salt = apUser.getSalt();
            String pswd = dto.getPassword();
            pswd = DigestUtils.md5DigestAsHex((pswd + salt).getBytes());
            if (!pswd.equals(apUser.getPassword())) {
                return ResponseResult.errorResult(AppHttpCodeEnum.LOGIN_PASSWORD_ERROR);
            }
            //1.3 è¿”å›æ•°æ®  jwt
            Map<String, Object> map = new HashMap<>();
            map.put("token", AppJwtUtil.getToken(apUser.getId().longValue()));
            apUser.setSalt("");
            apUser.setPassword("");
            map.put("user", apUser);
            return ResponseResult.okResult(map);
        } else {
            //2.æ¸¸å®¢  åŒæ ·è¿”å›token  id = 0
            Map<String, Object> map = new HashMap<>();
            map.put("token", AppJwtUtil.getToken(0l));
            return ResponseResult.okResult(map);
        }
    }
}
```

:::

<br/>



## ç½‘å…³æœåŠ¡

ç½‘å…³å·¥ä½œæµç¨‹

![image-20240111143236160](assets/image-20240111143236160.png)

é¡¹ç›®ä¸­ç½‘å…³çš„æœåŠ¡å·¥ç¨‹ç»“æ„

![image-20240111143245290](assets/image-20240111143245290.png)

<br/>

### åˆ›å»ºç½‘å…³æœåŠ¡

é¡¹ç›®ä¸­ç½‘å…³çš„æœåŠ¡å·¥ç¨‹åœ¨ `heima-leadnews-gateway` å¯¼å…¥ä»¥ä¸‹ä¾èµ–

**pomæ–‡ä»¶**

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-gateway</artifactId>
    </dependency>
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
    </dependency>
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
    </dependency>
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt</artifactId>
    </dependency>
    <dependency>
        <groupId>javax.xml.bind</groupId>
        <artifactId>jaxb-api</artifactId>
        <version>2.3.0</version>
    </dependency>
    <dependency>
        <groupId>com.sun.xml.bind</groupId>
        <artifactId>jaxb-impl</artifactId>
        <version>2.3.0</version>
    </dependency>
    <dependency>
        <groupId>com.sun.xml.bind</groupId>
        <artifactId>jaxb-core</artifactId>
        <version>2.3.0</version>
    </dependency>
    <dependency>
        <groupId>javax.activation</groupId>
        <artifactId>activation</artifactId>
        <version>1.1.1</version>
    </dependency>
</dependencies>
```

<br/>

åœ¨ `heima-leadnews-gateway` ä¸‹åˆ›å»º `heima-leadnews-app-gateway` å¾®æœåŠ¡

![image-20240303202432138](assets/image-20240303202432138.png)

**å¼•å¯¼ç±»**

```java
package com.heima.app.gateway;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient  //å¼€å¯æ³¨å†Œä¸­å¿ƒ
public class AppGatewayApplication {

    public static void main(String[] args) {
        SpringApplication.run(AppGatewayApplication.class,args);
    }
}
```

<br/>

**é…ç½®å†…å®¹**

bootstrap.yml

```yaml
server:
  port: 51601
  tomcat:
    uri-encoding: UTF-8
spring:
  profiles:
    active: dev
  application:
    name: leadnews-app-gateway
  cloud:
    gateway:
      globalcors:
        add-to-simple-url-handler-mapping: true
        corsConfigurations:
          '[/**]':
            allowedHeaders: "*"
            allowedOrigins: "*"
            allowedMethods:
              - GET
              - POST
              - DELETE
              - PUT
              - OPTION
      routes:
        # ç”¨æˆ·å¾®æœåŠ¡
        - id: user
          uri: lb://leadnews-user
          predicates:
            - Path=/user/**
          filters:
            - StripPrefix= 1
```

bootstrap-dev.yml

```yml
spring:
  cloud:
    nacos:
      server-addr: 192.168.150.102:8848
      discovery:
        namespace: dbf4a6ae-0292-4e73-ae38-0df835b183c1
        group: DEFAULT_GROUP
        ip: 192.168.150.102
logging:
  level:
    com.heima: debug
```

bootstrap-local.yml

```yml
spring:
  cloud:
    nacos:
      server-addr: 192.168.150.102:8848
      discovery:
        namespace: dbf4a6ae-0292-4e73-ae38-0df835b183c1
        group: DEFAULT_GROUP
        ip: 192.168.150.1
logging:
  level:
    com.heima: debug
```

ç¯å¢ƒæ­å»ºå®Œæˆä»¥åï¼Œå¯åŠ¨é¡¹ç›®ç½‘å…³å’Œç”¨æˆ·ä¸¤ä¸ªæœåŠ¡ï¼Œä½¿ç”¨postmanè¿›è¡Œæµ‹è¯•

è¯·æ±‚åœ°å€ï¼šhttp://localhost:51601/user/api/v1/login/login_auth

<br/>

### å®ç°å…¨å±€è¿‡æ»¤å™¨

**å…·ä½“æµç¨‹**

![image-20240302213022960](assets/image-20240302213022960.png)

**æ€è·¯åˆ†æ**

1. ç”¨æˆ·è¿›å…¥ç½‘å…³å¼€å§‹ç™»é™†ï¼Œç½‘å…³è¿‡æ»¤å™¨è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯ç™»å½•ï¼Œåˆ™è·¯ç”±åˆ°åå°ç®¡ç†å¾®æœåŠ¡è¿›è¡Œç™»å½•
2. ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œåå°ç®¡ç†å¾®æœåŠ¡ç­¾å‘ JWT TOKEN ä¿¡æ¯è¿”å›ç»™ç”¨æˆ·
3. ç”¨æˆ·å†æ¬¡è¿›å…¥ç½‘å…³å¼€å§‹è®¿é—®ï¼Œç½‘å…³è¿‡æ»¤å™¨æ¥æ”¶ç”¨æˆ·æºå¸¦çš„ TOKEN
4. ç½‘å…³è¿‡æ»¤å™¨è§£æ TOKEN ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æƒé™ï¼Œå¦‚æœæœ‰ï¼Œåˆ™æ”¾è¡Œï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›æœªè®¤è¯é”™è¯¯

<br/>

:::details å…·ä½“å®ç°

ç¬¬ä¸€ï¼šåœ¨è®¤è¯è¿‡æ»¤å™¨ä¸­éœ€è¦ç”¨åˆ° JWT çš„è§£æï¼Œæ‰€ä»¥éœ€è¦æŠŠ `heima-leadnews-utils` çš„ AppJwtUtil å·¥å…·ç±»æ‹·è´ä¸€ä»½åˆ°ç½‘å…³å¾®æœåŠ¡

ç¬¬äºŒï¼šåœ¨ç½‘å…³å¾®æœåŠ¡ä¸­æ–°å»ºå…¨å±€è¿‡æ»¤å™¨

```java
package com.heima.app.gateway.filter;


import com.heima.app.gateway.util.AppJwtUtil;
import io.jsonwebtoken.Claims;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang.StringUtils;
import org.springframework.cloud.gateway.filter.GatewayFilterChain;
import org.springframework.cloud.gateway.filter.GlobalFilter;
import org.springframework.core.Ordered;
import org.springframework.http.HttpStatus;
import org.springframework.http.server.reactive.ServerHttpRequest;
import org.springframework.http.server.reactive.ServerHttpResponse;
import org.springframework.stereotype.Component;
import org.springframework.web.server.ServerWebExchange;
import reactor.core.publisher.Mono;

@Component
@Slf4j
public class AuthorizeFilter implements Ordered, GlobalFilter {
    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        //1.è·å–requestå’Œresponseå¯¹è±¡
        ServerHttpRequest request = exchange.getRequest();
        ServerHttpResponse response = exchange.getResponse();

        //2.åˆ¤æ–­æ˜¯å¦æ˜¯ç™»å½•
        if(request.getURI().getPath().contains("/login")){
            //æ”¾è¡Œ
            return chain.filter(exchange);
        }


        //3.è·å–token
        String token = request.getHeaders().getFirst("token");

        //4.åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨
        if(StringUtils.isBlank(token)){
            response.setStatusCode(HttpStatus.UNAUTHORIZED);
            return response.setComplete();
        }

        //5.åˆ¤æ–­tokenæ˜¯å¦æœ‰æ•ˆ
        try {
            Claims claimsBody = AppJwtUtil.getClaimsBody(token);
            //æ˜¯å¦æ˜¯è¿‡æœŸ
            int result = AppJwtUtil.verifyToken(claimsBody);
            if(result == 1 || result  == 2){
                response.setStatusCode(HttpStatus.UNAUTHORIZED);
                return response.setComplete();
            }
        }catch (Exception e){
            e.printStackTrace();
            response.setStatusCode(HttpStatus.UNAUTHORIZED);
            return response.setComplete();
        }

        //6.æ”¾è¡Œ
        return chain.filter(exchange);
    }

    /**
     * ä¼˜å…ˆçº§è®¾ç½®  å€¼è¶Šå°  ä¼˜å…ˆçº§è¶Šé«˜
     * @return
     */
    @Override
    public int getOrder() {
        return 0;
    }
}
```

:::

<br/>

**å®ç°æµ‹è¯•**

åœ¨æœ¬åœ°å¯åŠ¨

å¯åŠ¨useræœåŠ¡ï¼Œç»§ç»­è®¿é—®å…¶ä»–å¾®æœåŠ¡ï¼Œä¼šæç¤ºéœ€è¦è®¤è¯æ‰èƒ½è®¿é—®ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦åœ¨headsä¸­è®¾ç½®è®¾ç½®tokenæ‰èƒ½æ­£å¸¸è®¿é—®ã€‚
