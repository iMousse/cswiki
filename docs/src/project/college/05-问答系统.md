Day05-é—®ç­”ç³»ç»Ÿ
==============

ä¸€ä¸ªäººå­¦ä¹ æ€»æ˜¯å­¤ç‹¬çš„ï¼Œè€Œä¸”å¾€å¾€éš¾ä»¥åšæŒã€‚

æ‰€ä»¥æˆ‘ä»¬çš„ç³»ç»Ÿè®¾è®¡äº†ä¸€äº›å­¦ä¹ è¾…åŠ©çš„åŠŸèƒ½ï¼Œå¢å¼ºå­¦ä¹ çš„æ°›å›´æ„Ÿã€‚åŒ…æ‹¬ï¼š

- äº’åŠ¨é—®ç­”ç³»ç»Ÿ
- å­¦ä¹ ç¬”è®°ç³»ç»Ÿ
- å­¦ä¹ è¯„æµ‹ç³»ç»Ÿ
- å­¦ä¹ ç§¯åˆ†ç³»ç»Ÿ
- æ¦œå•æ’åç³»ç»Ÿ

<br/>

é€šè¿‡è¿™å¥—ç³»ç»Ÿè®©ç”¨æˆ·æ„Ÿè§‰åˆ°è‡ªå·±ä¸æ˜¯ä¸€ä¸ªäººåœ¨å­¦ä¹ ï¼Œæœ‰äº’åŠ©ã€æœ‰ç«äº‰ã€æœ‰è¯„æµ‹ï¼Œåˆºæ¿€ç”¨æˆ·æŒç»­å­¦ä¹ ï¼Œæå‡å­¦ä¹ æ•ˆæœå’Œç”¨æˆ·ç²˜åº¦ã€‚

<br/>

è¿™å¥—ç³»ç»Ÿä¸­åŒ…å«äº†å¾ˆå¤šä¼ä¸šä¸­éå¸¸å®ç”¨çš„è§£å†³æ–¹æ¡ˆå’ŒæŠ€æœ¯æ‰‹æ®µï¼Œå¯ä»¥ä¸ºå¤§å®¶ä»¥åçš„å·¥ä½œæä¾›å¾ˆå¤§å¸®åŠ©ã€‚ä¾‹å¦‚ï¼š

- äº’åŠ¨é—®ç­”åŠŸèƒ½ï¼šåœ¨ç¤¾äº¤ç±»å‹ã€å­¦ä¹ ç±»å‹çš„äº’è”ç½‘é¡¹ç›®ä¸­éƒ½æœ‰ç”¨åˆ°
- ç‚¹èµåŠŸèƒ½ï¼šç”µå•†ã€ç¤¾äº¤ã€å­¦ä¹ ç­‰ç­‰éƒ½ä¼šç”¨åˆ°
- ç§¯åˆ†ç³»ç»Ÿï¼šç”µå•†ã€ç¤¾äº¤ã€å­¦ä¹ ç­‰é¡¹ç›®ä¸­ç”¨åˆ°
- æ’è¡Œæ¦œç³»ç»Ÿï¼šæ¸¸æˆã€ç¤¾äº¤ã€å­¦ä¹ ç­‰é¡¹ç›®ä¸­éƒ½æœ‰ç”¨åˆ°
- å­¦ä¹ è¯„æµ‹ç³»ç»Ÿï¼šè€ƒè¯•ã€å­¦ä¹ ç±»å‹çš„é¡¹ç›®ä¼šç”¨åˆ°

åœ¨è¿™äº›è§£å†³æ–¹æ¡ˆä¸­ä½ èƒ½è§£é”Redisã€MQç­‰çƒ­é—¨ä¸­é—´ä»¶çš„å„ç§å„æ ·çš„ä½¿ç”¨æ–¹å¼ã€‚

<br/>

ä»Šå¤©æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹äº’åŠ¨é—®ç­”ç³»ç»Ÿçš„è®¾è®¡ä¸å®ç°ã€‚



## éœ€æ±‚åˆ†æ

ç»è¿‡å‡ å¤©å­¦ä¹ ï¼Œç›¸ä¿¡å¤§å®¶å¯¹äºä¸šåŠ¡å¼€å‘å·²ç»è½»è½¦ç†Ÿè·¯äº†ï¼Œæ•´ä½“æµç¨‹ä¸ä»¥å¾€ä¸€æ ·ï¼š

- éœ€æ±‚å’ŒåŸå‹å›¾åˆ†æ
- æ¥å£ç»Ÿè®¡å’Œè®¾è®¡
- æ•°æ®ç»“æ„è®¾è®¡
- æ¥å£çš„å®ç°

<br/>

### äº§å“åŸå‹

æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹ä¸äº’åŠ¨é—®ç­”æœ‰å…³çš„åŸå‹é¡µé¢ã€‚

<br/>

#### è¯¾ç¨‹è¯¦æƒ…é¡µ

åœ¨ç”¨æˆ·å·²ç»ç™»å½•çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç”¨æˆ·è´­ä¹°äº†è¯¾ç¨‹ï¼Œåœ¨è¯¾ç¨‹è¯¦æƒ…é¡µå¯ä»¥çœ‹åˆ°ä¸€ä¸ªäº’åŠ¨é—®ç­”çš„é€‰é¡¹å¡ï¼š

![img](./assets/20230725153710888.jpg)

é—®ç­”é€‰é¡¹å¡å¦‚ä¸‹ï¼š

![img](./assets/20230725153709570.jpg)

<br/>

:::warning ğŸ’¡ é—®ç­”åˆ—è¡¨

- é—®ç­”åˆ—è¡¨å¯ä»¥é€‰æ‹©`å…¨éƒ¨é—®é¢˜`è¿˜æ˜¯`æˆ‘çš„é—®é¢˜`ï¼Œé€‰æ‹©`æˆ‘çš„é—®é¢˜`åˆ™åªå±•ç¤ºæˆ‘æé—®çš„é—®é¢˜ã€‚é»˜è®¤æ˜¯å…¨éƒ¨
- é€‰æ‹©ç« èŠ‚åºå·ï¼Œæ ¹æ®ç« èŠ‚å·æŸ¥çœ‹ç« èŠ‚ä¸‹å¯¹åº”é—®ç­”ã€‚é»˜è®¤å±•ç¤ºæ‰€æœ‰ç« èŠ‚çš„é—®é¢˜
- å¯¹äºæˆ‘æé—®çš„é—®é¢˜ï¼Œå¯ä»¥åšåˆ é™¤ã€ä¿®æ”¹æ“ä½œ

<br/>

ğŸ’¡  **è·³è½¬é€»è¾‘**

- ç‚¹å‡»æé—®æŒ‰é’®ï¼Œè¿›å…¥é—®é¢˜ç¼–è¾‘é¡µé¢
- ç‚¹å‡»é—®é¢˜æ ‡é¢˜ï¼Œè¿›å…¥é—®é¢˜è¯¦æƒ…é¡µ
- ç‚¹å‡»é—®é¢˜ä¸‹çš„å›ç­”ï¼Œè¿›å…¥å›ç­”è¡¨å•

:::

<br/>

ç‚¹å‡»æé—®æˆ–ç¼–è¾‘æŒ‰é’®ä¼šè¿›å…¥é—®é¢˜ç¼–è¾‘é¡µé¢ï¼š

![img](./assets/20230725153709915.jpg)

<br/>

:::warning ğŸ’¡ è¡¨å•å†…å®¹

- è¯¾ç¨‹ï¼šé—®é¢˜ä¸€å®šå…³è”æé—®æ—¶æ‰€åœ¨çš„è¯¾ç¨‹ï¼Œæ— éœ€é€‰æ‹©
- ç« èŠ‚ï¼šå¯ä»¥é€‰æ‹©æé—®çŸ¥è¯†ç‚¹å¯¹åº”çš„ç« èŠ‚ï¼Œä¹Ÿå¯ä»¥ä¸é€‰
- é—®é¢˜æ ‡é¢˜ï¼šä¸€ä¸ªæ¦‚æ‹¬æ€§æè¿°
- é—®é¢˜è¯¦æƒ…ï¼šè¯¦ç»†é—®é¢˜ä¿¡æ¯ï¼Œå¯Œæ–‡æœ¬
- æ˜¯å¦åŒ¿åï¼šç”¨æˆ·å¯ä»¥é€‰æ‹©åŒ¿åæé—®ï¼Œå…¶å®ƒç”¨æˆ·ä¸å¯è§æé—®è€…ä¿¡æ¯

:::

<br/>

ç‚¹å‡»æŸä¸ªé—®é¢˜ï¼Œåˆ™ä¼šè¿›å…¥é—®é¢˜è¯¦æƒ…é¡µé¢ï¼š

![img](./assets/20230725153710466.jpg)

<br/>

:::warning ğŸ’¡ é¡µé¢å†…å®¹

- é¡¶éƒ¨å±•ç¤ºé—®é¢˜ç›¸å…³è¯¦ç»†ä¿¡æ¯
- ä»»ä½•äººéƒ½å¯ä»¥å¯¹é—®é¢˜åšå›å¤ï¼Œä¹Ÿå¯ä»¥å¯¹ä»–äººçš„å›ç­”å†æ¬¡å›å¤ï¼Œæ— é™å æ¥¼ã€‚
- ä¹Ÿæ²¡æ¸²æŸ“åªåˆ†ä¸¤å±‚ï¼š
  - å¯¹é—®é¢˜çš„ä¸€çº§å›å¤ï¼Œç§°ä¸ºå›ç­”
  - å¯¹å›ç­”çš„å›å¤ã€å¯¹å›å¤çš„å›å¤ï¼Œä½œä¸ºç¬¬äºŒçº§ï¼Œç§°ä¸ºè¯„è®º
- é—®é¢˜è¯¦æƒ…é¡µä¸‹é¢å±•ç¤ºé—®é¢˜ä¸‹çš„æ‰€æœ‰å›ç­”
- ç‚¹å‡»å›ç­”ä¸‹çš„è¯¦æƒ…æ‰å±•ç¤ºäºŒçº§è¯„è®º
- å¯ä»¥å¯¹è¯„è®ºã€å›ç­”ç‚¹èµ

:::

<br/>

#### è§†é¢‘å­¦ä¹ é¡µ

å¦å¤–ï¼Œåœ¨è§†é¢‘å­¦ä¹ é¡µé¢ä¸­åŒæ ·å¯ä»¥çœ‹åˆ°äº’åŠ¨é—®ç­”åŠŸèƒ½ï¼š

![img](./assets/20230725153710216.jpg)

è¿™ä¸ªé¡µé¢ä¸è¯¾ç¨‹è¯¦æƒ…é¡µåŠŸèƒ½ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯åœ¨è§‚çœ‹è§†é¢‘çš„è¿‡ç¨‹ä¸­æ“ä½œã€‚ç”¨æˆ·äº§ç”Ÿå­¦ä¹ ç–‘é—®æ˜¯å¯ä»¥å¿«é€Ÿæé—®ï¼Œä¸ç”¨é€€å›åˆ°è¯¾ç¨‹è¯¦æƒ…é¡µï¼Œç”¨æˆ·ä½“éªŒè¾ƒå¥½ã€‚

<br/>

**é¡µé¢é€»è¾‘**

- é»˜è®¤å±•ç¤ºè§†é¢‘æ’­æ”¾å°èŠ‚ä¸‹çš„é—®ç­”
- ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œæé—®é—®é¢˜ï¼Œè‡ªåŠ¨ä¸å½“å‰è¯¾ç¨‹ã€å½“å‰è§†é¢‘å¯¹åº”ç« èŠ‚å…³è”ã€‚å…¶å®ƒå‚æ•°ä¸è¯¾ç¨‹è¯¦æƒ…é¡µçš„é—®é¢˜è¡¨å•ç±»ä¼¼ã€‚
- é—®ç­”åˆ—è¡¨é»˜è®¤åªæ˜¾ç¤ºé—®é¢˜ï¼Œç‚¹å‡»åè¿›å…¥é—®é¢˜è¯¦æƒ…é¡µæ‰èƒ½æŸ¥çœ‹å…·ä½“ç­”æ¡ˆ

<br/>

#### ç®¡ç†ç«¯é—®ç­”ç®¡ç†é¡µ

é™¤äº†ç”¨æˆ·ç«¯ä»¥å¤–ï¼Œç®¡ç†ç«¯ä¹Ÿå¯ä»¥ç®¡ç†äº’åŠ¨é—®ç­”ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªåˆ—è¡¨é¡µï¼š

![img](./assets/20230725153710208.jpg)

**æœç´¢**

- ç®¡ç†å‘˜å¯ä»¥æœç´¢ç”¨æˆ·æå‡ºçš„æ‰€æœ‰é—®é¢˜
- æœç´¢ç»“æœå¯ä»¥åŸºäºé¡µé¢è¿‡æ»¤æ¡ä»¶åšè¿‡æ»¤
  - é—®é¢˜çŠ¶æ€ï¼šå·²æŸ¥çœ‹ã€æœªæŸ¥çœ‹ä¸¤ç§ã€‚æ ‡ç¤ºæ˜¯å¦å·²ç»è¢«ç®¡ç†å‘˜æŸ¥çœ‹è¿‡ã€‚æ¯å½“å­¦å‘˜åœ¨é—®é¢˜ä¸‹è¯„è®ºï¼ŒçŠ¶æ€é‡ç½®ä¸ºæœªæŸ¥çœ‹
  - è¯¾ç¨‹åç§°ï¼šç”±äºé—®é¢˜æ˜¯æé—®åœ¨è¯¾ç¨‹ä¸‹çš„ï¼Œæ‰€ä»¥ä¼šè·Ÿè¯¾ç¨‹å…³è”ã€‚ç®¡ç†å‘˜è¾“å…¥è¯¾ç¨‹åç§°ï¼Œæœç´¢è¯¥è¯¾ç¨‹ä¸‹çš„æ‰€æœ‰é—®é¢˜
  - æé—®æ—¶é—´ï¼šæå‡ºé—®é¢˜çš„æ—¶é—´

<br/>

**é¡µé¢åˆ—è¡¨**

- é»˜è®¤æŒ‰ç…§æé—®æ—¶é—´å€’åºæ’åˆ—ï¼›ç‚¹å‡»å›ç­”æ•°é‡æ—¶å¯ä»¥æ ¹æ®å›ç­”æ•°é‡æ’åº
- è¯¾ç¨‹åˆ†ç±»ï¼šéœ€è¦å±•ç¤ºé—®é¢˜æ‰€å±è¯¾ç¨‹çš„ä¸‰çº§åˆ†ç±»çš„åç§°çš„æ‹¼æ¥
- è¯¾ç¨‹æ‰€å±ç« èŠ‚ï¼šå¦‚æœæ˜¯åœ¨è§†é¢‘é¡µé¢æé—®ï¼Œåˆ™é—®é¢˜ä¼šä¸è§†é¢‘å¯¹åº”çš„ç« ã€èŠ‚å…³è”ï¼Œåˆ™æ­¤å¤„æ˜¾ç¤ºç« åç§°ã€èŠ‚åç§°ã€‚
- è¯¾ç¨‹åç§°ï¼šæé—®æ˜¯é’ˆå¯¹æŸä¸ªè¯¾ç¨‹çš„ï¼Œå› æ­¤æ­¤å¤„æ˜¾ç¤ºå¯¹åº”çš„è¯¾ç¨‹åç§°
- å›ç­”æ•°é‡ï¼šè¯¥é—®é¢˜ä¸‹çš„ä¸€çº§å›å¤ï¼Œç§°ä¸ºå›ç­”ã€‚æ­¤å¤„æ˜¾ç¤ºé—®é¢˜ä¸‹çš„å›ç­”çš„æ•°é‡ï¼Œå…¶å®ƒè¯„è®ºä¸ç»Ÿè®¡ã€‚
- ç”¨æˆ·ç«¯çŠ¶æ€ï¼šéšè—/æ˜¾ç¤ºã€‚è¡¨ç¤ºæ˜¯å¦åœ¨ç”¨æˆ·ç«¯å±•ç¤ºï¼Œå¯¹äºä¸€äº›æ•æ„Ÿè¯é¢˜ï¼Œç®¡ç†å‘˜å¯ä»¥ç›´æ¥éšè—é—®é¢˜ã€‚

<br/>

**æ“ä½œ**

- ç‚¹å‡»æŸ¥çœ‹ï¼šä¼šå°†è¯¥é—®é¢˜æ ‡è®°ä¸ºå·²æŸ¥çœ‹çŠ¶æ€ï¼Œå¹¶ä¸”è·³è½¬åˆ°é—®é¢˜è¯¦æƒ…é¡µ
- ç‚¹å‡»éšè—æˆ–æ˜¾ç¤ºï¼šæ§åˆ¶è¯¥é—®é¢˜æ˜¯å¦åœ¨ç”¨æˆ·ç«¯æ˜¾ç¤ºã€‚éšè—é—®é¢˜ï¼Œåˆ™é—®é¢˜ä¸‹çš„æ‰€æœ‰å›ç­”å’Œæ¢å¤éƒ½è¢«éšè—

<br/>

ç‚¹å‡»æŸ¥çœ‹æŒ‰é’®ï¼Œä¼šè¿›å…¥ä¸€ä¸ªé—®é¢˜è¯¦æƒ…é¡µé¢ï¼š

![img](./assets/20230725153712084.jpg)

<br/>

é—®é¢˜è¯¦æƒ…

- é¡µé¢é¡¶éƒ¨æ˜¯é—®é¢˜è¯¦æƒ…ï¼Œå±•ç¤ºä¿¡æ¯ä¸é—®é¢˜åˆ—è¡¨é¡µåŸºæœ¬ä¸€è‡´
- ç‚¹å‡»è¯„è®ºï¼Œè€å¸ˆå¯ä»¥å›ç­”é—®é¢˜
- ç‚¹å‡»éšè—/æ˜¾ç¤ºï¼Œå¯ä»¥éšè—æˆ–æ˜¾ç¤ºé—®é¢˜

å›ç­”åˆ—è¡¨

- åˆ†é¡µå±•ç¤ºé—®é¢˜ä¸‹çš„å›ç­”ï¼ˆä¸€çº§å›å¤ï¼‰
- å¯ä»¥å¯¹å›ç­”ç‚¹èµã€è¯„è®ºã€éšè—
- ç‚¹å‡»æŸ¥çœ‹ï¼Œåˆ™è¿›å…¥å›ç­”è¯¦æƒ…é¡µ

<br/>

ç»§ç»­ç‚¹å‡»æŸ¥çœ‹æ›´å¤šæŒ‰é’®ï¼Œå¯ä»¥è¿›å…¥å›ç­”è¯¦æƒ…é¡µï¼š

![img](./assets/20230725153712923.jpg)

**å›ç­”è¯¦æƒ…**

- é¡µé¢é¡¶éƒ¨æ˜¯å›ç­”è¯¦æƒ…ï¼Œå±•ç¤ºä¿¡æ¯ä¸å›ç­”åˆ—è¡¨é¡µåŸºæœ¬ä¸€è‡´
- ç‚¹å‡»æˆ‘æ¥è¯„è®ºï¼Œè€å¸ˆå¯ä»¥è¯„è®ºè¯¥å›ç­”
- ç‚¹å‡»éšè—/æ˜¾ç¤ºï¼Œå¯ä»¥éšè—æˆ–æ˜¾ç¤ºè¯¥å›ç­”ï¼Œè¯¥å›ç­”ä¸‹çš„æ‰€æœ‰è¯„è®ºä¹Ÿéƒ½ä¼šè¢«éšè—æˆ–æ˜¾ç¤º

**è¯„è®ºåˆ—è¡¨**

- åˆ†é¡µå±•ç¤ºå›ç­”ä¸‹çš„è¯„è®º
- å¯ä»¥å¯¹è¯„è®ºç‚¹èµã€å›å¤ã€éšè—

<br/>

#### æµç¨‹æ€»ç»“

æ•´ä½“æ¥è¯´ï¼Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š

- å­¦å‘˜åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å¯ä»¥éšæ—¶æé—®é—®é¢˜
- è€å¸ˆã€å…¶ä»–å­¦å‘˜éƒ½å¯ä»¥å›ç­”é—®é¢˜
- è€å¸ˆã€å­¦å‘˜ä¹Ÿéƒ½å¯ä»¥å¯¹å›ç­”å¤šæ¬¡å›å¤
- è€å¸ˆã€å­¦å‘˜ä¹Ÿéƒ½å¯ä»¥å¯¹è¯„è®ºå¤šæ¬¡å›å¤
- è€å¸ˆå¯ä»¥åœ¨ç®¡ç†ç«¯ç®¡ç†é—®é¢˜ã€å›ç­”ã€è¯„è®ºçš„çŠ¶æ€

ä¸šåŠ¡æµç¨‹å¹¶ä¸å¤æ‚ã€‚

<br/>

### æ¥å£ç»Ÿè®¡

ç†è®ºä¸Šæˆ‘ä»¬åº”è¯¥å…ˆè®¾è®¡æ‰€æœ‰æ¥å£ï¼Œå†ç»§ç»­è®¾è®¡æ¥å£å¯¹åº”çš„è¡¨ç»“æ„ã€‚ä¸è¿‡ç”±äºæ¥å£è¾ƒå¤šï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆå¯¹æ¥å£åšç®€å•ç»Ÿè®¡ã€‚ç„¶åç›´æ¥è®¾è®¡æ•°æ®åº“ï¼Œæœ€åè¾¹è®¾è®¡æ¥å£ï¼Œè¾¹å®ç°æ¥å£ã€‚

#### é—®é¢˜çš„CRUD

é¦–å…ˆç¬¬ä¸€ä¸ªé¡µé¢ï¼Œåˆ—è¡¨å±•ç¤ºé¡µï¼š

![img](./assets/20230725153712249.jpg)

ç»“åˆåŸå‹è®¾è®¡å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡ŒåŒ…å«4ä¸ªæ¥å£ï¼š

- å¸¦æ¡ä»¶è¿‡æ»¤çš„åˆ†é¡µæŸ¥è¯¢
- æ–°å¢æé—®
- ä¿®æ”¹æé—®
- åˆ é™¤æé—®

è¿™äº›éƒ½æ˜¯åŸºæœ¬çš„CRUDï¼Œåº”è¯¥ä¸éš¾ã€‚

<br/>

#### é—®é¢˜çš„å›ç­”å’Œè¯„è®º

è¿›å…¥é—®ç­”è¯¦æƒ…é¡µå†çœ‹ï¼š

![img](./assets/20230725153713104.jpg)

å¯ä»¥çœ‹åˆ°é¡µé¢ä¸­åŒ…å«5ä¸ªæ¥å£ï¼š

- æ ¹æ®idæŸ¥è¯¢é—®é¢˜è¯¦æƒ…
- åˆ†é¡µæŸ¥è¯¢é—®é¢˜ä¸‹çš„æ‰€æœ‰å›ç­”
- åˆ†é¡µæŸ¥è¯¢å›ç­”ä¸‹çš„è¯„è®º
- ç‚¹èµ/å–æ¶ˆç‚¹èµæŸä¸ªå›ç­”æˆ–è¯„è®º
- å›ç­”æŸä¸ªæé—®ã€è¯„è®ºä»–äººå›ç­”

<br/>

é™¤äº†ç‚¹èµåŠŸèƒ½å¤–ï¼Œå…¶å®ƒæ¥å£ä¹Ÿéƒ½æ˜¯åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼Œå¹¶ä¸å¤æ‚ã€‚

<br/>

#### ç®¡ç†ç«¯æ¥å£

åˆšæ‰åˆ†æçš„éƒ½æ˜¯ç”¨æˆ·ç«¯çš„ç›¸å…³æ¥å£ï¼Œè¿™äº›æ¥å£éƒ¨åˆ†å¯ä»¥ä¸ç®¡ç†ç«¯å…±ç”¨ï¼Œä½†ç®¡ç†ç«¯ä¹Ÿæœ‰è‡ªå·±çš„ç‰¹æœ‰éœ€æ±‚ã€‚

ç®¡ç†ç«¯ä¹Ÿå¯ä»¥åˆ†é¡µæŸ¥è¯¢é—®é¢˜åˆ—è¡¨ï¼Œè€Œä¸”è¿‡æ»¤æ¡ä»¶ã€æŸ¥è¯¢ç»“æœä¼šæœ‰å¾ˆå¤§ä¸åŒï¼š

![img](./assets/20230725153712967.jpg)

<br/>

æ¯”è¾ƒæ˜æ˜¾çš„æœ‰ä¸¤ä¸ªæ¥å£ï¼š

- ç®¡ç†ç«¯åˆ†é¡µæŸ¥è¯¢é—®é¢˜åˆ—è¡¨ï¼šä¸ç”¨æˆ·ç«¯åˆ†é¡µæŸ¥è¯¢ä¸é€šç”¨ï¼ŒåŠŸèƒ½æ›´å¤æ‚ï¼ŒæŸ¥è¯¢æ¡ä»¶æ›´å¤š
- éšè—æˆ–æ˜¾ç¤ºæŒ‡å®šé—®é¢˜

<br/>

é™¤æ­¤ä»¥å¤–ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜çŠ¶æ€å­—æ®µï¼Œè¡¨ç¤ºç®¡ç†å‘˜æ˜¯å¦æŸ¥çœ‹äº†è¯¥é—®é¢˜ä»¥åŠé—®é¢˜ä¸­çš„å›ç­”ã€‚é»˜è®¤æ˜¯æœªæŸ¥çœ‹çŠ¶æ€ï¼›å½“ç®¡ç†å‘˜ç‚¹å‡»æŸ¥çœ‹åï¼ŒçŠ¶æ€ä¼šå˜åŒ–ä¸ºå·²æŸ¥çœ‹ï¼›å½“**å­¦å‘˜**å†æ¬¡å›ç­”æˆ–è¯„è®ºï¼ŒçŠ¶æ€ä¼šå†æ¬¡å˜ä¸ºæœªæŸ¥çœ‹ã€‚

<br/>

å› æ­¤ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š

- æ¯å½“ç”¨æˆ·ç‚¹å‡»æŸ¥çœ‹æŒ‰é’®ï¼Œéœ€è¦æ ¹æ®æ ¹æ®idæŸ¥è¯¢é—®é¢˜è¯¦æƒ…ï¼Œæ­¤æ—¶åº”æ ‡è®°é—®é¢˜çŠ¶æ€ä¸ºå·²æŸ¥çœ‹
- æ¯å½“**å­¦å‘˜**å›ç­”æˆ–è¯„è®ºæ—¶ï¼Œéœ€è¦å°†é—®é¢˜æ ‡è®°ä¸ºæœªæŸ¥çœ‹

<br/>

ç®¡ç†ç«¯ä¹Ÿä¼šæœ‰å›ç­”åˆ—è¡¨ã€è¯„è®ºåˆ—è¡¨ã€‚å¦å¤–ï¼Œå›ç­”å’Œè¯„è®ºåŒæ ·æœ‰éšè—åŠŸèƒ½ã€‚

é—®é¢˜è¯¦æƒ…å’Œå›ç­”åˆ—è¡¨ï¼š

![img](./assets/20230725153712544.jpg)

<br/>

è¿˜æœ‰è¯„è®ºåˆ—è¡¨ï¼š

![img](./assets/20230725153713244.jpg)

<br/>

æ€»ç»“ä¸€ä¸‹ï¼Œå›ç­”å’Œè¯„è®ºåŒ…å«çš„æ¥å£æœ‰ï¼š

- ç®¡ç†ç«¯æ ¹æ®idæŸ¥è¯¢é—®é¢˜è¯¦æƒ…
- åˆ†é¡µæŸ¥è¯¢é—®é¢˜ä¸‹çš„å›ç­”
- åˆ†é¡µæŸ¥è¯¢å›ç­”ä¸‹çš„è¯„è®º
- ç‚¹èµ/å–æ¶ˆç‚¹èµæŸä¸ªå›ç­”æˆ–è¯„è®º
- éšè—/æ˜¾ç¤ºæŒ‡å®šå›ç­”æˆ–è¯„è®º
- å›ç­”æŸä¸ªæé—®ã€è¯„è®ºä»–äººå›ç­”ã€è¯„è®ºï¼ˆä¸ç”¨æˆ·ç«¯å…±ç”¨ï¼‰

<br/>

#### æ€»ç»“

ç»¼ä¸Šï¼Œä¸é—®ç­”ç³»ç»Ÿæœ‰å…³çš„æ¥å£æœ‰ï¼š

![image-20240219164649142](assets/image-20240219164649142.png)



## æ•°æ®ç»“æ„

ä»åŸå‹å›¾ä¸éš¾çœ‹å‡ºï¼Œè¿™éƒ¨åˆ†åŠŸèƒ½ä¸»è¦æ¶‰åŠä¸¤ä¸ªå®ä½“ï¼š

- é—®é¢˜
- å›ç­”/è¯„è®ºï¼šå›ç­”ã€è¯„è®ºå¯ä»¥çœ‹åšä¸€ç±»å®ä½“

å› æ­¤æ ¸å¿ƒè¦è®¾è®¡çš„å°±æ˜¯è¿™ä¸¤å¼ è¡¨ã€‚

<br/>

### ERå›¾

#### é—®é¢˜

é¦–å…ˆæ˜¯`é—®é¢˜`ï¼Œé€šè¿‡æ–°å¢æé—®çš„è¡¨å•å¯ä»¥çœ‹å‡º`é—®é¢˜`åŒ…å«çš„å±æ€§ï¼š

![img](./assets/20230725153712500.jpg)

åŸºæœ¬å±æ€§ï¼š

- æ ‡é¢˜
- æè¿°

å…³è”ä¿¡æ¯ï¼š

- ç”¨æˆ·idï¼šä¹Ÿå°±æ˜¯æé—®çš„äºº
- è¯¾ç¨‹id
- ç« id
- èŠ‚id

åŠŸèƒ½å­—æ®µï¼š

- æ˜¯å¦æ˜¯åŒ¿å

<br/>

å¦å¤–ï¼Œåœ¨é—®é¢˜åˆ—è¡¨ä¸­ï¼Œéœ€è¦çŸ¥é“é—®é¢˜æœ€æ–°çš„ä¸€ä¸ªå›ç­”çš„ä¿¡æ¯ï¼š

![img](./assets/20230725153713132.jpg)

å¦‚æœæ¯æ¬¡åˆ†é¡µæŸ¥è¯¢é—®é¢˜çš„æ—¶å€™å†å»ç»Ÿè®¡æœ€æ–°çš„å›ç­”æ˜¯å“ªä¸ªï¼Œæ•ˆç‡æ¯”è¾ƒä½ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ¯æ¬¡æœ‰æ–°å›ç­”æ—¶å°†è¿™ä¸ªidè®°å½•åˆ°é—®é¢˜è¡¨ä¸­ã€‚å› æ­¤é—®é¢˜è¡¨ä¸­éœ€è¦æ·»åŠ è¿™æ ·ä¸€ä¸ªå­—æ®µï¼š

- æœ€æ–°ä¸€æ¬¡å›ç­”çš„id

<br/>

é™¤äº†è¿™äº›å­—æ®µä»¥å¤–ï¼Œç®¡ç†ç«¯åˆ†é¡µæŸ¥è¯¢é—®é¢˜åˆ—è¡¨æ—¶ä¹Ÿæœ‰ä¸€äº›åŠŸèƒ½å­—æ®µï¼š

![img](./assets/20230725153713095.jpg)

åŠŸèƒ½å­—æ®µï¼š

- é—®é¢˜ä¸‹çš„å›ç­”æ•°é‡
- ç”¨æˆ·ç«¯æ˜¾ç¤ºçŠ¶æ€ï¼šæ˜¯å¦è¢«éšè—
- é—®é¢˜çŠ¶æ€ï¼šç®¡ç†ç«¯æ˜¯å¦å·²ç»æŸ¥çœ‹

<br/>

ç»¼ä¸Šï¼Œé—®é¢˜çš„ERå›¾å¦‚ä¸‹ï¼š

![image-20240219164806221](assets/image-20240219164806221.png)

<br/>

#### å›ç­”ã€è¯„è®º

å›ç­”å’Œè¯„è®ºçš„å±æ€§åŸºæœ¬ä¸€è‡´ï¼Œå·®åˆ«å°±æ˜¯ï¼š

- å›ç­”çš„å¯¹è±¡æ˜¯é—®é¢˜
- è¯„è®ºçš„å¯¹è±¡æ˜¯å…¶å®ƒå›ç­”æˆ–è¯„è®º

æ¥çœ‹ä¸‹åŸå‹å›¾ï¼š

![img](./assets/20230725153713346.jpg)![img](assets/image-20240219164806222.png)

é¦–å…ˆæ˜¯åŸºæœ¬å±æ€§ï¼š

- å›ç­”çš„å†…å®¹

åŠŸèƒ½å­—æ®µï¼š

- æ˜¯å¦æ˜¯åŒ¿å
- ç‚¹èµæ•°é‡

ç„¶åæ˜¯å…³è”ä¿¡æ¯ï¼š

- ç”¨æˆ·idï¼šä¹Ÿå°±æ˜¯å›ç­”çš„äºº
- é—®é¢˜idï¼šæ— è®ºæ˜¯å›ç­”ã€è¯„è®ºï¼Œéƒ½å±äºæŸä¸ªé—®é¢˜

æ¥ä¸‹æ¥æ˜¯è¯„è®ºçš„ç‰¹æœ‰å±æ€§ï¼š

- å›ç­”idï¼šä¸€ä¸ªå›ç­”ä¸‹ä¼šæœ‰å¾ˆå¤šè¯„è®ºï¼Œè¯„è®ºä¹‹é—´ä¹Ÿä¼šç›¸äº’è¯„è®ºï¼Œä½†æˆ‘ä»¬æŠŠå›ç­”ä¸‹æ‰€æœ‰è¯„è®ºä½œä¸ºä¸€å±‚æ¥å±•ç¤ºã€‚å› æ­¤è¯¥å›ç­”ä¸‹çš„æ‰€æœ‰è¯„è®ºéƒ½åº”è®°ä½æ‰€å±çš„å›ç­”çš„id
- ç›®æ ‡ç”¨æˆ·idï¼šè¯„è®ºé’ˆå¯¹çš„ç›®æ ‡ç”¨æˆ·ï¼Œé¡µé¢æ˜¾ç¤ºä¸º `å¼ ä¸‰è¯„è®ºäº†æå››`
- ç›®æ ‡è¯„è®ºidï¼šè¯„è®ºé’ˆå¯¹çš„ç›®æ ‡è¯„è®ºçš„id

<br/>

ç»¼ä¸Šï¼Œè¯„è®ºçš„ERå›¾ä¸ºï¼š

![image-20240219165034870](assets/image-20240219165034870.png)

<br/>

### æ•°æ®åº“è¡¨

ç»“åˆERå›¾ï¼Œè¡¨ç»“æ„å°±éå¸¸æ¸…æ¥šäº†ï¼Œä¼šåŒ…å«ä¸¤å¼ è¡¨ï¼š

- é—®é¢˜è¡¨
- å›å¤è¡¨ï¼šå›ç­”å’Œè¯„è®ºéƒ½æ˜¯å›å¤ï¼Œåœ¨ä¸€å¼ è¡¨

<br/>

#### é—®é¢˜è¡¨

é¦–å…ˆæ˜¯é—®é¢˜è¡¨ï¼š

```SQL
CREATE TABLE IF NOT EXISTS `interaction_question` (
  `id` bigint NOT NULL COMMENT 'ä¸»é”®ï¼Œäº’åŠ¨é—®é¢˜çš„id',
  `title` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT 'äº’åŠ¨é—®é¢˜çš„æ ‡é¢˜',
  `description` varchar(2048) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT '' COMMENT 'é—®é¢˜æè¿°ä¿¡æ¯',
  `course_id` bigint NOT NULL COMMENT 'æ‰€å±è¯¾ç¨‹id',
  `chapter_id` bigint NOT NULL COMMENT 'æ‰€å±è¯¾ç¨‹ç« id',
  `section_id` bigint NOT NULL COMMENT 'æ‰€å±è¯¾ç¨‹èŠ‚id',
  `user_id` bigint NOT NULL COMMENT 'æé—®å­¦å‘˜id',
  `latest_answer_id` bigint DEFAULT NULL COMMENT 'æœ€æ–°çš„ä¸€ä¸ªå›ç­”çš„id',
  `answer_times` int unsigned NOT NULL DEFAULT '0' COMMENT 'é—®é¢˜ä¸‹çš„å›ç­”æ•°é‡',
  `anonymity` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åŒ¿åï¼Œé»˜è®¤false',
  `hidden` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦è¢«éšè—ï¼Œé»˜è®¤false',
  `status` tinyint DEFAULT '0' COMMENT 'ç®¡ç†ç«¯é—®é¢˜çŠ¶æ€ï¼š0-æœªæŸ¥çœ‹ï¼Œ1-å·²æŸ¥çœ‹',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æé—®æ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_course_id` (`course_id`) USING BTREE,
  KEY `section_id` (`section_id`),
  KEY `user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci ROW_FORMAT=DYNAMIC COMMENT='äº’åŠ¨æé—®çš„é—®é¢˜è¡¨';
```

<br/>

#### å›ç­”æˆ–è¯„è®º

å›ç­”å’Œè¯„è®ºåˆä¸ºä¸€å¼ è¡¨ï¼Œç§°ä¸ºè¯„è®ºè¡¨ï¼š

```SQL
CREATE TABLE IF NOT EXISTS `interaction_reply` (
  `id` bigint NOT NULL COMMENT 'äº’åŠ¨é—®é¢˜çš„å›ç­”id',
  `question_id` bigint NOT NULL COMMENT 'äº’åŠ¨é—®é¢˜é—®é¢˜id',
  `answer_id` bigint DEFAULT '0' COMMENT 'å›å¤çš„ä¸Šçº§å›ç­”id',
  `user_id` bigint NOT NULL COMMENT 'å›ç­”è€…id',
  `content` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT 'å›ç­”å†…å®¹',
  `target_user_id` bigint DEFAULT '0' COMMENT 'å›å¤çš„ç›®æ ‡ç”¨æˆ·id',
  `target_reply_id` bigint DEFAULT '0' COMMENT 'å›å¤çš„ç›®æ ‡å›å¤id',
  `reply_times` int NOT NULL DEFAULT '0' COMMENT 'è¯„è®ºæ•°é‡',
  `liked_times` int NOT NULL DEFAULT '0' COMMENT 'ç‚¹èµæ•°é‡',
  `hidden` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦è¢«éšè—ï¼Œé»˜è®¤false',
  `anonymity` bit(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åŒ¿åï¼Œé»˜è®¤false',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_question_id` (`question_id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci ROW_FORMAT=DYNAMIC COMMENT='äº’åŠ¨é—®é¢˜çš„å›ç­”æˆ–è¯„è®º';
```

<br/>

### ä»£ç ç”Ÿæˆ

æ¥ä¸‹æ¥ï¼Œåˆ©ç”¨MPæ’ä»¶è‡ªåŠ¨ä»£ç ç”Ÿæˆå¯¹åº”çš„ä»£ç ã€‚ä¸è¿‡åœ¨è¿™ä¹‹å‰ï¼Œä¸è¦å¿˜äº†åˆ›å»ºæ–°çš„åŠŸèƒ½åˆ†æ”¯ã€‚è¿™é‡Œæˆ‘ä»¬æ˜¯äº’åŠ¨é—®ç­”åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨devåˆ†æ”¯åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªé—®ç­”åˆ†æ”¯ï¼š`feature-qa`

![img](./assets/20230725153714414.jpg)

ç„¶åå†ç”Ÿæˆä»£ç å³å¯ã€‚

<br/>

#### controller

æ³¨æ„æŠŠcontrollerè·¯å¾„ä¿®æ”¹ä¸ºRestfulé£æ ¼ï¼š

![img](./assets/20230725153713523.jpg)

![img](./assets/20230725153713475.jpg)

<br/>

#### IDç­–ç•¥

é—®é¢˜å’Œè¯„è®ºçš„idéƒ½é‡‡ç”¨é›ªèŠ±ç®—æ³•ï¼š

![img](./assets/20230725153715543.jpg)

è¯„è®ºï¼š

![img](./assets/20230725153714678.jpg)

<br/>

#### çŠ¶æ€æšä¸¾

é—®é¢˜å­˜åœ¨å·²æŸ¥çœ‹å’ŒæœªæŸ¥çœ‹ä¸¤ç§çŠ¶æ€ï¼Œæˆ‘ä»¬å®šä¹‰å‡ºä¸€ä¸ªæšä¸¾æ¥æ ‡ç¤ºï¼š

![img](./assets/20230725153714425.jpg)

å…·ä½“ä»£ç ï¼š

```Java
@Getter
public enum QuestionStatus implements BaseEnum {
    UN_CHECK(0, "æœªæŸ¥çœ‹"),
    CHECKED(1, "å·²æŸ¥çœ‹"),
    ;
    @JsonValue
    @EnumValue
    int value;
    String desc;

    QuestionStatus(int value, String desc) {
        this.value = value;
        this.desc = desc;
    }

    @JsonCreator(mode = JsonCreator.Mode.DELEGATING)
    public static QuestionStatus of(Integer value){
        if (value == null) {
            return null;
        }
        for (QuestionStatus status : values()) {
            if (status.equalsValue(value)) {
                return status;
            }
        }
        return null;
    }
}
```

ç„¶åæŠŠ`InteractionQuestion`ç±»ä¸­çš„çŠ¶æ€ä¿®æ”¹ä¸ºæšä¸¾ç±»å‹ï¼š

![img](./assets/20230725153714300.jpg)

<br/>

## é—®é¢˜ç›¸å…³æ¥å£

é—®é¢˜ç›¸å…³æ¥å£åœ¨ç®¡ç†ç«¯å’Œç”¨æˆ·ç«¯å­˜åœ¨ä¸€äº›å·®å¼‚ï¼Œåœ¨è®¾è®¡æ¥å£æ—¶ä¸€å®šè¦ç•™æ„ã€‚å¦å¤–ï¼Œæ­¤å¤„æˆ‘ä»¬åªå¸¦å¤§å®¶å®ç°å…¶ä¸­çš„éƒ¨åˆ†æ¥å£ï¼š

- æ–°å¢äº’åŠ¨é—®é¢˜
- ç”¨æˆ·ç«¯åˆ†é¡µæŸ¥è¯¢é—®é¢˜
- æ ¹æ®idæŸ¥è¯¢é—®é¢˜è¯¦æƒ…
- ç®¡ç†ç«¯åˆ†é¡µæŸ¥è¯¢é—®é¢˜

å…¶å®ƒçš„æ¥å£ç•™ç»™å¤§å®¶ä½œä¸ºç»ƒä¹ ï¼ŒåŒ…æ‹¬ï¼š

- ç®¡ç†ç«¯æ ¹æ®idæŸ¥è¯¢é—®é¢˜è¯¦æƒ…
- ä¿®æ”¹é—®é¢˜
- åˆ é™¤é—®é¢˜
- ç®¡ç†ç«¯éšè—æˆ–æ˜¾ç¤ºé—®é¢˜
- æ–°å¢å›ç­”æˆ–è¯„è®º
- åˆ†é¡µæŸ¥è¯¢å›ç­”æˆ–è¯„è®º
- ç®¡ç†ç«¯åˆ†é¡µæŸ¥è¯¢å›ç­”æˆ–è¯„è®º
- ç®¡ç†ç«¯éšè—æˆ–æ˜¾ç¤ºå›ç­”ã€è¯„è®º

<br/>

### æ–°å¢é—®é¢˜

#### æ¥å£åˆ†æ

é¦–å…ˆè¿˜æ˜¯çœ‹åŸå‹å›¾ï¼Œæ–°å¢çš„è¡¨å•å¦‚ä¸‹ï¼š

![img](./assets/20230725153713930.jpg)

é€šè¿‡æ–°å¢çš„é—®é¢˜çš„è¡¨å•å³å¯åˆ†æå‡ºæ¥å£çš„è¯·æ±‚å‚æ•°ä¿¡æ¯äº†ï¼Œç„¶åæŒ‰ç…§Restfulçš„é£æ ¼è®¾è®¡å³å¯ï¼š

![image-20240219171303922](assets/image-20240219171303922.png)

<br/>

#### å®ä½“ç±»

æ–°å¢ä¸šåŠ¡ä¸­æ— è¿”å›å€¼ï¼Œåªéœ€è¦è®¾è®¡å‡ºå…¥å‚å¯¹åº”çš„DTOå³å¯ï¼Œåœ¨è¯¾å‰èµ„æ–™ä¸­å·²ç»æä¾›å¥½äº†ï¼š

![img](./assets/20230725153714214.jpg)

å¤åˆ¶åˆ°`tj-learning`æ¨¡å—ä¸‹çš„`domain`ä¸‹çš„`dto`åŒ…ä¸‹ï¼š

![img](./assets/20230725153714639.jpg)

<br/>

#### ä»£ç å®ç°

é¦–å…ˆæ˜¯`tj-learning`ä¸­çš„`InteractionQuestionController`ï¼š

```Java
@RestController
@RequestMapping("/questions")
@RequiredArgsConstructor
public class InteractionQuestionController {

    private final IInteractionQuestionService questionService;

    @ApiOperation("æ–°å¢æé—®")
    @PostMapping
    public void saveQuestion(@Valid @RequestBody QuestionFormDTO questionDTO){
        questionService.saveQuestion(questionDTO);
    }
}
```

<br/>

ç„¶åæ˜¯ `tj-learning` ä¸­çš„ `IInteractionQuestionService` æ¥å£ï¼š

```Java
public interface IInteractionQuestionService extends IService<InteractionQuestion> {
    void saveQuestion(QuestionFormDTO questionDTO);
}
```

<br/>

æœ€åæ˜¯`tj-learning`ä¸­çš„`InteractionQuestionServiceImpl`å®ç°ç±»ï¼š

```Java
@Service
@RequiredArgsConstructor
public class InteractionQuestionServiceImpl extends ServiceImpl<InteractionQuestionMapper, InteractionQuestion> implements IInteractionQuestionService {
    
    private final IInteractionQuestionDetailService detailService;

    @Override
    @Transactional
    public void saveQuestion(QuestionFormDTO questionDTO) {
        // 1.è·å–ç™»å½•ç”¨æˆ·
        Long userId = UserContext.getUser();
        // 2.æ•°æ®è½¬æ¢
        InteractionQuestion question = BeanUtils.toBean(questionDTO, InteractionQuestion.class);
        // 3.è¡¥å……æ•°æ®
        question.setUserId(userId);
        // 4.ä¿å­˜é—®é¢˜
        save(question);

        // 5.é—®é¢˜è¯¦æƒ…
        InteractionQuestionDetail detail = new InteractionQuestionDetail();
        detail.setId(question.getId());
        detail.setDescription(questionDTO.getDescription());
        detailService.save(detail);
    }
}
```

<br/>

### ä¿®æ”¹é—®é¢˜ï¼ˆç»ƒä¹ ï¼‰

#### æ¥å£åˆ†æ

ä¿®æ”¹ä¸æ–°å¢è¡¨å•åŸºæœ¬ç±»ä¼¼ï¼Œæ­¤å¤„ä¸å†åˆ†æã€‚æˆ‘ä»¬å¯ä»¥å‚è€ƒæ–°å¢çš„æ¥å£ï¼Œç„¶åæŒ‰ç…§Restfulçš„é£æ ¼è®¾è®¡ä¸ºæ›´æ–°å³å¯ï¼š

![image-20240219172056448](assets/image-20240219172056448.png)

è™½ç„¶ä¿®æ”¹é—®é¢˜æ—¶æäº¤çš„JSONå‚æ•°ä¼šå°‘ä¸€äº›ï¼Œä¸è¿‡ä¾ç„¶å¯ä»¥æ²¿ç”¨æ–°å¢æ—¶çš„DTO.

#### ä»£ç å®ç°ï¼ˆç»ƒä¹ ï¼‰

<br/>

### ç”¨æˆ·ç«¯åˆ†é¡µæŸ¥è¯¢é—®é¢˜

#### æ¥å£åˆ†æ

å…ˆçœ‹åŸå‹å›¾ï¼š

![img](assets/20240219172147246.png)

è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„åˆ†é¡µæŸ¥è¯¢ã€‚ä¸»è¦åˆ†æè¯·æ±‚å‚æ•°å’Œè¿”å›å€¼å°±è¡Œäº†ã€‚

<br/>

è¯·æ±‚å‚æ•°å°±æ˜¯è¿‡æ»¤æ¡ä»¶ï¼Œé¡µé¢å¯ä»¥çœ‹åˆ°çš„æ¡ä»¶æœ‰ï¼š

- åˆ†é¡µæ¡ä»¶
- å…¨éƒ¨å›ç­”/æˆ‘çš„å›ç­”ï¼šä¹Ÿå°±æ˜¯è¦ä¸è¦åŸºäºç”¨æˆ·idè¿‡æ»¤
- è¯¾ç¨‹idï¼šéšå«æ¡ä»¶ï¼Œå› ä¸ºé—®é¢˜åˆ—è¡¨æ˜¯åœ¨æŸè¯¾ç¨‹è¯¦æƒ…é¡µé¢æŸ¥çœ‹çš„ï¼Œæ‰€ä»¥ä¸€å®šè¦ä»¥è¯¾ç¨‹idä¸ºæ¡ä»¶
- ç« èŠ‚idï¼šå¯é€‰æ¡ä»¶ï¼Œå½“ç”¨æˆ·ç‚¹å‡»å°èŠ‚æ—¶ä¼ é€’

<br/>

è¿”å›å€¼æ ¼å¼ï¼Œä»é¡µé¢å¯ä»¥çœ‹åˆ°å±æ€§æœ‰ï¼š

- æ˜¯å¦åŒ¿åï¼šå¦‚æœæäº¤é—®é¢˜æ˜¯é€‰æ‹©äº†åŒ¿åï¼Œåˆ™é¡µé¢ä¸èƒ½å±•ç¤ºç”¨æˆ·ä¿¡æ¯
- ç”¨æˆ·idï¼šåŒ¿ååˆ™ä¸æ˜¾ç¤º
- ç”¨æˆ·å¤´åƒï¼šåŒ¿ååˆ™ä¸æ˜¾ç¤º
- ç”¨æˆ·åç§°ï¼šåŒ¿ååˆ™ä¸æ˜¾ç¤º
- é—®é¢˜æ ‡é¢˜
- æé—®æ—¶é—´
- å›ç­”æ•°é‡
- æœ€è¿‘ä¸€æ¬¡å›ç­”çš„ä¿¡æ¯ï¼š
  - å›ç­”äººåç§°
  - å›ç­”å†…å®¹

<br/>

ç»¼ä¸Šï¼ŒæŒ‰ç…§Restfulæ¥è®¾è®¡æ¥å£ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š

![image-20240219225423806](assets/image-20240219225423806.png)

<br/>

#### å®ä½“ç±»

é¦–å…ˆæ˜¯è¯·æ±‚å‚æ•°ï¼ŒæŸ¥è¯¢ç±»å‹æˆ‘ä»¬å®šä¹‰ä¸ºQueryï¼Œåœ¨è¯¾å‰èµ„æ–™ä¸­å·²ç»æä¾›äº†ï¼š

```java
@EqualsAndHashCode(callSuper = true)
@Data
@ApiModel(description = "äº’åŠ¨é—®é¢˜åˆ†é¡µæŸ¥è¯¢æ¡ä»¶")
public class QuestionPageQuery extends PageQuery {
    // ç”¨æˆ·ç«¯æŸ¥è¯¢æ¡ä»¶
    @ApiModelProperty(value = "è¯¾ç¨‹id")
    private Long courseId;
    
    @ApiModelProperty(value = "å°èŠ‚id", example = "1")
    private Long sectionId;
    
    @ApiModelProperty(value = "æ˜¯å¦åªæŸ¥è¯¢æˆ‘çš„é—®é¢˜", example = "1")
    private Boolean onlyMine = false;
}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`QuestionPageQuery`æ˜¯ç»§æ‰¿è‡ª`tj-common`ä¸­é€šç”¨çš„`PageQuery`ï¼Œè¿™æ ·å°±æ— éœ€é‡å¤å®šä¹‰åˆ†é¡µæŸ¥è¯¢å‚æ•°äº†ï¼š

![img](./assets/20230725153715980.jpg)

ç„¶åæ˜¯è¿”å›å€¼ï¼Œé¡µé¢è§†å›¾å¯¹è±¡ï¼Œæˆ‘ä»¬å®šä¹‰ä¸ºVOï¼Œåœ¨è¯¾å‰èµ„æ–™ä¸­å·²ç»æä¾›äº†ï¼š

![img](./assets/20230725153714945.jpg)

æˆ‘ä»¬å°†VOå’ŒQueryå®ä½“åˆ†åˆ«æ”¾åˆ°domainåŒ…çš„voåŒ…å’ŒqueryåŒ…ä¸‹ï¼š

![img](./assets/20230725153716729.jpg)

<br/>

#### å£°æ˜æ¥å£

é¦–å…ˆæ˜¯`tj-learning`ä¸­çš„`com.tianji.learning.controller.InteractionQuestionController`

```Java
package com.tianji.learning.controller;


import com.tianji.common.domain.dto.PageDTO;
import com.tianji.learning.domain.query.QuestionPageQuery;
import com.tianji.learning.domain.vo.QuestionVO;
import com.tianji.learning.service.IInteractionQuestionService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiParam;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;

/**
 * <p>
 * äº’åŠ¨æé—®çš„é—®é¢˜è¡¨ å‰ç«¯æ§åˆ¶å™¨
 * </p>
 */
@RestController
@RequestMapping("/questions")
@Api(tags = "äº’åŠ¨é—®ç­”ç›¸å…³æ¥å£")
@RequiredArgsConstructor
public class InteractionQuestionController {

    private final IInteractionQuestionService questionService;

    @ApiOperation("åˆ†é¡µæŸ¥è¯¢äº’åŠ¨é—®é¢˜")
    @GetMapping("page")
    public PageDTO<QuestionVO> queryQuestionPage(QuestionPageQuery query){
        return questionService.queryQuestionPage(query);
    }

}
```

ç„¶åæ˜¯`tj-learning`ä¸­çš„`com.tianji.learning.service.IInteractionQuestionService`æ¥å£ï¼š

```Java
package com.tianji.learning.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.tianji.common.domain.dto.PageDTO;
import com.tianji.learning.domain.query.QuestionPageQuery;
import com.tianji.learning.domain.vo.QuestionVO;

/**
 * <p>
 * äº’åŠ¨æé—®çš„é—®é¢˜è¡¨ æœåŠ¡ç±»
 * </p>
 */
public interface IInteractionQuestionService extends IService<InteractionQuestion> {

    PageDTO<QuestionVO> queryQuestionPage(QuestionPageQuery query);
}
```

æœ€åæ˜¯`tj-learning`ä¸­çš„`com.tianji.learning.service.impl.InteractionQuestionServiceImpl`å®ç°ç±»ï¼š

```Java
package com.tianji.learning.service.impl;

import com.tianji.learning.domain.query.QuestionPageQuery;
import com.tianji.learning.domain.vo.QuestionVO;
import com.tianji.learning.service.IInteractionQuestionService;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.*;

/**
 * <p>
 * äº’åŠ¨æé—®çš„é—®é¢˜è¡¨ æœåŠ¡å®ç°ç±»
 * </p>
 */
@Service
@RequiredArgsConstructor
public class InteractionQuestionServiceImpl extends ServiceImpl<InteractionQuestionMapper, InteractionQuestion> implements IInteractionQuestionService {

    @Override
    public PageDTO<QuestionVO> queryQuestionPage(QuestionPageQuery query) {
        
        return null;
    }
}
```

<br/>

#### æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯

ç”±äºé¡µé¢VOä¸­éœ€è¦æé—®è€…ä¿¡æ¯ã€æœ€è¿‘ä¸€æ¬¡å›ç­”ä¿¡æ¯ï¼Œéƒ½éœ€è¦æŸ¥è¯¢å‡ºç”¨æˆ·æ˜µç§°ã€å¤´åƒç­‰ã€‚è€Œæ•°æ®åº“ä¸­ä»…ä»…ä¿å­˜äº†æé—®äººçš„idã€å›ç­”äººçš„idã€‚

è¿™å°±è¦æ±‚æˆ‘ä»¬èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·idå»æŸ¥è¯¢å‡ºç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚

<br/>

è€Œç”¨æˆ·ä¿¡æ¯å…¨éƒ¨éƒ½åœ¨`tj-user`æ¨¡å—å¯¹åº”çš„`user-service`æœåŠ¡ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿œç¨‹è°ƒç”¨`user-service`ä»¥è·å–è¿™äº›æ•°æ®ã€‚

<br/>

å¥½åœ¨user-serviceå·²ç»æä¾›äº†æŸ¥è¯¢ç”¨æˆ·çš„Feignå®¢æˆ·ç«¯ï¼Œå¹¶ä¸”ç»Ÿä¸€å®šä¹‰åˆ°äº†`tj-api`æ¨¡å—ä¸­ï¼š

![img](./assets/20230725153716688.jpg)

<br/>

å…¶ä¸­æœ‰è¿™æ ·çš„ä¸€ä¸ªAPIï¼š

![img](./assets/20230725153715504.jpg)

æ°å¥½å°±èƒ½å®ç°æ ¹æ®idé›†åˆæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯é›†åˆçš„åŠŸèƒ½ã€‚

<br/>

è€Œä¸”è¿”å›çš„UserDTOä¸­æ•°æ®éå¸¸ä¸°å¯Œï¼Œå®Œå…¨èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ï¼š

![img](./assets/20230725153716324.jpg)

<br/>

#### å®ç°æŸ¥è¯¢é€»è¾‘

æŸ¥è¯¢çš„å®ç°é€»è¾‘å¦‚ä¸‹ï¼š

```Java
package com.tianji.learning.service.impl;

import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.tianji.api.cache.CategoryCache;
import com.tianji.api.client.user.UserClient;
import com.tianji.api.dto.user.UserDTO;
import com.tianji.common.domain.dto.PageDTO;
import com.tianji.common.exceptions.BadRequestException;
import com.tianji.common.utils.BeanUtils;
import com.tianji.common.utils.CollUtils;
import com.tianji.common.utils.StringUtils;
import com.tianji.common.utils.UserContext;
import com.tianji.learning.domain.po.InteractionQuestion;
import com.tianji.learning.domain.po.InteractionReply;
import com.tianji.learning.domain.query.QuestionPageQuery;
import com.tianji.learning.domain.vo.QuestionVO;
import com.tianji.learning.mapper.InteractionQuestionMapper;
import com.tianji.learning.mapper.InteractionReplyMapper;
import com.tianji.learning.service.IInteractionQuestionService;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.*;
import java.util.stream.Collectors;

/**
 * <p>
 * äº’åŠ¨æé—®çš„é—®é¢˜è¡¨ æœåŠ¡å®ç°ç±»
 * </p>
 *
 * @author è™å“¥
 */
@Service
@RequiredArgsConstructor
public class InteractionQuestionServiceImpl extends ServiceImpl<InteractionQuestionMapper, InteractionQuestion> implements IInteractionQuestionService {

    private final InteractionReplyMapper replyMapper;
    private final UserClient userClient;
    
    @Override
    public PageDTO<QuestionVO> queryQuestionPage(QuestionPageQuery query) {
        // 1.å‚æ•°æ ¡éªŒï¼Œè¯¾ç¨‹idå’Œå°èŠ‚idä¸èƒ½éƒ½ä¸ºç©º
        Long courseId = query.getCourseId();
        Long sectionId = query.getSectionId();
        if (courseId == null && sectionId == null) {
            throw new BadRequestException("è¯¾ç¨‹idå’Œå°èŠ‚idä¸èƒ½éƒ½ä¸ºç©º");
        }
        // 2.åˆ†é¡µæŸ¥è¯¢
        Page<InteractionQuestion> page = lambdaQuery()
                .select(InteractionQuestion.class, info -> !info.getProperty().equals("description"))
                .eq(query.getOnlyMine(), InteractionQuestion::getUserId, UserContext.getUser())
                .eq(courseId != null, InteractionQuestion::getCourseId, courseId)
                .eq(sectionId != null, InteractionQuestion::getSectionId, sectionId)
                .eq(InteractionQuestion::getHidden, false)
                .page(query.toMpPageDefaultSortByCreateTimeDesc());
        List<InteractionQuestion> records = page.getRecords();
        if (CollUtils.isEmpty(records)) {
            return PageDTO.empty(page);
        }
        // 3.æ ¹æ®idæŸ¥è¯¢æé—®è€…å’Œæœ€è¿‘ä¸€æ¬¡å›ç­”çš„ä¿¡æ¯
        Set<Long> userIds = new HashSet<>();
        Set<Long> answerIds = new HashSet<>();
        // 3.1.å¾—åˆ°é—®é¢˜å½“ä¸­çš„æé—®è€…idå’Œæœ€è¿‘ä¸€æ¬¡å›ç­”çš„id
        for (InteractionQuestion q : records) {
            if(!q.getAnonymity()) { // åªæŸ¥è¯¢éåŒ¿åçš„é—®é¢˜
                userIds.add(q.getUserId());
            }
            answerIds.add(q.getLatestAnswerId());
        }
        // 3.2.æ ¹æ®idæŸ¥è¯¢æœ€è¿‘ä¸€æ¬¡å›ç­”
        answerIds.remove(null);
        Map<Long, InteractionReply> replyMap = new HashMap<>(answerIds.size());
        if(CollUtils.isNotEmpty(answerIds)) {
            List<InteractionReply> replies = replyMapper.selectBatchIds(answerIds);
            for (InteractionReply reply : replies) {
                replyMap.put(reply.getId(), reply);
                if(!reply.getAnonymity()){ // åŒ¿åç”¨æˆ·ä¸åšæŸ¥è¯¢
                    userIds.add(reply.getUserId());
                }
            }
        }

        // 3.3.æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ˆæé—®è€…ï¼‰
        userIds.remove(null);
        Map<Long, UserDTO> userMap = new HashMap<>(userIds.size());
        if(CollUtils.isNotEmpty(userIds)) {
            List<UserDTO> users = userClient.queryUserByIds(userIds);
            userMap = users.stream()
                    .collect(Collectors.toMap(UserDTO::getId, u -> u));
        }

        // 4.å°è£…VO
        List<QuestionVO> voList = new ArrayList<>(records.size());
        for (InteractionQuestion r : records) {
            // 4.1.å°†POè½¬ä¸ºVO
            QuestionVO vo = BeanUtils.copyBean(r, QuestionVO.class);
            voList.add(vo);
            // 4.2.å°è£…æé—®è€…ä¿¡æ¯
            if(!r.getAnonymity()){
                UserDTO userDTO = userMap.get(r.getUserId());
                if (userDTO != null) {
                    vo.setUserName(userDTO.getName());
                    vo.setUserIcon(userDTO.getIcon());
                }
            }

            // 4.3.å°è£…æœ€è¿‘ä¸€æ¬¡å›ç­”çš„ä¿¡æ¯
            InteractionReply reply = replyMap.get(r.getLatestAnswerId());
            if (reply != null) {
                vo.setLatestReplyContent(reply.getContent());
                if(!reply.getAnonymity()){// åŒ¿åç”¨æˆ·ç›´æ¥å¿½ç•¥
                    UserDTO user = userMap.get(reply.getUserId());
                    vo.setLatestReplyUser(user.getName());
                }

            }
        }

        return PageDTO.of(page, voList);
    }
}
```

<br/>

### æ ¹æ®idæŸ¥è¯¢é—®é¢˜è¯¦æƒ…

#### æ¥å£åˆ†æ

å…ˆçœ‹ä¸‹è¯¦æƒ…é¡µåŸå‹å›¾ï¼š

![img](./assets/20230725153715456.jpg)

ç”±æ­¤å¯ä»¥çœ‹å‡ºè¯¦æƒ…é¡µæ‰€éœ€è¦çš„ä¿¡æ¯ç›¸æ¯”åˆ†é¡µæ—¶ï¼Œä¸»è¦å¤šäº†é—®é¢˜è¯¦æƒ…ï¼Œä¸»è¦å­—æ®µæœ‰ï¼š

- æ˜¯å¦åŒ¿å
- ç”¨æˆ·idï¼šåŒ¿ååˆ™ä¸æ˜¾ç¤º
- ç”¨æˆ·å¤´åƒï¼šåŒ¿ååˆ™ä¸æ˜¾ç¤º
- ç”¨æˆ· åç§°ï¼šåŒ¿ååˆ™ä¸æ˜¾ç¤º
- é—®é¢˜æ ‡é¢˜
- æé—®æ—¶é—´
- å›ç­”æ•°é‡
- **é—®é¢˜æè¿°è¯¦æƒ…**

<br/>

è€Œè¯·æ±‚å‚æ•°åˆ™æ›´åŠ ç®€å•äº†ï¼Œå°±æ˜¯é—®é¢˜çš„id

ç„¶åï¼Œå†æŒ‰ç…§Restfulé£æ ¼è®¾è®¡ï¼Œæ¥å£å°±å‡ºæ¥äº†ï¼š

![image-20240219231122610](assets/image-20240219231122610.png)

<br/>

#### å®ä½“ç±»

æ—¢ç„¶ä»…ä»…æ¯”åˆ†é¡µæ—¶å¤šäº†ä¸€ä¸ªå­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥æ²¿ç”¨ä¹‹å‰åˆ†é¡µæŸ¥è¯¢æ—¶çš„VOå¯¹è±¡ï¼Œæ·»åŠ ä¸€ä¸ªæ–°å±æ€§å³å¯ï¼š

![img](./assets/20230725153716017.jpg)

<br/>

#### ä»£ç å®ç°

é¦–å…ˆæ˜¯`tj-learning`ä¸­çš„`InteractionQuestionController`ï¼š

```Java
@ApiOperation("æ ¹æ®idæŸ¥è¯¢é—®é¢˜è¯¦æƒ…")
@GetMapping("/{id}")
public QuestionVO queryQuestionById(@ApiParam(value = "é—®é¢˜id", example = "1") @PathVariable("id") Long id){
    return questionService.queryQuestionById(id);
}
```

<br/>

ç„¶åæ˜¯ `tj-learning` ä¸­çš„ `IInteractionQuestionService` æ¥å£ï¼š

```Java
QuestionVO queryQuestionById(Long id);
```

<br/>

æœ€åæ˜¯ `tj-learning `ä¸­çš„ `InteractionQuestionServiceImpl `å®ç°ç±»ï¼š

```Java
@Override
public QuestionVO queryQuestionById(Long id) {
    // 1.æ ¹æ®idæŸ¥è¯¢æ•°æ®
    InteractionQuestion question = getById(id);
    // 2.æ•°æ®æ ¡éªŒ
    if(question == null || question.getHidden()){
        // æ²¡æœ‰æ•°æ®æˆ–è€…æ˜¯è¢«éšè—äº†
        return null;
    }
    // 3.æŸ¥è¯¢æé—®è€…ä¿¡æ¯
    UserDTO user = null;
    if(!question.getAnonymity()){
        user = userClient.queryUserById(question.getUserId());
    }
    // 4.å°è£…VO
    QuestionVO vo = BeanUtils.copyBean(question, QuestionVO.class);
    if (user != null) {
        vo.setUserName(user.getName());
        vo.setUserIcon(user.getIcon());
    }
    return vo;
}
```

<br/>

### åˆ é™¤æˆ‘çš„é—®é¢˜ï¼ˆç»ƒä¹ ï¼‰

#### æ¥å£åˆ†æ

ç”¨æˆ·å¯ä»¥åˆ é™¤è‡ªå·±æé—®çš„é—®é¢˜ï¼Œå¦‚å›¾ï¼š

![img](./assets/20230725153715828.jpg)

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ç”¨æˆ·åˆ é™¤æŸä¸ªé—®é¢˜æ—¶ï¼Œä¹Ÿéœ€è¦åˆ é™¤é—®é¢˜ä¸‹çš„å›ç­”ã€è¯„è®ºã€‚

æ•´ä½“ä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š

- æŸ¥è¯¢é—®é¢˜æ˜¯å¦å­˜åœ¨
- åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰ç”¨æˆ·æé—®çš„
- å¦‚æœä¸æ˜¯åˆ™æŠ¥é”™
- å¦‚æœæ˜¯åˆ™åˆ é™¤é—®é¢˜
- ç„¶ååˆ é™¤é—®é¢˜ä¸‹çš„å›ç­”åŠè¯„è®º

æ¥å£ä¿¡æ¯å¦‚ä¸‹ï¼š

- **æ¥å£åœ°å€**:`/questions/{id}`
- **è¯·æ±‚æ–¹å¼**:`DELETE`
- **è¯·æ±‚å‚æ•°**: åŸºäºè·¯å¾„å ä½ç¬¦ï¼Œé—®é¢˜id

#### ä»£ç å®ç°ï¼ˆç»ƒä¹ ï¼‰

<br/>

### ç®¡ç†ç«¯åˆ†é¡µæŸ¥è¯¢é—®é¢˜

#### æ¥å£åˆ†æ

åœ¨ç®¡ç†ç«¯åå°å­˜åœ¨é—®ç­”ç®¡ç†åˆ—è¡¨é¡µï¼Œä¸ç”¨æˆ·ç«¯ç±»ä¼¼éƒ½æ˜¯åˆ†é¡µæŸ¥è¯¢ï¼Œä½†æ˜¯è¯·æ±‚å‚æ•°å’Œè¿”å›å€¼æœ‰è¾ƒå¤§å·®åˆ«ï¼š

![img](./assets/20230725153716555.jpg)

ä»è¯·æ±‚å‚æ•°æ¥çœ‹ï¼Œé™¤äº†åˆ†é¡µå‚æ•°ï¼Œè¿˜åŒ…å«3ä¸ªï¼š

- é—®é¢˜çš„æŸ¥çœ‹çŠ¶æ€
- è¯¾ç¨‹åç§°
- æé—®æ—¶é—´

ä»è¿”å›å€¼æ¥çœ‹ï¼Œæ¯”ç”¨æˆ·ç«¯å¤šäº†ä¸€äº›å­—æ®µï¼š

- æ˜¯å¦åŒ¿å: ç®¡ç†ç«¯ä¸å…³å¿ƒï¼Œå…¨éƒ½å±•ç¤º
- æé—®è€…ä¿¡æ¯ï¼š
  - ç”¨æˆ·id
  - ç”¨æˆ·å¤´åƒï¼šåŒ¿ååˆ™ä¸æ˜¾ç¤º
  - ç”¨æˆ· åç§°ï¼šåŒ¿ååˆ™ä¸æ˜¾ç¤º
- é—®é¢˜æ ‡é¢˜
- æé—®æ—¶é—´
- å›ç­”æ•°é‡
- æœ€è¿‘ä¸€æ¬¡å›ç­”çš„ä¿¡æ¯ï¼š
  - å›ç­”äººåç§°
  - å›ç­”å†…å®¹
- é—®é¢˜å…³è”çš„è¯¾ç¨‹åç§°
- é—®é¢˜å…³è”çš„ç« ã€èŠ‚åç§°
- é—®é¢˜å…³è”è¯¾ç¨‹çš„åˆ†ç±»åç§°

<br/>

ç”±äºè¯·æ±‚å…¥å‚å’Œè¿”å›å€¼ä¸ç”¨æˆ·ç«¯æœ‰è¾ƒå¤§å·®å¼‚ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªæ–°çš„æ¥å£ï¼š

![image-20240219233014749](assets/image-20240219233014749.png)

<br/>

#### å®ä½“ç±»

ä¸ç”¨æˆ·ç«¯åˆ†é¡µæŸ¥è¯¢é—®é¢˜ç±»ä¼¼ï¼Œè¿™é‡Œä¹Ÿéœ€è¦å®šä¹‰Queryå®ä½“ã€VOå®ä½“ã€‚è¯¾å‰èµ„æ–™ä¸­å·²ç»æä¾›å¥½äº†ï¼š

é¦–å…ˆæ˜¯Queryï¼š

![img](./assets/20230725153716084.jpg)

ç„¶åæ˜¯VOï¼š

![img](./assets/20230725153716351.jpg)

<br/>

#### æ¥å£å£°æ˜

ä¸ºäº†ä¸ç”¨æˆ·ç«¯åŠ ä»¥åŒºåˆ†ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–°çš„controllerï¼š

![img](./assets/20230725153716441.jpg)

ä»£ç å¦‚ä¸‹ï¼š

```Java
package com.tianji.learning.controller;


import com.tianji.common.domain.dto.PageDTO;
import com.tianji.learning.domain.query.QuestionAdminPageQuery;
import com.tianji.learning.domain.vo.QuestionAdminVO;
import com.tianji.learning.service.IInteractionQuestionService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiParam;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;

/**
 * <p>
 * äº’åŠ¨æé—®çš„é—®é¢˜è¡¨ å‰ç«¯æ§åˆ¶å™¨
 * </p>
 *
 * @author è™å“¥
 */
@RestController
@RequestMapping("/admin/questions")
@Api(tags = "äº’åŠ¨é—®ç­”ç›¸å…³æ¥å£")
@RequiredArgsConstructor
public class InteractionQuestionAdminController {

    private final IInteractionQuestionService questionService;

    @ApiOperation("ç®¡ç†ç«¯åˆ†é¡µæŸ¥è¯¢äº’åŠ¨é—®é¢˜")
    @GetMapping("page")
    public PageDTO<QuestionAdminVO> queryQuestionPageAdmin(QuestionAdminPageQuery query){
        return questionService.queryQuestionPageAdmin(query);
    }
}
```

<br/>

ç„¶ååœ¨`tj-learning`çš„`com.tianji.learning.service.IInteractionQuestionService`ä¸­æ·»åŠ æ–¹æ³•å£°æ˜ï¼š

```Java
PageDTO<QuestionAdminVO> queryQuestionPageAdmin(QuestionAdminPageQuery query);
```

<br/>

åœ¨å®ç°ç±»`com.tianji.learning.service.impl.InteractionQuestionServiceImpl`ä¸­å®ç°æ–¹æ³•ï¼š

```Java
@Override
public PageDTO<QuestionAdminVO> queryQuestionsPageForAdmin(QuestionAdminPageQuery query) {
    // TODO
    return null;
}
```

<br/>

#### è¯¾ç¨‹åç§°æ¨¡ç³Šæœç´¢

åœ¨ç®¡ç†ç«¯çš„æŸ¥è¯¢æ¡ä»¶ä¸­æœ‰ä¸€ä¸ªæ ¹æ®è¯¾ç¨‹åç§°æœç´¢ï¼š

![img](./assets/20230725153716921.jpg)

ä½†æ˜¯ï¼Œåœ¨ interaction_question è¡¨ä¸­ï¼Œå¹¶æ²¡æœ‰è¯¾ç¨‹åç§°å­—æ®µï¼Œåªæœ‰è¯¾ç¨‹idï¼š

![img](./assets/20230725153716744.jpg)

é‚£æˆ‘ä»¬è¯¥å¦‚ä½•å®ç°æ¨¡ç³Šæœç´¢å‘¢ï¼Ÿ

<br/>

åœ¨å¤©æœºå­¦å ‚é¡¹ç›®ä¸­ï¼Œæ‰€æœ‰ä¸Šçº¿çš„è¯¾ç¨‹æ•°æ®éƒ½ä¼šå­˜å‚¨åˆ°`Elasticsearch`ä¸­ï¼Œæ–¹ä¾¿ç”¨æˆ·æ£€ç´¢è¯¾ç¨‹ã€‚å¹¶ä¸”åœ¨`tj-search`æ¨¡å—ä¸­æä¾›äº†ç›¸å…³çš„æŸ¥è¯¢æ¥å£ã€‚

å…¶ä¸­å°±æœ‰æ ¹æ®è¯¾ç¨‹åç§°æœç´¢è¯¾ç¨‹ä¿¡æ¯çš„åŠŸèƒ½ï¼Œå¹¶ä¸”è¿™ä¸ªåŠŸèƒ½è¿˜å¯¹å¤–å¼€æ”¾äº†ä¸€ä¸ªFeignå®¢æˆ·ç«¯æ–¹ä¾¿æˆ‘ä»¬è°ƒç”¨ï¼š

![img](./assets/20230725153718205.jpg)

è¿™ä¸ªæ¥å£çš„è¯·æ±‚å‚æ•°å°±æ˜¯è¯¾ç¨‹**åç§°å…³é”®å­—**ï¼Œå…¶å†…éƒ¨ä¼šåˆ©ç”¨elasticsearchçš„å…¨æ–‡æ£€ç´¢åŠŸèƒ½å¸®æˆ‘ä»¬æŸ¥è¯¢ç›¸å…³è¯¾ç¨‹ï¼Œå¹¶è¿”å›è¯¾ç¨‹idé›†åˆã€‚è¿™ä¸æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„å˜›ï¼

<br/>

å› æ­¤ï¼Œå¦‚æœå‰ç«¯ä¼ é€’äº†è¯¾ç¨‹åç§°å…³é”®å­—ï¼Œæˆ‘ä»¬çš„æœç´¢æµç¨‹å¦‚ä¸‹ï¼š

- é¦–å…ˆè°ƒç”¨SearchClientæ¥å£ï¼Œæ ¹æ®åç§°å…³é”®å­—æœç´¢ï¼Œè·å–courseIdé›†åˆ
- åˆ¤æ–­ç»“æœæ˜¯å¦ä¸ºç©º
  - å¦‚æœä¸ºç©ºï¼Œç›´æ¥ç»“æŸï¼Œä»£è¡¨æ²¡æœ‰æœç´¢åˆ°
  - å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™æŠŠå¾—åˆ°çš„courseIdé›†åˆä½œä¸ºæ¡ä»¶ï¼Œç»“åˆå…¶å®ƒæ¡ä»¶ï¼Œåˆ†é¡µæŸ¥è¯¢é—®é¢˜å³å¯

<br/>

#### è¯¾ç¨‹åˆ†ç±»æ•°æ®

**æŸ¥è¯¢æ€è·¯åˆ†æ**

å‰é¢åˆ†æè¿‡ï¼Œç®¡ç†ç«¯é™¤äº†è¦æŸ¥è¯¢åˆ°é—®é¢˜ï¼Œè¿˜éœ€è¦è¿”å›é—®é¢˜æ‰€å±çš„ä¸€ç³»åˆ—ä¿¡æ¯ï¼š

![img](./assets/20230725153716933.jpg)

è¿™äº›æ•°æ®å¯¹åº”åˆ°interaction_questionè¡¨ä¸­ï¼ŒåªåŒ…å«ä¸€äº›idå­—æ®µï¼š

![img](./assets/20230725153717524.jpg)

é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•è·å–å…¶åç§°æ•°æ®å‘¢ï¼Ÿ

- è¯¾ç¨‹åç§°ï¼šæ ¹æ®course_idåˆ°è¯¾ç¨‹å¾®æœåŠ¡æŸ¥è¯¢
- ç« èŠ‚åç§°ï¼šæ ¹æ®chapter_idå’Œsection_idåˆ°è¯¾ç¨‹å¾®æœåŠ¡æŸ¥è¯¢
- **åˆ†ç±»**ï¼šæœªçŸ¥
- æé—®è€…åç§°ï¼šæ ¹æ®user_idåˆ°ç”¨æˆ·å¾®æœåŠ¡æŸ¥è¯¢

å…¶ä¸­ï¼Œè¯¾ç¨‹ã€ç« èŠ‚ã€æé—®è€…ç­‰ä¿¡æ¯çš„æŸ¥è¯¢åœ¨ä»¥å¾€çš„ä¸šåŠ¡ä¸­æˆ‘ä»¬å·²ç»æ¶‰åŠåˆ°ï¼Œä¸å†èµ˜è¿°ã€‚ä½†æ˜¯è¯¾ç¨‹åˆ†ç±»ä¿¡æ¯ä»¥å‰æ²¡æœ‰æŸ¥è¯¢è¿‡ã€‚

<br/>

è¯¾ç¨‹åˆ†ç±»åœ¨é¦–é¡µå°±èƒ½çœ‹åˆ°ï¼Œå…±åˆ†ä¸º3çº§ï¼š

![img](./assets/20230725153717665.jpg)

æ¯ä¸€ä¸ªè¯¾ç¨‹éƒ½ä¸ç¬¬ä¸‰çº§åˆ†ç±»å…³è”ï¼Œå› æ­¤å‘ä¸Šçº§è¿½æº¯ï¼Œä¹Ÿæœ‰å¯¹åº”çš„äºŒçº§ã€ä¸€çº§åˆ†ç±»ã€‚åœ¨è¯¾ç¨‹å¾®æœåŠ¡æä¾›çš„æŸ¥è¯¢è¯¾ç¨‹çš„æ¥å£ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›çš„è¯¾ç¨‹ä¿¡æ¯ä¸­å°±åŒ…å«äº†å…³è”çš„ä¸€çº§ã€äºŒçº§ã€ä¸‰çº§åˆ†ç±»ï¼š

![image-20240219233309137](assets/image-20240219233309137.png)

å› æ­¤ï¼Œ**åªè¦æˆ‘ä»¬æŸ¥è¯¢åˆ°äº†é—®é¢˜æ‰€å±çš„è¯¾ç¨‹ï¼Œå°±èƒ½çŸ¥é“è¯¾ç¨‹å…³è”çš„ä¸‰çº§åˆ†ç±»id**ï¼Œæ¥ä¸‹æ¥åªéœ€è¦æ ¹æ®åˆ†ç±»idæŸ¥è¯¢å‡ºåˆ†ç±»åç§°å³å¯ã€‚

<br/>

è€Œåœ¨course-serviceæœåŠ¡ä¸­æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥æŸ¥è¯¢åˆ°æ‰€æœ‰çš„åˆ†ç±»ï¼š

![img](./assets/20230725153718630.jpg)

éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™ä¸ªè¿”å›çš„æ˜¯æ‰€æœ‰è¯¾ç¨‹åˆ†ç±»çš„é›†åˆï¼Œè€Œè¯¾ç¨‹ä¸­åªåŒ…å«3ä¸ªåˆ†ç±»idã€‚å› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå·±ä»æ‰€æœ‰åˆ†ç±»é›†åˆä¸­æ‰¾å‡ºè¯¾ç¨‹æœ‰å…³çš„è¿™ä¸‰ä¸ªã€‚

åˆ†æåˆ°è¿™é‡Œå¤§å®¶åº”è¯¥çŸ¥é“å¦‚ä½•åšäº†ã€‚ä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªå€¼å¾—æ€è€ƒçš„ç‚¹ï¼š

- è¯¾ç¨‹åˆ†ç±»æ•°æ®åœ¨å¾ˆå¤šä¸šåŠ¡ä¸­éƒ½éœ€è¦æŸ¥è¯¢ï¼Œè¿™æ ·çš„æ•°æ®å¦‚æ­¤é¢‘ç¹çš„æŸ¥è¯¢ï¼Œæœ‰æ²¡æœ‰æ€§èƒ½ä¼˜åŒ–çš„åŠæ³•å‘¢ï¼Ÿ

<br/>

##### å¤šçº§ç¼“å­˜

ç›¸ä¿¡å¾ˆå¤šåŒå­¦éƒ½èƒ½æƒ³åˆ°å€ŸåŠ©äºRedisç¼“å­˜æ¥æé«˜æ€§èƒ½ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›ã€‚éå¸¸å¥½ï¼ä¸è¿‡ï¼ŒRedisè™½ç„¶èƒ½æé«˜æ€§èƒ½ï¼Œä½†æ¯æ¬¡æŸ¥è¯¢ç¼“å­˜è¿˜æ˜¯ä¼š**å¢åŠ ç½‘ç»œå¸¦å®½æ¶ˆè€—**ï¼Œä¹Ÿä¼šå­˜åœ¨**ç½‘ç»œå»¶è¿Ÿ**ã€‚

è€Œåˆ†ç±»æ•°æ®å…·å¤‡ä¸¤å¤§ç‰¹ç‚¹ï¼š

- æ•°æ®é‡å°
- é•¿æ—¶é—´ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚

åƒè¿™æ ·çš„æ•°æ®ï¼Œé™¤äº†å»ºç«‹Redisç¼“å­˜ä»¥å¤–ï¼Œè¿˜éå¸¸é€‚åˆåšæœ¬åœ°ç¼“å­˜ï¼ˆLocal Cacheï¼‰ã€‚è¿™æ ·å°±å¯ä»¥å½¢æˆå¤šçº§ç¼“å­˜æœºåˆ¶ï¼š

- æ•°æ®æŸ¥è¯¢æ—¶ä¼˜å…ˆæŸ¥è¯¢æœ¬åœ°ç¼“å­˜
- æœ¬åœ°ç¼“å­˜ä¸å­˜åœ¨ï¼Œå†æŸ¥è¯¢Redisç¼“å­˜
- Redisä¸å­˜åœ¨ï¼Œå†å»æŸ¥è¯¢æ•°æ®åº“ã€‚

å¦‚å›¾ï¼š

![image-20240219233351430](assets/image-20240219233351430.png)

é‚£ä¹ˆï¼Œæœ¬åœ°ç¼“å­˜ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåˆè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ

<br/>

æœ¬åœ°ç¼“å­˜ç®€å•æ¥è¯´å°±æ˜¯JVMå†…å­˜çš„ç¼“å­˜ï¼Œæ¯”å¦‚ä½ å»ºç«‹ä¸€ä¸ªHashMapï¼ŒæŠŠæ•°æ®åº“æŸ¥è¯¢çš„æ•°æ®å­˜å…¥è¿›å»ã€‚ä»¥åä¼˜å…ˆä»è¿™ä¸ªHashMapæŸ¥è¯¢ï¼Œä¸€ä¸ªæœ¬åœ°ç¼“å­˜å°±å»ºç«‹å¥½äº†ã€‚

æœ¬åœ°ç¼“å­˜ä¼˜ç‚¹ï¼š

- è¯»å–æœ¬åœ°å†…å­˜ï¼Œæ²¡æœ‰ç½‘ç»œå¼€é”€ï¼Œé€Ÿåº¦æ›´å¿«

æœ¬åœ°ç¼“å­˜ç¼ºç‚¹ï¼š

- æ•°æ®åŒæ­¥å›°éš¾ï¼Œä¸€èˆ¬é‡‡ç”¨è‡ªåŠ¨è¿‡æœŸæ–¹æ¡ˆ
- å­˜å‚¨å®¹é‡æœ‰é™ã€å¯é æ€§è¾ƒä½ã€æ— æ³•å…±äº«

<br/>

æœ¬åœ°ç¼“å­˜ç”±äºæ— éœ€ç½‘ç»œæŸ¥è¯¢ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚ä¸è¿‡ç”±äºä¸Šè¿°ç¼ºç‚¹ï¼Œæœ¬åœ°ç¼“å­˜å¾€å¾€é€‚ç”¨äº**æ•°æ®é‡å°**ã€**æ›´æ–°ä¸é¢‘ç¹**çš„æ•°æ®ã€‚è€Œè¯¾ç¨‹åˆ†ç±»æ°å¥½ç¬¦åˆã€‚

<br/>

##### Caffeine

å½“ç„¶ï¼Œæˆ‘ä»¬çœŸæ­£åˆ›å»ºæœ¬åœ°ç¼“å­˜çš„æ—¶å€™å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨HashMapä¹‹ç±»çš„é›†åˆï¼Œå› ä¸ºç»´æŠ¤èµ·æ¥ä¸å¤ªæ–¹ä¾¿ã€‚è€Œä¸”å†…å­˜æ·˜æ±°æœºåˆ¶å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨æˆç†Ÿçš„æ¡†æ¶æ¥å®Œæˆï¼Œæ¯”å¦‚Caffeineï¼š

**Caffeine**æ˜¯ä¸€ä¸ªåŸºäºJava8å¼€å‘çš„ï¼Œæä¾›äº†è¿‘ä¹æœ€ä½³å‘½ä¸­ç‡çš„é«˜æ€§èƒ½çš„æœ¬åœ°ç¼“å­˜åº“ã€‚ç›®å‰Springå†…éƒ¨çš„ç¼“å­˜ä½¿ç”¨çš„å°±æ˜¯Caffeineã€‚GitHubåœ°å€ï¼šhttps://github.com/ben-manes/caffeine

Caffeineçš„æ€§èƒ½éå¸¸å¥½ï¼Œä¸‹å›¾æ˜¯å®˜æ–¹ç»™å‡ºçš„å‡ ç§å¸¸è§çš„æœ¬åœ°ç¼“å­˜å®ç°æ–¹æ¡ˆçš„æ€§èƒ½å¯¹æ¯”ï¼š

![img](./assets/20230725153717861.jpg)

å¯ä»¥çœ‹åˆ°Caffeineçš„æ€§èƒ½é¥é¥é¢†å…ˆï¼

<br/>

ç¼“å­˜ä½¿ç”¨çš„åŸºæœ¬APIï¼š

```Java
@Test
void testBasicOps() {
    // æ„å»ºcacheå¯¹è±¡
    Cache<String, String> cache = Caffeine.newBuilder().build();

    // å­˜æ•°æ®
    cache.put("gf", "è¿ªä¸½çƒ­å·´");

    // å–æ•°æ®
    String gf = cache.getIfPresent("gf");
    System.out.println("gf = " + gf);

    // å–æ•°æ®ï¼ŒåŒ…å«ä¸¤ä¸ªå‚æ•°ï¼š
    // å‚æ•°ä¸€ï¼šç¼“å­˜çš„key
    // å‚æ•°äºŒï¼šLambdaè¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼å‚æ•°å°±æ˜¯ç¼“å­˜çš„keyï¼Œæ–¹æ³•ä½“æ˜¯æŸ¥è¯¢æ•°æ®åº“çš„é€»è¾‘
    // ä¼˜å…ˆæ ¹æ®keyæŸ¥è¯¢JVMç¼“å­˜ï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œåˆ™æ‰§è¡Œå‚æ•°äºŒçš„Lambdaè¡¨è¾¾å¼
    String defaultGF = cache.get("defaultGF", key -> {
        // æ ¹æ®keyå»æ•°æ®åº“æŸ¥è¯¢æ•°æ®
        return "æŸ³å²©";
    });
    System.out.println("defaultGF = " + defaultGF);
}
```

Caffeineæ—¢ç„¶æ˜¯ç¼“å­˜çš„ä¸€ç§ï¼Œè‚¯å®šéœ€è¦æœ‰ç¼“å­˜çš„æ¸…é™¤ç­–ç•¥ï¼Œä¸ç„¶çš„è¯å†…å­˜æ€»ä¼šæœ‰è€—å°½çš„æ—¶å€™ã€‚

<br/>

Caffeineæä¾›äº†ä¸‰ç§ç¼“å­˜é©±é€ç­–ç•¥ï¼š

-  **åŸºäºå®¹é‡**ï¼šè®¾ç½®ç¼“å­˜çš„æ•°é‡ä¸Šé™ 

```Java
// åˆ›å»ºç¼“å­˜å¯¹è±¡
Cache<String, String> cache = Caffeine.newBuilder()
    .maximumSize(1) // è®¾ç½®ç¼“å­˜å¤§å°ä¸Šé™ä¸º 1
    .build();
```

 <br/>

-  **åŸºäºæ—¶é—´**ï¼šè®¾ç½®ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´ 

```Java
// åˆ›å»ºç¼“å­˜å¯¹è±¡
Cache<String, String> cache = Caffeine.newBuilder()
    // è®¾ç½®ç¼“å­˜æœ‰æ•ˆæœŸä¸º 10 ç§’ï¼Œä»æœ€åä¸€æ¬¡å†™å…¥å¼€å§‹è®¡æ—¶ 
    .expireAfterWrite(Duration.ofSeconds(10)) 
    .build();
```

 <br/>

-  **åŸºäºå¼•ç”¨**ï¼šè®¾ç½®ç¼“å­˜ä¸ºè½¯å¼•ç”¨æˆ–å¼±å¼•ç”¨ï¼Œåˆ©ç”¨GCæ¥å›æ”¶ç¼“å­˜æ•°æ®ã€‚æ€§èƒ½è¾ƒå·®ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚ 

<br/>

**æ³¨æ„**ï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç¼“å­˜å…ƒç´ è¿‡æœŸçš„æ—¶å€™ï¼ŒCaffeineä¸ä¼šè‡ªåŠ¨ç«‹å³å°†å…¶æ¸…ç†å’Œé©±é€ã€‚è€Œæ˜¯åœ¨ä¸€æ¬¡è¯»æˆ–å†™æ“ä½œåï¼Œæˆ–è€…åœ¨ç©ºé—²æ—¶é—´å®Œæˆå¯¹å¤±æ•ˆæ•°æ®çš„é©±é€ã€‚

<br/>

##### è¯¾ç¨‹åˆ†ç±»çš„æœ¬åœ°ç¼“å­˜

å…¶å®ï¼Œåœ¨ `tj-api` æ¨¡å—ä¸­ï¼Œå·²ç»å®šä¹‰å¥½äº†å•†å“åˆ†ç±»çš„æœ¬åœ°ç¼“å­˜ï¼š

![img](./assets/20230725153718294.jpg)

å…¶ä¸­`CategoryCacheConfig`æ˜¯Caffeineçš„ç¼“å­˜é…ç½®ï¼š

```Java
package com.tianji.api.config;

import com.github.benmanes.caffeine.cache.Cache;
import com.github.benmanes.caffeine.cache.Caffeine;
import com.tianji.api.cache.CategoryCache;
import com.tianji.api.client.course.CategoryClient;
import com.tianji.api.dto.course.CategoryBasicDTO;
import org.springframework.context.annotation.Bean;

import java.time.Duration;
import java.util.Map;

public class CategoryCacheConfig {
    /**
     * è¯¾ç¨‹åˆ†ç±»çš„caffeineç¼“å­˜
     */
    @Bean
    public Cache<String, Map<Long, CategoryBasicDTO>> categoryCaches(){
        return Caffeine.newBuilder()
                .initialCapacity(1) // å®¹é‡é™åˆ¶
                .maximumSize(10_000) // æœ€å¤§å†…å­˜é™åˆ¶
                .expireAfterWrite(Duration.ofMinutes(30)) // æœ‰æ•ˆæœŸ
                .build();
    }
    /**
     * è¯¾ç¨‹åˆ†ç±»çš„ç¼“å­˜å·¥å…·ç±»
     */
    @Bean
    public CategoryCache categoryCache(
            Cache<String, Map<Long, CategoryBasicDTO>> categoryCaches, CategoryClient categoryClient){
        return new CategoryCache(categoryCaches, categoryClient);
    }
}
```

è€Œ`CategoryCache`åˆ™æ˜¯ç¼“å­˜ä½¿ç”¨çš„å·¥å…·ç±»ã€‚ç”±äºå•†å“åˆ†ç±»ç»å¸¸éœ€è¦æ ¹æ®idæŸ¥è¯¢ï¼Œå› æ­¤æˆ‘æ ¹æ®idæŸ¥è¯¢åˆ†ç±»çš„å„ç§APIï¼š

![img](./assets/20230725153718801.jpg)

è¿™æ ·ï¼Œåœ¨ä»»ä½•å¾®æœåŠ¡ä¸­ï¼Œåªè¦å¼•å…¥`tj-api`ï¼Œæˆ‘ä»¬å°±èƒ½éå¸¸æ–¹ä¾¿å¹¶ä¸”é«˜æ€§èƒ½çš„è·å–åˆ†ç±»åç§°äº†ã€‚

<br/>

:::warning ğŸ’¡ **æ³¨æ„**ï¼š

åœ¨CategoryCacheä¸­æˆ‘ä»¬åªåˆ©ç”¨Caffeineå®ç°äº†æœ¬åœ°ç¼“å­˜ã€‚å½“ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œæˆ‘ä»¬ä¼šå»è°ƒç”¨course-serviceæä¾›çš„CategoryClientæä¾›çš„æ–¹æ³•æŸ¥è¯¢åˆ†ç±»æ•°æ®ï¼Œè€Œä¸æ˜¯å»æŸ¥è¯¢Redisã€‚

å¦‚æœè¦å®ç°å¤šçº§ç¼“å­˜ï¼Œå¯ä»¥åœ¨course-serviceæœåŠ¡ä¸­å®ç°åˆ†ç±»æŸ¥è¯¢çš„æ¥å£å†…æ·»åŠ Redisç¼“å­˜ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå®ç°ã€‚

:::

<br/>

##### å®ç°åˆ†é¡µæŸ¥è¯¢

æœ€ç»ˆï¼Œ`InteractionQuestionServiceImpl`ä»£ç å¦‚ä¸‹ï¼š

```Java
@Override
public PageDTO<QuestionAdminVO> queryQuestionPageAdmin(QuestionAdminPageQuery query) {
    // 1.å¤„ç†è¯¾ç¨‹åç§°ï¼Œå¾—åˆ°è¯¾ç¨‹id
    List<Long> courseIds = null;
    if (StringUtils.isNotBlank(query.getCourseName())) {
        courseIds = searchClient.queryCoursesIdByName(query.getCourseName());
        if (CollUtils.isEmpty(courseIds)) {
            return PageDTO.empty(0L, 0L);
        }
    }
    // 2.åˆ†é¡µæŸ¥è¯¢
    Integer status = query.getStatus();
    LocalDateTime begin = query.getBeginTime();
    LocalDateTime end = query.getEndTime();
    Page<InteractionQuestion> page = lambdaQuery()
            .in(courseIds != null, InteractionQuestion::getCourseId, courseIds)
            .eq(status != null, InteractionQuestion::getStatus, status)
            .gt(begin != null, InteractionQuestion::getCreateTime, begin)
            .lt(end != null, InteractionQuestion::getCreateTime, end)
            .page(query.toMpPageDefaultSortByCreateTimeDesc());
    List<InteractionQuestion> records = page.getRecords();
    if (CollUtils.isEmpty(records)) {
        return PageDTO.empty(page);
    }

    // 3.å‡†å¤‡VOéœ€è¦çš„æ•°æ®ï¼šç”¨æˆ·æ•°æ®ã€è¯¾ç¨‹æ•°æ®ã€ç« èŠ‚æ•°æ®
    Set<Long> userIds = new HashSet<>();
    Set<Long> cIds = new HashSet<>();
    Set<Long> cataIds = new HashSet<>();
    // 3.1.è·å–å„ç§æ•°æ®çš„idé›†åˆ
    for (InteractionQuestion q : records) {
        userIds.add(q.getUserId());
        cIds.add(q.getCourseId());
        cataIds.add(q.getChapterId());
        cataIds.add(q.getSectionId());
    }
    // 3.2.æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·
    List<UserDTO> users = userClient.queryUserByIds(userIds);
    Map<Long, UserDTO> userMap = new HashMap<>(users.size());
    if (CollUtils.isNotEmpty(users)) {
        userMap = users.stream().collect(Collectors.toMap(UserDTO::getId, u -> u));
    }

    // 3.3.æ ¹æ®idæŸ¥è¯¢è¯¾ç¨‹
    List<CourseSimpleInfoDTO> cInfos = courseClient.getSimpleInfoList(cIds);
    Map<Long, CourseSimpleInfoDTO> cInfoMap = new HashMap<>(cInfos.size());
    if (CollUtils.isNotEmpty(cInfos)) {
        cInfoMap = cInfos.stream().collect(Collectors.toMap(CourseSimpleInfoDTO::getId, c -> c));
    }

    // 3.4.æ ¹æ®idæŸ¥è¯¢ç« èŠ‚
    List<CataSimpleInfoDTO> catas = catalogueClient.batchQueryCatalogue(cataIds);
    Map<Long, String> cataMap = new HashMap<>(catas.size());
    if (CollUtils.isNotEmpty(catas)) {
        cataMap = catas.stream()
                .collect(Collectors.toMap(CataSimpleInfoDTO::getId, CataSimpleInfoDTO::getName));
    }


    // 4.å°è£…VO
    List<QuestionAdminVO> voList = new ArrayList<>(records.size());
    for (InteractionQuestion q : records) {
        // 4.1.å°†POè½¬VOï¼Œå±æ€§æ‹·è´
        QuestionAdminVO vo = BeanUtils.copyBean(q, QuestionAdminVO.class);
        voList.add(vo);
        // 4.2.ç”¨æˆ·ä¿¡æ¯
        UserDTO user = userMap.get(q.getUserId());
        if (user != null) {
            vo.setUserName(user.getName());
        }
        // 4.3.è¯¾ç¨‹ä¿¡æ¯ä»¥åŠåˆ†ç±»ä¿¡æ¯
        CourseSimpleInfoDTO cInfo = cInfoMap.get(q.getCourseId());
        if (cInfo != null) {
            vo.setCourseName(cInfo.getName());
            vo.setCategoryName(categoryCache.getCategoryNames(cInfo.getCategoryIds()));
        }
        // 4.4.ç« èŠ‚ä¿¡æ¯
        vo.setChapterName(cataMap.getOrDefault(q.getChapterId(), ""));
        vo.setSectionName(cataMap.getOrDefault(q.getSectionId(), ""));
    }
    return PageDTO.of(page, voList);
```

<br/>

### ç®¡ç†ç«¯éšè—æˆ–æ˜¾ç¤ºé—®é¢˜ï¼ˆç»ƒä¹ ï¼‰

#### æ¥å£åˆ†æ

åœ¨ç®¡ç†ç«¯çš„äº’åŠ¨é—®é¢˜åˆ—è¡¨ä¸­ï¼Œç®¡ç†å‘˜å¯ä»¥éšè—æŸä¸ªé—®é¢˜ï¼Œè¿™æ ·å°±ä¸ä¼šåœ¨ç”¨æˆ·ç«¯é¡µé¢å±•ç¤ºäº†ï¼š

![img](./assets/20230725153718324.jpg)

ç”±äº`interaction_question`è¡¨ä¸­æœ‰ä¸€ä¸ª`hidden`å­—æ®µæ¥è¡¨ç¤ºæ˜¯å¦éšè—ï¼š

![img](./assets/20230725153718476.jpg)

å› æ­¤ï¼Œæœ¬è´¨æ¥è¯´ï¼Œè¿™ä¸ªæ¥å£æ˜¯ä¸€ä¸ªä¿®æ”¹æŸå­—æ®µå€¼çš„æ¥å£ï¼Œå¹¶ä¸å¤æ‚ã€‚

æˆ‘ä»¬æŒ‰ç…§Restfulçš„é£æ ¼æ¥è®¾å®šï¼Œæ¥å£ä¿¡æ¯å¦‚ä¸‹ï¼š

- **æ¥å£åœ°å€**:`/admin/questions/{id}/hidden/{hidden}`
- **è¯·æ±‚æ–¹å¼**:`PUT`
- **è¯·æ±‚å‚æ•°**: è·¯å¾„å ä½ç¬¦å‚æ•°
  - idï¼šé—®é¢˜id
  - hiddenï¼šæ˜¯å¦éšè—

<br/>

#### ä»£ç å®ç°ï¼ˆç»ƒä¹ ï¼‰

<br/>

### ç®¡ç†ç«¯æ ¹æ®idæŸ¥è¯¢é—®é¢˜è¯¦æƒ…ï¼ˆç»ƒä¹ ï¼‰

#### æ¥å£åˆ†æ

åœ¨ç®¡ç†ç«¯çš„é—®é¢˜ç®¡ç†é¡µé¢ï¼Œç‚¹å‡»æŸ¥çœ‹æŒ‰é’®å°±ä¼šè¿›å…¥é—®é¢˜è¯¦æƒ…é¡µï¼š

![img](./assets/20230725153718806.jpg)

é—®é¢˜è¯¦æƒ…é¡µå¦‚ä¸‹ï¼š

![img](./assets/20230725153718935.jpg)

å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œéœ€è¦æŸ¥è¯¢çš„æ•°æ®è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼ŒåŒ…å«ï¼š

- é—®é¢˜æ ‡é¢˜
- é—®é¢˜æè¿°
- æé—®è€…ä¿¡æ¯
  - id
  - æ˜µç§°
  - å¤´åƒ
- è¯¾ç¨‹ä¸‰çº§åˆ†ç±»
- è¯¾ç¨‹åç§°
- **è¯¾ç¨‹è´Ÿè´£è€å¸ˆ**
- è¯¾ç¨‹æ‰€å±ç« èŠ‚
- å›ç­”æ•°é‡
- ç”¨æˆ·ç«¯æ˜¯å¦æ˜¾ç¤º

<br/>

è¿”å›å€¼ä¸ç®¡ç†ç«¯åˆ†é¡µæŸ¥è¯¢åŸºæœ¬ä¸€è‡´ï¼Œå¤šäº†ä¸€ä¸ªè¯¾ç¨‹è´Ÿè´£è€å¸ˆä¿¡æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬æ²¿ç”¨ä¹‹å‰çš„`QuestionAdminVO`å³å¯ã€‚ä½†æ˜¯éœ€è¦æ·»åŠ ä¸€ä¸ªè¯¾ç¨‹è´Ÿè´£è€å¸ˆçš„å­—æ®µï¼š

![img](./assets/20230725153719471.jpg)

è™½ç„¶ç”¨æˆ·ç«¯ä¹Ÿæœ‰æ ¹æ®idæŸ¥è¯¢é—®é¢˜ï¼Œä½†æ˜¯è¿”å›å€¼ä¸ç”¨æˆ·ç«¯å­˜åœ¨è¾ƒå¤§å·®å¼‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¦å¤–è®¾è®¡ä¸€ä¸ªæ¥å£ã€‚

æŒ‰ç…§Restfulé£æ ¼ï¼Œæ¥å£ä¿¡æ¯å¦‚ä¸‹ï¼š

- **æ¥å£åœ°å€**: `/admin/questions/{id}`
- **è¯·æ±‚æ–¹å¼**: `GET`
- **è¯·æ±‚å‚æ•°**: è·¯å¾„å ä½ç¬¦æ ¼å¼
- **è¿”å›å€¼**ï¼šä¸åˆ†é¡µæŸ¥è¯¢å…±äº«VOï¼Œè¿™é‡Œä¸å†èµ˜è¿°

<br/>

**æ³¨æ„**ï¼š

é—®é¢˜è¡¨ä¸­æœ‰ä¸€ä¸ªstatuså­—æ®µï¼Œæ ‡è®°ç®¡ç†å‘˜æ˜¯å¦å·²ç»æŸ¥çœ‹è¿‡è¯¥é—®é¢˜ã€‚å› æ­¤æ¯å½“è°ƒç”¨æ ¹æ®idæŸ¥è¯¢é—®é¢˜æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºç®¡ç†å‘˜æŸ¥çœ‹äº†è¯¥é—®é¢˜ï¼Œåº”è¯¥å°†é—®é¢˜statusæ ‡è®°ä¸º**å·²æŸ¥çœ‹**ã€‚

#### ä»£ç å®ç°ï¼ˆç»ƒä¹ ï¼‰

## è¯„è®ºç›¸å…³æ¥å£ï¼ˆç»ƒä¹ ï¼‰

è¯„è®ºç›¸å…³æ¥å£æœ‰å››ä¸ªï¼š

- æ–°å¢å›ç­”æˆ–è¯„è®º
- åˆ†é¡µæŸ¥è¯¢å›ç­”æˆ–è¯„è®º
- ç®¡ç†ç«¯åˆ†é¡µæŸ¥è¯¢å›ç­”æˆ–è¯„è®º
- ç®¡ç†ç«¯éšè—æˆ–æ˜¾ç¤ºå›ç­”æˆ–è¯„è®º

### æ–°å¢å›ç­”æˆ–è¯„è®ºï¼ˆç»ƒä¹ ï¼‰

#### æ¥å£åˆ†æ

å…ˆæ¥çœ‹ä¸‹å›ç­”æˆ–è¯„è®ºçš„è¡¨å•åŸå‹å›¾ï¼š

![img](./assets/20230725153719967.jpg)

å›å¤æœ¬èº«åªæœ‰ä¸€ä¸ªç®€å•å±æ€§ï¼š

- å›å¤å†…å®¹

ä¸€ä¸ªåŠŸèƒ½å±æ€§ï¼š

- æ˜¯å¦åŒ¿å

ä¸€ä¸ªå…³è”å±æ€§ï¼š

- é—®é¢˜idï¼šå›ç­”è¦å…³è”æŸä¸ªé—®é¢˜

<br/>

å¦‚æœæ˜¯é’ˆå¯¹æŸä¸ªå›ç­”å‘è¡¨çš„è¯„è®ºï¼Œåˆ™æœ‰æ–°çš„å…³è”å±æ€§ï¼š

- å›ç­”idï¼šè¯„è®ºæ˜¯åœ¨å“ªä¸ªå›ç­”ä¸‹é¢çš„
- ç›®æ ‡è¯„è®ºidï¼šå½“å‰è¯„è®ºæ˜¯é’ˆå¯¹å“ªä¸€æ¡è¯„è®ºçš„
- ç›®æ ‡ç”¨æˆ·idï¼šå½“å‰è¯„è®ºæ˜¯é’ˆå¯¹å“ªä¸€ä¸ªç”¨æˆ·çš„

<br/>

å¦‚æœæ˜¯å›ç­”ï¼Œåˆ™åªéœ€è¦å‰3ä¸ªå±æ€§å³å¯ã€‚å¦‚æœæ˜¯è¯„è®ºï¼Œåˆ™è¿˜éœ€è¦è¡¥å……æœ€åçš„3ä¸ªå±æ€§ã€‚

ç”±äºæˆ‘ä»¬æŠŠä¼šå›ç­”å’Œè¯„è®ºæ¥å£åˆå¹¶ï¼Œå› æ­¤ä»¥ä¸Šå±æ€§éƒ½åº”è¯¥ä½œä¸ºè¡¨å•å‚æ•°ã€‚

<br/>

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ–°å¢å›ç­”æˆ–è¯„è®ºæ—¶ï¼Œé™¤äº†è¦æŠŠæ•°æ®å†™å…¥`interaction_reply`è¡¨ï¼Œè¿˜æœ‰å‡ ä»¶äº‹æƒ…è¦åšï¼š

- åˆ¤æ–­å½“å‰æäº¤çš„æ˜¯å¦æ˜¯å›ç­”ï¼Œå¦‚æœæ˜¯éœ€è¦åœ¨`interaction_question`ä¸­è®°å½•æœ€æ–°ä¸€æ¬¡å›ç­”çš„id
- åˆ¤æ–­æäº¤è¯„è®ºçš„ç”¨æˆ·æ˜¯å¦æ˜¯å­¦ç”Ÿï¼Œå¦‚æœæ˜¯æ ‡è®°é—®é¢˜çŠ¶æ€ä¸ºæœªæŸ¥çœ‹

å› æ­¤æˆ‘ä»¬çš„ä¸šåŠ¡æµç¨‹åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

![image-20240219234015726](assets/image-20240219234015726.png)

ä¸ºäº†æ–¹ä¾¿åˆ¤æ–­æ˜¯å¦æ˜¯å­¦ç”Ÿæäº¤çš„å›ç­”ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‰ç«¯ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼š

- isStudentï¼šæ ‡è®°å½“å‰å›ç­”æ˜¯å¦æ˜¯å­¦ç”Ÿæäº¤çš„

<br/>

ç»¼ä¸Šï¼ŒæŒ‰ç…§Restfulçš„è§„èŒƒè®¾è®¡ï¼Œæ¥å£ä¿¡æ¯å¦‚ä¸‹ï¼š

![image-20240219234033069](assets/image-20240219234033069.png)

<br/>

#### å®ä½“ç±»

æŒ‰ç…§å‰é¢çš„æ¥å£åˆ†æï¼Œé¦–å…ˆå®šä¹‰è¯·æ±‚å‚æ•°DTOï¼Œåœ¨è¯¾å‰èµ„æ–™ä¸­å·²ç»æä¾›äº†ï¼š

![img](./assets/20230725153719415.jpg)

#### ä»£ç å®ç°



### åˆ†é¡µæŸ¥è¯¢å›ç­”æˆ–è¯„è®ºåˆ—è¡¨ï¼ˆç»ƒä¹ ï¼‰

#### æ¥å£åˆ†æ

é—®é¢˜è¯¦æƒ…é¡µï¼Œé™¤äº†å±•ç¤ºé—®é¢˜è¯¦æƒ…å¤–ï¼Œæœ€é‡è¦çš„å°±æ˜¯å›ç­”åˆ—è¡¨äº†ï¼ŒåŸå‹å›¾å¦‚ä¸‹ï¼š

![img](assets/20240219234109804.png)

æˆ‘ä»¬å…ˆæ¥åˆ†æå›ç­”åˆ—è¡¨ï¼Œéœ€è¦å±•ç¤ºçš„å†…å®¹åŒ…æ‹¬ï¼š

- å›ç­”id
- å›ç­”å†…å®¹
- æ˜¯å¦åŒ¿å
- å›ç­”äººä¿¡æ¯ï¼ˆå¦‚æœæ˜¯åŒ¿åï¼Œåˆ™æ— éœ€è¿”å›ï¼‰
  - id
  - æ˜µç§°
  - å¤´åƒ
- å›ç­”æ—¶é—´
- è¯„è®ºæ•°é‡
- ç‚¹èµæ•°é‡

è¯·æ±‚å‚æ•°å°±æ˜¯é—®é¢˜çš„idã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªé—®é¢˜ä¸‹çš„å›ç­”æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ä¸€æ¬¡åªèƒ½å±•ç¤ºä¸€éƒ¨åˆ†ï¼Œæ›´å¤šæ•°æ®ä¼šé‡‡ç”¨æ»šåŠ¨æ‡’åŠ è½½æ¨¡å¼ã€‚ç®€å•æ¥è¯´è¯´å°±æ˜¯åˆ†é¡µæŸ¥è¯¢ï¼Œæ‰€ä»¥ä¹Ÿè¦å¸¦ä¸Šåˆ†é¡µå‚æ•°ã€‚

<br/>

å†æ¥çœ‹ä¸€ä¸‹å›ç­”ä¸‹çš„è¯„è®ºåˆ—è¡¨ï¼š

![img](./assets/20230725153719381.jpg)

ä»”ç»†è§‚å¯Ÿåå¯ä»¥å‘ç°ï¼Œéœ€è¦å±•ç¤ºçš„æ•°æ®ä¸å›ç­”åŠå…¶ç›¸ä¼¼ï¼Œéƒ½åŒ…æ‹¬ï¼š

- è¯„è®ºid
- è¯„è®ºå†…å®¹
- æ˜¯å¦åŒ¿å
- è¯„è®ºäººä¿¡æ¯ï¼ˆå¦‚æœæ˜¯åŒ¿åï¼Œåˆ™æ— éœ€è¿”å›ï¼‰
  - id
  - æ˜µç§°
  - å¤´åƒ
- å›ç­”æ—¶é—´
- è¯„è®ºæ•°é‡(æ— ï¼‰
- ç‚¹èµæ•°é‡
- **ç›®æ ‡ç”¨æˆ·æ˜µç§°ï¼ˆè¯„è®ºç‰¹æœ‰ï¼‰**

ä»è¿”å›ç»“æœæ¥çœ‹ï¼šç›¸æ¯”å›ç­”åˆ—è¡¨ï¼Œè¯„è®ºæ— éœ€å±•ç¤ºè¯„è®ºä¸‹çš„è¯„è®ºæ•°é‡ï¼Œä½†æ˜¯éœ€è¦å±•ç¤ºç›®æ ‡ç”¨æˆ·çš„æ˜µç§°ï¼Œå› ä¸ºè¯„è®ºæ˜¯é’ˆå¯¹æŸä¸ªç›®æ ‡çš„ã€‚

ä»æŸ¥è¯¢å‚æ•°æ¥çœ‹ï¼šæŸ¥è¯¢è¯„è®ºéœ€è¦çŸ¥é“å›ç­”çš„idï¼Œè¿™ç‚¹ä¸æŸ¥è¯¢å›ç­”åˆ—è¡¨ä¸å¤ªä¸€æ ·ã€‚

ç»¼ä¸Šï¼ŒæŒ‰ç…§Restfulçš„è§„èŒƒè®¾è®¡ï¼Œæ¥å£ä¿¡æ¯å¦‚ä¸‹ï¼š

![image-20240219234223950](assets/image-20240219234223950.png)

:::warning ğŸ’¡æ³¨æ„ï¼š

åˆ†é¡µæŸ¥è¯¢æ—¶é»˜è®¤è¦æŒ‰ç…§ç‚¹èµæ¬¡æ•°æ’åºã€‚

é¡µé¢å±•ç¤ºç‚¹èµæŒ‰é’®æ—¶ï¼Œå¦‚æœç‚¹èµè¿‡ä¼šé«˜äº®æ˜¾ç¤ºã€‚å› æ­¤æˆ‘ä»¬è¦åœ¨è¿”å›å€¼ä¸­æ ‡è®°å½“å‰ç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡è¿™æ¡è¯„è®ºæˆ–å›ç­”ã€‚

ä½†ç‚¹èµåŠŸèƒ½æˆ‘ä»¬æš‚æœªå®ç°ï¼Œè¿™ä¸¤éƒ¨åˆ†å¤§å®¶æš‚æ—¶æ— éœ€å®ç°ã€‚

:::

<br/>

#### å®ä½“ç±»

è¯·æ±‚å…¥å‚ï¼Œæ˜¯ä¸€ä¸ªQueryå®ä½“ï¼Œåœ¨è¯¾å‰èµ„æ–™çš„queryç›®å½•ä¸‹ï¼š

![img](./assets/20230725153719625.jpg)

è¿”å›å€¼ï¼Œæ˜¯ä¸€ä¸ªVOå®ä½“ï¼Œåœ¨è¯¾å‰èµ„æ–™çš„voç›®å½•ä¸‹ï¼š

![img](./assets/20230725153719732.jpg)

#### ä»£ç å®ç°

### ç®¡ç†ç«¯åˆ†é¡µæŸ¥è¯¢å›ç­”æˆ–è¯„è®ºåˆ—è¡¨ï¼ˆç»ƒä¹ ï¼‰

#### æ¥å£åˆ†æ

ç®¡ç†ç«¯æŸ¥è¯¢å›ç­”åˆ—è¡¨åŸå‹å¦‚ä¸‹ï¼š

![img](assets/20240219234301535.png)

å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›çš„æ•°æ®æ ¼å¼åŒ…å«ï¼š

- è¯„è®ºid
- è¯„è®ºå†…å®¹
- è¯„è®ºäººä¿¡æ¯
  - id
  - æ˜µç§°
  - å¤´åƒ
  - ç±»å‹
- å›ç­”æ—¶é—´
- è¯„è®ºæ•°é‡ï¼ˆå›ç­”æ—¶æœ‰ï¼‰
- ç‚¹èµæ•°é‡
- ç›®æ ‡ç”¨æˆ·æ˜µç§°ï¼ˆè¯„è®ºç‰¹æœ‰ï¼‰
- **æ˜¯å¦è¢«éšè—ï¼ˆç®¡ç†ç«¯ç‰¹æœ‰ï¼‰**

ä¸ç”¨æˆ·ç«¯æŸ¥è¯¢å‡ ä¹å®Œå…¨ä¸€è‡´ã€‚

é‚£æœ‰åŒå­¦ä¼šæœ‰ç–‘é—®äº†ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨åŒä¸€ä¸ªæ¥å£ï¼Ÿ

<br/>

åŸå› æœ‰ä¸¤ç‚¹ï¼š

- ç®¡ç†ç«¯åœ¨ç»Ÿè®¡è¯„è®ºæ•°é‡çš„æ—¶å€™ï¼Œè¢«éšè—çš„è¯„è®ºä¹Ÿè¦ç»Ÿè®¡ï¼ˆç”¨æˆ·ç«¯ä¸ç»Ÿè®¡éšè—å›ç­”ï¼‰
- ç®¡ç†ç«¯æ— è§†åŒ¿åï¼Œæ‰€æœ‰è¯„è®ºéƒ½è¦è¿”å›ç”¨æˆ·ä¿¡æ¯ï¼›ç”¨æˆ·ç«¯åŒ¿åè¯„è®ºä¸è¿”å›ç”¨æˆ·ä¿¡æ¯ã€‚

æ‰€ä»¥å¤§å®¶åœ¨å®ç°çš„æ—¶å€™ï¼ŒåŸºæœ¬é€»è¾‘å¯ä»¥ä¸ç”¨æˆ·ç«¯åˆ†é¡µä¸€è‡´ï¼Œä½†ç»Ÿè®¡è¯„è®ºæ•°é‡ã€å¤„ç†ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œéœ€è¦åŒºåˆ«å¯¹å¾…ã€‚

<br/>

**ä¸ºäº†å‡å°‘ä»£ç é‡å¤ï¼Œå¤§å®¶å¯ä»¥å¯¹ä»£ç åšæ”¹é€ æŠ½å–ï¼Œä¸è¦é‡å¤copyä»£ç **ã€‚

![image-20240219234405667](assets/image-20240219234405667.png)

<br/>

#### å®ä½“

è¯·æ±‚å‚æ•°å’Œè¿”å›å€¼å®ä½“ä¸ç”¨æˆ·ç«¯åˆ†é¡µæŸ¥è¯¢åŸºæœ¬ä¸€è‡´ï¼Œå› æ­¤è¿™é‡Œä¸å†é‡å¤å®šä¹‰å®ä½“ã€‚ä¸è¿‡è¿”å›å€¼VOä¸­è¦æ·»åŠ `hidden`å­—æ®µï¼Œæ ‡ç¤ºè¯„è®ºæ˜¯å¦è¢«éšè—ã€‚

<br/>

### ç®¡ç†ç«¯æ˜¾ç¤ºæˆ–éšè—è¯„è®ºï¼ˆç»ƒä¹ ï¼‰

#### æ¥å£åˆ†æ

ä¸é—®é¢˜ç±»ä¼¼ï¼Œç®¡ç†å‘˜ä¹Ÿå¯ä»¥æ˜¾ç¤ºæˆ–éšè—æŸä¸ªè¯„è®ºæˆ–è¯„è®ºï¼š

![img](./assets/20230725153720087.jpg)

ä¸éšè—é—®é¢˜ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯ä¿®æ”¹hiddenå­—æ®µã€‚å› æ­¤æŒ‰ç…§Restfulé£æ ¼è®¾è®¡æ¥å£å¦‚ä¸‹ï¼š

<br/>

- **æ¥å£åœ°å€ï¼š**`/admin/replies/{id}/hidden/{hidden}`
- **è¯·æ±‚æ–¹å¼ï¼š**`PUT`
- **è¯·æ±‚å‚æ•°ï¼š**è·¯å¾„å ä½ç¬¦å‚æ•°
  - idï¼šå›ç­”æˆ–è¯„è®ºid
  - hiddenï¼šæ˜¯å¦è¢«éšè—

**æ³¨æ„**ï¼šå¦‚æœéšè—çš„æ˜¯å›ç­”ï¼Œåˆ™å›ç­”ä¸‹çš„è¯„è®ºä¹Ÿè¦éšè—

#### ä»£ç å®ç°ï¼ˆç»ƒä¹ ï¼‰
