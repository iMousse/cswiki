import{_ as E,E as l,c as d,J as s,w as g,m as h,a as y,V as i,o as k,b as o,e as c}from"./chunks/framework.syB9hai_.js";const F="/cswiki/assets/20230725154301601.0lvXwtcy.jpg",A="/cswiki/assets/image-20240214023218815.AeNdROzB.png",D="/cswiki/assets/20230725154303923.cdpfztR_.jpg",m="/cswiki/assets/20230725154302494.kBPc6PFf.jpg",u="/cswiki/assets/20230725154301670.zTDLL0m3.jpg",B="/cswiki/assets/20230725154302362.LVMGzid6.jpg",b="/cswiki/assets/image-20240214023326783.HgD40nZA.png",C="/cswiki/assets/20230725154301894.rU-1igMs.jpg",v="/cswiki/assets/20230725154301753.wrTmAA_Q.jpg",_="/cswiki/assets/image-20240214023844466.-27NCE5_.png",x="/cswiki/assets/20230725154302135.XB-I-eNG.jpg",S="/cswiki/assets/20230725154302438.d2Iq0NcV.jpg",P="/cswiki/assets/20230725154302350.H4vMq40b.jpg",T="/cswiki/assets/20230725154302639.5vlH4mlG.jpg",j="/cswiki/assets/20230725154302631.xy4QcbF-.jpg",I="/cswiki/assets/20230725154302982.5Dq2emJd.jpg",R="/cswiki/assets/20230725154303860.rnW5hOq1.jpg",q="/cswiki/assets/20230725154303021.GQMa79P0.jpg",L="/cswiki/assets/20230725154302911.-p5essp8.jpg",f="/cswiki/assets/20230725154303194.8lk14MEx.jpg",O="/cswiki/assets/20230725154304334.KlEIMYRI.jpg",N="/cswiki/assets/20230725154304413.HsNrSWMS.jpg",w="/cswiki/assets/20230725154303561.cvqvAjsH.jpg",M="/cswiki/assets/20230725154304079.xcj89xim.jpg",X="/cswiki/assets/20230725141106785.vwt6Hv6K.jpg",J="/cswiki/assets/20230725154304200.w_IinTqg.jpg",z="/cswiki/assets/20230725154304337.MT5xfUNy.jpg",U="/cswiki/assets/20230725141106785.vwt6Hv6K.jpg",V="/cswiki/assets/20230725154304734.ZrNMBUFO.jpg",H="/cswiki/assets/20230725154304969._nDY4A2c.jpg",Q="/cswiki/assets/20230725154304691.inyGz4HY.jpg",Y="/cswiki/assets/20230725154305607.lPq5CitD.jpg",K="/cswiki/assets/20230725154305471.6y8_I2ul.jpg",G="/cswiki/assets/20230725154305685.6ZuxF1aL.jpg",Z="/cswiki/assets/20230725154305473.OMK1K_Pn.jpg",W="/cswiki/assets/20230725154305606.JbAsnJMN.jpg",$="/cswiki/assets/20230725154305260.ACyJzjKu.jpg",ss="/cswiki/assets/20230725154305765.p5i6NRDM.jpg",is="/cswiki/assets/20230725154306809.UjlrmBWM.jpg",as="/cswiki/assets/20230725154305821.3qos_K78.jpg",ns="/cswiki/assets/20230725154308184.qv3DX1QG.jpg",ls="/cswiki/assets/20230725154305885.UDn511hg.jpg",ts="/cswiki/assets/image-20240214024255526.BkFP6dL3.png",ps="/cswiki/assets/20230725154306147.8W6jo60k.jpg",hs="/cswiki/assets/20230725154308818.G0ic3zRT.jpg",ks="/cswiki/assets/20230725154306390.s5hrsq3g.jpg",es="/cswiki/assets/image-20240214024407842.zRsYbiTF.png",rs="/cswiki/assets/image-20240214024424868.MVeSk6Tu.png",Es="/cswiki/assets/20230725154308109.60K16a_7.jpg",ds="/cswiki/assets/20230725154306323.iDdw6pBt.jpg",gs="/cswiki/assets/20230725154307757.ppZFEMw9.jpg",ys="/cswiki/assets/20230725154308002.abai4cSu.jpg",os="/cswiki/assets/20230725154307410.7OftYvuC.jpg",cs="/cswiki/assets/20230725154310238.FNApWVGl.jpg",Fs="/cswiki/assets/20230725154311054.q-CGK1Z8.jpg",As="/cswiki/assets/20230725154308382.NaaNiVUY.jpg",Ds="/cswiki/assets/image-20240214024455682.CyCJnVTs.png",ms="/cswiki/assets/20230725154309412.rTR4oHSd.jpg",us="/cswiki/assets/20230725154308512.G4nK79y9.jpg",Bs="/cswiki/assets/20230725154309279.EGbXNArg.jpg",bs="/cswiki/assets/20230725154309486.XyXch3bP.jpg",Cs="/cswiki/assets/20230725154308821.BJRua4oM.jpg",vs="/cswiki/assets/20230725154309174.PsdSEBrB.jpg",_s="/cswiki/assets/20230725154309693.3plbNkDP.jpg",Ms=JSON.parse('{"title":"Day08-æ’è¡Œæ¦œåŠŸèƒ½","description":"","frontmatter":{},"headers":[],"relativePath":"src/project/college/08-æ’è¡Œæ¦œåŠŸèƒ½.md","filePath":"src/project/college/08-æ’è¡Œæ¦œåŠŸèƒ½.md","lastUpdated":1730648753000}'),xs={name:"src/project/college/08-æ’è¡Œæ¦œåŠŸèƒ½.md"},Ss=h("h1",{id:"day08-æ’è¡Œæ¦œåŠŸèƒ½",tabindex:"-1"},[y("Day08-æ’è¡Œæ¦œåŠŸèƒ½ "),h("a",{class:"header-anchor",href:"#day08-æ’è¡Œæ¦œåŠŸèƒ½","aria-label":'Permalink to "Day08-æ’è¡Œæ¦œåŠŸèƒ½"'},"â€‹")],-1),Ps=i('<p>åœ¨æ˜¨å¤©çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ç§¯åˆ†åŠŸèƒ½ï¼Œå¹¶ä¸”ä¹Ÿå°†ç”¨æˆ·çš„ç§¯åˆ†æ˜ç»†ä¿å­˜åˆ°äº†æ•°æ®åº“ã€‚ä½†æ˜¯å¹¶æ²¡æœ‰å½¢æˆæ’è¡Œæ¦œã€‚</p><p>é‚£ä¹ˆæ’è¡Œæ¦œè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p><p>æ˜¯ä¸æ˜¯ç®€å•çš„SQLæŸ¥è¯¢å°±å¯ä»¥å½¢æˆæ¦œå•å‘¢ï¼Ÿ</p><p>ä»Šå¤©æˆ‘ä»¬å°±ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ã€‚</p><h2 id="å®æ—¶æ’è¡Œæ¦œ" tabindex="-1">å®æ—¶æ’è¡Œæ¦œ <a class="header-anchor" href="#å®æ—¶æ’è¡Œæ¦œ" aria-label="Permalink to &quot;å®æ—¶æ’è¡Œæ¦œ&quot;">â€‹</a></h2><p>æ¦œå•åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>å®æ—¶æ¦œå•ï¼šä¹Ÿå°±æ˜¯æœ¬èµ›å­£çš„æ¦œå•</li><li>å†å²æ¦œå•ï¼šä¹Ÿå°±æ˜¯å†å²èµ›å­£çš„æ¦œå•</li></ul><p>æœ¬èŠ‚æˆ‘ä»¬å…ˆåˆ†æä¸€ä¸‹å®ç°å®æ—¶æ¦œå•åŠŸèƒ½ã€‚</p><p>ğŸ’¡æ€è€ƒï¼š</p><h3 id="æ€è·¯åˆ†æ" tabindex="-1">æ€è·¯åˆ†æ <a class="header-anchor" href="#æ€è·¯åˆ†æ" aria-label="Permalink to &quot;æ€è·¯åˆ†æ&quot;">â€‹</a></h3><p>ç›®å‰ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç§¯åˆ†è®°å½•æ˜ç»†è¡¨ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="'+F+`" alt="img" loading="lazy"></p><p>ä¸€ä¸ªç”¨æˆ·å¯èƒ½äº§ç”Ÿå¾ˆå¤šæ¡ç§¯åˆ†è®°å½•ï¼Œæ•°æ®ç»“æ„å¤§æ¦‚åƒè¿™æ ·ï¼š</p><table><thead><tr><th style="text-align:center;"><strong>id</strong></th><th style="text-align:center;"><strong>userId</strong></th><th style="text-align:center;"><strong>type</strong></th><th style="text-align:center;"><strong>points</strong></th><th style="text-align:center;"><strong>c_time</strong></th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">9527</td><td style="text-align:center;">1</td><td style="text-align:center;">10</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">9528</td><td style="text-align:center;">4</td><td style="text-align:center;">3</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">3</td><td style="text-align:center;">9529</td><td style="text-align:center;">2</td><td style="text-align:center;">1</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">4</td><td style="text-align:center;">9528</td><td style="text-align:center;">2</td><td style="text-align:center;">7</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">5</td><td style="text-align:center;">9529</td><td style="text-align:center;">4</td><td style="text-align:center;">3</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">6</td><td style="text-align:center;">9528</td><td style="text-align:center;">2</td><td style="text-align:center;">1</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">7</td><td style="text-align:center;">9527</td><td style="text-align:center;">1</td><td style="text-align:center;">10</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">8</td><td style="text-align:center;">9529</td><td style="text-align:center;">4</td><td style="text-align:center;">3</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">9</td><td style="text-align:center;">9527</td><td style="text-align:center;">3</td><td style="text-align:center;">5</td><td style="text-align:center;"></td></tr></tbody></table><p>è¦æƒ³å½¢æˆæ’è¡Œæ¦œï¼Œæˆ‘ä»¬åœ¨æŸ¥è¯¢æ•°æ®åº“æ—¶ï¼Œéœ€è¦å…ˆå¯¹ç”¨æˆ·åˆ†ç»„ï¼Œå†å¯¹ç§¯åˆ†æ±‚å’Œï¼Œæœ€ç»ˆæŒ‰ç…§ç§¯åˆ†å’Œæ’åºï¼ŒSqlè¯­å¥æ˜¯è¿™æ ·ï¼š</p><div class="language-SQL vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_id, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(points) </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> points_record </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GROUP BY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ORDER BY</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(points)</span></span></code></pre></div><p>è¦çŸ¥é“ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½å¯èƒ½ä¼šæœ‰æ•°åç”šè‡³ä¸Šç™¾æ¡ç§¯åˆ†è®°å½•ï¼Œå½“ç”¨æˆ·è§„æ¨¡è¾¾åˆ°ç™¾ä¸‡è§„æ¨¡ï¼Œå¯èƒ½äº§ç”Ÿçš„ç§¯åˆ†è®°å½•å°±æ˜¯æ•°ä»¥<strong>äº¿</strong>è®¡ã€‚</p><p>è¦åœ¨æ¯æ¬¡æŸ¥è¯¢æ’è¡Œæ¦œæ—¶ï¼Œåœ¨å†…å­˜ä¸­å¯¹è¿™ä¹ˆå¤šæ•°æ®åšåˆ†ç»„ã€æ±‚å’Œã€æ’åºï¼Œå¯¹å†…å­˜å’ŒCPUçš„å ç”¨ä¼šéå¸¸ææ€–ï¼Œä¸å¤ªé è°±ã€‚</p><p>é‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><br><p>åœ¨è¿™é‡Œç»™å¤§å®¶ä»‹ç»ä¸¤ç§ä¸åŒçš„å®ç°æ€è·¯ï¼š</p><ul><li>æ–¹æ¡ˆä¸€ï¼šåŸºäºMySQLçš„ç¦»çº¿æ’åº</li><li>æ–¹æ¡ˆäºŒï¼šåŸºäºRedisçš„SortedSet</li></ul><br><p>é¦–å…ˆè¯´æ–¹æ¡ˆä¸€ï¼šç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†æ•°æ®åº“ä¸­çš„æ•°æ®æŸ¥è¯¢å‡ºæ¥ï¼Œåœ¨å†…å­˜ä¸­è‡ªå·±åˆ©ç”¨ç®—æ³•å®ç°æ’åºï¼Œè€Œåå°†æ’åºå¾—åˆ°çš„æ¦œå•ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ä½†ç”±äºè¿™ä¸ªæ’åºæ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬æ— æ³•å®æ—¶æ›´æ–°æ’è¡Œæ¦œï¼Œè€Œæ˜¯æ¯éš”å‡ åˆ†é’Ÿè®¡ç®—ä¸€æ¬¡æ’è¡Œæ¦œã€‚è¿™ç§æ–¹æ¡ˆå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”å®æ—¶æ€§è¾ƒå·®ã€‚ä¸è¿‡ä¼˜ç‚¹æ˜¯ä¸ä¼šä¸€ç›´å ç”¨ç³»ç»Ÿèµ„æºã€‚</p><br><p>å†è¯´æ–¹æ¡ˆäºŒï¼šRedisçš„SortedSetåº•å±‚é‡‡ç”¨äº†è·³è¡¨çš„æ•°æ®ç»“æ„ï¼Œå› æ­¤å¯ä»¥éå¸¸é«˜æ•ˆçš„å®ç°æ’åºåŠŸèƒ½ï¼Œç™¾ä¸‡ç”¨æˆ·æ’åºè½»æ¾æå®šã€‚è€Œä¸”æ¯å½“ç”¨æˆ·ç§¯åˆ†å‘ç”Ÿå˜æ›´æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®æ—¶æ›´æ–°Redisä¸­çš„ç”¨æˆ·ç§¯åˆ†ï¼Œè€ŒSortedSetä¹Ÿä¼šå®æ—¶æ›´æ–°æ’åã€‚å®ç°èµ·æ¥ç®€å•ã€é«˜æ•ˆï¼Œå®æ—¶æ€§ä¹Ÿéå¸¸å¥½ã€‚ç¼ºç‚¹å°±æ˜¯éœ€è¦ä¸€ç›´å ç”¨Redisçš„å†…å­˜ï¼Œå½“ç”¨æˆ·é‡è¾¾åˆ°æ•°åƒä¸‡ä¸‡æ—¶ï¼Œæ€§èƒ½æœ‰ä¸€å®šçš„ä¸‹é™ã€‚</p><p>å½“ç³»ç»Ÿç”¨æˆ·é‡è§„æ¨¡è¾¾åˆ°æ•°åƒä¸‡ï¼Œä¹ƒè‡³æ•°äº¿æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨åˆ†æ²»çš„æ€æƒ³ï¼Œå°†ç”¨æˆ·æ•°æ®æŒ‰ç…§ç§¯åˆ†èŒƒå›´åˆ’åˆ†ä¸ºå¤šä¸ªæ¡¶ï¼Œä¾‹å¦‚ï¼š</p><p>0 ~ 100åˆ†ã€101 ~ 200åˆ†ã€201 ~ 300åˆ†ã€301 ~ 500åˆ†ã€501 ~ 800åˆ†ã€801 ~ 1200åˆ†ã€1201 ~ 1500åˆ†ã€1501 ~ 2000åˆ†</p><p>åœ¨Rediså†…ä¸ºæ¯ä¸ªæ¡¶åˆ›å»ºä¸€ä¸ªSortedSetç±»å‹çš„keyï¼Œè¿™æ ·å°±å¯ä»¥å°†æ•°æ®åˆ†æ•£ï¼Œå‡å°‘å•ä¸ªKEYçš„æ•°æ®è§„æ¨¡äº†ã€‚è€Œè¦è®¡ç®—æ’åæ—¶ï¼Œåªéœ€è¦æŒ‰ç…§èŒƒå›´æŸ¥è¯¢å‡ºç”¨æˆ·ç§¯åˆ†æ‰€åœ¨çš„æ¡¶ï¼Œå†ç´¯åŠ åˆ†å€¼æ¯”ä»–é«˜çš„æ¡¶çš„ç”¨æˆ·æ•°é‡å³å¯ã€‚ä¾ç„¶éå¸¸ç®€å•ã€é«˜æ•ˆã€‚</p><br><p>ç»¼ä¸Šï¼Œæˆ‘ä»¬æ¨èåŸºäºRedisçš„SortedSetæ¥å®ç°æ’è¡Œæ¦œåŠŸèƒ½ã€‚</p><p>SortedSetçš„å¸¸ç”¨å‘½ä»¤ï¼Œå¯ä»¥å‚è€ƒå®˜ç½‘ï¼š<a href="https://redis.io/commands/?group=sorted-set" target="_blank" rel="noreferrer">https://redis.io/commands/?group=sorted-set</a></p><br><h3 id="ç”Ÿæˆå®æ—¶æ¦œå•" tabindex="-1">ç”Ÿæˆå®æ—¶æ¦œå• <a class="header-anchor" href="#ç”Ÿæˆå®æ—¶æ¦œå•" aria-label="Permalink to &quot;ç”Ÿæˆå®æ—¶æ¦œå•&quot;">â€‹</a></h3><p>æ—¢ç„¶è¦ä½¿ç”¨Redisçš„SortedSetæ¥å®ç°æ’è¡Œæ¦œï¼Œå°±éœ€è¦åœ¨<strong>ç”¨æˆ·æ¯æ¬¡ç§¯åˆ†å˜æ›´æ—¶ï¼Œç´¯åŠ ç§¯åˆ†åˆ°Redisçš„SortedSetä¸­</strong>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦å¯¹ä¹‹å‰çš„æ–°å¢ç§¯åˆ†åŠŸèƒ½åšç®€å•æ”¹é€ ï¼Œå¦‚å›¾ä¸­ç»¿è‰²éƒ¨åˆ†ï¼š</p><p><img src="`+A+'" alt="image-20240214023218815" loading="lazy"></p><p>åœ¨Redisä¸­ï¼Œä½¿ç”¨SortedSetç»“æ„ï¼Œ<strong>ä»¥èµ›å­£çš„æ—¥æœŸä¸ºkeyï¼Œä»¥ç”¨æˆ·idä¸ºmemberï¼Œä»¥ç§¯åˆ†å’Œä¸ºscore. æ¯å½“ç”¨æˆ·æ–°å¢ç§¯åˆ†ï¼Œå°±ç´¯åŠ åˆ°scoreä¸­</strong>ï¼ŒSortedSetæ’åå°±ä¼šå®æ—¶æ›´æ–°ã€‚è¿™æ ·ä¸€ä¸ªå®æ—¶çš„å½“å‰èµ›å­£æ¦œå•å°±å‡ºç°äº†ã€‚</p><br><h4 id="å®šä¹‰redisçš„keyå‰ç¼€" tabindex="-1">å®šä¹‰Redisçš„KEYå‰ç¼€ <a class="header-anchor" href="#å®šä¹‰redisçš„keyå‰ç¼€" aria-label="Permalink to &quot;å®šä¹‰Redisçš„KEYå‰ç¼€&quot;">â€‹</a></h4><p>åœ¨<code>tj-learning</code>çš„<code>RedisConstants</code>ä¸­å®šä¹‰ä¸€ä¸ªæ–°çš„KEYå‰ç¼€ï¼š</p><p><img src="'+D+'" alt="img" loading="lazy"></p><p>æ³¨æ„ï¼ŒKEYçš„åç¼€æ˜¯æ—¶é—´æˆ³ï¼Œæˆ‘ä»¬æœ€å¥½å®šä¹‰ä¸€ä¸ª<code>DateTimeFormatter</code>ï¼Œæ–¹ä¾¿åæœŸä½¿ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹<code>tj-commom</code>ä¸­çš„<code>DateUtils</code>ï¼Œæ·»åŠ ä¸€ä¸ª<code>DateTimeFormatter</code>çš„å¸¸é‡ï¼š</p><p><img src="'+m+'" alt="img" loading="lazy"></p><br><h4 id="æ›´æ–°ç§¯åˆ†åˆ°redis" tabindex="-1">æ›´æ–°ç§¯åˆ†åˆ°Redis <a class="header-anchor" href="#æ›´æ–°ç§¯åˆ†åˆ°redis" aria-label="Permalink to &quot;æ›´æ–°ç§¯åˆ†åˆ°Redis&quot;">â€‹</a></h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ”¹é€ tj-learningä¸­çš„<code>com.tianji.learning.service.impl.PointsRecordServiceImpl</code>ï¼Œé¦–å…ˆæ³¨å…¥<code>StringRedisTemplate</code>ï¼š</p><p><img src="'+u+`" alt="img" loading="lazy"></p><br><p>ç„¶åï¼Œæ”¹é€ å…¶ä¸­çš„<code>addPointsRecord</code>æ–¹æ³•ï¼Œæ·»åŠ ç§¯åˆ†åˆ°Redisä¸­ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addPointsRecord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Long userId, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> points, PointsRecordType type) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LocalDateTime now </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxPoints </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> type.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMaxPoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1.åˆ¤æ–­å½“å‰æ–¹å¼æœ‰æ²¡æœ‰ç§¯åˆ†ä¸Šé™</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> realPoints </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> points;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(maxPoints </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.æœ‰ï¼Œåˆ™éœ€è¦åˆ¤æ–­æ˜¯å¦è¶…è¿‡ä¸Šé™</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LocalDateTime begin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DateUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDayStartTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(now);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LocalDateTime end </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DateUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getDayEndTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(now);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.1.æŸ¥è¯¢ä»Šæ—¥å·²å¾—ç§¯åˆ†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> currentPoints </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> queryUserPointsByTypeAndDate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId, type, begin, end);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.2.åˆ¤æ–­æ˜¯å¦è¶…è¿‡ä¸Šé™</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(currentPoints </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxPoints) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 2.3.è¶…è¿‡ï¼Œç›´æ¥ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.4.æ²¡è¶…è¿‡ï¼Œä¿å­˜ç§¯åˆ†è®°å½•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(currentPoints </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> points </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxPoints){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            realPoints </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxPoints </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> currentPoints;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.æ²¡æœ‰ï¼Œç›´æ¥ä¿å­˜ç§¯åˆ†è®°å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PointsRecord p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsRecord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setPoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(realPoints);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(type);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    save</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4.æ›´æ–°æ€»ç§¯åˆ†åˆ°Redis</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RedisConstants.POINTS_BOARD_KEY_PREFIX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> now.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DateUtils.POINTS_BOARD_SUFFIX_FORMATTER);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">opsForZSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">incrementScore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key, userId.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), realPoints);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h3 id="æŸ¥è¯¢ç§¯åˆ†æ¦œ" tabindex="-1">æŸ¥è¯¢ç§¯åˆ†æ¦œ <a class="header-anchor" href="#æŸ¥è¯¢ç§¯åˆ†æ¦œ" aria-label="Permalink to &quot;æŸ¥è¯¢ç§¯åˆ†æ¦œ&quot;">â€‹</a></h3><p>åœ¨ä¸ªäººä¸­å¿ƒï¼Œå­¦ç”Ÿå¯ä»¥æŸ¥çœ‹æŒ‡å®šèµ›å­£ç§¯åˆ†æ’è¡Œæ¦œï¼ˆåªæ˜¾ç¤ºå‰100 ï¼‰ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹è‡ªå·±æ€»ç§¯åˆ†å’Œæ’åã€‚è€Œä¸”æ’è¡Œæ¦œåˆ†ä¸ºæœ¬èµ›å­£æ¦œå•å’Œå†å²èµ›å­£æ¦œå•ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªæ¥å£ä¸­åŒæ—¶å®ç°è¿™ä¸¤ç±»æ¦œå•çš„æŸ¥è¯¢ã€‚</p><br><h4 id="åˆ†æå’Œè®¾è®¡æ¥å£" tabindex="-1">åˆ†æå’Œè®¾è®¡æ¥å£ <a class="header-anchor" href="#åˆ†æå’Œè®¾è®¡æ¥å£" aria-label="Permalink to &quot;åˆ†æå’Œè®¾è®¡æ¥å£&quot;">â€‹</a></h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹é¡µé¢åŸå‹ï¼ˆè¿™é‡Œæˆ‘ç»™å‡ºçš„æ˜¯åŸå‹å¯¹åº”çš„è®¾è®¡ç¨¿ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆå‰ç«¯è®¾è®¡çš„é¡µé¢æ•ˆæœï¼‰ï¼š</p><p><img src="`+B+'" alt="img" loading="lazy"></p><p>é¦–å…ˆæˆ‘ä»¬åˆ†æä¸€ä¸‹è¯·æ±‚å‚æ•°ï¼š</p><ul><li>æ¦œå•æ•°æ®éå¸¸å¤šï¼Œä¸å¯èƒ½ä¸€æ¬¡æ€§æŸ¥è¯¢å‡ºæ¥ï¼Œå› æ­¤è¿™é‡Œä¸€å®šæ˜¯åˆ†é¡µæŸ¥è¯¢ï¼ˆæ»šåŠ¨åˆ†é¡µï¼‰ï¼Œéœ€è¦åˆ†é¡µå‚æ•°ã€‚</li><li>ç”±äºè¦æŸ¥è¯¢å†å²æ¦œå•éœ€è¦çŸ¥é“èµ›å­£ï¼Œå› æ­¤å‚æ•°ä¸­éœ€è¦æŒ‡å®šèµ›å­£idã€‚å½“èµ›å­£idä¸ºç©ºï¼Œæˆ‘ä»¬è®¤å®šæ˜¯æŸ¥è¯¢å½“å‰èµ›å­£ã€‚è¿™æ ·å°±å¯ä»¥æŠŠä¸¤ä¸ªæ¥å£åˆäºŒä¸ºä¸€ã€‚</li></ul><p>ç„¶åæ˜¯è¿”å›å€¼ï¼Œæ— è®ºæ˜¯å†å²æ¦œå•è¿˜æ˜¯å½“å‰æ¦œå•ï¼Œç»“æ„éƒ½ä¸€æ ·ã€‚åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li>å½“å‰ç”¨æˆ·çš„ç§¯åˆ†å’Œæ’åã€‚å½“å‰ç”¨æˆ·ä¸ä¸€å®šä¸Šæ¦œï¼Œå› æ­¤éœ€è¦å•ç‹¬æŸ¥è¯¢</li><li>æ¦œå•æ•°æ®ã€‚å°±æ˜¯Nä¸ªç”¨æˆ·çš„ç§¯åˆ†ã€æ’åå½¢æˆçš„é›†åˆã€‚</li></ul><br><p>ç»¼ä¸Šï¼Œæ¥å£ä¿¡æ¯å¦‚ä¸‹ï¼š</p><p><img src="'+b+'" alt="image-20240214023326783" loading="lazy"><br></p><h4 id="å®ä½“ç±»" tabindex="-1">å®ä½“ç±» <a class="header-anchor" href="#å®ä½“ç±»" aria-label="Permalink to &quot;å®ä½“ç±»&quot;">â€‹</a></h4><p>æŸ¥è¯¢ç§¯åˆ†æ’è¡Œæ¦œæ¥å£ä¸­åŒ…æ‹¬3ä¸ªå®ä½“ï¼š</p><ul><li>æŸ¥è¯¢æ¡ä»¶QUERYå®ä½“</li><li>åˆ†é¡µè¿”å›ç»“æœVOå®ä½“</li><li>åˆ†é¡µä¸­æ¯ä¸€æ¡æ•°æ®çš„VOå®ä½“</li></ul><p>è¿™äº›åœ¨è¯¾å‰èµ„æ–™ä¸­éƒ½æä¾›å¥½äº†ã€‚</p><p>é¦–å…ˆæ˜¯QUERYå®ä½“ï¼š</p><p><img src="'+C+'" alt="img" loading="lazy"></p><p>ç„¶åæ˜¯åˆ†é¡µVOå®ä½“ã€åˆ†é¡µæ¡ç›®VOå®ä½“ï¼š</p><p><img src="'+v+`" alt="img" loading="lazy"></p><br><h4 id="å®ç°æ¥å£" tabindex="-1">å®ç°æ¥å£ <a class="header-anchor" href="#å®ç°æ¥å£" aria-label="Permalink to &quot;å®ç°æ¥å£&quot;">â€‹</a></h4><p>é¦–å…ˆï¼Œåœ¨<code>tj-learning</code>çš„<code>com.tianji.learning.controller.PointsBoardController</code>ä¸­å®šä¹‰æ¥å£ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.controller;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.utils.BeanUtils;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.utils.CollUtils;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.po.PointsBoardSeason;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.query.PointsBoardQuery;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.vo.PointsBoardVO;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service.IPointsBoardService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io.swagger.annotations.Api;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io.swagger.annotations.ApiOperation;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lombok.RequiredArgsConstructor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.web.bind.annotation.GetMapping;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.web.bind.annotation.RequestMapping;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.web.bind.annotation.RestController;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.time.LocalDateTime;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.List;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * å­¦éœ¸å¤©æ¢¯æ¦œ æ§åˆ¶å™¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;/p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RestController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequiredArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequestMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/boards&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ç§¯åˆ†ç›¸å…³æ¥å£&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsBoardController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IPointsBoardService pointsBoardService;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GetMapping</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;åˆ†é¡µæŸ¥è¯¢æŒ‡å®šèµ›å­£çš„ç§¯åˆ†æ’è¡Œæ¦œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PointsBoardVO </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryPointsBoardBySeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PointsBoardQuery </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pointsBoardService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryPointsBoardBySeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>ç„¶åï¼Œåœ¨<code>com.tianji.learning.service.IPointsBoardService</code>ä¸­å®šä¹‰serviceæ–¹æ³•ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.extension.service.IService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.po.PointsBoard;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.query.PointsBoardQuery;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.vo.PointsBoardVO;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.List;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * å­¦éœ¸å¤©æ¢¯æ¦œ æœåŠ¡ç±»</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;/p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IPointsBoardService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PointsBoardVO </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryPointsBoardBySeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PointsBoardQuery </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>ç„¶åï¼Œåœ¨<code>com.tianji.learning.service.impl.PointsBoardServiceImpl</code>ä¸­å®ç°æ–¹æ³•ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service.impl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.api.client.user.UserClient;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.api.dto.user.UserDTO;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.utils.CollUtils;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.utils.DateUtils;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.utils.UserContext;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.constants.RedisConstants;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.po.PointsBoard;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.query.PointsBoardQuery;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.vo.PointsBoardItemVO;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.vo.PointsBoardVO;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.mapper.PointsBoardMapper;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service.IPointsBoardService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.utils.TableInfoContext;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lombok.RequiredArgsConstructor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.data.redis.core.BoundZSetOperations;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.data.redis.core.StringRedisTemplate;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.data.redis.core.ZSetOperations;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.stereotype.Service;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.time.LocalDateTime;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.stream.Collectors;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.constants.LearningConstants.POINTS_BOARD_TABLE_PREFIX;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * å­¦éœ¸å¤©æ¢¯æ¦œ æœåŠ¡å®ç°ç±»</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;/p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@author</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> è™å“¥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequiredArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsBoardServiceImpl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ServiceImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoardMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IPointsBoardService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StringRedisTemplate redisTemplate;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UserClient userClient;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PointsBoardVO </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryPointsBoardBySeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PointsBoardQuery </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1.åˆ¤æ–­æ˜¯å¦æ˜¯æŸ¥è¯¢å½“å‰èµ›å­£</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Long season </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isCurrent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> season </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> season </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.è·å–Redisçš„Key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LocalDateTime now </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RedisConstants.POINTS_BOARD_KEY_PREFIX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> now.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DateUtils.POINTS_BOARD_SUFFIX_FORMATTER);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.æŸ¥è¯¢æˆ‘çš„ç§¯åˆ†å’Œæ’å</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        PointsBoard myBoard </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isCurrent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                queryMyCurrentBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // æŸ¥è¯¢å½“å‰æ¦œå•ï¼ˆRedisï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                queryMyHistoryBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(season); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æŸ¥è¯¢å†å²æ¦œå•ï¼ˆMySQLï¼‰</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3.æŸ¥è¯¢æ¦œå•åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isCurrent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                queryCurrentBoardList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key, query.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPageNo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), query.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPageSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                queryHistoryBoardList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.å°è£…VO</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        PointsBoardVO vo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsBoardVO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.1.å¤„ç†æˆ‘çš„ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (myBoard </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setPoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myBoard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myBoard.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(list)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vo;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.2.æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Set&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; uIds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PointsBoard</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getUserId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Collectors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UserDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryUserByIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(uIds);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; userMap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HashMap&lt;&gt;(uIds.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isNotEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(users)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            userMap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Collectors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(UserDTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getId, UserDTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getName));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.3.è½¬æ¢VO</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoardItemVO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; items </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ArrayList&lt;&gt;(list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (PointsBoard p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            PointsBoardItemVO v </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsBoardItemVO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            v.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setPoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getPoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            v.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            v.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            items.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(v);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setBoardList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(items);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vo;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryHistoryBoardList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PointsBoardQuery </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // TODO</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryCurrentBoardList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Integer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pageNo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Integer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pageSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1.è®¡ç®—åˆ†é¡µ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> from </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pageNo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pageSize;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.æŸ¥è¯¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Set&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ZSetOperations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TypedTuple</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; tuples </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">opsForZSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reverseRangeWithScores</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key, from, from </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pageSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tuples)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">emptyList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3.å°è£…</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rank </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> from </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ArrayList&lt;&gt;(tuples.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ZSetOperations.TypedTuple&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; tuple </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tuples) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            String userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tuple.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Double points </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tuple.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getScore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> points </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                continue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            PointsBoard p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Long.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">valueOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setPoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(points.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">intValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rank</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(p);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PointsBoard </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryMyHistoryBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Long </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">season</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // TODO</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PointsBoard </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryMyCurrentBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1.ç»‘å®škey</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        BoundZSetOperations&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; ops </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">boundZSetOps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UserContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3.æŸ¥è¯¢ç§¯åˆ†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Double points </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ops.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">score</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.æŸ¥è¯¢æ’å</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Long rank </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ops.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reverseRank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 5.å°è£…è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        PointsBoard p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setPoints</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(points </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> points.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">intValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rank </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rank.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">intValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> p;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="å†å²æ’è¡Œæ¦œ" tabindex="-1">å†å²æ’è¡Œæ¦œ <a class="header-anchor" href="#å†å²æ’è¡Œæ¦œ" aria-label="Permalink to &quot;å†å²æ’è¡Œæ¦œ&quot;">â€‹</a></h2><p>åœ¨å¤©æœºå­¦å ‚é¡¹ç›®ä¸­ï¼Œç§¯åˆ†æ’è¡Œæ¦œæ˜¯åˆ†èµ›å­£çš„ï¼Œæ¯ä¸€ä¸ªæœˆæ˜¯ä¸€ä¸ªèµ›å­£ã€‚å› æ­¤æ¯åˆ°æ¯ä¸ªæœˆçš„æœˆåˆï¼Œå°±ä¼šè¿›å…¥ä¸€ä¸ªæ–°çš„èµ›å­£ã€‚æ‰€æœ‰ç”¨æˆ·çš„ç§¯åˆ†åº”è¯¥æ¸…é›¶ï¼Œé‡æ–°ç´¯ç§¯ã€‚</p><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬èƒ½æŠŠRedisä¸­çš„æ¦œå•æ•°æ®ç›´æ¥æ¸…ç©ºå—ï¼Ÿæ˜¾ç„¶ä¸è¡Œï¼Redisä¸­çš„æ¦œå•æ•°æ®æ˜¯ä¸Šä¸ªæœˆçš„æ•°æ®ï¼Œå±äºå†å²æ¦œå•äº†ï¼Œç›´æ¥æ¸…ç©ºå°±ä¸¢å¤±äº†ä¸€ä¸ªèµ›å­£çš„æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å°†Redisä¸­çš„å†å²æ•°æ®æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼Œç„¶åå†æ¸…é›¶ã€‚å¦‚å›¾ï¼š</p><p><img src="`+_+'" alt="image-20240214023844466" loading="lazy"></p><p>ä¸è¿‡ï¼Œè¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼š</p><p>å‡å¦‚æœ‰æ•°ç™¾ä¸‡ç”¨æˆ·ï¼Œè¿™å°±æ„å‘³ç€æ¯ä¸ªèµ›å­£æ¦œå•éƒ½æœ‰æ•°ç™¾ä¸‡æ•°æ®ã€‚éšç€æ—¶é—´æ¨ç§»ï¼Œå†å²èµ›å­£è¶Šæ¥è¶Šå¤šï¼Œå¦‚æœå…¨éƒ¨ä¿å­˜åˆ°ä¸€å¼ è¡¨ä¸­ï¼Œæ•°æ®é‡ä¼šéå¸¸ææ€–ï¼</p><p>è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><br><h3 id="æµ·é‡æ•°æ®å­˜å‚¨ç­–ç•¥" tabindex="-1">æµ·é‡æ•°æ®å­˜å‚¨ç­–ç•¥ <a class="header-anchor" href="#æµ·é‡æ•°æ®å­˜å‚¨ç­–ç•¥" aria-label="Permalink to &quot;æµ·é‡æ•°æ®å­˜å‚¨ç­–ç•¥&quot;">â€‹</a></h3><p>å¯¹äºæ•°æ®åº“çš„æµ·é‡æ•°æ®å­˜å‚¨ï¼Œæ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œå¸¸è§çš„æœ‰ï¼š</p><p><img src="'+x+'" alt="img" loading="lazy"></p><br><h4 id="åˆ†åŒº" tabindex="-1">åˆ†åŒº <a class="header-anchor" href="#åˆ†åŒº" aria-label="Permalink to &quot;åˆ†åŒº&quot;">â€‹</a></h4><p>è¡¨åˆ†åŒºï¼ˆPartitionï¼‰æ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹æ¡ˆï¼Œå¯ä»¥è§£å†³å•è¡¨æ•°æ®è¾ƒå¤šçš„é—®é¢˜ã€‚MySQL5.1å¼€å§‹æ”¯æŒè¡¨åˆ†åŒºåŠŸèƒ½ã€‚</p><br><p>æ•°æ®åº“çš„è¡¨æœ€ç»ˆè‚¯å®šæ˜¯ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œå¯¹äºInoDBå¼•æ“ï¼Œä¸€å¼ è¡¨çš„æ•°æ®åœ¨ç£ç›˜ä¸Šå¯¹åº”ä¸€ä¸ªibdæ–‡ä»¶ã€‚å¦‚å›¾ï¼Œæˆ‘ä»¬çš„ç§¯åˆ†æ¦œå•è¡¨å¯¹åº”çš„æ–‡ä»¶ï¼š</p><p><img src="'+S+'" alt="img" loading="lazy"></p><br><p>å¦‚æœè¡¨æ•°æ®è¿‡å¤šï¼Œå°±ä¼šå¯¼è‡´æ–‡ä»¶ä½“ç§¯éå¸¸å¤§ã€‚æ–‡ä»¶å°±ä¼šè·¨è¶Šå¤šä¸ªç£ç›˜åˆ†åŒºï¼Œæ•°æ®æ£€ç´¢æ—¶çš„é€Ÿåº¦å°±ä¼šéå¸¸æ…¢ã€‚</p><br><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMySQLåœ¨5.1ç‰ˆæœ¬å¼•å…¥è¡¨åˆ†åŒºåŠŸèƒ½ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŒ‰ç…§æŸç§è§„åˆ™ï¼ŒæŠŠè¡¨æ•°æ®å¯¹åº”çš„ibdæ–‡ä»¶æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶æ¥å­˜å‚¨ã€‚ä»ç‰©ç†ä¸Šæ¥çœ‹ï¼Œä¸€å¼ è¡¨çš„æ•°æ®è¢«æ‹†åˆ°å¤šä¸ªè¡¨æ–‡ä»¶å­˜å‚¨äº†ï¼›ä»é€»è¾‘ä¸Šæ¥çœ‹ï¼Œä»–ä»¬å¯¹å¤–è¡¨ç°æ˜¯ä¸€å¼ è¡¨ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„å†å²æ¦œå•æ•°æ®ï¼Œå¯ä»¥æŒ‰ç…§èµ›å­£åˆ‡åˆ†ï¼š</p><p><img src="'+P+'" alt="img" loading="lazy"></p><p>æ­¤æ—¶ï¼Œèµ›å­£æ¦œå•è¡¨çš„ç£ç›˜æ–‡ä»¶å°±è¢«åˆ†æˆäº†ä¸¤ä¸ªæ–‡ä»¶ã€‚ä½†é€»è¾‘ä¸Šè¿˜æ˜¯ä¸€å¼ è¡¨ã€‚å¢åˆ æ”¹æŸ¥çš„æ–¹å¼ä¸ä¼šæœ‰ä»€ä¹ˆå˜åŒ–ï¼Œåªä¸è¿‡åº•å±‚MySQLåº•å±‚çš„å¤„ç†ä¸Šä¼šæœ‰å˜æ›´ã€‚ä¾‹å¦‚æ£€ç´¢æ—¶å¯ä»¥åªæ£€ç´¢æŸä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ã€‚</p><br><p>è¿™æ ·åšæœ‰å‡ ä¸ªå¥½å¤„ï¼š</p><ul><li>å¯ä»¥å­˜å‚¨æ›´å¤šçš„æ•°æ®ï¼Œçªç ´å•è¡¨ä¸Šé™ã€‚ç”šè‡³å¯ä»¥å­˜å‚¨åˆ°ä¸åŒç£ç›˜ï¼Œçªç ´ç£ç›˜ä¸Šé™</li><li>æŸ¥è¯¢æ—¶å¯ä»¥æ ¹æ®è§„åˆ™åªæ£€ç´¢æŸä¸€ä¸ªæ–‡ä»¶ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡</li><li>æ•°æ®ç»Ÿè®¡æ—¶ï¼Œå¯ä»¥å¤šæ–‡ä»¶å¹¶è¡Œç»Ÿè®¡ï¼Œæœ€åæ±‡æ€»ç»“æœï¼Œæé«˜ç»Ÿè®¡æ•ˆç‡</li><li>å¯¹äºä¸€äº›å†å²æ•°æ®ï¼Œå¦‚æœä¸éœ€è¦æ—¶ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤åˆ†åŒºæ–‡ä»¶ï¼Œæé«˜åˆ é™¤æ•ˆç‡</li></ul><br><p>è¡¨åˆ†åŒºçš„æœ¬è´¨æ˜¯å¯¹æ•°æ®çš„<strong>æ°´å¹³æ‹†åˆ†</strong>ï¼Œè€Œæ‹†åˆ†çš„æ–¹å¼ä¹Ÿæœ‰å¤šç§ï¼Œå¸¸è§çš„æœ‰ï¼š</p><ul><li>Rangeåˆ†åŒºï¼šæŒ‰ç…§æŒ‡å®šå­—æ®µçš„å–å€¼èŒƒå›´åˆ†åŒº</li><li>Liståˆ†åŒºï¼šæŒ‰ç…§æŒ‡å®šå­—æ®µçš„æšä¸¾å€¼åˆ†åŒºï¼Œå¿…é¡»æå‰æŒ‡å®šå¥½æ‰€æœ‰çš„åˆ†åŒºå€¼ï¼Œå¦‚æœæ•°æ®æ‰¾ä¸åˆ°åˆ†åŒºä¼šæŠ¥é”™</li><li>Hashåˆ†åŒºï¼šåŸºäºå­—æ®µåšhashè¿ç®—ååˆ†åŒºï¼Œä¸€èˆ¬åšhashè¿ç®—çš„å­—æ®µéƒ½æ˜¯æ•°å€¼ç±»å‹</li><li>Keyåˆ†åŒºï¼šæ ¹æ®æŒ‡å®šå­—æ®µçš„å€¼åšè¿ç®—çš„ç»“æœåˆ†åŒºï¼Œä¸hashåˆ†åŒºç±»ä¼¼ï¼Œä½†ä¸é™å®šå­—æ®µç±»å‹</li></ul><br><p>å¯¹äºèµ›å­£æ¦œå•æ¥è¯´ï¼Œæœ€åˆé€‚çš„åˆ†åŒºæ–¹å¼æ˜¯åŸºäºèµ›å­£å€¼åˆ†åŒºï¼Œæˆ‘ä»¬å¸Œæœ›åŒä¸€ä¸ªèµ›å­£æ”¾åˆ°ä¸€ä¸ªåˆ†åŒºã€‚è¿™å°±åªèƒ½ä½¿ç”¨Liståˆ†åŒºï¼Œè€ŒListåˆ†åŒºå´éœ€è¦æšä¸¾å‡ºæ‰€æœ‰å¯èƒ½çš„åˆ†åŒºå€¼ã€‚ä½†æ˜¯èµ›å­£åˆ†åŒºidæ˜¯æ— é™çš„ï¼Œæ— æ³•å…¨éƒ¨æšä¸¾ï¼Œæ‰€ä»¥å°±éå¸¸å°´å°¬ã€‚</p><br><p>MySQLçš„è¡¨åˆ†åŒºè¯¦ç»†ä¿¡æ¯å¯å‚è€ƒä¸‹é¢çš„æ–‡æ¡£ï¼š</p><p><a href="https://www.cnblogs.com/wenxuehai/p/15901779.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/wenxuehai/p/15901779.html</a></p><br><h4 id="åˆ†è¡¨" tabindex="-1">åˆ†è¡¨ <a class="header-anchor" href="#åˆ†è¡¨" aria-label="Permalink to &quot;åˆ†è¡¨&quot;">â€‹</a></h4><p><strong>åˆ†è¡¨</strong>æ˜¯ä¸€ç§è¡¨è®¾è®¡æ–¹æ¡ˆï¼Œç”±å¼€å‘è€…åœ¨åˆ›å»ºè¡¨æ—¶æŒ‰ç…§è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚æ‹†åˆ†è¡¨ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯å¼€å‘è€…è‡ªå·±å¯¹è¡¨çš„å¤„ç†ï¼Œä¸æ•°æ®åº“æ— å…³ã€‚</p><br><p>è€Œä¸”ï¼Œä¸€æ—¦åšäº†åˆ†è¡¨ï¼Œæ— è®ºæ˜¯é€»è¾‘ä¸Šï¼Œè¿˜æ˜¯ç‰©ç†ä¸Šï¼Œå°±ä»ä¸€å¼ è¡¨å˜æˆäº†å¤šå¼ è¡¨ï¼å¢åˆ æ”¹æŸ¥çš„æ–¹å¼å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œå¿…é¡»è‡ªå·±è€ƒè™‘è¦å»å“ªå¼ è¡¨åšæ•°æ®å¤„ç†ã€‚</p><p>åˆ†åŒºåˆ™åœ¨é€»è¾‘ä¸Šæ˜¯åŒä¸€å¼ è¡¨ï¼Œå¢åˆ æ”¹æŸ¥ä¸ä»¥å‰æ²¡æœ‰åŒºåˆ«ã€‚è¿™å°±æ˜¯åˆ†åŒºå’Œåˆ†è¡¨æœ€å¤§çš„ä¸€ç§åŒºåˆ«ã€‚</p><br><p><strong>æ°´å¹³åˆ†è¡¨</strong></p><p>ä¾‹å¦‚ï¼Œå¯¹äºèµ›å­£æ¦œå•ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§èµ›å­£æ‹†åˆ†ä¸ºå¤šå¼ è¡¨ï¼Œ<strong>æ¯ä¸€ä¸ªèµ›å­£ä¸€å¼ æ–°çš„è¡¨</strong>ã€‚å¦‚å›¾ï¼š</p><p><img src="'+T+'" alt="img" loading="lazy"></p><p>è¿™ç§æ–¹å¼å°±æ˜¯æ°´å¹³åˆ†è¡¨ï¼Œ<strong>è¡¨ç»“æ„ä¸å˜</strong>ï¼Œä»…ä»…æ˜¯æ¯å¼ è¡¨<strong>æ•°æ®ä¸åŒ</strong>ã€‚æŸ¥è¯¢èµ›å­£1ï¼Œå°±æ‰¾ç¬¬ä¸€å¼ è¡¨ã€‚æŸ¥è¯¢èµ›å­£2ï¼Œå°±æ‰¾ç¬¬äºŒå¼ è¡¨ã€‚</p><p>ç”±äºåˆ†è¡¨æ˜¯å¼€å‘è€…çš„è¡Œä¸ºï¼Œå› æ­¤æ‹†åˆ†æ–¹å¼æ›´åŠ çµæ´»ã€‚é™¤äº†æ°´å¹³åˆ†è¡¨ï¼Œä¹Ÿå¯ä»¥åš<strong>å‚ç›´åˆ†è¡¨</strong>ã€‚</p><br><p><strong>å‚ç›´åˆ†è¡¨</strong></p><p>ä»€ä¹ˆæ˜¯å‚ç›´åˆ†è¡¨å‘¢ï¼Ÿ</p><p>å¦‚æœä¸€å¼ è¡¨çš„å­—æ®µéå¸¸å¤šï¼Œæ¯”å¦‚è¾¾åˆ°30ä¸ªä»¥ä¸Šï¼Œè¿™æ ·çš„è¡¨æˆ‘ä»¬ç§°ä¸º<strong>å®½è¡¨</strong>ã€‚å®½è¡¨ç”±äºå­—æ®µå¤ªå¤šï¼Œå•è¡Œæ•°æ®ä½“ç§¯å°±ä¼šéå¸¸å¤§ï¼Œè™½ç„¶æ•°æ®ä¸å¤šï¼Œä½†å¯èƒ½è¡¨ä½“ç§¯ä¹Ÿä¼šéå¸¸å¤§ï¼ä»è€Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>ä¾‹å¦‚ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯è¡¨ï¼Œé™¤äº†ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼Œè¿˜åŒ…å«å¾ˆå¤šå…¶å®ƒåŠŸèƒ½ä¿¡æ¯ï¼š</p><p><img src="'+j+'" alt="img" loading="lazy"></p><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå…¶ä¸­çš„ä¸€äº›ä¸å¸¸ç”¨å­—æ®µæ‹†åˆ†å‡ºå»ã€‚ä¸€å¼ è¡¨ä¸­åŒ…å«ç™»å½•å¸¸ç”¨å­—æ®µï¼Œå¦ä¸€å¼ è¡¨åŒ…å«å…¶å®ƒå­—æ®µï¼š</p><p><img src="'+I+'" alt="img" loading="lazy"></p><p>è¿™ä¸ªæ—¶å€™ä¸€å¼ è¡¨å°±å˜æˆäº†ä¸¤å¼ è¡¨ã€‚è€Œä¸”ä¸¤å¼ è¡¨çš„<strong>ç»“æ„ä¸åŒ</strong>ï¼Œ<strong>æ•°æ®ä¹Ÿä¸åŒ</strong>ã€‚è¿™ç§æŒ‰ç…§å­—æ®µæ‹†åˆ†è¡¨çš„æ–¹å¼ï¼Œç§°ä¸º<strong>å‚ç›´æ‹†åˆ†</strong>ã€‚</p><br><p><strong>ä¼˜ç¼ºç‚¹</strong></p><p>åˆ†è¡¨æ–¹æ¡ˆä¸åˆ†åŒºæ–¹æ¡ˆç›¸æ¯”æœ‰ä¸€äº›ä¼˜ç‚¹ï¼š</p><ul><li>æ‹†åˆ†æ–¹å¼æ›´åŠ çµæ´»</li><li>è€Œä¸”å¯ä»¥è§£å†³å•è¡¨å­—æ®µè¿‡å¤šçš„é—®é¢˜</li></ul><p>ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ç¡®å®šï¼š</p><ul><li>å¢åˆ æ”¹æŸ¥æ—¶ï¼Œéœ€è¦è‡ªå·±åˆ¤æ–­è®¿é—®å“ªå¼ è¡¨</li><li>å‚ç›´æ‹†åˆ†è¿˜ä¼šå¯¼è‡´äº‹åŠ¡é—®é¢˜åŠæ•°æ®å…³è”é—®é¢˜ï¼šåŸæœ¬ä¸€å¼ è¡¨çš„æ“ä½œï¼Œå˜ä¸ºå¤šå¼ è¡¨æ“ä½œã€‚</li></ul><br><p>ä¸è¿‡ï¼Œåœ¨å¼€å‘ä¸­æˆ‘ä»¬å¾ˆå¤šæƒ…å†µä¸‹ä¸šåŠ¡éœ€æ±‚å¤æ‚ï¼Œæ›´çœ‹é‡åˆ†è¡¨çš„çµæ´»æ€§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½ä¼šé€‰æ‹©åˆ†è¡¨æ–¹æ¡ˆã€‚</p><br><h4 id="åˆ†åº“å’Œé›†ç¾¤" tabindex="-1">åˆ†åº“å’Œé›†ç¾¤ <a class="header-anchor" href="#åˆ†åº“å’Œé›†ç¾¤" aria-label="Permalink to &quot;åˆ†åº“å’Œé›†ç¾¤&quot;">â€‹</a></h4><p>æ— è®ºæ˜¯åˆ†åŒºï¼Œè¿˜æ˜¯åˆ†è¡¨ï¼Œæˆ‘ä»¬åˆšæ‰çš„åˆ†æéƒ½æ˜¯å»ºç«‹åœ¨å•ä¸ªæ•°æ®åº“çš„åŸºç¡€ä¸Šã€‚ä½†æ˜¯å•ä¸ªæ•°æ®åº“ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>å•ç‚¹æ•…éšœé—®é¢˜ï¼šæ•°æ®åº“å‘ç”Ÿæ•…éšœï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¼šç˜«ç—ª</li><li>å•åº“çš„æ€§èƒ½ç“¶é¢ˆé—®é¢˜ï¼šå•åº“å—æœåŠ¡å™¨é™åˆ¶ï¼Œå…¶ç½‘ç»œå¸¦å®½ã€CPUã€è¿æ¥æ•°éƒ½æœ‰ç“¶é¢ˆ</li><li>å•åº“çš„å­˜å‚¨ç“¶é¢ˆé—®é¢˜ï¼šå•åº“çš„ç£ç›˜ç©ºé—´æœ‰ä¸Šé™ï¼Œå¦‚æœç£ç›˜è¿‡å¤§ï¼Œæ•°æ®æ£€ç´¢çš„é€Ÿåº¦åˆä¼šå˜æ…¢</li></ul><br><p>ç»¼ä¸Šï¼Œåœ¨å¤§å‹ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬é™¤äº†è¦åšåˆ†è¡¨ã€è¿˜éœ€è¦å¯¹æ•°æ®åšåˆ†åº“ï¼Œå»ºç«‹ç»¼åˆé›†ç¾¤ã€‚</p><br><p>é¦–å…ˆï¼Œåœ¨å¾®æœåŠ¡é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¼šæŒ‰ç…§é¡¹ç›®æ¨¡å—ï¼Œæ¯ä¸ªå¾®æœåŠ¡ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œå› æ­¤æ¯ä¸ªåº“çš„è¡¨æ˜¯ä¸åŒçš„ï¼Œè¿™ç§åˆ†åº“æ¨¡å¼æˆä¸º<strong>å‚ç›´åˆ†åº“</strong>ã€‚</p><p>è€Œä¸ºäº†ä¿è¯å•èŠ‚ç‚¹çš„é«˜å¯ç”¨æ€§ï¼Œæˆ‘ä»¬ä¼šç»™æ•°æ®åº“å»ºç«‹ä¸»ä»é›†ç¾¤ï¼Œä¸»èŠ‚ç‚¹å‘ä»èŠ‚ç‚¹åŒæ­¥æ•°æ®ã€‚ä¸¤è€…ç»“æ„ä¸€æ ·ï¼Œå¯ä»¥çœ‹åšæ˜¯<strong>æ°´å¹³æ‰©å±•</strong>ã€‚</p><br><p>è¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°å‚ç›´åˆ†åº“ã€æ°´å¹³æ‰©å±•çš„ç»¼åˆé›†ç¾¤ï¼Œå¦‚å›¾ï¼š</p><p><img src="'+R+'" alt="img" loading="lazy"></p><br><p>è¿™ç§æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ï¼š</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>è§£å†³äº†æµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜ï¼Œçªç ´äº†å•æœºå­˜å‚¨ç“¶é¢ˆ</li><li>æé«˜äº†å¹¶å‘èƒ½åŠ›ï¼Œçªç ´äº†å•æœºæ€§èƒ½ç“¶é¢ˆ</li><li>é¿å…äº†å•ç‚¹æ•…éšœ</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æˆæœ¬éå¸¸é«˜</li><li>æ•°æ®èšåˆç»Ÿè®¡æ¯”è¾ƒéº»çƒ¦</li><li>ä¸»ä»åŒæ­¥çš„ä¸€è‡´æ€§é—®é¢˜</li><li>åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</li></ul><br><h3 id="å†å²æ¦œå•çš„å­˜å‚¨ç­–ç•¥" tabindex="-1">å†å²æ¦œå•çš„å­˜å‚¨ç­–ç•¥ <a class="header-anchor" href="#å†å²æ¦œå•çš„å­˜å‚¨ç­–ç•¥" aria-label="Permalink to &quot;å†å²æ¦œå•çš„å­˜å‚¨ç­–ç•¥&quot;">â€‹</a></h3><p>å¤©æœºå­¦å ‚é¡¹ç›®æ˜¯ä¸€ä¸ªæ•™è‚²ç±»é¡¹ç›®ï¼Œç”¨æˆ·è§„æ¨¡å¹¶ä¸ä¼šå¾ˆé«˜ï¼Œä¸€èˆ¬åœ¨åå¤šä¸‡åˆ°ç™¾ä¸‡çº§åˆ«ã€‚å› æ­¤æœ€ç»ˆçš„æ•°æ®è§„æ¨¡ä¹Ÿå¹¶ä¸ä¼šéå¸¸åºå¤§ã€‚</p><p>ç»¼åˆä¹‹å‰çš„åˆ†æï¼Œç»“åˆå¤©æœºå­¦å ‚çš„é¡¹ç›®æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¦œå•æ•°æ®åšåˆ†è¡¨ï¼Œä½†æ˜¯æš‚æ—¶ä¸éœ€è¦åšåˆ†åº“å’Œé›†ç¾¤ã€‚</p><br><p>ç”±äºæˆ‘ä»¬è¦è§£å†³çš„æ˜¯æ•°æ®è¿‡å¤šé—®é¢˜ï¼Œå› æ­¤åˆ†è¡¨çš„æ–¹å¼é€‰æ‹©<strong>æ°´å¹³åˆ†è¡¨</strong>ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯æŒ‰ç…§èµ›å­£æ‹†åˆ†ï¼Œæ¯ä¸€ä¸ªèµ›å­£æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¡¨ï¼Œå¦‚å›¾ï¼š</p><p><img src="'+q+'" alt="img" loading="lazy"></p><p>ä¸è¿‡è¿™é‡Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›ç®€åŒ–ï¼š</p><ul><li>æˆ‘ä»¬å¯ä»¥å°†idé‡‡ç”¨è‡ªå¢idï¼Œé‚£ä¹ˆidå°±æ˜¯æ’åï¼Œæ’åå­—æ®µå°±ä¸éœ€è¦äº†ã€‚</li><li>ä¸åŒèµ›å­£ç”¨ä¸åŒè¡¨ï¼Œé‚£ä¹ˆèµ›å­£å­—æ®µå°±ä¸éœ€è¦äº†ã€‚</li></ul><p>ç»¼ä¸Šï¼Œæœ€ç»ˆè¡¨ç»“æ„å¯ä»¥æ˜¯è¿™æ ·ï¼š</p><p><img src="'+L+'" alt="img" loading="lazy"></p><p>ä¸è¿‡è¿™å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œæ¯ä¸ªèµ›å­£è¦æœ‰ä¸åŒçš„è¡¨ï¼Œè¿™äº›è¡¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºå‘¢ï¼Ÿ</p><br><p>æ˜¾ç„¶ï¼Œåº”è¯¥åœ¨æ¯ä¸ªèµ›å­£åˆšå¼€å§‹çš„æ—¶å€™ï¼ˆæœˆåˆï¼‰æ¥åˆ›å»ºæ–°çš„èµ›å­£æ¦œå•è¡¨ã€‚æ¯ä¸ªæœˆçš„æœˆåˆæ‰§è¡Œä¸€ä¸ªåˆ›å»ºè¡¨çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®šæ—¶ä»»åŠ¡æ¥å®ç°ã€‚</p><p>ç”±äºè¡¨çš„åç§°ä¸­åŒ…å«èµ›å­£idï¼Œå› æ­¤åœ¨å®šæ—¶ä»»åŠ¡ä¸­æˆ‘ä»¬è¿˜è¦å…ˆæŸ¥è¯¢èµ›å­£ä¿¡æ¯ï¼Œè·å–èµ›å­£idï¼Œæ‹¼æ¥å¾—åˆ°è¡¨åï¼Œæœ€ååˆ›å»ºè¡¨ã€‚</p><br><p>å¤§æ¦‚æµç¨‹å¦‚å›¾ï¼š</p><p><img src="'+f+'" alt="img" loading="lazy"></p><br><p>è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><div class="language-SQL vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `points_board_X`</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      BIGINT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTO_INCREMENT COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;æ¦œå•id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `user_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> BIGINT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;å­¦ç”Ÿid&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    `points`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  INT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ç§¯åˆ†å€¼&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USING</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BTREE,</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    INDEX</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `idx_user_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`user_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USING</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BTREE</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> )</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    COMMENT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;å­¦éœ¸å¤©æ¢¯æ¦œ&#39;</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    COLLATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;utf8mb4_0900_ai_ci&#39;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ENGINE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> InnoDB</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ROW_FORMAT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DYNAMIC</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ;</span></span></code></pre></div><br><p>è¡¨åç§°çš„å‰ç¼€æ˜¯<code>points_board_</code>ï¼Œæˆ‘ä»¬åº”è¯¥å°†å…¶å®šä¹‰ä¸ºå¸¸é‡ã€‚åœ¨<code>tj-learning</code>æ¨¡å—ä¸­å®šä¹‰ï¼š</p><p><img src="'+O+'" alt="img" loading="lazy"></p><br><p>åŒæ—¶ï¼Œè¡¨ä¸­çš„å­—æ®µå°‘äº†2ä¸ªï¼ˆrankã€seasonï¼‰ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¿®æ”¹å¯¹åº”çš„å®ä½“ç±»ï¼š</p><p><img src="'+N+'" alt="img" loading="lazy"></p><br><h3 id="å®šæ—¶ä»»åŠ¡ç”Ÿæˆæ¦œå•è¡¨" tabindex="-1">å®šæ—¶ä»»åŠ¡ç”Ÿæˆæ¦œå•è¡¨ <a class="header-anchor" href="#å®šæ—¶ä»»åŠ¡ç”Ÿæˆæ¦œå•è¡¨" aria-label="Permalink to &quot;å®šæ—¶ä»»åŠ¡ç”Ÿæˆæ¦œå•è¡¨&quot;">â€‹</a></h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡SpringTaskå®šä¹‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œåœ¨æ¯æœˆåˆåŠ¨æ€ç”Ÿæˆèµ›å­£æ¦œå•è¡¨ã€‚</p><br><h4 id="å®šæ—¶ä»»åŠ¡" tabindex="-1">å®šæ—¶ä»»åŠ¡ <a class="header-anchor" href="#å®šæ—¶ä»»åŠ¡" aria-label="Permalink to &quot;å®šæ—¶ä»»åŠ¡&quot;">â€‹</a></h4><p>é¦–å…ˆï¼Œåœ¨<code>tj-learning</code>æ¨¡å—ä¸‹å®šä¹‰ä¸€ä¸ªä»»åŠ¡å¤„ç†ç±»ï¼š</p><p><img src="'+w+`" alt="img" loading="lazy"></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.handler;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.utils.CollUtils;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.utils.DateUtils;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service.IPointsBoardSeasonService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service.IPointsBoardService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lombok.RequiredArgsConstructor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.stereotype.Component;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.time.LocalDateTime;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.List;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.constants.LearningConstants.POINTS_BOARD_TABLE_PREFIX;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequiredArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsBoardPersistentHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IPointsBoardSeasonService seasonService;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IPointsBoardService pointsBoardService;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Scheduled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cron</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0 0 3 1 * ?&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¯æœˆ1å·ï¼Œå‡Œæ™¨3ç‚¹æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createPointsBoardTableOfLastSeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1.è·å–ä¸Šæœˆæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LocalDateTime time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minusMonths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.æŸ¥è¯¢èµ›å­£id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Integer season </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> seasonService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">querySeasonByTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(time);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (season </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // èµ›å­£ä¸å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3.åˆ›å»ºè¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pointsBoardService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createPointsBoardTableBySeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(season);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>è¿™é‡Œè°ƒç”¨äº†ä¸¤ä¸ªserviceçš„æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯æŸ¥è¯¢èµ›å­£ï¼Œä¸€ä¸ªæ˜¯åˆ›å»ºè¡¨ã€‚</p><br><h4 id="æŸ¥è¯¢èµ›å­£id" tabindex="-1">æŸ¥è¯¢èµ›å­£id <a class="header-anchor" href="#æŸ¥è¯¢èµ›å­£id" aria-label="Permalink to &quot;æŸ¥è¯¢èµ›å­£id&quot;">â€‹</a></h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨<code>tj-learning</code>æ¨¡å—çš„<code>com.tianji.learning.service.IPointsBoardSeasonService</code>ä¸­å®šä¹‰æŸ¥è¯¢èµ›å­£çš„æ–¹æ³•ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.extension.service.IService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.po.PointsBoardSeason;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.time.LocalDateTime;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *  æœåŠ¡ç±»</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;/p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IPointsBoardSeasonService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoardSeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Integer </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">querySeasonByTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LocalDateTime </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>ç„¶ååœ¨<code>com.tianji.learning.service.impl.PointsBoardSeasonServiceImpl</code>ä¸­å®ç°è¯¥æ–¹æ³•ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service.impl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.po.PointsBoardSeason;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.mapper.PointsBoardSeasonMapper;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service.IPointsBoardSeasonService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.stereotype.Service;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.time.LocalDateTime;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.Optional;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *  æœåŠ¡å®ç°ç±»</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;/p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Service</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsBoardSeasonServiceImpl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ServiceImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoardSeasonMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoardSeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IPointsBoardSeasonService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">querySeasonByTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LocalDateTime </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Optional&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoardSeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; optional </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lambdaQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">le</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PointsBoardSeason</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getBeginTime, time)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PointsBoardSeason</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getEndTime, time)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oneOpt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> optional.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PointsBoardSeason</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orElse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h4 id="åˆ›å»ºè¡¨" tabindex="-1">åˆ›å»ºè¡¨ <a class="header-anchor" href="#åˆ›å»ºè¡¨" aria-label="Permalink to &quot;åˆ›å»ºè¡¨&quot;">â€‹</a></h4><p>åœ¨<code>tj-learning</code>æ¨¡å—çš„<code>com.tianji.learning.service.IPointsBoardService</code>ä¸­å®šä¹‰åˆ›å»ºè¡¨çš„æ–¹æ³•ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.extension.service.IService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.po.PointsBoard;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.query.PointsBoardQuery;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.vo.PointsBoardVO;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.List;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * å­¦éœ¸å¤©æ¢¯æ¦œ æœåŠ¡ç±»</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;/p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IPointsBoardService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PointsBoardVO </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryPointsBoardBySeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PointsBoardQuery </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createPointsBoardTableBySeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Integer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">season</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>ç„¶ååœ¨<code>com.tianji.learning.service.impl.PointsBoardServiceImpl</code>ä¸­å®ç°è¯¥æ–¹æ³•ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createPointsBoardTableBySeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Integer season) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    getBaseMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createPointsBoardTable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(POINTS_BOARD_TABLE_PREFIX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> season);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>è¿™é‡Œçš„å»ºè¡¨è¯­å¥è‚¯å®šæ˜¯è‡ªå®šä¹‰SQLï¼Œéœ€è¦ç°åœ¨åœ¨<code>com.tianji.learning.mapper.PointsBoardMapper</code>ä¸­å®šä¹‰å‡ºæ–¹æ³•ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.mapper;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.po.PointsBoard;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.apache.ibatis.annotations.Param;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * å­¦éœ¸å¤©æ¢¯æ¦œ Mapper æ¥å£</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;/p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsBoardMapper</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createPointsBoardTable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tableName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tableName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>ç„¶ååœ¨<code>tj-learning</code>æ¨¡å—çš„<code>src/resources/mapper/PointsBoardMapper.xml</code>ä¸­ç¼–å†™SQLï¼š</p><div class="language-XML vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">XML</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;?</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">xml</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UTF-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;!</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DOCTYPE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> mapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">mapper</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.tianji.learning.mapper.PointsBoardMapper&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">insert</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;createPointsBoardTable&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> parameterType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;java.lang.String&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        CREATE TABLE \`\${tableName}\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            \`id\`      BIGINT NOT NULL AUTO_INCREMENT COMMENT &#39;æ¦œå•id&#39;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            \`user_id\` BIGINT NOT NULL COMMENT &#39;å­¦ç”Ÿid&#39;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            \`points\`  INT    NOT NULL COMMENT &#39;ç§¯åˆ†å€¼&#39;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            PRIMARY KEY (\`id\`) USING BTREE,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            INDEX \`idx_user_id\` (\`user_id\`) USING BTREE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            COMMENT =&#39;å­¦éœ¸å¤©æ¢¯æ¦œ&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            COLLATE = &#39;utf8mb4_0900_ai_ci&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ENGINE = InnoDB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ROW_FORMAT = DYNAMIC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">insert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">mapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><br><h3 id="åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦" tabindex="-1">åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ <a class="header-anchor" href="#åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦" aria-label="Permalink to &quot;åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦&quot;">â€‹</a></h3><p>ç›®å‰ï¼Œæˆ‘ä»¬çš„å®šæ—¶ä»»åŠ¡éƒ½æ˜¯åŸºäºSpringTaskæ¥å®ç°çš„ã€‚ä½†æ˜¯SpringTaskå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>å½“å¾®æœåŠ¡å¤šå®ä¾‹éƒ¨ç½²æ—¶ï¼Œå®šæ—¶ä»»åŠ¡ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ã€‚è€Œäº‹å®ä¸Šæˆ‘ä»¬åªéœ€è¦è¿™ä¸ªä»»åŠ¡è¢«æ‰§è¡Œä¸€æ¬¡å³å¯ã€‚</li><li>æˆ‘ä»¬é™¤äº†è¦å®šæ—¶åˆ›å»ºè¡¨ï¼Œè¿˜è¦å®šæ—¶æŒä¹…åŒ–Redisæ•°æ®åˆ°æ•°æ®åº“ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™å¤šä¸ªå®šæ—¶ä»»åŠ¡èƒ½å¤ŸæŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œï¼ŒSpringTaskæ— æ³•æ§åˆ¶ä»»åŠ¡é¡ºåº</li></ul><br><p>ä¸ä»…ä»…æ˜¯SpringTaskï¼Œå…¶å®ƒå•æœºä½¿ç”¨çš„å®šæ—¶ä»»åŠ¡å·¥å…·ï¼Œéƒ½æ— æ³•å®ç°åƒè¿™ç§ä»»åŠ¡æ‰§è¡Œè€…çš„è°ƒåº¦ã€ä»»åŠ¡æ‰§è¡Œé¡ºåºçš„ç¼–æ’ã€ä»»åŠ¡ç›‘æ§ç­‰åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½å¿…é¡»è¦ç”¨åˆ°åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç»„ä»¶ã€‚</p><br><h4 id="åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦åŸç†" tabindex="-1">åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦åŸç† <a class="header-anchor" href="#åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦åŸç†" aria-label="Permalink to &quot;åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦åŸç†&quot;">â€‹</a></h4><p>é‚£ä¹ˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ˜¯å¦‚ä½•å®ç°ä»»åŠ¡è°ƒåº¦å’Œç¼–æ’çš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ™®é€šå®šæ—¶ä»»åŠ¡çš„å®ç°åŸç†ï¼Œä¸€èˆ¬å®šæ—¶ä»»åŠ¡ä¸­ä¼šæœ‰ä¸¤ä¸ªç»„ä»¶ï¼š</p><ul><li>ä»»åŠ¡ï¼šè¦æ‰§è¡Œçš„ä»£ç </li><li>ä»»åŠ¡è§¦å‘å™¨ï¼šåŸºäºå®šä¹‰å¥½çš„è§„åˆ™è§¦å‘ä»»åŠ¡</li></ul><br><p>å› æ­¤åœ¨å¤šå®ä¾‹éƒ¨ç½²çš„æ—¶å€™ï¼Œæ¯ä¸ªå¯åŠ¨çš„æœåŠ¡å®ä¾‹éƒ½ä¼šæœ‰è‡ªå·±çš„<strong>ä»»åŠ¡è§¦å‘å™¨</strong>ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å„ä¸ªå®ä¾‹å„è‡ªè¿è¡Œï¼Œæ— æ³•ç»Ÿä¸€æ§åˆ¶ï¼š</p><p><img src="`+M+'" alt="img" loading="lazy"></p><p>é‚£å¦‚æœæˆ‘ä»¬æƒ³è¦ç»Ÿä¸€æ§åˆ¶å„ä¸ªæœåŠ¡å®ä¾‹çš„ä»»åŠ¡æ‰§è¡Œå’Œè°ƒåº¦è¯¥æ€ä¹ˆåŠï¼Ÿ</p><br><p>å¤§å®¶åº”è¯¥èƒ½æƒ³åˆ°ï¼šå°±æ˜¯è¦æŠŠä»»åŠ¡è§¦å‘å™¨æå–åˆ°å„ä¸ªæœåŠ¡å®ä¾‹ä¹‹å¤–ï¼Œå»åšç»Ÿä¸€çš„è§¦å‘ã€ç»Ÿä¸€çš„è°ƒåº¦ã€‚</p><p>äº‹å®ä¸Šï¼Œå¤§å¤šæ•°çš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç»„ä»¶éƒ½æ˜¯è¿™æ ·åšçš„ï¼š</p><p><img src="'+X+'" alt="img" loading="lazy"></p><br><p>è¿™æ ·ä¸€æ¥ï¼Œå…·ä½“å“ªä¸ªä»»åŠ¡è¯¥æ‰§è¡Œï¼Œä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œäº¤ç»™å“ªä¸ªåº”ç”¨å®ä¾‹æ¥æ‰§è¡Œï¼Œå…¨éƒ¨éƒ½æœ‰ç»Ÿä¸€çš„ä»»åŠ¡è°ƒåº¦æœåŠ¡æ¥ç»Ÿä¸€æ§åˆ¶ã€‚å¹¶ä¸”æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä»»åŠ¡ç»“æœè¿˜å¯ä»¥é€šè¿‡å›è°ƒæ¥å£è¿”å›ï¼Œè®©æˆ‘ä»¬æ–¹ä¾¿çš„æŸ¥çœ‹ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ã€æ‰§è¡Œæ—¥å¿—ã€‚è¿™æ ·çš„æœåŠ¡å°±æ˜¯<strong>åˆ†å¸ƒå¼è°ƒåº¦æœåŠ¡</strong>äº†ã€‚</p><br><h4 id="åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æŠ€æœ¯å¯¹æ¯”" tabindex="-1">åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æŠ€æœ¯å¯¹æ¯” <a class="header-anchor" href="#åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æŠ€æœ¯å¯¹æ¯”" aria-label="Permalink to &quot;åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æŠ€æœ¯å¯¹æ¯”&quot;">â€‹</a></h4><p>èƒ½å¤Ÿå®ç°åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦çš„æŠ€æœ¯æœ‰å¾ˆå¤šï¼Œå¸¸è§çš„æœ‰ï¼š</p><table><thead><tr><th style="text-align:center;"></th><th style="text-align:center;"><strong>Quartz</strong></th><th style="text-align:center;"><strong>XXL-Job</strong></th><th style="text-align:center;"><strong>SchedulerX</strong></th><th style="text-align:center;"><strong>PowerJob</strong></th></tr></thead><tbody><tr><td style="text-align:center;"><strong>å®šæ—¶ç±»å‹</strong></td><td style="text-align:center;">CRON</td><td style="text-align:center;">é¢‘ç‡ã€é—´éš”ã€CRON</td><td style="text-align:center;">é¢‘ç‡ã€é—´éš”ã€CRONã€OpenAPI</td><td style="text-align:center;">é¢‘ç‡ã€é—´éš”ã€CRONã€OpenAPI</td></tr><tr><td style="text-align:center;"><strong>ä»»åŠ¡ç±»å‹</strong></td><td style="text-align:center;">Java</td><td style="text-align:center;">å¤šè¯­è¨€è„šæœ¬</td><td style="text-align:center;">å¤šè¯­è¨€è„šæœ¬</td><td style="text-align:center;">å¤šè¯­è¨€è„šæœ¬</td></tr><tr><td style="text-align:center;"><strong>ä»»åŠ¡è°ƒåº¦æ–¹å¼</strong></td><td style="text-align:center;">éšæœº</td><td style="text-align:center;">å•æœºã€åˆ†ç‰‡</td><td style="text-align:center;">å•æœºã€å¹¿æ’­ã€Mapã€MapReduce</td><td style="text-align:center;">å•æœºã€å¹¿æ’­ã€åˆ†ç‰‡ã€Mapã€MapReduce</td></tr><tr><td style="text-align:center;"><strong>ç®¡ç†æ§åˆ¶å°</strong></td><td style="text-align:center;">æ— </td><td style="text-align:center;">æ”¯æŒ</td><td style="text-align:center;">æ”¯æŒ</td><td style="text-align:center;">æ”¯æŒ</td></tr><tr><td style="text-align:center;"><strong>æ—¥å¿—ç™½å±</strong></td><td style="text-align:center;">æ— </td><td style="text-align:center;">æ”¯æŒ</td><td style="text-align:center;">æ”¯æŒ</td><td style="text-align:center;">æ”¯æŒ</td></tr><tr><td style="text-align:center;"><strong>æŠ¥è­¦ç›‘æ§</strong></td><td style="text-align:center;">æ— </td><td style="text-align:center;">æ”¯æŒ</td><td style="text-align:center;">æ”¯æŒ</td><td style="text-align:center;">æ”¯æŒ</td></tr><tr><td style="text-align:center;"><strong>å·¥ä½œæµ</strong></td><td style="text-align:center;">æ— </td><td style="text-align:center;">æœ‰é™</td><td style="text-align:center;">æ”¯æŒ</td><td style="text-align:center;">æ”¯æŒ</td></tr></tbody></table><p>å…¶ä¸­ï¼š</p><ul><li>Quartzç”±äºåŠŸèƒ½ç›¸å¯¹æ¯”è¾ƒè½åï¼Œç°åœ¨å·²ç»å¾ˆå°‘è¢«ä½¿ç”¨äº†ã€‚</li><li>SchedulerXæ˜¯é˜¿é‡Œå·´å·´çš„äº‘äº§å“ï¼Œæ”¶è´¹ã€‚</li><li>PowerJobæ˜¯é˜¿é‡Œå‘˜å·¥è‡ªå·±å¼€æºçš„ä¸€ä¸ªç»„ä»¶ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä¸è¿‡ç›®å‰å¸‚å€¼å æ¯”è¿˜ä¸é«˜ï¼Œè¿˜éœ€è¦ç­‰å¾…å¸‚åœºæ£€éªŒã€‚</li><li>XXL-JOBï¼šå¼€æºå…è´¹ï¼ŒåŠŸèƒ½è™½ç„¶ä¸å¦‚PowerJobï¼Œä¸è¿‡ç›®å‰å¸‚åœºå æ¯”æœ€é«˜ï¼Œç¨³å®šæ€§æœ‰ä¿è¯ã€‚</li></ul><br><p>æˆ‘ä»¬è¯¾å ‚ä¸­ä¼šé€‰æ‹©XXL-JOBè¿™ä¸ªç»„ä»¶ï¼Œå¦‚æœä½ ä»¬ä¼ä¸šå…·å¤‡æ¢ç´¢ç²¾ç¥ï¼Œè€Œä¸”éœ€è¦ä¸€äº›åˆ†å¸ƒå¼è¿ç®—åŠŸèƒ½ï¼Œæ¨èä½¿ç”¨PowerJobã€‚</p><br><h4 id="xxl-jobä»‹ç»" tabindex="-1">XXL-JOBä»‹ç» <a class="header-anchor" href="#xxl-jobä»‹ç»" aria-label="Permalink to &quot;XXL-JOBä»‹ç»&quot;">â€‹</a></h4><p>å®˜ç½‘åœ°å€ï¼š<a href="https://www.xuxueli.com/xxl-job/" target="_blank" rel="noreferrer">https://www.xuxueli.com/xxl-job/</a></p><p>XXL-JOBçš„è¿è¡ŒåŸç†å’Œæ¶æ„å¦‚å›¾ï¼š</p><p><img src="'+J+'" alt="img" loading="lazy"></p><p>XXL-JOBåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li><strong>æ‰§è¡Œå™¨</strong>ï¼šæˆ‘ä»¬çš„æœåŠ¡å¼•å…¥ä¸€ä¸ªXXL-JOBçš„ä¾èµ–ï¼Œå°±å¯ä»¥é€šè¿‡é…ç½®åˆ›å»ºä¸€ä¸ªæ‰§è¡Œå™¨ã€‚è´Ÿè´£ä¸XXL-JOBè°ƒåº¦ä¸­å¿ƒäº¤äº’ï¼Œæ‰§è¡Œæœ¬åœ°ä»»åŠ¡ã€‚</li><li><strong>è°ƒåº¦ä¸­å¿ƒ</strong>ï¼šä¸€ä¸ªç‹¬ç«‹æœåŠ¡ï¼Œè´Ÿè´£ç®¡ç†æ‰§è¡Œå™¨ã€ç®¡ç†ä»»åŠ¡ã€ä»»åŠ¡æ‰§è¡Œçš„è°ƒåº¦ã€ä»»åŠ¡ç»“æœå’Œæ—¥å¿—æ”¶é›†ã€‚</li></ul><br><h4 id="xxl-jobå®šæ—¶åˆ›å»ºæ¦œå•è¡¨" tabindex="-1">XXL-JOBå®šæ—¶åˆ›å»ºæ¦œå•è¡¨ <a class="header-anchor" href="#xxl-jobå®šæ—¶åˆ›å»ºæ¦œå•è¡¨" aria-label="Permalink to &quot;XXL-JOBå®šæ—¶åˆ›å»ºæ¦œå•è¡¨&quot;">â€‹</a></h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥ä¸€ä¸ªXXL-JOBçš„å¿«é€Ÿå…¥é—¨ï¼Œé¡ºä¾¿æ”¹é€ ä¸€ä¸‹ä¹‹å‰ç”¨SpringTaskå®ç°çš„å®šæ—¶åˆ›å»ºæ¦œå•è¡¨çš„åŠŸèƒ½ã€‚</p>',262),Ts=i('<p><strong>éƒ¨ç½²è°ƒåº¦ä¸­å¿ƒ</strong></p><p>è°ƒåº¦ä¸­å¿ƒåœ¨æˆ‘ä»¬æä¾›çš„è™šæ‹Ÿæœºå¼€å‘ç¯å¢ƒä¸­å·²ç»éƒ¨ç½²å®Œæˆäº†ã€‚è®¿é—®ï¼š<a href="http://xxljob.tianji.com/" target="_blank" rel="noreferrer">http://xxljob.tianji.com</a>å³å¯æŸ¥çœ‹è°ƒåº¦ä¸­å¿ƒæ§åˆ¶å°é¡µé¢ã€‚é»˜è®¤çš„è´¦å·å¯†ç æ˜¯ï¼šadmin/123456</p><p><img src="'+z+`" alt="img" loading="lazy"></p><p>å¦‚æœè¦è‡ªå·±éƒ¨ç½²ï¼Œåˆ†ä¸ºä¸¤æ­¥ï¼š</p><ul><li>è¿è¡Œåˆå§‹åŒ–SQLï¼Œåˆ›å»ºæ•°æ®åº“è¡¨</li><li>åˆ©ç”¨Dockerå‘½ä»¤ï¼Œåˆ›å»ºå¹¶è¿è¡Œå®¹å™¨</li></ul><p>è¯¾å‰èµ„æ–™å·²ç»ç»™å‡ºäº†è„šæœ¬ï¼š</p><br><p>Dockerå¯åŠ¨å‘½ä»¤</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-e </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">PARAMS=&quot;--spring.datasource.url=jdbc:mysql://192.168.150.101:3306/xxl_job?Unicode=true&amp;characterEncoding=UTF-8 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--spring.datasource.username=root </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">--spring.datasource.password=123&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--restart=always </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-p </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">28080</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:8080 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-v </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">xxl-job-admin-applogs:/data/applogs </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--name </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">xxl-job-admin </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">-d </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">xuxueli/xxl-job-admin:2.3.0</span></span></code></pre></div><p><img src="`+U+'" alt="img" loading="lazy"></p><p>æœ€ç»ˆXXL-JOBçš„è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="'+V+'" alt="img" loading="lazy"></p><p>è¯´æ˜ï¼š</p><ul><li>xxl_job_lockï¼šä»»åŠ¡è°ƒåº¦é”è¡¨ï¼›</li><li>xxl_job_groupï¼šæ‰§è¡Œå™¨ä¿¡æ¯è¡¨ï¼Œç»´æŠ¤ä»»åŠ¡æ‰§è¡Œå™¨ä¿¡æ¯ï¼›</li><li>xxl_job_infoï¼šè°ƒåº¦æ‰©å±•ä¿¡æ¯è¡¨ï¼š ç”¨äºä¿å­˜XXL-JOBè°ƒåº¦ä»»åŠ¡çš„æ‰©å±•ä¿¡æ¯ï¼Œå¦‚ä»»åŠ¡åˆ†ç»„ã€ä»»åŠ¡åã€æœºå™¨åœ°å€ã€æ‰§è¡Œå™¨ã€æ‰§è¡Œå…¥å‚å’ŒæŠ¥è­¦é‚®ä»¶ç­‰ç­‰ï¼›</li><li>xxl_job_logï¼šè°ƒåº¦æ—¥å¿—è¡¨ï¼š ç”¨äºä¿å­˜XXL-JOBä»»åŠ¡è°ƒåº¦çš„å†å²ä¿¡æ¯ï¼Œå¦‚è°ƒåº¦ç»“æœã€æ‰§è¡Œç»“æœã€è°ƒåº¦å…¥å‚ã€è°ƒåº¦æœºå™¨å’Œæ‰§è¡Œå™¨ç­‰ç­‰ï¼›</li><li>xxl_job_log_reportï¼šè°ƒåº¦æ—¥å¿—æŠ¥è¡¨ï¼šç”¨æˆ·å­˜å‚¨XXL-JOBä»»åŠ¡è°ƒåº¦æ—¥å¿—çš„æŠ¥è¡¨ï¼Œè°ƒåº¦ä¸­å¿ƒæŠ¥è¡¨åŠŸèƒ½é¡µé¢ä¼šç”¨åˆ°ï¼›</li><li>xxl_job_logglueï¼šä»»åŠ¡GLUEæ—¥å¿—ï¼šç”¨äºä¿å­˜GLUEæ›´æ–°å†å²ï¼Œç”¨äºæ”¯æŒGLUEçš„ç‰ˆæœ¬å›æº¯åŠŸèƒ½ï¼›</li><li>xxl_job_registryï¼šæ‰§è¡Œå™¨æ³¨å†Œè¡¨ï¼Œç»´æŠ¤åœ¨çº¿çš„æ‰§è¡Œå™¨å’Œè°ƒåº¦ä¸­å¿ƒæœºå™¨åœ°å€ä¿¡æ¯ï¼›</li><li>xxl_job_userï¼šç³»ç»Ÿç”¨æˆ·è¡¨ï¼›</li></ul>',14),js=i(`<p><strong>å¾®æœåŠ¡é›†æˆæ‰§è¡Œå™¨</strong></p><p>é¦–å…ˆéœ€è¦åœ¨tj-learningæœåŠ¡å¼•å…¥ä¾èµ–ï¼š</p><div class="language-XML vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">XML</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!--xxl-job--&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;com.xuxueli&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;xxl-job-core&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>ç„¶åè¿˜éœ€è¦é…ç½®æ‰§è¡Œå™¨ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªé…ç½®æ‰§è¡Œå™¨çš„ç¤ºä¾‹ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> XxlJobSpringExecutor </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xxlJobExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    logger.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job config init.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    XxlJobSpringExecutor xxlJobSpringExecutor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> XxlJobSpringExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    xxlJobSpringExecutor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAdminAddresses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(adminAddresses);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    xxlJobSpringExecutor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAppname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(appname);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    xxlJobSpringExecutor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setIp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ip);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    xxlJobSpringExecutor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(port);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    xxlJobSpringExecutor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAccessToken</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(accessToken);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    xxlJobSpringExecutor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setLogPath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(logPath);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    xxlJobSpringExecutor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setLogRetentionDays</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(logRetentionDays);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> xxlJobSpringExecutor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li>adminAddressï¼šè°ƒåº¦ä¸­å¿ƒåœ°å€ï¼Œå¤©æœºå­¦å ‚ä¸­å°±æ˜¯å¡«è™šæ‹Ÿæœºåœ°å€</li><li>appnameï¼šå¾®æœåŠ¡åç§°</li><li>ipå’Œportï¼šå½“å‰æ‰§è¡Œå™¨çš„ipå’Œç«¯å£ï¼Œæ— éœ€é…ç½®ï¼Œè‡ªåŠ¨è·å–</li><li>accessTokenï¼šè®¿é—®ä»¤ç‰Œï¼Œåœ¨è°ƒåº¦ä¸­å¿ƒä¸­é…ç½®ä»¤ç‰Œï¼Œæ‰€æœ‰æ‰§è¡Œå™¨è®¿é—®æ—¶éƒ½å¿…é¡»æºå¸¦è¯¥ä»¤ç‰Œï¼Œå¦åˆ™æ— æ³•è®¿é—®ã€‚å’±ä»¬é¡¹ç›®çš„ä»¤ç‰Œå·²ç»é…å¥½ï¼Œå°±æ˜¯<code>tianji</code>ã€‚å¦‚æœè¦ä¿®æ”¹ï¼Œå¯ä»¥åˆ°è™šæ‹Ÿæœºçš„<code>/usr/local/src/xxl-job/application.properties</code>æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹<code>xxl.job.accessToken</code>å±æ€§ï¼Œç„¶åé‡å¯XXL-JOBå³å¯ã€‚</li><li>logPathï¼šä»»åŠ¡è¿è¡Œæ—¥å¿—çš„ä¿å­˜ç›®å½•</li><li>logRetentionDaysï¼šæ—¥å¿—æœ€é•¿ä¿ç•™æ—¶é•¿</li></ul><br><p>ä½†æ˜¯å‘¢ï¼Œå¤§å®¶å®Œå…¨ä¸éœ€è¦è‡ªå·±é…ç½®è°ƒåº¦å™¨äº†ï¼Œå› ä¸ºåœ¨å¤©æœºå­¦å ‚çš„tj-commonæ¨¡å—å·²ç»å®ç°äº†XXL-JOBçš„è‡ªåŠ¨è£…é…ï¼š</p><p><img src="`+H+'" alt="img" loading="lazy"></p><p>é…ç½®ä¸­çš„å…³é”®å±æ€§éƒ½å·²ç»åœ¨Nacosä¸­å…±äº«äº†ï¼š</p><p><img src="'+Q+`" alt="img" loading="lazy"></p><br><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬é¡¹ç›®çš„å¾®æœåŠ¡æ¨¡å—åªè¦å¼•å…¥<code>äº†tj-common</code>ï¼Œå¹¶ä¸”å¼•å…¥äº†XXL-JOBçš„ä¾èµ–ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚</p><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8090</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  tomcat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    uri-encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">UTF-8</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   #æœåŠ¡ç¼–ç </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spring</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  profiles</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    active</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">dev</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  application</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">learning-service</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  cloud</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    nacos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        file-extension</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        shared-configs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å…±äº«é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shared-spring.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # å…±äº«springé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            refresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shared-redis.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # å…±äº«redisé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            refresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shared-mybatis.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # å…±äº«mybatisé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            refresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shared-logs.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # å…±äº«æ—¥å¿—é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            refresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shared-feign.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # å…±äº«feigné…ç½®</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            refresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shared-mq.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # å…±äº«mqé…ç½®</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            refresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">data-id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">shared-xxljob.yaml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # å…±äº«mqé…ç½®</span></span>
<span class="line highlighted"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            refresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span></code></pre></div><br><p><strong>å®šä¹‰ä»»åŠ¡</strong></p><p>æ¥ä¸‹æ¥ï¼ŒæŠŠä¹‹å‰çš„SpringTaskä»»åŠ¡æ”¹æˆXXL-JOBçš„ä»»åŠ¡ã€‚</p><p>æˆ‘ä»¬ä¿®æ”¹tj-learningæ¨¡å—ä¸‹çš„<code>com.tianji.learning.handler.PointsBoardPersistentHandler</code>ï¼Œå°†åŸæœ¬çš„<code>@Scheduled</code>æ³¨è§£æ›¿æ¢ä¸º<code>@XXLJob</code>æ³¨è§£ï¼š</p><p><img src="`+Y+'" alt="img" loading="lazy"></p><p>å…¶ä¸­ï¼Œ<code>@XxlJob</code>æ³¨è§£ä¸­å®šä¹‰çš„å°±æ˜¯å½“å‰<strong>ä»»åŠ¡çš„åç§°</strong>ã€‚</p><br><p>æ³¨å†Œæ‰§è¡Œå™¨</p><p>æ¥ä¸‹æ¥ï¼Œé‡å¯<code>tj-learning</code>æœåŠ¡ï¼Œç™»å½•XXL-JOBæ§åˆ¶å°ï¼Œæ³¨å†Œæ‰§è¡Œå™¨ã€‚</p><p><img src="'+K+'" alt="img" loading="lazy"></p><p>åœ¨å¼¹å‡ºçš„çª—å£ä¸­å¡«å†™ä¿¡æ¯ï¼š</p><p><img src="'+G+'" alt="img" loading="lazy"></p><p>ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¼šå‘ç°<code>learning-service</code>å·²ç»æˆåŠŸæ³¨å†Œäº†ï¼š</p><p><img src="'+Z+'" alt="img" loading="lazy"></p><br><p><strong>é…ç½®ä»»åŠ¡è°ƒåº¦</strong></p><p>ç°åœ¨ï¼Œæ‰§è¡Œå™¨å·²ç»æˆåŠŸæ³¨å†Œï¼Œä»»åŠ¡ä¹Ÿå·²ç»æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥åšä»»åŠ¡è°ƒåº¦äº†ï¼Œä¹Ÿå°±æ˜¯ï¼š</p><ul><li>åˆ†é…ä»»åŠ¡ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ</li><li>å¦‚æœæœ‰å¤šä¸ªæ‰§è¡Œå™¨ï¼Œåº”è¯¥ç”±å“ªä¸ªæ‰§è¡Œå™¨æ‰§è¡Œï¼ˆè·¯ç”±ç­–ç•¥ï¼‰</li></ul><br><p>æˆ‘ä»¬è¿›å…¥ä»»åŠ¡ç®¡ç†èœå•ï¼Œé€‰ä¸­å­¦ä¹ ä¸­å¿ƒæ‰§è¡Œå™¨ï¼Œç„¶åæ–°å¢ä»»åŠ¡ï¼š</p><p><img src="'+W+'" alt="img" loading="lazy"></p><br><p>åœ¨å¼¹å‡ºè¡¨å•ä¸­ï¼Œå¡«å†™ä»»åŠ¡è°ƒåº¦ä¿¡æ¯ï¼š</p><p><img src="'+$+'" alt="img" loading="lazy"></p><p>å…¶ä¸­æ¯”è¾ƒå…³é”®çš„å‡ ä¸ªé…ç½®ï¼š</p><ul><li><p>è°ƒåº¦é…ç½®ï¼šä¹Ÿå°±æ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œä¸€èˆ¬é€‰æ‹©cronè¡¨è¾¾å¼</p></li><li><p>ä»»åŠ¡é…ç½®ï¼šé‡‡ç”¨BEANæ¨¡å¼ï¼ŒæŒ‡å®šJobHandlerï¼Œè¿™é‡ŒæŒ‡å®šçš„å°±æ˜¯åœ¨é¡¹ç›®ä¸­<code>@XxlJob</code>æ³¨è§£ä¸­çš„ä»»åŠ¡åç§°</p></li><li><p>è·¯ç”±ç­–ç•¥ï¼šå°±æ˜¯æŒ‡å¦‚æœæœ‰å¤šä¸ªä»»åŠ¡æ‰§è¡Œå™¨ï¼Œè¯¥ç”±è°æ‰§è¡Œï¼Ÿè¿™é‡Œæ”¯æŒçš„ç­–ç•¥éå¸¸å¤šï¼š</p><p><img src="'+ss+'" alt="img" loading="lazy"></p></li></ul><br><p>è·¯ç”±ç­–ç•¥è¯´æ˜ï¼š</p><ul><li>FIRSTï¼ˆç¬¬ä¸€ä¸ªï¼‰ï¼šå›ºå®šé€‰æ‹©ç¬¬ä¸€ä¸ªæ‰§è¡Œå™¨ï¼›</li><li>LASTï¼ˆæœ€åä¸€ä¸ªï¼‰ï¼šå›ºå®šé€‰æ‹©æœ€åä¸€ä¸ªæ‰§è¡Œå™¨ï¼›</li><li>ROUNDï¼ˆè½®è¯¢ï¼‰ï¼šåœ¨çº¿çš„æ‰§è¡Œå™¨æŒ‰ç…§è½®è¯¢ç­–ç•¥é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œ</li><li>RANDOMï¼ˆéšæœºï¼‰ï¼šéšæœºé€‰æ‹©åœ¨çº¿çš„æ‰§è¡Œå™¨ï¼›</li><li>CONSISTENT_HASHï¼ˆä¸€è‡´æ€§HASHï¼‰ï¼šæ¯ä¸ªä»»åŠ¡æŒ‰ç…§Hashç®—æ³•å›ºå®šé€‰æ‹©æŸä¸€å°æ‰§è¡Œå™¨ï¼Œä¸”æ‰€æœ‰ä»»åŠ¡å‡åŒ€æ•£åˆ—åœ¨ä¸åŒæ‰§è¡Œå™¨ä¸Šã€‚</li><li>LEAST_FREQUENTLY_USEDï¼ˆæœ€ä¸ç»å¸¸ä½¿ç”¨ï¼‰ï¼šä½¿ç”¨é¢‘ç‡æœ€ä½çš„æ‰§è¡Œå™¨ä¼˜å…ˆè¢«é€‰ä¸¾ï¼›</li><li>LEAST_RECENTLY_USEDï¼ˆæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ï¼‰ï¼šæœ€ä¹…æœªä½¿ç”¨çš„æ‰§è¡Œå™¨ä¼˜å…ˆè¢«é€‰ä¸¾ï¼›</li><li>FAILOVERï¼ˆæ•…éšœè½¬ç§»ï¼‰ï¼šæŒ‰ç…§é¡ºåºä¾æ¬¡è¿›è¡Œå¿ƒè·³æ£€æµ‹ï¼Œç¬¬ä¸€ä¸ªå¿ƒè·³æ£€æµ‹æˆåŠŸçš„æ‰§è¡Œå™¨é€‰å®šä¸ºç›®æ ‡æ‰§è¡Œå™¨å¹¶å‘èµ·è°ƒåº¦ï¼›</li><li>BUSYOVERï¼ˆå¿™ç¢Œè½¬ç§»ï¼‰ï¼šæŒ‰ç…§é¡ºåºä¾æ¬¡è¿›è¡Œç©ºé—²æ£€æµ‹ï¼Œç¬¬ä¸€ä¸ªç©ºé—²æ£€æµ‹æˆåŠŸçš„æ‰§è¡Œå™¨é€‰å®šä¸ºç›®æ ‡æ‰§è¡Œå™¨å¹¶å‘èµ·è°ƒåº¦ï¼›</li><li>SHARDING_BROADCAST(åˆ†ç‰‡å¹¿æ’­)ï¼šå¹¿æ’­è§¦å‘å¯¹åº”é›†ç¾¤ä¸­æ‰€æœ‰æ‰§è¡Œå™¨æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼ŒåŒæ—¶ç³»ç»Ÿè‡ªåŠ¨ä¼ é€’åˆ†ç‰‡å‚æ•°ï¼›å¯æ ¹æ®åˆ†ç‰‡å‚æ•°å¼€å‘åˆ†ç‰‡ä»»åŠ¡</li></ul>',44),Is=i('<p><strong>æ‰§è¡Œä¸€æ¬¡</strong></p><p>å½“ä»»åŠ¡é…ç½®å®Œæˆåï¼Œå°±ä¼šæŒ‰ç…§è®¾ç½®çš„è°ƒåº¦ç­–ç•¥ï¼Œå®šæœŸå»æ‰§è¡Œäº†ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬æƒ³è¦æµ‹è¯•çš„è¯ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ã€‚</p><p>åœ¨ä»»åŠ¡ç®¡ç†ç•Œé¢ï¼Œç‚¹å‡»è¦æ‰§è¡Œçš„ä»»åŠ¡åé¢çš„<code>æ“ä½œ</code>æŒ‰é’®ï¼Œç‚¹å‡»<code>æ‰§è¡Œä¸€æ¬¡</code>ï¼š</p><p><img src="'+is+'" alt="img" loading="lazy"></p><p>ç„¶ååœ¨å¼¹å‡ºçš„çª—å£ä¸­ï¼Œç›´æ¥ç‚¹ä¿å­˜å³å¯æ‰§è¡Œï¼š</p><p><img src="'+as+'" alt="img" loading="lazy"></p><p>æ³¨æ„ï¼Œå¦‚æœæ˜¯åˆ†ç‰‡å¹¿æ’­æ¨¡å¼ï¼Œ è¿™é‡Œè¿˜å¯ä»¥å¡«å†™ä¸€äº›ä»»åŠ¡å‚æ•°ã€‚</p><p>ç„¶ååœ¨è°ƒåº¦æ—¥å¿—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡ŒæˆåŠŸçš„æ—¥å¿—ä¿¡æ¯ï¼š</p><p><img src="'+ns+'" alt="img" loading="lazy"></p><br><h3 id="æ¦œå•æŒä¹…åŒ–" tabindex="-1">æ¦œå•æŒä¹…åŒ– <a class="header-anchor" href="#æ¦œå•æŒä¹…åŒ–" aria-label="Permalink to &quot;æ¦œå•æŒä¹…åŒ–&quot;">â€‹</a></h3><p>æ¦œå•æŒä¹…åŒ–çš„åŸºæœ¬æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>åˆ›å»ºè¡¨</li><li>æŒä¹…åŒ–Redisæ•°æ®åˆ°æ•°æ®åº“</li><li>æ¸…ç†Redisæ•°æ®</li></ul><br><p>ç°åœ¨ï¼Œåˆ›å»ºè¡¨çš„åŠ¨ä½œå·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥å°±è½®åˆ°Redisæ•°æ®çš„æŒä¹…åŒ–äº†ã€‚æŒä¹…åŒ–çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>è¯»å–Redisæ•°æ®</li><li>åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ <ul><li>ä¸å­˜åœ¨ï¼Œç›´æ¥ç»“æŸ</li><li>å­˜åœ¨ï¼Œåˆ™ç»§ç»­</li></ul></li><li>ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“</li></ul><br><p>ä¸è¿‡ï¼ŒRedisçš„æ•°æ®ç»“æ„å¦‚å›¾ï¼š</p><p><img src="'+ls+'" alt="img" loading="lazy"></p><p>å…¶KEYä¸­åŒ…å«ä¸€ä¸ªä¸Šèµ›å­£å¯¹åº”çš„æ—¥æœŸï¼Œå› æ­¤è¦è¯»å–Redisæ•°æ®ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆå¾—åˆ°ä¸Šèµ›å­£çš„æ—¥æœŸã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†æ°´å¹³åˆ†è¡¨çš„ç­–ç•¥ï¼Œæ¯ä¸€ä¸ªèµ›å­£éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹è¡¨ã€‚é‚£ä¹ˆåœ¨å†™æ•°æ®åˆ°æ•°æ®åº“æ—¶ï¼Œå¿…é¡»å…ˆçŸ¥é“è¡¨åç§°ã€‚</p><br><p>ç»¼ä¸Šï¼Œæœ€ç»ˆæŒä¹…åŒ–çš„ä¸šåŠ¡æµç¨‹å¦‚å›¾ï¼š</p><p><img src="'+ts+'" alt="image-20240214024255526" loading="lazy"></p><br><h4 id="åŠ¨æ€è¡¨å" tabindex="-1">åŠ¨æ€è¡¨å <a class="header-anchor" href="#åŠ¨æ€è¡¨å" aria-label="Permalink to &quot;åŠ¨æ€è¡¨å&quot;">â€‹</a></h4><p>æŒä¹…åŒ–çš„æµç¨‹ä¸­å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“æŒä¹…åŒ–é‡‡ç”¨çš„æ˜¯MybatisPlusæ¥å®ç°çš„ã€‚è€ŒMybatisPlusè¯»å–è¡¨åçš„æ–¹å¼æ˜¯é€šè¿‡å®ä½“ç±»ä¸Šçš„<code>@Table</code>æ³¨è§£ï¼Œè€Œæ³¨è§£å¾€å¾€æ˜¯å†™æ­»çš„ï¼š</p><p><img src="'+ps+'" alt="img" loading="lazy"></p><p>é‚£æˆ‘ä»¬è¯¥å¦‚ä½•è®©MybatisPlusåœ¨æ‰§è¡Œçš„æ—¶å€™æ”¹å˜æ•°æ®å†™å…¥çš„è¡¨åç§°å‘¢ï¼Ÿ</p><br><p><strong>åŠ¨æ€è¡¨åæ’ä»¶</strong></p><p>MybatisPlusä¸­æä¾›äº†ä¸€ä¸ªåŠ¨æ€è¡¨åçš„æ’ä»¶ï¼š</p><p><a href="https://baomidou.com/pages/2a45ff/#dynamictablenameinnerinterceptor" target="_blank" rel="noreferrer">https://baomidou.com/pages/2a45ff/#dynamictablenameinnerinterceptor</a></p><p>æ’ä»¶çš„éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><p><img src="'+hs+'" alt="img" loading="lazy"></p><p>å¯è§è¡¨åç§°åŠ¨æ€è·å–å°±æ˜¯ä¾èµ–äºtableNameHandlerMappingä¸­çš„å…·ä½“çš„TableNameHandlerï¼Œè¿™ä¸ªMapå¦‚å›¾ï¼š</p><p><img src="'+ks+`" alt="img" loading="lazy"></p><p>è¿™ä¸ªMapçš„keyæ˜¯æ—§çš„è¡¨åç§°ï¼Œvalueæ˜¯TableNameHandlerï¼Œå°±æ˜¯è¡¨çš„åç§°å¤„ç†å™¨ï¼Œç”¨äºæ ¹æ®æ—§åç§°è·å–æ–°åç§°ã€‚</p><br><p>TableNameHandlerçš„æºç å¦‚ä¸‹ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TableNameHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * ç”ŸæˆåŠ¨æ€è¡¨å</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> sql</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       å½“å‰æ‰§è¡Œ SQL</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> tableName</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> è¡¨å</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> String</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dynamicTableName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tableName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>OKï¼Œå› æ­¤æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±å¾ˆç®€å•äº†ï¼Œå®šä¹‰<code>DynamicTableNameInnterInterceptor</code>ï¼Œå‘å…¶ä¸­æ·»åŠ ä¸€ä¸ª<code>TableNameHandler</code>ï¼Œå°†<code>points_board</code>è¿™ä¸ªè¡¨åï¼Œæ›¿æ¢ä¸º<code>points_board_èµ›å­£id</code>çš„åç§°ã€‚</p><br><p>ä¸è¿‡ï¼Œæ–°çš„é—®é¢˜æ¥äº†ï¼Œè¿™ä¸ªæ’ä»¶ä¸­çš„TableNameHandlerè¯¥å¦‚ä½•è·å–èµ›å­£å¯¹åº”çš„è¡¨åç§°å‘¢ï¼Ÿ</p><p>è®¡ç®—è¡¨åçš„æ–¹å¼æ˜¯è·å–è·å–ä¸Šèµ›å­£æ—¶é—´ï¼ŒæŸ¥è¯¢æ•°æ®åº“ä¸­ä¸Šèµ›å­£ä¿¡æ¯ï¼Œå¾—åˆ°ä¸Šèµ›å­£idã€‚ç„¶åæ‹¼æ¥å¾—åˆ°è¡¨åã€‚</p><br><p>å½“æˆ‘ä»¬æ‰¹é‡çš„å†™æ•°æ®åˆ°æ•°æ®åº“æ—¶ï¼Œ<strong>å¦‚æœæ¯æ¬¡æ’å…¥éƒ½è®¡ç®—ä¸€æ¬¡è¡¨åï¼Œé‚£æ€§èƒ½ä¹Ÿå¤ªå·®äº†</strong>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯å¸Œæœ›ä¸€æ¬¡è®¡ç®—ï¼Œåœ¨TableNameHandlerä¸­å¯ä»¥éšæ—¶è·å–ã€‚</p><p>é‚£ä¹ˆè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p><br><p><strong>ä¼ é€’è¡¨å</strong></p><p>æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹æ•´ä½“ä¸šåŠ¡æµç¨‹ï¼š</p><p><img src="`+es+'" alt="image-20240214024407842" loading="lazy"></p><p>æµç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå…ˆè®¡ç®—è¡¨åï¼Œç„¶åå»æ‰§è¡ŒæŒä¹…åŒ–ï¼Œè€ŒåŠ¨æ€è¡¨åæ’ä»¶å°±ä¼šç”Ÿæ•ˆï¼Œå»æ›¿æ¢è¡¨åã€‚</p><p>å› æ­¤ï¼Œä¸€æ—¦æˆ‘ä»¬è®¡ç®—å®Œè¡¨åï¼Œä»¥æŸç§æ–¹å¼ä¼ é€’ç»™æ’ä»¶ä¸­çš„TableNameHandlerï¼Œé‚£ä¹ˆå°±æ— éœ€é‡å¤è®¡ç®—è¡¨åäº†ã€‚</p><p>ä¸è¿‡ï¼Œé—®é¢˜æ¥äº†ï¼šè¦çŸ¥é“åŠ¨æ€è¡¨åç§°æ’ä»¶ï¼Œä»¥åŠTableNameHandlerï¼Œéƒ½æ˜¯ç”±MybatisPluså†…éƒ¨è°ƒç”¨çš„ã€‚æˆ‘ä»¬æ— æ³•ä¼ é€’å‚æ•°ã€‚</p><p>é‚£ä¹ˆè¯¥å¦‚ä½•ä¼ é€’è¡¨åç§°å‘¢ï¼Ÿ</p><br><p>è™½ç„¶æ— æ³•ä¼ å‚ï¼Œä½†æ˜¯ä»è®¡ç®—è¡¨åï¼Œåˆ°åŠ¨æ€è¡¨åæ’ä»¶æ‰§è¡Œï¼Œè°ƒç”¨TableNameHandlerï¼Œéƒ½æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹å†…å®Œæˆçš„ã€‚è¦åœ¨ä¸€ä¸ªçº¿ç¨‹å†…å®ç°æ•°æ®å…±äº«ï¼Œè¯¥ç”¨ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>å¤§å®¶åº”è¯¥å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå°±æ˜¯ThreadLocal.</p><p>æˆ‘ä»¬å¯ä»¥åœ¨å®šæ—¶ä»»åŠ¡ä¸­è®¡ç®—å®ŒåŠ¨æ€è¡¨ååï¼Œå°†è¡¨åå­˜å…¥ThreadLocalï¼Œç„¶ååœ¨æ’ä»¶ä¸­ä»ThreadLocalä¸­è¯»å–å³å¯ï¼š</p><p><img src="'+rs+'" alt="image-20240214024424868" loading="lazy"></p><br><p>æˆ‘ä»¬åœ¨<code>tj-learning</code>çš„<code>com.tianji.learning.utils</code>åŒ…ä¸‹å®šä¹‰ä¸€ä¸ªä¼ é€’è¡¨åç§°çš„å·¥å…·ï¼š</p><p><img src="'+Es+`" alt="img" loading="lazy"></p><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.utils;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TableInfoContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadLocal&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; TL </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadLocal&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">info</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TL.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(info);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TL.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> remove</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TL.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remove</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>ç„¶ååœ¨<code>tj-learning</code>æ¨¡å—ä¸‹å®šä¹‰ä¸€ä¸ªé…ç½®ç±»ï¼Œç”¨äºå®šä¹‰<code>DynamicTableNameInnterInterceptor</code>æ’ä»¶ï¼š</p><p><img src="`+ds+`" alt="img" loading="lazy"></p><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.config;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.extension.plugins.handler.TableNameHandler;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.extension.plugins.inner.DynamicTableNameInnerInterceptor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.utils.TableInfoContext;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.context.annotation.Bean;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.context.annotation.Configuration;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.HashMap;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.Map;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MybatisConfiguration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DynamicTableNameInnerInterceptor </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dynamicTableNameInnerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å‡†å¤‡ä¸€ä¸ªMapï¼Œç”¨äºå­˜å‚¨TableNameHandler</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TableNameHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HashMap&lt;&gt;(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å­˜å…¥ä¸€ä¸ªTableNameHandlerï¼Œç”¨æ¥æ›¿æ¢points_boardè¡¨åç§°</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ›¿æ¢æ–¹å¼ï¼Œå°±æ˜¯ä»TableInfoContextä¸­è¯»å–ä¿å­˜å¥½çš„åŠ¨æ€è¡¨å</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;points_board&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (sql, tableName) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TableInfoContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DynamicTableNameInnerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(map);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>æ’ä»¶è™½ç„¶å®šä¹‰å¥½äº†ï¼Œä½†æ˜¯è¯¥å¦‚ä½•ç»§æ‰¿åˆ°MybatisPlusä¸­å‘¢ï¼Ÿ</p><p>åœ¨å¤©æœºå­¦å ‚é¡¹ç›®ä¸­çš„tj-commonæ¨¡å—ä¸­ï¼Œå·²ç»å®ç°äº†MybatisPlusçš„è‡ªåŠ¨è£…é…ï¼Œå¹¶ä¸”å®šä¹‰äº†å¾ˆå¤šçš„MPæ’ä»¶ã€‚å¦‚æœæˆ‘ä»¬åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­é‡æ–°å®šä¹‰MPé…ç½®ï¼Œå°±ä¼šå¯¼è‡´tj-commonä¸­çš„æ’ä»¶å¤±æ•ˆã€‚</p><br><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥ä¿®æ”¹<code>tj-common</code>ä¸­çš„MPé…ç½®ï¼Œå°†<code>DynamicTableNameInnerInterceptor</code>é…ç½®è¿›å»ã€‚æ‰¾åˆ°<code>tj-common</code>æ¨¡å—ä¸‹çš„<code>MybatisConfig</code>é…ç½®ï¼š</p><p><img src="`+gs+'" alt="img" loading="lazy"></p><p>ä¿®æ”¹å…¶ä¸­çš„æ‹¦æˆªå™¨é…ç½®ï¼š</p><p><img src="'+ys+`" alt="img" loading="lazy"></p><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>ç”±äº<code>DynamicTableNameInnerInterceptor</code>å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªå¾®æœåŠ¡éƒ½ç”¨äº†ï¼Œæ‰€ä»¥è¿™é‡ŒåŠ å…¥äº†@Autowired(required= false)ï¼Œé¿å…æœªå®šä¹‰è¯¥æ‹¦æˆªå™¨çš„å¾®æœåŠ¡æŠ¥é”™ã€‚</li><li>MybatisPlusçš„æ’ä»¶å®šä¹‰é¡ºåºéå¸¸é‡è¦ï¼Œå¿…é¡»æŒ‰ç…§ä¸€å®šçš„é¡ºåºæ¥å®šä¹‰ã€‚å‚è€ƒï¼š<a href="https://baomidou.com/pages/2976a3/#innerinterceptor" target="_blank" rel="noreferrer">https://baomidou.com/pages/2976a3/#innerinterceptor</a></li></ul><br><h4 id="å®šæ—¶æŒä¹…åŒ–ä»»åŠ¡" tabindex="-1">å®šæ—¶æŒä¹…åŒ–ä»»åŠ¡ <a class="header-anchor" href="#å®šæ—¶æŒä¹…åŒ–ä»»åŠ¡" aria-label="Permalink to &quot;å®šæ—¶æŒä¹…åŒ–ä»»åŠ¡&quot;">â€‹</a></h4><p>åŠ¨æ€è¡¨åå·²ç»å‡†å¤‡å°±ç»ªï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥å»å®šä¹‰å®šæ—¶ä»»åŠ¡ï¼Œå®ç°æ¦œå•æŒä¹…åŒ–äº†ã€‚</p><p>åœ¨<code>tj-learning</code>æ¨¡å—çš„<code>com.tianji.learning.handler.PointsBoardPersistentHandler</code>ä¸­æ·»åŠ ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">XxlJob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;savePointsBoard2DB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> savePointsBoard2DB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1.è·å–ä¸Šæœˆæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LocalDateTime time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minusMonths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.è®¡ç®—åŠ¨æ€è¡¨å</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.1.æŸ¥è¯¢èµ›å­£ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Integer season </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> seasonService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">querySeasonByTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(time);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.2.å°†è¡¨åå­˜å…¥ThreadLocal</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TableInfoContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(POINTS_BOARD_TABLE_PREFIX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> season);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.æŸ¥è¯¢æ¦œå•æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.1.æ‹¼æ¥KEY</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RedisConstants.POINTS_BOARD_KEY_PREFIX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DateUtils.POINTS_BOARD_SUFFIX_FORMATTER);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.2.æŸ¥è¯¢æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pageNo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pageSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; boardList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pointsBoardService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryCurrentBoardList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key, pageNo, pageSize);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(boardList)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.æŒä¹…åŒ–åˆ°æ•°æ®åº“</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.1.æŠŠæ’åä¿¡æ¯å†™å…¥id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        boardList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            b.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(b.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">longValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            b.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.2.æŒä¹…åŒ–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pointsBoardService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">saveBatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(boardList);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 5.ç¿»é¡µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pageNo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ä»»åŠ¡ç»“æŸï¼Œç§»é™¤åŠ¨æ€è¡¨å</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TableInfoContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remove</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>éœ€è¦æ³¨æ„çš„ï¼Œç”±äºæ¦œå•æ•°æ®éå¸¸å¤šï¼Œä¸å¯èƒ½ä¸€æ¬¡æ€§æŸ¥å®Œï¼Œå› æ­¤è¿™é‡Œé‡‡ç”¨çš„æ˜¯åˆ†é¡µæŸ¥è¯¢çš„æ–¹å¼ã€‚è€Œåˆ†é¡µæŸ¥è¯¢è°ƒç”¨çš„æ˜¯<code>com.tianji.learning.service.IPointsBoardService</code>ä¸­çš„<code>queryCurrentBoardList</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åœ¨serviceå®ç°ç±»ä¸­æœ¬æ¥å°±æœ‰ï¼Œåªä¸è¿‡æ²¡æœ‰æŠ½å–åˆ°serviceæ¥å£ã€‚</p><p>å› æ­¤è¿™é‡Œè¦åœ¨<code>com.tianji.learning.service.IPointsBoardService</code>ä¸­æŠ½å–è¿™ä¸ªæ¥å£ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.extension.service.IService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.po.PointsBoard;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.query.PointsBoardQuery;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.vo.PointsBoardVO;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.List;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * å­¦éœ¸å¤©æ¢¯æ¦œ æœåŠ¡ç±»</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;/p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IPointsBoardService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PointsBoardVO </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryPointsBoardBySeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PointsBoardQuery </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createPointsBoardTableBySeason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Integer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">season</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryCurrentBoardList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Integer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pageNo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Integer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pageSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>æŠŠ<code>com.tianji.learning.service.impl.PointsBoardServiceImpl</code>ä¸­çš„æ–¹æ³•æ”¹ä¸ºpublicï¼š</p><p><img src="`+os+'" alt="img" loading="lazy"></p><br><h4 id="xxl-jobä»»åŠ¡åˆ†ç‰‡" tabindex="-1">XXL-JOBä»»åŠ¡åˆ†ç‰‡ <a class="header-anchor" href="#xxl-jobä»»åŠ¡åˆ†ç‰‡" aria-label="Permalink to &quot;XXL-JOBä»»åŠ¡åˆ†ç‰‡&quot;">â€‹</a></h4><p>åˆšæ‰å®šä¹‰çš„å®šæ—¶æŒä¹…åŒ–ä»»åŠ¡ï¼Œé€šè¿‡whileæ­»å¾ªç¯ï¼Œä¸åœçš„æŸ¥è¯¢æ•°æ®ï¼Œç›´åˆ°æŠŠæ‰€æœ‰æ•°æ®éƒ½æŒä¹…åŒ–ä¸ºæ­¢ã€‚è¿™æ ·å¦‚æœæ•°æ®é‡è¾¾åˆ°æ•°ç™¾ä¸‡ï¼Œäº¤ç»™ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå™¨æ¥å¤„ç†ä¼šè€—è´¹éå¸¸å¤šæ—¶é—´ã€‚</p><p>å› æ­¤ï¼Œå°†æ¥è‚¯å®šä¼šå°†å­¦ä¹ æœåŠ¡å¤šå®ä¾‹éƒ¨ç½²ï¼Œè¿™æ ·å°±ä¼šæœ‰å¤šä¸ªæ‰§è¡Œå™¨å¹¶è¡Œæ‰§è¡Œã€‚**ä½†æ˜¯ï¼Œ**å¦‚æœäº¤ç»™å¤šä¸ªä»»åŠ¡æ‰§è¡Œå™¨ï¼Œå¤§å®¶æ‰§è¡Œç›¸åŒä»£ç ï¼Œéƒ½ä»ç¬¬1é¡µé€é¡µå¤„ç†æ•°æ®ï¼Œåˆä¼šå‡ºç°é‡å¤å¤„ç†çš„æƒ…å†µã€‚</p><p>æ€ä¹ˆåŠï¼Ÿ</p><p>è¿™å°±è¦ç”¨åˆ°ä»»åŠ¡åˆ†ç‰‡çš„æ–¹æ¡ˆäº†ã€‚</p><br><p>æ€æ ·æ‰èƒ½ç¡®ä¿ä»»åŠ¡ä¸é‡å¤å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å‚è€ƒæ‰‘å…‹ç‰Œå‘ç‰Œçš„åŸç†ï¼š</p><ul><li>é€ä¸€ç»™æ¯ä¸ªäººå‘ç‰Œ</li><li>å‘å®Œä¸€åœˆåï¼Œå†å›å¤´ç»™ç¬¬ä¸€ä¸ªäººå‘</li><li>é‡å¤ä¸Šè¿°åŠ¨ä½œï¼Œç›´åˆ°ç‰Œå‘å®Œä¸ºæ­¢</li></ul><p><img src="'+cs+'" alt="img" loading="lazy"></p><p>ä¸æ­¤ç±»ä¼¼ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯åŠ¨äº†3ä¸ªæœåŠ¡å®ä¾‹ï¼Œå°±æœ‰3ä¸ªæ‰§è¡Œå™¨ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ‰§è¡Œå™¨å½“åšæ‰“ç‰Œçš„äººï¼Œç„¶åæŠŠæ¯ä¸€é¡µæ•°æ®ä½œä¸ºä¸€å¼ ç‰Œï¼š</p><ul><li>æŠŠæ¯é¡µæ•°æ®é€ä¸€åˆ†å‘ç»™æ¯ä¸ªæ‰§è¡Œå™¨ï¼Œ</li><li>å‘å®Œä¸€åœˆåï¼Œå†å›åˆ°ç¬¬ä¸€ä¸ªæ‰§è¡Œå™¨ã€‚</li><li>ç›´åˆ°æ‰€æœ‰é¡µæ•°æ®éƒ½å‘æ”¾å®Œæ¯•ã€‚</li></ul><p>é‚£ä¹ˆæ•°æ®åˆ†å‘çš„è¿‡ç¨‹å¦‚å›¾ï¼š</p><p><img src="'+Fs+'" alt="img" loading="lazy"></p><p>æœ€ç»ˆï¼Œæ¯ä¸ªæ‰§è¡Œå™¨å¤„ç†çš„æ•°æ®é¡µæƒ…å†µï¼š</p><ul><li>æ‰§è¡Œå™¨1ï¼šå¤„ç†ç¬¬1ã€4ã€7ã€10ã€13ã€...é¡µæ•°æ®</li><li>æ‰§è¡Œå™¨2ï¼šå¤„ç†ç¬¬2ã€5ã€8ã€11ã€14ã€...é¡µæ•°æ®</li><li>æ‰§è¡Œå™¨3ï¼šå¤„ç†ç¬¬3ã€6ã€9ã€12ã€15ã€...é¡µæ•°æ®</li></ul><br><p>è¦æƒ³çŸ¥é“æ¯ä¸€ä¸ªæ‰§è¡Œå™¨æ‰§è¡Œå“ªäº›é¡µæ•°æ®ï¼Œåªè¦å¼„æ¸…æ¥šä¸¤ä¸ªå…³é”®å‚æ•°å³å¯ï¼š</p><ul><li>èµ·å§‹é¡µç ï¼špageNo</li><li>ä¸‹ä¸€é¡µçš„è·¨åº¦ï¼šstep</li></ul><br><p>è€Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯æœ‰è§„å¾‹çš„ï¼š</p><ul><li>èµ·å§‹é¡µç ï¼šæ‰§è¡Œå™¨ç¼–å·æ˜¯å¤šå°‘ï¼Œèµ·å§‹é¡µç å°±æ˜¯å¤šå°‘</li><li>é¡µè·¨åº¦ï¼šæ‰§è¡Œå™¨æœ‰å‡ ä¸ªï¼Œè·¨åº¦å°±æ˜¯å¤šå°‘ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ è¦è·³è¿‡åˆ«äººè¯»å–è¿‡çš„é¡µç </li></ul><br><p>å› æ­¤ï¼Œç°åœ¨çš„å…³é”®å°±æ˜¯è·å–ä¸¤ä¸ªæ•°æ®ï¼š</p><ul><li>æ‰§è¡Œå™¨ç¼–å·</li><li>æ‰§è¡Œå™¨æ•°é‡</li></ul><p>è¿™ä¸¤ä¸ªå‚æ•°XXL-JOBä½œä¸ºä»»åŠ¡è°ƒåº¦ä¸­å¿ƒï¼Œè‚¯å®šæ˜¯çŸ¥é“çš„ï¼Œè€Œä¸”ä¹Ÿæä¾›äº†APIå¸®åŠ©æˆ‘ä»¬è·å–ï¼š</p><p><img src="'+As+`" alt="img" loading="lazy"></p><br><p>è¿™é‡Œçš„åˆ†ç‰‡åºå·å…¶å®å°±æ˜¯æ‰§è¡Œå™¨åºå·ï¼Œä¸è¿‡æ˜¯ä»0å¼€å§‹ï¼Œé‚£æˆ‘ä»¬åªè¦å¯¹åºå·+1ï¼Œå°±å¯ä»¥ä½œä¸ºèµ·å§‹é¡µç äº†ã€‚</p><br><p>å› æ­¤ï¼Œæœ€ç»ˆæˆ‘ä»¬æ”¹é€ ä»£ç ï¼Œå®ç°æ•°æ®åˆ†ç‰‡å¦‚å›¾ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">XxlJob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;savePointsBoard2DB&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> savePointsBoard2DB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1.è·å–ä¸Šæœˆæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LocalDateTime time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minusMonths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.è®¡ç®—åŠ¨æ€è¡¨å</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.1.æŸ¥è¯¢èµ›å­£ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Integer season </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> seasonService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">querySeasonByTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(time);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.2.å­˜å…¥ThreadLocal</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TableInfoContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(POINTS_BOARD_TABLE_PREFIX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> season);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.æŸ¥è¯¢æ¦œå•æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.1.æ‹¼æ¥KEY</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RedisConstants.POINTS_BOARD_KEY_PREFIX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DateUtils.POINTS_BOARD_SUFFIX_FORMATTER);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.2.æŸ¥è¯¢æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> XxlJobHelper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getShardIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> total </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> XxlJobHelper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getShardTotal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pageNo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// èµ·å§‹é¡µï¼Œå°±æ˜¯åˆ†ç‰‡åºå·+1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pageSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PointsBoard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; boardList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pointsBoardService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryCurrentBoardList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key, pageNo, pageSize);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(boardList)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.æŒä¹…åŒ–åˆ°æ•°æ®åº“</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.1.æŠŠæ’åä¿¡æ¯å†™å…¥id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        boardList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            b.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(b.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">longValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            b.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRank</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.2.æŒä¹…åŒ–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pointsBoardService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">saveBatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(boardList);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 5.ç¿»é¡µï¼Œè·³è¿‡Nä¸ªé¡µï¼ŒNå°±æ˜¯åˆ†ç‰‡æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pageNo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">total;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    TableInfoContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remove</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h4 id="æ¸…ç†redisç¼“å­˜ä»»åŠ¡" tabindex="-1">æ¸…ç†Redisç¼“å­˜ä»»åŠ¡ <a class="header-anchor" href="#æ¸…ç†redisç¼“å­˜ä»»åŠ¡" aria-label="Permalink to &quot;æ¸…ç†Redisç¼“å­˜ä»»åŠ¡&quot;">â€‹</a></h4><p>å½“ä»»åŠ¡æŒä¹…åŒ–ä»¥åï¼Œæˆ‘ä»¬è¿˜è¦æ¸…ç†Redisä¸­çš„ä¸Šèµ›å­£çš„æ¦œå•æ•°æ®ï¼Œé¿å…è¿‡å¤šçš„å†…å­˜å ç”¨ã€‚</p><p>åœ¨<code>tj-learning</code>æ¨¡å—çš„<code>com.tianji.learning.handler.PointsBoardPersistentHandler</code>ä¸­æ·»åŠ ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼š</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.handler;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.utils.CollUtils;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.utils.DateUtils;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.constants.RedisConstants;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.po.PointsBoard;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service.IPointsBoardSeasonService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service.IPointsBoardService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.utils.TableInfoContext;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.xxl.job.core.context.XxlJobHelper;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.xxl.job.core.handler.annotation.XxlJob;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lombok.RequiredArgsConstructor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.data.redis.core.StringRedisTemplate;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.stereotype.Component;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.time.LocalDateTime;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.List;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.constants.LearningConstants.POINTS_BOARD_TABLE_PREFIX;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequiredArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PointsBoardPersistentHandler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IPointsBoardSeasonService seasonService;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IPointsBoardService pointsBoardService;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StringRedisTemplate redisTemplate;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... ç•¥</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">XxlJob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;clearPointsBoardFromRedis&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> clearPointsBoardFromRedis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1.è·å–ä¸Šæœˆæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LocalDateTime time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minusMonths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.è®¡ç®—key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RedisConstants.POINTS_BOARD_KEY_PREFIX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DateUtils.POINTS_BOARD_SUFFIX_FORMATTER);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3.åˆ é™¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        redisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unlink</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h4 id="ä»»åŠ¡é“¾" tabindex="-1">ä»»åŠ¡é“¾ <a class="header-anchor" href="#ä»»åŠ¡é“¾" aria-label="Permalink to &quot;ä»»åŠ¡é“¾&quot;">â€‹</a></h4><p>ç°åœ¨ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»å®šä¹‰å®Œæ¯•ã€‚æ¥ä¸‹æ¥å°±ç»™é…ç½®ä»»åŠ¡è°ƒåº¦äº†ã€‚</p><p>æˆ‘ä»¬æœ€ç»ˆæœŸæœ›çš„ä»»åŠ¡æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="`+Ds+'" alt="image-20240214024455682" loading="lazy"></p><p>ä½†é—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•æ§åˆ¶ä¸‰ä¸ªä»»åŠ¡çš„æ‰§è¡Œé¡ºåºå‘¢ï¼Ÿ</p><p>è¿™å°±è¦å€ŸåŠ©äºXXL-JOBä¸­çš„å­ä»»åŠ¡åŠŸèƒ½äº†ã€‚</p><br><p>é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠæŒä¹…åŒ–æ¦œå•æ•°æ®ã€æ¸…ç†Redisä¸­å†å²æ¦œå•çš„ä»»åŠ¡ä¹Ÿåœ¨XXL-JOBä¸­å®šä¹‰å‡ºæ¥ã€‚</p><p>é¦–å…ˆæ˜¯æŒä¹…åŒ–æ¦œå•ï¼š</p><p><img src="'+ms+'" alt="img" loading="lazy"></p><br><p>ç„¶åæ˜¯æ¸…ç†Redisçš„ä»»åŠ¡ï¼š</p><p><img src="'+us+'" alt="img" loading="lazy"></p><br><p>æ¥ä¸‹æ¥ï¼Œå›åˆ°ä»»åŠ¡ç®¡ç†é¡µé¢ï¼Œä¼šçœ‹åˆ°3ä¸ªä»»åŠ¡éƒ½æ·»åŠ æˆåŠŸï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡éƒ½æœ‰è‡ªå·±çš„IDï¼š</p><p><img src="'+Bs+'" alt="img" loading="lazy"></p><p>è¦æƒ³è®©ä»»åŠ¡Aã€Bä¾æ¬¡æ‰§è¡Œï¼Œå…¶å®å°±æ˜¯é…ç½®ä»»åŠ¡Bä½œä¸ºä»»åŠ¡Açš„å­ä»»åŠ¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸‹é¢æ–¹å¼é…ç½®ï¼š</p><ul><li>åˆ›å»ºå†å²æ¦œå•è¡¨ï¼ˆ10ï¼‰çš„å­ä»»åŠ¡æ˜¯æŒä¹…åŒ–æ¦œå•æ•°æ®ä»»åŠ¡ï¼ˆ12ï¼‰</li><li>æŒä¹…åŒ–æ¦œå•æ•°æ®ä»»åŠ¡ï¼ˆ12ï¼‰çš„å­ä»»åŠ¡æ˜¯æ¸…ç†Redisä¸­çš„å†å²æ¦œå•ï¼ˆ13ï¼‰</li></ul><br><p>ä¹Ÿå°±æ˜¯è¯´ï¼š10çš„å­ä»»åŠ¡æ˜¯12, 12çš„å­ä»»åŠ¡æ˜¯13</p><br><p>é¦–å…ˆï¼Œç‚¹å‡»åˆ›å»ºå†å²ç»‘å®šè¡¨åé¢çš„æ“ä½œï¼Œç„¶åç¼–è¾‘ï¼š</p><p><img src="'+bs+'" alt="img" loading="lazy"></p><br><p>ç„¶ååœ¨å­ä»»åŠ¡ä¸­ï¼Œå¡«å†™æŒä¹…åŒ–æ¦œå•æ•°æ®ä»»åŠ¡çš„idï¼Œæœ¬ä¾‹ä¸­æ˜¯12ï¼š</p><p><img src="'+Cs+'" alt="img" loading="lazy"></p><p>ä¿å­˜ã€‚</p><br><p>ç„¶åç‚¹å‡»æŒä¹…åŒ–æ¦œå•æ•°æ®ä»»åŠ¡åé¢çš„æ“ä½œï¼Œç¼–è¾‘ï¼š</p><p><img src="'+vs+'" alt="img" loading="lazy"></p><br><p>ç„¶ååœ¨å­ä»»åŠ¡ä¸€æ ï¼Œå¡«å†™æ¸…ç†Redisä¸­çš„å†å²æ¦œå•çš„ä»»åŠ¡idï¼Œæœ¬ä¾‹ä¸­æ˜¯13ï¼š</p><p><img src="'+_s+'" alt="img" loading="lazy"></p><p>å¥½äº†ï¼Œä»»åŠ¡é“¾å½¢æˆäº†ã€‚</p><br><p>æ¥ä¸‹æ¥ï¼Œæ‰§è¡Œä¸€æ¬¡åˆ›å»ºæ¦œå•è¡¨ä»»åŠ¡ï¼Œå°±ä¼šå‘ç°åç»­çš„ä¸¤ä¸ªä»»åŠ¡ä¹Ÿä¾æ¬¡æ‰§è¡Œäº†ã€‚</p><h2 id="ç»ƒä¹ " tabindex="-1">ç»ƒä¹  <a class="header-anchor" href="#ç»ƒä¹ " aria-label="Permalink to &quot;ç»ƒä¹ &quot;">â€‹</a></h2><h3 id="æŸ¥è¯¢ç§¯åˆ†æ¦œ-1" tabindex="-1">æŸ¥è¯¢ç§¯åˆ†æ¦œ <a class="header-anchor" href="#æŸ¥è¯¢ç§¯åˆ†æ¦œ-1" aria-label="Permalink to &quot;æŸ¥è¯¢ç§¯åˆ†æ¦œ&quot;">â€‹</a></h3><p>å®Œå–„æŸ¥è¯¢å­¦éœ¸ç§¯åˆ†æ¦œåŠŸèƒ½ï¼Œè¯¾å ‚ä¸­åªå®ç°äº†å¯¹å½“å‰èµ›å­£æ¦œå•çš„æŸ¥è¯¢ï¼Œå¤§å®¶éœ€è¦å®Œå–„å¯¹å†å²æ¦œå•æ•°æ®çš„æŸ¥è¯¢ã€‚</p><p>æ³¨æ„ï¼šå†å²æ¦œå•æ•°æ®åœ¨ä¸åŒçš„è¡¨ä¸­ã€‚</p><br><h3 id="æ¸…ç†ç§¯åˆ†æ˜ç»†" tabindex="-1">æ¸…ç†ç§¯åˆ†æ˜ç»† <a class="header-anchor" href="#æ¸…ç†ç§¯åˆ†æ˜ç»†" aria-label="Permalink to &quot;æ¸…ç†ç§¯åˆ†æ˜ç»†&quot;">â€‹</a></h3><p>ç§¯åˆ†æ˜ç»†æ•°æ®æ¯”ç§¯åˆ†æ¦œå•æ•°æ®é‡æ›´å¤§ï¼Œå…¨éƒ¨æ”¾åˆ°ä¸€å¼ è¡¨ä¸­ä¸å¤ªåˆé€‚ã€‚å»ºè®®æŒ‰ç…§èµ›å­£çš„æ—¥æœŸå¯¹ç§¯åˆ†æ˜ç»†æ•°æ®åšæ°´å¹³æ‹†åˆ†ï¼š</p><ul><li>å½“å‰èµ›å­£çš„æ•°æ®ä¾ç„¶ä¿å­˜åœ¨points_recordè¡¨ä¸å˜</li><li>æ¯ä¸ªå†å²èµ›å­£çš„ç§¯åˆ†æ˜ç»†éœ€è¦ä»points_recordè¡¨è¿ç§»åˆ°ä¸€å¼ ç‹¬ç«‹çš„è¡¨ä¸­</li><li>è¡¨åç§°è§„åˆ™points_record_xxï¼Œè¿™é‡Œçš„xxå°±æ˜¯èµ›å­£id</li></ul><p>é€šè¿‡ä¸€ä¸ªå®šæ—¶ä»»åŠ¡åœ¨æ¯æœˆåˆå®Œæˆæ•°æ®è¿ç§»ã€‚</p><br><h2 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to &quot;æ€»ç»“&quot;">â€‹</a></h2><div class="warning custom-block"><p class="custom-block-title">ğŸ’¡æ€è€ƒï¼šä½ åœ¨é¡¹ç›®ä¸­è´Ÿè´£ç§¯åˆ†æ’è¡Œæ¦œåŠŸèƒ½ï¼Œè¯´è¯´çœ‹ä½ ä»¬æ’è¡Œæ¦œæ€ä¹ˆè®¾è®¡å®ç°çš„ï¼Ÿ</p><p>ç­”ï¼šæˆ‘ä»¬çš„æ’è¡Œæ¦œåŠŸèƒ½åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ªæ˜¯å½“å‰èµ›å­£æ’è¡Œæ¦œï¼Œä¸€ä¸ªæ˜¯å†å²æ’è¡Œæ¦œã€‚</p><p>å› ä¸ºæˆ‘ä»¬çš„äº§å“è®¾è®¡æ˜¯æ¯ä¸ªæœˆä¸ºä¸€ä¸ªèµ›å­£ï¼Œæœˆåˆæ¸…é›¶ç§¯åˆ†è®°å½•ï¼Œè¿™æ ·å­¦å‘˜å°±æœ‰æŒç»­çš„åŠ¨åŠ›å»å­¦ä¹ ã€‚è¿™å°±æœ‰äº†èµ›å­£çš„æ¦‚å¿µï¼Œå› æ­¤ä¹Ÿå°±æœ‰äº†å½“å‰èµ›å­£æ¦œå•å’Œå†å²æ¦œå•çš„åŒºåˆ†ï¼Œå…¶å®ç°æ€è·¯ä¹Ÿä¸ä¸€æ ·ã€‚</p><p>é¦–å…ˆè¯´å½“å‰èµ›å­£æ¦œå•ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†Redisçš„SortedSetæ¥å®ç°ã€‚memberæ˜¯ç”¨æˆ·idï¼Œscoreå°±æ˜¯å½“æœˆç§¯åˆ†æ€»å€¼ã€‚æ¯å½“ç”¨æˆ·äº§ç”Ÿç§¯åˆ†è¡Œä¸ºçš„æ—¶å€™ï¼Œè·å–ç§¯åˆ†æ—¶ï¼Œå°±ä¼šæ›´æ–°scoreå€¼ã€‚è¿™æ ·Rediså°±ä¼šè‡ªåŠ¨å½¢æˆæ¦œå•äº†ã€‚éå¸¸æ–¹ä¾¿ä¸”é«˜æ•ˆã€‚</p><p>ç„¶åå†è¯´å†å²æ¦œå•ï¼Œå†å²æ¦œå•è‚¯å®šæ˜¯ä¿å­˜åˆ°æ•°æ®åº“äº†ã€‚ä¸è¿‡ç”±äºæ•°æ®è¿‡å¤šï¼Œæ‰€ä»¥éœ€è¦å¯¹æ•°æ®åšæ°´å¹³æ‹†åˆ†ï¼Œæˆ‘ä»¬ç›®å‰çš„æ€è·¯æ˜¯æŒ‰ç…§èµ›å­£æ¥æ‹†åˆ†ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªèµ›å­£çš„æ¦œå•å•ç‹¬ä¸€å¼ è¡¨ã€‚è¿™æ ·åšæœ‰å‡ ä¸ªå¥½å¤„ï¼š</p><ul><li>æ‹†åˆ†æ•°æ®æ—¶æ¯”è¾ƒè‡ªç„¶ï¼Œæ— éœ€åšé¢å¤–å¤„ç†</li><li>æŸ¥è¯¢æ•°æ®æ—¶å¾€å¾€éƒ½æ˜¯æŒ‰ç…§èµ›å­£æ¥æŸ¥è¯¢ï¼Œè¿™æ ·ä¸€æ¬¡åªéœ€è¦æŸ¥ä¸€å¼ è¡¨ï¼Œä¸å­˜åœ¨è·¨è¡¨æŸ¥è¯¢é—®é¢˜</li></ul><p>å› æ­¤æˆ‘ä»¬å°±ä¸éœ€è¦ç”¨åˆ°åˆ†åº“åˆ†è¡¨çš„æ’ä»¶äº†ï¼Œç›´æ¥åœ¨ä¸šåŠ¡å±‚åˆ©ç”¨MybatisPluså°±å¯ä»¥å®ç°åŠ¨æ€è¡¨åï¼ŒåŠ¨æ€æ’å…¥äº†ã€‚ç®€å•é«˜æ•ˆã€‚</p><p>æˆ‘ä»¬ä¼šåˆ©ç”¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡åœ¨æ¯æœˆåˆç”Ÿæˆä¸Šèµ›å­£çš„æ¦œå•è¡¨ï¼Œç„¶åå†ç”¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡è¯»å–Redisä¸­çš„ä¸Šèµ›å­£æ¦œå•æ•°æ®ï¼ŒæŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ã€‚æœ€åå†æœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¸…ç†Redisä¸­çš„å†å²æ•°æ®ã€‚</p><p>è¿™é‡Œè¦è¯´æ˜ä¸€ä¸‹ï¼Œè¿™é‡Œä¸‰ä¸ªä»»åŠ¡æ˜¯æœ‰å…³è”çš„ï¼Œä¹‹æ‰€ä»¥è®©ä»»åŠ¡åˆ†å¼€å®šä¹‰ï¼Œæ˜¯ä¸ºäº†é¿å…ä»»åŠ¡è€¦åˆã€‚è¿™æ ·åœ¨éƒ¨åˆ†ä»»åŠ¡å¤±è´¥æ—¶ï¼Œå¯ä»¥å•ç‹¬é‡è¯•ï¼Œæ— éœ€æ‰€æœ‰ä»»åŠ¡ä»å¤´é‡è¯•ã€‚</p><p>å½“ç„¶ï¼Œæœ€ç»ˆæˆ‘ä»¬è‚¯å®šè¦ç¡®ä¿è¿™ä¸‰ä¸ªä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼Œä¸€å®šæ˜¯ä¾æ¬¡æ‰§è¡Œçš„ã€‚</p><br><p>ğŸ’¡<strong>æ€è€ƒï¼šä½ ä»¬ä½¿ç”¨Redisçš„SortedSetæ¥ä¿å­˜æ¦œå•æ•°æ®ï¼Œå¦‚æœç”¨æˆ·é‡éå¸¸å¤šæ€ä¹ˆåŠï¼Ÿ</strong></p><p>é¦–å…ˆRedisçš„SortedSetåº•å±‚åˆ©ç”¨äº†è·³è¡¨æœºåˆ¶ï¼Œæ€§èƒ½è¿˜æ˜¯éå¸¸ä¸é”™çš„ã€‚å³ä¾¿æœ‰ç™¾ä¸‡çº§åˆ«çš„ç”¨æˆ·é‡ï¼Œåˆ©ç”¨SortedSetä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæ€§èƒ½ä¸Šä¹Ÿèƒ½å¾—åˆ°ä¿è¯ã€‚åœ¨æˆ‘ä»¬çš„é¡¹ç›®ç”¨æˆ·é‡ä¸‹ï¼Œå®Œå…¨è¶³å¤Ÿã€‚</p><p>å½“ç³»ç»Ÿç”¨æˆ·é‡è§„æ¨¡è¾¾åˆ°æ•°åƒä¸‡ï¼Œä¹ƒè‡³æ•°äº¿æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨åˆ†æ²»çš„æ€æƒ³ï¼Œå°†ç”¨æˆ·æ•°æ®æŒ‰ç…§ç§¯åˆ†èŒƒå›´åˆ’åˆ†ä¸ºå¤šä¸ªæ¡¶ã€‚</p><p>ç„¶åä¸ºæ¯ä¸ªæ¡¶åˆ›å»ºä¸€ä¸ªSortedSetç±»å‹çš„keyï¼Œè¿™æ ·å°±å¯ä»¥å°†æ•°æ®åˆ†æ•£ï¼Œå‡å°‘å•ä¸ªKEYçš„æ•°æ®è§„æ¨¡äº†ã€‚</p><p>è€Œè¦è®¡ç®—æ’åæ—¶ï¼Œåªéœ€è¦æŒ‰ç…§èŒƒå›´æŸ¥è¯¢å‡ºç”¨æˆ·ç§¯åˆ†æ‰€åœ¨çš„æ¡¶ï¼Œå†ç´¯åŠ åˆ†å€¼èŒƒå›´æ¯”ä»–é«˜çš„æ¡¶çš„ç”¨æˆ·æ•°é‡å³å¯ã€‚ä¾ç„¶éå¸¸ç®€å•ã€é«˜æ•ˆã€‚</p><br><p>ğŸ’¡<strong>æ€è€ƒï¼šä½ ä»¬ä½¿ç”¨å†å²æ¦œå•é‡‡ç”¨çš„å®šæ—¶ä»»åŠ¡æ¡†æ¶æ˜¯å“ªä¸ªï¼Ÿå¤„ç†æ•°ç™¾ä¸‡çš„æ¦œå•æ•°æ®æ—¶ä»»åŠ¡æ˜¯å¦‚ä½•åˆ†ç‰‡çš„ï¼Ÿä½ ä»¬æ˜¯å¦‚ä½•ç¡®ä¿å¤šä¸ªä»»åŠ¡ä¾æ¬¡æ‰§è¡Œçš„å‘¢ï¼Ÿ</strong></p><p>ç­”ï¼šæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯XXL-JOBæ¡†æ¶ã€‚</p><p>XXL-JOBè‡ªå¸¦ä»»åŠ¡åˆ†ç‰‡å¹¿æ’­æœºåˆ¶ï¼Œæ¯ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå™¨éƒ½èƒ½é€šè¿‡APIå¾—åˆ°è‡ªå·±çš„åˆ†ç‰‡ç¼–å·ã€æ€»åˆ†ç‰‡æ•°é‡ã€‚åœ¨åšæ¦œå•æ•°æ®æ‰¹å¤„ç†æ—¶ï¼Œæˆ‘ä»¬æ˜¯æŒ‰ç…§åˆ†é¡µæŸ¥è¯¢çš„æ–¹å¼ï¼š</p><ul><li>æ¯ä¸ªæ‰§è¡Œå™¨çš„è¯»å–çš„èµ·å§‹é¡µéƒ½æ˜¯è‡ªå·±çš„åˆ†ç‰‡ç¼–å·+1ï¼Œä¾‹å¦‚ç¬¬ä¸€ä¸ªæ‰§è¡Œå™¨ï¼Œå…¶èµ·å§‹é¡µå°±æ˜¯1ï¼Œç¬¬äºŒä¸ªæ‰§è¡Œå™¨ï¼Œå…¶èµ·å§‹é¡µå°±æ˜¯2ï¼Œä»¥æ­¤ç±»æ¨</li><li>ç„¶åä¸æ˜¯é€é¡µæŸ¥è¯¢ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªé¡µçš„è·¨åº¦ï¼Œè·¨åº¦å€¼å°±æ˜¯åˆ†ç‰‡æ€»æ•°é‡ã€‚ä¾‹å¦‚åˆ†äº†3ç‰‡ï¼Œé‚£ä¹ˆè·¨åº¦å°±æ˜¯3</li></ul><p>æ­¤æ—¶ï¼Œç¬¬ä¸€ä¸ªåˆ†ç‰‡å¤„ç†çš„æ•°æ®å°±æ˜¯ç¬¬1ã€4ã€7ã€10ã€13ç­‰å‡ é¡µæ•°æ®ï¼Œç¬¬äºŒä¸ªåˆ†ç‰‡å¤„ç†çš„å°±æ˜¯ç¬¬2ã€5ã€8ã€11ã€14ç­‰é¡µçš„æ•°æ®ï¼Œç¬¬ä¸‰ä¸ªåˆ†ç‰‡å¤„ç†çš„å°±æ˜¯ç¬¬3ã€6ã€9ã€12ã€15ç­‰é¡µçš„æ•°æ®ã€‚</p><p>è¿™æ ·å°±èƒ½ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«å¤„ç†ï¼Œè€Œä¸”æ¯ä¸€ä¸ªæ‰§è¡Œå™¨éƒ½æ‰§è¡Œçš„æ˜¯ä¸åŒçš„æ•°æ®äº†ã€‚</p><p>æœ€åï¼Œè¦ç¡®ä¿å¤šä¸ªä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼Œå¯ä»¥åˆ©ç”¨XXL-JOBä¸­çš„å­ä»»åŠ¡åŠŸèƒ½ã€‚æ¯”å¦‚æœ‰ä»»åŠ¡Aã€Bã€Cï¼Œè¦æŒ‰ç…§å­—æ¯é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†Cè®¾ç½®ä¸ºBçš„å­ä»»åŠ¡ï¼Œå†å°†Bè®¾ç½®ä¸ºAçš„å­ä»»åŠ¡ã€‚ç„¶åç»™Aè®¾ç½®ä¸€ä¸ªè§¦å‘å™¨ã€‚</p><p>è¿™æ ·ï¼Œå½“Aè§¦å‘æ—¶ï¼Œå°±ä¼šä¾æ¬¡æ‰§è¡Œè¿™ä¸‰ä¸ªä»»åŠ¡äº†ã€‚</p></div>',179);function Rs(a,qs,Ls,fs,Os,Ns){const e=l("ArticleMetadata"),r=l("ClientOnly"),n=l("Br");return k(),d("div",null,[Ss,s(r,null,{default:g(()=>{var t,p;return[(((t=a.$frontmatter)==null?void 0:t.aside)??!0)&&(((p=a.$frontmatter)==null?void 0:p.showArticleMetadata)??!0)?(k(),o(e,{key:0,article:a.$frontmatter},null,8,["article"])):c("",!0)]}),_:1}),Ps,s(n),Ts,s(n),js,s(n),Is])}const Xs=E(xs,[["render",Rs]]);export{Ms as __pageData,Xs as default};
