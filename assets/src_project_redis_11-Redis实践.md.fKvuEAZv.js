import{_ as p,E as n,c as e,J as E,w as r,m as l,a as d,V as g,o as h,b as y,e as F}from"./chunks/framework.syB9hai_.js";const v=JSON.parse('{"title":"Rediså®è·µ","description":"","frontmatter":{},"headers":[],"relativePath":"src/project/redis/11-Rediså®è·µ.md","filePath":"src/project/redis/11-Rediså®è·µ.md","lastUpdated":1730648753000}'),o={name:"src/project/redis/11-Rediså®è·µ.md"},c=l("h1",{id:"rediså®è·µ",tabindex:"-1"},[d("Rediså®è·µ "),l("a",{class:"header-anchor",href:"#rediså®è·µ","aria-label":'Permalink to "Rediså®è·µ"'},"â€‹")],-1),u=g(`<nav class="table-of-contents"><ul><li><a href="#rediså®è·µ">Rediså®è·µ</a><ul><li><a href="#redisé”®å€¼è®¾è®¡">Redisé”®å€¼è®¾è®¡</a><ul><li><a href="#ä¼˜é›…çš„keyç»“æ„">ä¼˜é›…çš„Keyç»“æ„</a></li><li><a href="#æ‹’ç»bigkey">æ‹’ç»BigKey</a><ul><li><a href="#bigkeyçš„å±å®³">BigKeyçš„å±å®³</a></li><li><a href="#å¦‚ä½•å‘ç°bigkey">å¦‚ä½•å‘ç°BigKey</a></li><li><a href="#å¦‚ä½•åˆ é™¤bigkey">å¦‚ä½•åˆ é™¤BigKey</a></li></ul></li><li><a href="#æ°å½“çš„æ•°æ®ç±»å‹">æ°å½“çš„æ•°æ®ç±»å‹</a><ul><li><a href="#æ–¹æ¡ˆä¸€">æ–¹æ¡ˆä¸€</a></li><li><a href="#æ–¹æ¡ˆäºŒ">æ–¹æ¡ˆäºŒ</a></li></ul></li></ul></li><li><a href="#æ‰¹å¤„ç†ä¼˜åŒ–">æ‰¹å¤„ç†ä¼˜åŒ–</a><ul><li><a href="#pipeline">Pipeline</a><ul><li><a href="#æœåŠ¡å™¨äº¤äº’">æœåŠ¡å™¨äº¤äº’</a></li><li><a href="#mset">MSet</a></li><li><a href="#pipeline-1">Pipeline</a></li></ul></li><li><a href="#é›†ç¾¤ä¸‹çš„æ‰¹å¤„ç†">é›†ç¾¤ä¸‹çš„æ‰¹å¤„ç†</a></li></ul></li><li><a href="#æœåŠ¡ç«¯ä¼˜åŒ–">æœåŠ¡ç«¯ä¼˜åŒ–</a><ul><li><a href="#æŒä¹…åŒ–é…ç½®">æŒä¹…åŒ–é…ç½®</a></li><li><a href="#æ…¢æŸ¥è¯¢ä¼˜åŒ–">æ…¢æŸ¥è¯¢ä¼˜åŒ–</a><ul><li><a href="#ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢">ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢</a></li><li><a href="#å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢">å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢</a></li></ul></li><li><a href="#å‘½ä»¤åŠå®‰å…¨é…ç½®">å‘½ä»¤åŠå®‰å…¨é…ç½®</a></li><li><a href="#å†…å­˜é…ç½®">å†…å­˜é…ç½®</a></li></ul></li><li><a href="#é›†ç¾¤æœ€ä½³å®è·µ">é›†ç¾¤æœ€ä½³å®è·µ</a></li></ul></li></ul></nav><br><p><strong>Redisé”®å€¼è®¾è®¡</strong></p><ul><li>Keyçš„æœ€ä½³å®è·µ <ul><li>å›ºå®šæ ¼å¼ï¼š[ä¸šåŠ¡å]:[æ•°æ®å]:[id]</li><li>ç®€çŸ­æ•´æ´ï¼šä¸è¶…è¿‡44å­—èŠ‚ï¼Œä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦</li></ul></li><li>Valueçš„æœ€ä½³å®è·µ <ul><li>åˆç†çš„æ‹†åˆ†æ•°æ®ï¼Œæ‹’ç» BigKey <ul><li>ç½‘ç»œé˜»å¡ï¼šBigKey æ‰§è¡Œè¯»è¯·æ±‚ï¼Œå°‘é‡çš„QPSå°±å¯èƒ½å¯¼è‡´å¸¦å®½ä½¿ç”¨ç‡è¢«å æ»¡ã€‚</li><li>æ•°æ®å€¾æ–œï¼šBigKey æ‰€åœ¨çš„å®ä¾‹å†…å­˜ä½¿ç”¨ç‡è¿œè¶…è¿‡å…¶ä»–å®ä¾‹ï¼Œä½¿åˆ†ç‰‡å†…å­˜èµ„æºæ— æ³•è¾¾åˆ°å‡è¡¡ã€‚</li><li>Redisé˜»å¡ï¼šå¯¹å…ƒç´ è¾ƒå¤šçš„Hashï¼ŒListï¼ŒZSet åšè¿ç®—ä¼šè€—æ—¶è¾ƒä¹…ï¼Œä½¿ä¸»çº¿ç¨‹è¢«é˜»å¡</li><li>CPUå‹åŠ›ï¼šBigKey åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¼šå¯¼è‡´ CPU çš„ä½¿ç”¨ç‡é£™å‡ï¼Œå½±å“å®ä¾‹å’Œå…¶ä»–åº”ç”¨</li></ul></li><li>åˆé€‚çš„æ•°æ®ç»“æ„ <ul><li>å­˜å‚¨ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ <ul><li>ä½¿ç”¨ Json å­—ç¬¦ä¸²ï¼Œå®ç°ç®€å•ï¼›ä½†æ•°æ®è€¦åˆï¼Œä¸å¤Ÿçµæ´»</li><li>ä½¿ç”¨ Hashï¼Œåº•å±‚ä½¿ç”¨ Ziplistï¼Œç©ºé—´å ç”¨å°ï¼Œå¯ä»¥çµæ´»è®¿é—®å¯¹è±¡å­—æ®µï¼›ä½†å®ç°å¤æ‚</li></ul></li><li>å­˜å‚¨å¤§æ•°æ®çš„Hash <ul><li>å­˜åœ¨é—®é¢˜ï¼šHash çš„ entry é»˜è®¤æ•°é‡è¶…è¿‡ 512 å¹¶ä¸”å¤§å°è¶…è¿‡ 64 å­—èŠ‚ï¼Œåˆ™ä¼šä» Ziplist è½¬ä¸º Dictï¼Œå†…å­˜å ç”¨ä¼šå˜å¤šï¼Œä¿®æ”¹ entry çš„æ•°é‡å’Œå¤§å°ä¼šé€ æˆ BigKey</li><li>å¦‚ä½•è§£å†³ï¼šå°†å¤§æ•°æ®çš„ Hash æ‹†åˆ†æˆå°çš„ Hashï¼Œå†…å­˜å ç”¨æ›´å°ï¼›ä½†å®ç°ä¼šå˜å¤æ‚</li></ul></li></ul></li></ul></li></ul><br><p><strong>æ‰¹å¤„ç†ä¼˜åŒ–</strong></p><ul><li>æ‰¹é‡å¤„ç†çš„æ–¹æ¡ˆ <ul><li>åŸç”Ÿçš„Mæ“ä½œï¼šMæ“ä½œè™½ç„¶å¯ä»¥æ‰¹å¤„ç†ï¼Œä½†æ˜¯åªæ”¯æŒéƒ¨åˆ†æ•°æ®ã€‚</li><li>Pipelineæ‰¹å¤„ç†ï¼šæ‰¹å¤„ç†æ—¶ä¸å»ºè®®ä¸€æ¬¡æºå¸¦å¤ªå¤šå‘½ä»¤ï¼Œå¹¶ä¸”å¤šä¸ªå‘½ä»¤ä¹‹é—´ä¸å…·å¤‡åŸå­æ€§ã€‚</li></ul></li><li>é›†ç¾¤æ‰¹é‡å¤„ç† <ul><li>ä¸²è¡Œå‘½ä»¤ï¼šfor å¾ªç¯éå†ï¼Œä¾æ­¤æ‰§è¡Œæ¯ä¸ªå‘½ä»¤ã€‚å®ç°ç®€å•ä½†è€—æ—¶éå¸¸ä¹…</li><li>ä¸²è¡Œ Slotï¼šåœ¨å®¢æˆ·ç«¯è®¡ç®— key çš„ slotï¼Œå°†ç›¸åŒçš„ slot åˆ©ç”¨ pipeline æ‰¹å¤„ç†ï¼Œ<mark>ä¸²è¡Œæ‰§è¡Œ</mark>ã€‚è€—æ—¶çŸ­ä½†æ˜¯å®ç°æ¯”è¾ƒå¤æ‚ï¼Œslot è¶Šå¤šè€—æ—¶çº¦ä¹…</li><li>å¹¶è¡Œ Slotï¼šåœ¨å®¢æˆ·ç«¯è®¡ç®— key çš„ slotï¼Œå°†ç›¸åŒçš„ slot åˆ©ç”¨ pipeline æ‰¹å¤„ç†ï¼Œ<mark>å¹¶è¡Œæ‰§è¡Œ</mark>ã€‚è€—æ—¶éå¸¸çŸ­ï¼Œä½†æ˜¯å®ç°å¤æ‚ã€‚æ¨èä½¿ç”¨</li><li>hash_tagï¼šå°†æ‰€æœ‰ key è®¾ç½®ç›¸åŒçš„ hash_tagï¼Œè®©æ‰€æœ‰çš„ key ä¿æŒç›¸åŒã€‚è€—æ—¶éå¸¸çŸ­ï¼Œå®ç°ç®€å•ï¼Œä½†æ˜¯å®¹æ˜“å‡ºç°æ•°æ®å€¾æ–œ</li></ul></li></ul><br><p><strong>æœåŠ¡ç«¯ä¼˜åŒ–</strong></p><ul><li>æŒä¹…åŒ–å»ºè®® <ul><li>ç”¨æ¥åšç¼“å­˜çš„æœåŠ¡å°½é‡ä¸è¦å¼€å¯æŒä¹…åŒ–åŠŸèƒ½</li><li>å»ºè®®å…³é—­ RDB æŒä¹…åŒ–ï¼Œä½¿ç”¨ AOF æŒä¹…åŒ–</li><li>åˆ©ç”¨è„šæœ¬å®šæœŸåœ¨ slave èŠ‚ç‚¹åš RDBï¼Œå®ç°æ•°æ®å¤‡ä»½</li><li>è®¾ç½®åˆç†çš„ rewrite é˜ˆå€¼ï¼Œé¿å…é¢‘ç¹çš„ bgwrite</li><li>ç¦æ­¢åœ¨ rewirte æœŸé—´åš AOFï¼Œé¿å…å›  AOF å¼•èµ·æœåŠ¡å™¨é˜»å¡</li></ul></li><li>éƒ¨ç½²å»ºè®® <ul><li>Redis å®ä¾‹çš„ç‰©ç†æœºè¦é¢„ç•™è¶³å¤Ÿçš„å†…å­˜ï¼Œæ¥åº”å¯¹ fork å’Œ rewrite</li><li>å•ä¸ª Redis å®ä¾‹å†…å­˜ä¸èƒ½å¤ªå¤§ï¼Œåˆé€‚çš„å†…å­˜èƒ½åŠ å¿« fork é€Ÿåº¦ã€å‡å°‘ä¸»ä»åŒæ­¥ã€æ•°æ®è¿ç§»å‹åŠ›</li><li>ä¸è¦å’Œè®¡ç®—å¯†é›†å‹å’Œé«˜ç¡¬ç›˜è´Ÿè½½åº”ç”¨éƒ¨ç½²åœ¨ä¸€èµ·ã€‚</li></ul></li><li>æ…¢æŸ¥è¯¢ä¼˜åŒ– <ul><li><code>slowlog-log-slower-than</code>ï¼šæ…¢æŸ¥è¯¢é˜ˆå€¼ï¼Œå•ä½æ˜¯å¾®ç§’ã€‚é»˜è®¤æ˜¯10000ï¼Œå»ºè®®1000</li><li><code>slowlog-max-len</code>ï¼šæ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆæœ¬è´¨æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼‰çš„é•¿åº¦ã€‚é»˜è®¤æ˜¯128ï¼Œå»ºè®®1000</li></ul></li><li>å®‰å…¨é…ç½® <ul><li>Redis ä¸€å®šè¦è®¾ç½®å¯†ç </li><li>åˆ©ç”¨ rename-command ç¦ç”¨ config setã€flushallã€flushdbç­‰å‘½ä»¤</li><li>é…ç½® bind é™åˆ¶ç½‘å¡ï¼Œç¦æ­¢å¤–ç½‘ç½‘å¡è®¿é—®</li><li>å¼€å¯é˜²ç«å¢™ï¼Œå¹¶ä¸”ä¸ä½¿ç”¨ Root è´¦æˆ·å¯åŠ¨ Redis</li><li>å°½é‡ä¸ä½¿ç”¨é»˜è®¤çš„ç«¯å£</li></ul></li><li>å†…å­˜é…ç½®ï¼šå½“ Redis å†…å­˜ä¸è¶³ä¼šå¯¼è‡´ Key é¢‘ç¹è¢«åˆ é™¤ã€å“åº”æ—¶é—´å˜é•¿ã€QPS ä¸ç¨³å®šï¼Œéœ€è¦å¿«é€Ÿå®šä½åŸå› ã€‚ <ul><li>æ•°æ®å†…å­˜ï¼šRedis æœ€ä¸»è¦éƒ¨åˆ†ï¼Œå­˜å‚¨ Redis é”®å€¼ä¿¡æ¯ï¼Œä¸»è¦é—®é¢˜æ˜¯ BigKey é—®é¢˜ã€å†…å­˜ç¢ç‰‡é—®é¢˜</li><li>è¿›ç¨‹å†…å­˜ï¼šRedis ä¸»è¿›ç¨‹æœ¬èº«è¿è¡Œå ç”¨çš„å†…å­˜ï¼Œå¦‚ä»£ç ï¼Œå¸¸é‡æ± ç­‰ç­‰ï¼›å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥å¿½ç•¥</li><li>ç¼“å†²åŒºå†…å­˜ï¼šä¸€èˆ¬åŒ…æ‹¬å®¢æˆ·ç«¯ç¼“å†²åŒºã€AOF ç¼“å†²åŒºã€å¤åˆ¶ç¼“å†²åŒºã€‚å®¢æˆ·ç«¯ç¼“å†²åŒºåˆåŒ…æ‹¬è¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒºã€‚è¾“å…¥ç¼“å†²åŒºæœ€å¤§ä¸º 1GBï¼Œè¶…è¿‡å°±ä¼šè‡ªåŠ¨æ–­å¼€ï¼›è¾“å‡ºç¼“å†²åŒºå†…å­˜å ç”¨æ³¢åŠ¨æ¯”è¾ƒå¤§ï¼Œä¸å½“ä½¿ç”¨ BigKeyï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºã€‚å¯é€šè¿‡å¢åŠ ç¼“å†²åŒºå¤§å°å’Œå¢åŠ æœåŠ¡å¸¦å®½æ¥è§£å†³ã€‚</li></ul></li></ul><br><p><strong>é›†ç¾¤æœ€ä½³å®è·µ</strong></p><ul><li>é›†ç¾¤å®Œæ•´æ€§é—®é¢˜ï¼šRedis é›†ç¾¤çš„é»˜è®¤é…ç½®ä¸ºå‘ç°ä»»æ„ä¸€ä¸ªæ’æ§½ä¸å¯ç”¨åˆ™æ•´ä¸ªé›†ç¾¤åœæ­¢æœåŠ¡ã€‚</li><li>å‘½ä»¤å…¼å®¹æ€§é—®é¢˜ï¼šå½“æˆ‘ä»¬ä½¿ç”¨æ‰¹å¤„ç†å‘½ä»¤æ—¶å¿…é¡»å°† Key è½åœ¨ç›¸åŒçš„æ’æ§½ä¸Šæ‰èƒ½åŒæ—¶æ“ä½œã€‚å®¢æˆ·ç«¯éœ€è¦å¯¹è¿™æ ·çš„æ•°æ®è¿›è¡Œé‡æ–°å¤„ç†ã€‚</li><li>æœåŠ¡äº‹åŠ¡é—®é¢˜ï¼šLua å’Œäº‹åŠ¡éƒ½æ˜¯è¦ä¿è¯åŸå­æ€§é—®é¢˜ï¼Œå¦‚æœ Key ä¸åœ¨ä¸€ä¸ªèŠ‚ç‚¹åˆ™æ— æ³•ä¿è¯ Lua çš„æ‰§è¡Œå’Œäº‹åŠ¡çš„ç‰¹æ€§ã€‚</li><li>é›†ç¾¤å¸¦å®½é—®é¢˜ï¼šé›†ç¾¤ä¹‹é—´ä¼šä¸æ–­çš„ Ping æ¥ç¡®å®šé›†ç¾¤å…¶å®ƒèŠ‚ç‚¹çš„çŠ¶æ€ã€‚è€Œéšç€èŠ‚ç‚¹çš„å¢å¤šï¼Œé›†ç¾¤çš„çŠ¶æ€ä¿¡æ¯å’Œæ’æ§½ä¿¡æ¯ä¼šè¶Šæ¥è¶Šå¤§ï¼Œ10ä¸ªèŠ‚ç‚¹ç›¸å…³æ•°æ®ä¹…å¯èƒ½è¾¾åˆ° 1KBï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„å¸¦å®½è¢«æ— ç”¨çš„ Ping ä¿¡æ¯æ‰€å ç”¨ã€‚é¿å…å¤§é›†ç¾¤ï¼ŒèŠ‚ç‚¹æ•°é‡ä¸è¦å¤ªå¤šï¼Œå¹¶ä¸”é¿å…åœ¨å•ä¸ªç‰©ç†æœºä¸­è¿è¡Œå¤šä¸ª Redisï¼Œé…ç½®åˆé€‚çš„é›†ç¾¤èŠ‚ç‚¹è¶…æ—¶æ—¶é—´ã€‚</li><li>æ•°æ®å€¾æ–œé—®é¢˜ï¼šä¼šé€ æˆæ•°æ®å€¾æ–œé—®é¢˜ï¼Œéœ€è¦æå‰è§„åˆ’ Key çš„åˆ†å¸ƒã€‚</li></ul><h2 id="redisé”®å€¼è®¾è®¡" tabindex="-1">Redisé”®å€¼è®¾è®¡ <a class="header-anchor" href="#redisé”®å€¼è®¾è®¡" aria-label="Permalink to &quot;Redisé”®å€¼è®¾è®¡&quot;">â€‹</a></h2><h3 id="ä¼˜é›…çš„keyç»“æ„" tabindex="-1">ä¼˜é›…çš„Keyç»“æ„ <a class="header-anchor" href="#ä¼˜é›…çš„keyç»“æ„" aria-label="Permalink to &quot;ä¼˜é›…çš„Keyç»“æ„&quot;">â€‹</a></h3><p>Redisçš„Keyè™½ç„¶å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æœ€å¥½éµå¾ªä¸‹é¢çš„å‡ ä¸ªæœ€ä½³å®è·µçº¦å®šï¼š</p><ul><li>éµå¾ªåŸºæœ¬æ ¼å¼ï¼š[ä¸šåŠ¡åç§°]:[æ•°æ®å]:[id]</li><li>é•¿åº¦ä¸è¶…è¿‡44å­—èŠ‚</li><li>ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦</li></ul><br><p>ä¾‹å¦‚ï¼šæˆ‘ä»¬çš„ç™»å½•ä¸šåŠ¡ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œå…¶keyå¯ä»¥è®¾è®¡æˆå¦‚ä¸‹æ ¼å¼ï¼š</p><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-20240315103909688.png" alt="image-20240315103909688" loading="lazy"></p><p>è¿™æ ·è®¾è®¡çš„å¥½å¤„ï¼š</p><ul><li>å¯è¯»æ€§å¼º</li><li>é¿å…keyå†²çª</li><li>æ–¹ä¾¿ç®¡ç†</li><li>æ›´èŠ‚çœå†…å­˜</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[mousse@MacBookAir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ redis-cli</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set num </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">123</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type num</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">string</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set name java</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> object encoding name</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;embstr&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type name</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">string</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set name aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type name</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">string</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> object encoding name </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;embstr&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set name aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> object encoding name </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;raw&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">ğŸ”–æ›´èŠ‚çœå†…å­˜çš„åŸå› </p><p>keyæ˜¯ String ç±»å‹ï¼Œåº•å±‚ç¼–ç åŒ…å« intã€embstr å’Œ raw ä¸‰ç§ã€‚embstr åœ¨å°äº44å­—èŠ‚ä½¿ç”¨ï¼Œé‡‡ç”¨è¿ç»­å†…å­˜ç©ºé—´ï¼Œå†…å­˜å ç”¨æ›´å°ã€‚å½“å­—èŠ‚æ•°å¤§äº 44 å­—èŠ‚æ—¶ï¼Œä¼šè½¬ä¸º raw æ¨¡å¼å­˜å‚¨ï¼Œåœ¨ raw æ¨¡å¼ä¸‹ï¼Œå†…å­˜ç©ºé—´ä¸æ˜¯è¿ç»­çš„ï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº†å¦å¤–ä¸€æ®µå†…å­˜ç©ºé—´ï¼Œåœ¨è¿™æ®µç©ºé—´é‡Œå­˜å‚¨ SDS å†…å®¹ï¼Œè¿™æ ·ç©ºé—´ä¸è¿ç»­ï¼Œè®¿é—®çš„æ—¶å€™æ€§èƒ½ä¹Ÿå°±ä¼šå—åˆ°å½±å“ï¼Œè¿˜æœ‰å¯èƒ½äº§ç”Ÿå†…å­˜ç¢ç‰‡</p></div><br><h3 id="æ‹’ç»bigkey" tabindex="-1">æ‹’ç»BigKey <a class="header-anchor" href="#æ‹’ç»bigkey" aria-label="Permalink to &quot;æ‹’ç»BigKey&quot;">â€‹</a></h3><p>BigKey é€šå¸¸ä»¥ Key çš„å¤§å°å’Œ Key ä¸­æˆå‘˜çš„æ•°é‡æ¥ç»¼åˆåˆ¤å®šï¼Œä¾‹å¦‚ï¼š</p><ul><li>Key æœ¬èº«çš„æ•°æ®é‡è¿‡å¤§ï¼šä¸€ä¸ª String ç±»å‹çš„ Keyï¼Œå®ƒçš„å€¼ä¸º 5MB</li><li>Key ä¸­æˆå‘˜çš„ Key æ•°è¿‡å¤šï¼šä¸€ä¸ª ZSET ç±»å‹çš„ Keyï¼Œå®ƒçš„æˆå‘˜æ•°é‡ä¸º10,000ä¸ª</li><li>Key ä¸­æˆå‘˜çš„ Value è¿‡å¤§ï¼šä¸€ä¸ª Hash ç±»å‹çš„ Keyï¼Œå®ƒçš„æˆå‘˜æ•°é‡è™½ç„¶åªæœ‰ 1,000 ä¸ªä½†è¿™äº›æˆå‘˜çš„ Valueï¼ˆå€¼ï¼‰æ€»å¤§å°ä¸º100 MB</li></ul><br><p>é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­å…ƒç´ çš„å¤§å°å‘¢ï¼ŸRedis ä¹Ÿç»™æˆ‘ä»¬æä¾›äº†å‘½ä»¤</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å¯ä»¥é‡‡ç”¨memoryusageæŒ‡ä»¤æŸ¥çœ‹æŒ‡å®škeyåŠå…¶valueå ç”¨å¤§å°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> memory usage name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) 120</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set name aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> memory usage name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) 104</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set name jack</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> memory usage name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) 72</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ä½†æ˜¯ä¸€èˆ¬ä¸æ¨èä½¿ç”¨memoryæŒ‡ä»¤ï¼Œå› æ­¤è¿™ä¸ªæŒ‡ä»¤å¯¹cpuçš„ä½¿ç”¨ç‡æ˜¯æ¯”è¾ƒé«˜çš„</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> strlen name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) 4</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å®é™…å¼€å‘ä¸­ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬åªéœ€è¦è¡¡é‡å€¼æˆ–è€…å€¼çš„ä¸ªæ•°å°±è¡Œäº†</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LPUSH l2 m1 m2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> LLEN l2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) 2</span></span></code></pre></div><br><p>æ¨èå€¼</p><ul><li>å•ä¸ª Key çš„ Value å°äº 10KB</li><li>å¯¹äºé›†åˆç±»å‹çš„ Keyï¼Œå»ºè®®å…ƒç´ æ•°é‡å°äº 1,000</li></ul><br><h4 id="bigkeyçš„å±å®³" tabindex="-1">BigKeyçš„å±å®³ <a class="header-anchor" href="#bigkeyçš„å±å®³" aria-label="Permalink to &quot;BigKeyçš„å±å®³&quot;">â€‹</a></h4><ul><li>ç½‘ç»œé˜»å¡ <ul><li>BigKey æ‰§è¡Œè¯»è¯·æ±‚æ—¶ï¼Œå°‘é‡çš„QPSå°±å¯èƒ½å¯¼è‡´å¸¦å®½ä½¿ç”¨ç‡è¢«å æ»¡ï¼Œå¯¼è‡´ Rediså®ä¾‹ï¼Œä¹ƒè‡³æ‰€åœ¨ç‰©ç†æœºå˜æ…¢</li></ul></li><li>æ•°æ®å€¾æ–œ <ul><li>BigKey æ‰€åœ¨çš„Rediså®ä¾‹å†…å­˜ä½¿ç”¨ç‡è¿œè¶…å…¶ä»–å®ä¾‹ï¼Œæ— æ³•ä½¿æ•°æ®åˆ†ç‰‡çš„å†…å­˜èµ„æºè¾¾åˆ°å‡è¡¡</li></ul></li><li>Redis é˜»å¡ <ul><li>å…ƒç´ è¾ƒå¤šçš„ Hashã€Listã€Zset ç­‰åšè¿ç®—ä¼šè€—æ—¶è¾ƒä¹…ï¼Œä½¿ä¸»çº¿ç¨‹è¢«é˜»å¡</li></ul></li><li>CPUå‹åŠ› <ul><li>BigKey çš„æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¼šå¯¼è‡´ CPU çš„ä½¿ç”¨ç‡é£™å‡ï¼Œå½±å“ Redis å®ä¾‹å’Œæœ¬æœºå…¶å®ƒåº”ç”¨</li></ul></li></ul><br><h4 id="å¦‚ä½•å‘ç°bigkey" tabindex="-1">å¦‚ä½•å‘ç°BigKey <a class="header-anchor" href="#å¦‚ä½•å‘ç°bigkey" aria-label="Permalink to &quot;å¦‚ä½•å‘ç°BigKey&quot;">â€‹</a></h4><p><strong>å‘½ä»¤è¡Œ</strong></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --bigkeys</span></span></code></pre></div><p>åˆ©ç”¨redis-cliæä¾›çš„ --bigkeys å‚æ•°ï¼Œå¯ä»¥éå†åˆ†ææ‰€æœ‰keyï¼Œå¹¶è¿”å›Keyçš„æ•´ä½“ç»Ÿè®¡ä¿¡æ¯ä¸æ¯ä¸ªæ•°æ®çš„Top1çš„big key</p><p>å‘½ä»¤ï¼š<code>redis-cli -a å¯†ç  --bigkeys</code></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[mousse@MacBookAir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]$ redis-cli --bigkeys</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Scanning the entire keyspace to find biggest keys as well as</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># average sizes per key type.  You can use -i 0.1 to sleep 0.1 sec</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># per 100 SCAN commands (not usually needed).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.00%] Biggest string found so far </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&quot;heima:user:1&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> with 36 bytes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.00%] Biggest string found so far </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&quot;heima:user:2&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> with 42 bytes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.00%] Biggest hash   found so far </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&quot;heima:user:3&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> with 1 fields</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.00%] Biggest list   found so far </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&quot;l2&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> with 2 items</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.00%] Biggest string found so far </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&quot;user:100&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> with 57 bytes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--------</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> summary -------</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sampled</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> keys in the keyspace!</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Total</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key length in bytes is </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">61</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">avg</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> len </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7.62</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Biggest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   list found &#39;&quot;l2&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> has </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> items</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Biggest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   hash found &#39;&quot;heima:user:3&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> has </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fields</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Biggest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> string found &#39;&quot;user:100&quot;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> has </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">57</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lists with </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> items </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">12.50%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of keys, avg size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hashs with </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fields </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">12.50%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of keys, avg size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">6</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> strings with </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">173</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">75.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of keys, avg size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">28.83</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> streams with </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> entries </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">00.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of keys, avg size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sets with </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> members </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">00.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of keys, avg size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zsets with </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> members </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">00.00%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of keys, avg size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.00</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><br><p><strong>Scan æ‰«æ</strong></p><p>è‡ªå·±ç¼–ç¨‹ï¼Œåˆ©ç”¨ Scan æ‰«æ Redis ä¸­çš„æ‰€æœ‰ Keyï¼Œåˆ©ç”¨ strlenã€hlen ç­‰å‘½ä»¤åˆ¤æ–­ Key çš„é•¿åº¦ï¼ˆæ­¤å¤„ä¸å»ºè®®ä½¿ç”¨MEMORY USAGEï¼‰</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scan </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> count </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) 1) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;heima:user:1&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;heima:user:2&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;heima:user:3&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scan </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> count </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;7&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) 1) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;num&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user:100&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">   3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span></span></code></pre></div><p>scan å‘½ä»¤è°ƒç”¨å®Œåæ¯æ¬¡ä¼šè¿”å› 2 ä¸ªå…ƒç´ ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä¸‹ä¸€æ¬¡è¿­ä»£çš„å…‰æ ‡ï¼Œç¬¬ä¸€æ¬¡å…‰æ ‡ä¼šè®¾ç½®ä¸º 0ï¼Œå½“æœ€åä¸€æ¬¡ scan è¿”å›çš„å…‰æ ‡ç­‰äº 0 æ—¶ï¼Œè¡¨ç¤ºæ•´ä¸ª scan éå†ç»“æŸäº†ï¼Œç¬¬äºŒä¸ªè¿”å›çš„æ˜¯ Listï¼Œä¸€ä¸ªåŒ¹é…çš„ Key çš„æ•°ç»„</p><br><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.heima.jedis.util.JedisConnectionFactory;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.junit.jupiter.api.AfterEach;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.junit.jupiter.api.BeforeEach;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.junit.jupiter.api.Test;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redis.clients.jedis.Jedis;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redis.clients.jedis.ScanResult;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.HashMap;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.List;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.Map;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JedisTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Jedis jedis;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BeforeEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1.å»ºç«‹è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // jedis = new Jedis(&quot;192.168.150.101&quot;, 6379);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        jedis </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JedisConnectionFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getJedis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.è®¾ç½®å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123321&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3.é€‰æ‹©åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    final</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> STR_MAX_LEN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    final</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HASH_MAX_LEN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> testScan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String cursor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // æ‰«æå¹¶è·å–ä¸€éƒ¨åˆ†key</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ScanResult&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cursor);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // è®°å½•cursor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            cursor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCursor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // éå†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (String key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // åˆ¤æ–­keyçš„ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                String type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                switch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (type) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;string&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">strlen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        maxLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> STR_MAX_LEN;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;hash&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hlen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        maxLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HASH_MAX_LEN;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;list&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">llen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        maxLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HASH_MAX_LEN;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;set&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        maxLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HASH_MAX_LEN;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    case</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;zset&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zcard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(key);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        maxLen </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HASH_MAX_LEN;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    default:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxLen) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">printf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Found big key : %s, type: %s, length or size: %d %n&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, key, type, len);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">while</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cursor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AfterEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tearDown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (jedis </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p><strong>ç¬¬ä¸‰æ–¹å·¥å…·</strong></p><ul><li>åˆ©ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå¦‚ Redis-Rdb-Tools åˆ†æRDBå¿«ç…§æ–‡ä»¶ï¼Œå…¨é¢åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µ</li><li><a href="https://github.com/sripathikrishnan/redis-rdb-tools" target="_blank" rel="noreferrer">https://github.com/sripathikrishnan/redis-rdb-tools</a></li></ul><br><p><strong>ç½‘ç»œç›‘æ§</strong></p><ul><li>è‡ªå®šä¹‰å·¥å…·ï¼Œç›‘æ§è¿›å‡ºRedisçš„ç½‘ç»œæ•°æ®ï¼Œè¶…å‡ºé¢„è­¦å€¼æ—¶ä¸»åŠ¨å‘Šè­¦</li><li>ä¸€èˆ¬é˜¿é‡Œäº‘æ­å»ºçš„äº‘æœåŠ¡å™¨å°±æœ‰ç›¸å…³ç›‘æ§é¡µé¢</li></ul><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-20220521140415785.png" alt="image-20220521140415785" loading="lazy"></p><br><h4 id="å¦‚ä½•åˆ é™¤bigkey" tabindex="-1">å¦‚ä½•åˆ é™¤BigKey <a class="header-anchor" href="#å¦‚ä½•åˆ é™¤bigkey" aria-label="Permalink to &quot;å¦‚ä½•åˆ é™¤BigKey&quot;">â€‹</a></h4><p>BigKeyå†…å­˜å ç”¨è¾ƒå¤šï¼Œå³ä¾¿æ—¶åˆ é™¤è¿™æ ·çš„ Key ä¹Ÿéœ€è¦è€—è´¹å¾ˆé•¿æ—¶é—´ï¼Œå¯¼è‡´ Redis ä¸»çº¿ç¨‹é˜»å¡ï¼Œå¼•å‘ä¸€ç³»åˆ—é—®é¢˜ã€‚</p><ul><li>Redis 3.0 åŠä»¥ä¸‹ç‰ˆæœ¬ <ul><li>å¦‚æœæ˜¯é›†åˆç±»å‹ï¼Œåˆ™éå†BigKeyçš„å…ƒç´ ï¼Œå…ˆé€ä¸ªåˆ é™¤å­å…ƒç´ ï¼Œæœ€ååˆ é™¤BigKey</li></ul></li></ul><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-20220521140621204.png" alt="image-20220521140621204" loading="lazy"></p><ul><li>Redis 4.0ä»¥å <ul><li>Redis åœ¨4.0åæä¾›äº†å¼‚æ­¥åˆ é™¤çš„å‘½ä»¤ï¼šunlink</li></ul></li></ul><br><h3 id="æ°å½“çš„æ•°æ®ç±»å‹" tabindex="-1">æ°å½“çš„æ•°æ®ç±»å‹ <a class="header-anchor" href="#æ°å½“çš„æ•°æ®ç±»å‹" aria-label="Permalink to &quot;æ°å½“çš„æ•°æ®ç±»å‹&quot;">â€‹</a></h3><p>ä¾‹1ï¼šæ¯”å¦‚å­˜å‚¨ä¸€ä¸ªUserå¯¹è±¡ï¼Œæˆ‘ä»¬æœ‰ä¸‰ç§å­˜å‚¨æ–¹å¼ï¼š</p><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-16935513619541.png" alt="image-16935513619541" loading="lazy"></p><br><p>ä¾‹2ï¼šå‡å¦‚æœ‰hashç±»å‹çš„keyï¼Œå…¶ä¸­æœ‰100ä¸‡å¯¹fieldå’Œvalueï¼Œfieldæ˜¯è‡ªå¢idï¼Œè¿™ä¸ªkeyå­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</p><table><tr style="color:red;"><td>key</td><td>field</td><td>value</td></tr><tr><td rowspan="3">someKey</td><td>id:0</td><td>value0</td></tr><tr><td>.....</td><td>.....</td></tr><tr><td>id:999999</td><td>value999999</td></tr></table><br><p>å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li><p>hashçš„entryæ•°é‡è¶…è¿‡500æ—¶ï¼Œä¼šä½¿ç”¨å“ˆå¸Œè¡¨è€Œä¸æ˜¯ ZipListï¼Œå†…å­˜å ç”¨è¾ƒå¤š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info memory</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Memory</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">used_memory_human:62.23M</span></span></code></pre></div></li><li><p>å¯ä»¥é€šè¿‡ hash-max-ziplist-entries é…ç½® entry ä¸Šé™ã€‚ä½†æ˜¯å¦‚æœ entry è¿‡å¤šå°±ä¼šå¯¼è‡´ BigKey é—®é¢˜</p></li></ul><br><h4 id="æ–¹æ¡ˆä¸€" tabindex="-1">æ–¹æ¡ˆä¸€ <a class="header-anchor" href="#æ–¹æ¡ˆä¸€" aria-label="Permalink to &quot;æ–¹æ¡ˆä¸€&quot;">â€‹</a></h4><p>æ‹†åˆ†ä¸ºstringç±»å‹</p><table><tr style="color:red;"><td>key</td><td>value</td></tr><tr><td>id:0</td><td>value0</td></tr><tr><td>.....</td><td>.....</td></tr><tr><td>id:999999</td><td>value999999</td></tr></table><br><p>å­˜åœ¨çš„é—®é¢˜ï¼š</p><ul><li><p>Stringç»“æ„åº•å±‚æ²¡æœ‰å¤ªå¤šå†…å­˜ä¼˜åŒ–ï¼Œå†…å­˜å ç”¨è¾ƒå¤š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info memory</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Memory</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">used_memory_human:77.54M</span></span></code></pre></div></li><li><p>æƒ³è¦æ‰¹é‡è·å–è¿™äº›æ•°æ®æ¯”è¾ƒéº»çƒ¦</p></li></ul><br><h4 id="æ–¹æ¡ˆäºŒ" tabindex="-1">æ–¹æ¡ˆäºŒ <a class="header-anchor" href="#æ–¹æ¡ˆäºŒ" aria-label="Permalink to &quot;æ–¹æ¡ˆäºŒ&quot;">â€‹</a></h4><p>æ‹†åˆ†ä¸ºå°çš„hashï¼Œå°† id / 100 ä½œä¸ºkeyï¼Œ å°†id % 100 ä½œä¸ºfieldï¼Œè¿™æ ·æ¯100ä¸ªå…ƒç´ ä¸ºä¸€ä¸ªHash</p><table><tr style="color:red;"><td>key</td><td>field</td><td>value</td></tr><tr><td rowspan="3">key:0</td><td>id:00</td><td>value0</td></tr><tr><td>.....</td><td>.....</td></tr><tr><td>id:99</td><td>value99</td></tr><tr><td rowspan="3">key:1</td><td>id:00</td><td>value100</td></tr><tr><td>.....</td><td>.....</td></tr><tr><td>id:99</td><td>value199</td></tr><tr><td colspan="3">....</td></tr><tr><td rowspan="3">key:9999</td><td>id:00</td><td>value999900</td></tr><tr><td>.....</td><td>.....</td></tr><tr><td>id:99</td><td>value999999</td></tr></table><p>æŸ¥çœ‹ä½¿ç”¨å†…å­˜å¤§å°ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info memory</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Memory</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">used_memory_human:24.44M</span></span></code></pre></div><p>å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.heima.test;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.heima.jedis.util.JedisConnectionFactory;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.junit.jupiter.api.AfterEach;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.junit.jupiter.api.BeforeEach;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.junit.jupiter.api.Test;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redis.clients.jedis.Jedis;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redis.clients.jedis.Pipeline;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> redis.clients.jedis.ScanResult;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.HashMap;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.List;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.Map;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JedisTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Jedis jedis;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BeforeEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1.å»ºç«‹è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // jedis = new Jedis(&quot;192.168.150.101&quot;, 6379);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        jedis </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JedisConnectionFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getJedis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.è®¾ç½®å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">auth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;123321&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3.é€‰æ‹©åº“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> testSetBigKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HashMap&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 650</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hmset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;m2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, map);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> testBigHash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HashMap&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;key_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hmset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test:big:hash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, map);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> testBigString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test:str:key_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> testSmallHash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hashSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HashMap&lt;&gt;(hashSize);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hashSize;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hashSize;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;key_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (v </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hmset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test:small:hash_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> k, map);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AfterEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tearDown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (jedis </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h2 id="æ‰¹å¤„ç†ä¼˜åŒ–" tabindex="-1">æ‰¹å¤„ç†ä¼˜åŒ– <a class="header-anchor" href="#æ‰¹å¤„ç†ä¼˜åŒ–" aria-label="Permalink to &quot;æ‰¹å¤„ç†ä¼˜åŒ–&quot;">â€‹</a></h2><h3 id="pipeline" tabindex="-1">Pipeline <a class="header-anchor" href="#pipeline" aria-label="Permalink to &quot;Pipeline&quot;">â€‹</a></h3><h4 id="æœåŠ¡å™¨äº¤äº’" tabindex="-1">æœåŠ¡å™¨äº¤äº’ <a class="header-anchor" href="#æœåŠ¡å™¨äº¤äº’" aria-label="Permalink to &quot;æœåŠ¡å™¨äº¤äº’&quot;">â€‹</a></h4><p>å•ä¸ªå‘½ä»¤çš„æ‰§è¡Œæµç¨‹</p><p>ä¸€æ¬¡å‘½ä»¤çš„å“åº”æ—¶é—´ = 1æ¬¡å¾€è¿”çš„ç½‘ç»œä¼ è¾“è€—æ—¶ + 1æ¬¡Redisæ‰§è¡Œå‘½ä»¤è€—æ—¶</p><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-20240315111754550.png" alt="image-20240315111754550" loading="lazy"></p><br><p>Næ¡å‘½ä»¤çš„æ‰§è¡Œæµç¨‹</p><p>Næ¬¡å‘½ä»¤çš„å“åº”æ—¶é—´ = Næ¬¡å¾€è¿”çš„ç½‘ç»œä¼ è¾“è€—æ—¶ + Næ¬¡Redisæ‰§è¡Œå‘½ä»¤è€—æ—¶</p><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-20240315112454702.png" alt="image-20240315112454702" loading="lazy"></p><br><p>Rediså¤„ç†æŒ‡ä»¤æ˜¯å¾ˆå¿«çš„ï¼Œä¸»è¦èŠ±è´¹çš„æ—¶å€™åœ¨äºç½‘ç»œä¼ è¾“ã€‚äºæ˜¯ä¹å¾ˆå®¹æ˜“æƒ³åˆ°å°†å¤šæ¡æŒ‡ä»¤æ‰¹é‡çš„ä¼ è¾“ç»™ Redis</p><p>Næ¬¡å‘½ä»¤çš„å“åº”æ—¶é—´ = 1æ¬¡å¾€è¿”çš„ç½‘ç»œä¼ è¾“è€—æ—¶ + Næ¬¡Redisæ‰§è¡Œå‘½ä»¤è€—æ—¶</p><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-20240315112530503.png" alt="image-20240315112530503" loading="lazy"></p><br><h4 id="mset" tabindex="-1">MSet <a class="header-anchor" href="#mset" aria-label="Permalink to &quot;MSet&quot;">â€‹</a></h4><p>Redisæä¾›äº†å¾ˆå¤šMxxxè¿™æ ·çš„å‘½ä»¤ï¼Œå¯ä»¥å®ç°æ‰¹é‡æ’å…¥æ•°æ®ï¼Œä¾‹å¦‚ï¼š</p><ul><li>mset</li><li>hmset</li></ul><p>åˆ©ç”¨msetæ‰¹é‡æ’å…¥10ä¸‡æ¡æ•°æ®</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> testMxx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] arr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> j;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentTimeMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        arr[j] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;test:key_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        arr[j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;value_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(arr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentTimeMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;time: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h4 id="pipeline-1" tabindex="-1">Pipeline <a class="header-anchor" href="#pipeline-1" aria-label="Permalink to &quot;Pipeline&quot;">â€‹</a></h4><p>MSETè™½ç„¶å¯ä»¥æ‰¹å¤„ç†ï¼Œä½†æ˜¯å´åªèƒ½æ“ä½œéƒ¨åˆ†æ•°æ®ç±»å‹ï¼Œå› æ­¤å¦‚æœæœ‰å¯¹å¤æ‚æ•°æ®ç±»å‹çš„æ‰¹å¤„ç†éœ€è¦ï¼Œå»ºè®®ä½¿ç”¨Pipeline</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> testPipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åˆ›å»ºç®¡é“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Pipeline pipeline </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jedis.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pipelined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentTimeMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ”¾å…¥å‘½ä»¤åˆ°ç®¡é“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pipeline.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test:key_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;value_&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // æ¯æ”¾å…¥1000æ¡å‘½ä»¤ï¼Œæ‰¹é‡æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            pipeline.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> System.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">currentTimeMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;time: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h3 id="é›†ç¾¤ä¸‹çš„æ‰¹å¤„ç†" tabindex="-1">é›†ç¾¤ä¸‹çš„æ‰¹å¤„ç† <a class="header-anchor" href="#é›†ç¾¤ä¸‹çš„æ‰¹å¤„ç†" aria-label="Permalink to &quot;é›†ç¾¤ä¸‹çš„æ‰¹å¤„ç†&quot;">â€‹</a></h3><p>å¦‚ MSET æˆ– Pipeline è¿™æ ·çš„æ‰¹å¤„ç†éœ€è¦åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æºå¸¦å¤šæ¡å‘½ä»¤ï¼Œè€Œæ­¤æ—¶å¦‚æœ Redis æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œé‚£æ‰¹å¤„ç†å‘½ä»¤çš„å¤šä¸ª Key å¿…é¡»è½åœ¨ä¸€ä¸ªæ’æ§½ä¸­ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´æ‰§è¡Œå¤±è´¥ã€‚å¤§å®¶å¯ä»¥æƒ³ä¸€æƒ³è¿™æ ·çš„è¦æ±‚å…¶å®å¾ˆéš¾å®ç°ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ‰¹å¤„ç†æ—¶ï¼Œå¯èƒ½ä¸€æ¬¡è¦æ’å…¥å¾ˆå¤šæ¡æ•°æ®ï¼Œè¿™äº›æ•°æ®å¾ˆæœ‰å¯èƒ½ä¸ä¼šéƒ½è½åœ¨ç›¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œè¿™å°±ä¼šå¯¼è‡´æŠ¥é”™äº†ã€‚</p><br><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°4ç§è§£å†³æ–¹æ¡ˆï¼š</p><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-20240315112636010.png" alt="image-20240315112636010" loading="lazy"></p><ul><li><p>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šä¸²è¡Œæ‰§è¡Œï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œå½“ç„¶ï¼Œæ‰§è¡Œèµ·æ¥å°±å¾ˆç®€å•äº†ï¼Œç¼ºç‚¹å°±æ˜¯è€—æ—¶è¿‡ä¹…ã€‚</p></li><li><p>ç¬¬äºŒç§æ–¹æ¡ˆï¼šä¸²è¡Œ Slotï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ‰§è¡Œå‰ï¼Œå®¢æˆ·ç«¯å…ˆè®¡ç®—ä¸€ä¸‹å¯¹åº” Key çš„ Slotï¼Œä¸€æ · Slot çš„ Key å°±æ”¾åˆ°ä¸€ä¸ªç»„é‡Œè¾¹ï¼Œä¸åŒçš„ï¼Œå°±æ”¾åˆ°ä¸åŒçš„ç»„é‡Œè¾¹ï¼Œç„¶åå¯¹æ¯ä¸ªç»„æ‰§è¡Œ Pipeline çš„æ‰¹å¤„ç†ï¼Œä»–å°±èƒ½ä¸²è¡Œæ‰§è¡Œå„ä¸ªç»„çš„å‘½ä»¤ï¼Œè¿™ç§åšæ³•æ¯”ç¬¬ä¸€ç§æ–¹æ³•è€—æ—¶è¦å°‘ï¼Œä½†æ˜¯ç¼ºç‚¹å‘¢ï¼Œç›¸å¯¹æ¥è¯´å¤æ‚ä¸€ç‚¹ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ¡ˆè¿˜éœ€è¦ä¼˜åŒ–ä¸€ä¸‹</p></li><li><p>ç¬¬ä¸‰ç§æ–¹æ¡ˆï¼šå¹¶è¡Œ Slotï¼Œç›¸è¾ƒäºç¬¬äºŒç§æ–¹æ¡ˆï¼Œåœ¨åˆ†ç»„å®Œæˆåä¸²è¡Œæ‰§è¡Œï¼Œç¬¬ä¸‰ç§æ–¹æ¡ˆï¼Œå°±å˜æˆäº†å¹¶è¡Œæ‰§è¡Œå„ä¸ªå‘½ä»¤ï¼Œæ‰€ä»¥ä»–çš„è€—æ—¶å°±éå¸¸çŸ­ï¼Œä½†æ˜¯å®ç°å‘¢ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚</p></li><li><p>ç¬¬å››ç§ï¼šhash_tagï¼ŒRedis è®¡ç®— key çš„ Slot çš„æ—¶å€™ï¼Œå…¶å®æ˜¯æ ¹æ® Key çš„æœ‰æ•ˆéƒ¨åˆ†æ¥è®¡ç®—çš„ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¸€æ¬¡å¤„ç†æ‰€æœ‰çš„keyï¼Œè¿™ç§æ–¹å¼è€—æ—¶æœ€çŸ­ï¼Œå®ç°ä¹Ÿç®€å•ï¼Œä½†æ˜¯å¦‚æœé€šè¿‡æ“ä½œkeyçš„æœ‰æ•ˆéƒ¨åˆ†ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æ‰€æœ‰çš„keyéƒ½è½åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œäº§ç”Ÿæ•°æ®å€¾æ–œçš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨èä½¿ç”¨ç¬¬ä¸‰ç§æ–¹å¼ã€‚</p></li></ul><br><p><strong>ä¸²è¡ŒåŒ–æ‰§è¡Œä»£ç å®è·µ</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JedisClusterTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JedisCluster jedisCluster;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BeforeEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setUp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // é…ç½®è¿æ¥æ± </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        JedisPoolConfig poolConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JedisPoolConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        poolConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setMaxTotal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        poolConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setMaxIdle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        poolConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setMinIdle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        poolConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setMaxWaitMillis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        HashSet&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; nodes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HashSet&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        nodes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        nodes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7002</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        nodes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7003</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        nodes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        nodes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8002</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        nodes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HostAndPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;192.168.150.101&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8003</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        jedisCluster </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JedisCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(nodes, poolConfig);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> testMSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        jedisCluster.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Jack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;21&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;male&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> testMSet2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HashMap&lt;&gt;(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Jack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;21&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Male&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //å¯¹Mapæ•°æ®è¿›è¡Œåˆ†ç»„ã€‚æ ¹æ®ç›¸åŒçš„slotæ”¾åœ¨ä¸€ä¸ªåˆ†ç»„</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //keyå°±æ˜¯slotï¼Œvalueå°±æ˜¯ä¸€ä¸ªç»„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Entry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;&gt; result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">entrySet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Collectors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">groupingBy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        entry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ClusterSlotHashUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">calculateSlot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //ä¸²è¡Œçš„å»æ‰§è¡Œmsetçš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Entry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] arr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                Map.Entry&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                arr[j] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                arr[j </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            jedisCluster.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(arr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AfterEach</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tearDown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (jedisCluster </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            jedisCluster.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p><strong>Springä»£ç </strong></p><p>Springé›†ç¾¤ç¯å¢ƒä¸‹æ‰¹å¤„ç†ä»£ç </p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Test</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> testMSetInCluster</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; map </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HashMap&lt;&gt;(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Rose&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;21&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Female&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        stringRedisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multiSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(map);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; strings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> stringRedisTemplate.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">opsForValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multiGet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Arrays.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">asList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;age&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sex&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        strings.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(System.out</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">println);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre></div><br><p><strong>åŸç†åˆ†æ</strong></p><p>åœ¨ <code>RedisAdvancedClusterAsyncCommandsImpl</code> ç±»ä¸­ï¼Œé¦–å…ˆæ ¹æ® Slot Hash ç®—å‡ºæ¥ä¸€ä¸ª partitioned çš„ mapï¼Œmap ä¸­çš„ Key å°±æ˜¯ Slotï¼Œè€Œä»–çš„ Value å°±æ˜¯å¯¹åº”çš„å¯¹åº”ç›¸åŒ Slot çš„ Key å¯¹åº”çš„æ•°æ®</p><p>é€šè¿‡ <code>RedisFuture&lt;String&gt; mset = super.mset(op);</code>è¿›è¡Œå¼‚æ­¥çš„æ¶ˆæ¯å‘é€</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RedisFuture</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">K, V</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> map) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">K</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; partitioned </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SlotHash.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">partition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(codec, map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">keySet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (partitioned.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(map);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, RedisFuture&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; executions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HashMap&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Map.Entry&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">K</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; entry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> partitioned.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">entrySet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">K</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">V</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; op </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HashMap&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        entry.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> op.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(k, map.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(k)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        RedisFuture&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; mset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(op);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        executions.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), mset);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MultiNodeExecution.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firstOfAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(executions);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="æœåŠ¡ç«¯ä¼˜åŒ–" tabindex="-1">æœåŠ¡ç«¯ä¼˜åŒ– <a class="header-anchor" href="#æœåŠ¡ç«¯ä¼˜åŒ–" aria-label="Permalink to &quot;æœåŠ¡ç«¯ä¼˜åŒ–&quot;">â€‹</a></h2><h3 id="æŒä¹…åŒ–é…ç½®" tabindex="-1">æŒä¹…åŒ–é…ç½® <a class="header-anchor" href="#æŒä¹…åŒ–é…ç½®" aria-label="Permalink to &quot;æŒä¹…åŒ–é…ç½®&quot;">â€‹</a></h3><p>Redisçš„æŒä¹…åŒ–è™½ç„¶å¯ä»¥ä¿è¯æ•°æ®å®‰å…¨ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥å¾ˆå¤šé¢å¤–çš„å¼€é”€ï¼Œå› æ­¤<strong>æŒä¹…åŒ–è¯·éµå¾ªä¸‹åˆ—å»ºè®®</strong></p><ul><li>ç”¨æ¥åšç¼“å­˜çš„ Redis å®ä¾‹å°½é‡ä¸è¦å¼€å¯æŒä¹…åŒ–åŠŸèƒ½</li><li>å»ºè®®å…³é—­ RDB æŒä¹…åŒ–åŠŸèƒ½ï¼Œä½¿ç”¨ AOF æŒä¹…åŒ–</li><li>åˆ©ç”¨è„šæœ¬å®šæœŸåœ¨ Slave èŠ‚ç‚¹åš RDBï¼Œå®ç°æ•°æ®å¤‡ä»½</li><li>è®¾ç½®åˆç†çš„ rewrite é˜ˆå€¼ï¼Œé¿å…é¢‘ç¹çš„ bgrewrite</li><li>é…ç½® <code>no-appendfsync-on-rewrite = yes</code> ï¼Œç¦æ­¢åœ¨ rewrite æœŸé—´åš AOF ï¼Œé¿å…å›  AOF å¼•èµ·çš„é˜»å¡</li></ul><br><p><strong>éƒ¨ç½²æœ‰å…³å»ºè®®</strong></p><ul><li>Redis å®ä¾‹çš„ç‰©ç†æœºè¦é¢„ç•™è¶³å¤Ÿå†…å­˜ï¼Œåº”å¯¹ fork å’Œ rewrite</li><li>å•ä¸ª Redis å®ä¾‹å†…å­˜ä¸Šé™ä¸è¦å¤ªå¤§ï¼Œä¾‹å¦‚ 4G æˆ– 8Gã€‚å¯ä»¥åŠ å¿« fork çš„é€Ÿåº¦ã€å‡å°‘ä¸»ä»åŒæ­¥ã€æ•°æ®è¿ç§»å‹åŠ›</li><li>ä¸è¦ä¸ CPU å¯†é›†å‹åº”ç”¨éƒ¨ç½²åœ¨ä¸€èµ·</li><li>ä¸è¦ä¸é«˜ç¡¬ç›˜è´Ÿè½½åº”ç”¨ä¸€èµ·éƒ¨ç½²ã€‚ä¾‹å¦‚ï¼šæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—</li></ul><br><p><strong>AOFæµç¨‹å›¾</strong></p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-169355136195430.png" style="zoom:50%;"><br><h3 id="æ…¢æŸ¥è¯¢ä¼˜åŒ–" tabindex="-1">æ…¢æŸ¥è¯¢ä¼˜åŒ– <a class="header-anchor" href="#æ…¢æŸ¥è¯¢ä¼˜åŒ–" aria-label="Permalink to &quot;æ…¢æŸ¥è¯¢ä¼˜åŒ–&quot;">â€‹</a></h3><h4 id="ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢" tabindex="-1">ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢ <a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢" aria-label="Permalink to &quot;ä»€ä¹ˆæ˜¯æ…¢æŸ¥è¯¢&quot;">â€‹</a></h4><p>å¹¶ä¸æ˜¯å¾ˆæ…¢çš„æŸ¥è¯¢æ‰æ˜¯æ…¢æŸ¥è¯¢ï¼Œè€Œæ˜¯ï¼šåœ¨Redisæ‰§è¡Œæ—¶è€—æ—¶è¶…è¿‡æŸä¸ªé˜ˆå€¼çš„å‘½ä»¤ï¼Œç§°ä¸ºæ…¢æŸ¥è¯¢ã€‚</p><p>æ…¢æŸ¥è¯¢çš„å±å®³ï¼šç”±äºRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯å‘å‡ºæŒ‡ä»¤åï¼Œä»–ä»¬éƒ½ä¼šè¿›å…¥åˆ°redisåº•å±‚çš„queueæ¥æ‰§è¡Œï¼Œå¦‚æœæ­¤æ—¶æœ‰ä¸€äº›æ…¢æŸ¥è¯¢çš„æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´å¤§é‡è¯·æ±‚é˜»å¡ï¼Œä»è€Œå¼•èµ·æŠ¥é”™ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è§£å†³æ…¢æŸ¥è¯¢é—®é¢˜ã€‚</p><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-20240315112947276.png" alt="image-20240315112947276" loading="lazy"></p><br><p>æ…¢æŸ¥è¯¢çš„é˜ˆå€¼å¯ä»¥é€šè¿‡é…ç½®æŒ‡å®šï¼š</p><ul><li><code>slowlog-log-slower-than</code>ï¼šæ…¢æŸ¥è¯¢é˜ˆå€¼ï¼Œå•ä½æ˜¯å¾®ç§’ã€‚é»˜è®¤æ˜¯10000ï¼Œå»ºè®®1000</li></ul><br><p>æ…¢æŸ¥è¯¢ä¼šè¢«æ”¾å…¥æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ï¼Œæ—¥å¿—çš„é•¿åº¦æœ‰ä¸Šé™ï¼Œå¯ä»¥é€šè¿‡é…ç½®æŒ‡å®šï¼š</p><ul><li><p><code>slowlog-max-len</code>ï¼šæ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆæœ¬è´¨æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼‰çš„é•¿åº¦ã€‚é»˜è®¤æ˜¯128ï¼Œå»ºè®®1000</p><ul><li>ä¿®æ”¹è¿™ä¸¤ä¸ªé…ç½®å¯ä»¥ä½¿ç”¨ï¼šconfig setå‘½ä»¤</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config get slowlog-max-len</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;slowlog-max-len&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;128&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config set slowlog-max-len </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">127.0.0.1:6379&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config get slowlog-max-len</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;slowlog-max-len&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1000&quot;</span></span></code></pre></div></li></ul><br><h4 id="å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢" tabindex="-1">å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢ <a class="header-anchor" href="#å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢" aria-label="Permalink to &quot;å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢&quot;">â€‹</a></h4><p>çŸ¥é“äº†ä»¥ä¸Šå†…å®¹ä¹‹åï¼Œé‚£ä¹ˆå’±ä»¬å¦‚ä½•å»æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—åˆ—è¡¨å‘¢ï¼š</p><ul><li>slowlog lenï¼šæŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—é•¿åº¦</li><li>slowlog get [n]ï¼šè¯»å–næ¡æ…¢æŸ¥è¯¢æ—¥å¿—</li><li>slowlog resetï¼šæ¸…ç©ºæ…¢æŸ¥è¯¢åˆ—è¡¨</li></ul><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/1653130858066.png" alt="1653130858066" loading="lazy"></p><br><h3 id="å‘½ä»¤åŠå®‰å…¨é…ç½®" tabindex="-1">å‘½ä»¤åŠå®‰å…¨é…ç½® <a class="header-anchor" href="#å‘½ä»¤åŠå®‰å…¨é…ç½®" aria-label="Permalink to &quot;å‘½ä»¤åŠå®‰å…¨é…ç½®&quot;">â€‹</a></h3><p>å®‰å…¨å¯ä»¥è¯´æ˜¯æœåŠ¡å™¨ç«¯ä¸€ä¸ªéå¸¸é‡è¦çš„è¯é¢˜ï¼Œå¦‚æœå®‰å…¨å‡ºç°äº†é—®é¢˜ï¼Œé‚£ä¹ˆä¸€æ—¦è¿™ä¸ªæ¼æ´è¢«ä¸€äº›åäººçŸ¥é“äº†ä¹‹åï¼Œå¹¶ä¸”è¿›è¡Œæ”»å‡»ï¼Œé‚£ä¹ˆè¿™å°±ä¼šç»™å’±ä»¬çš„ç³»ç»Ÿå¸¦æ¥å¾ˆå¤šçš„æŸå¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™èŠ‚è¯¾å°±æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>Redis ä¼šç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œè¿™æ ·å°†ä¼šå°† Redis æœåŠ¡æš´éœ²åˆ°å…¬ç½‘ä¸Šï¼Œè€Œ Redis å¦‚æœæ²¡æœ‰åšèº«ä»½è®¤è¯ï¼Œä¼šå‡ºç°ä¸¥é‡çš„å®‰å…¨æ¼æ´.</p><ul><li>æ¼æ´é‡ç°æ–¹å¼ï¼š<a href="https://cloud.tencent.com/developer/article/1039000" target="_blank" rel="noreferrer">https://cloud.tencent.com/developer/article/1039000</a></li></ul><br><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸éœ€è¦å¯†ç ä¹Ÿèƒ½å¤Ÿç™»å½•å‘¢ï¼Œä¸»è¦æ˜¯ Redis è€ƒè™‘åˆ°æ¯æ¬¡ç™»å½•éƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥ Redis å°±æœ‰ä¸€ç§ ssh å…ç§˜é’¥ç™»å½•çš„æ–¹å¼ï¼Œç”Ÿæˆä¸€å¯¹å…¬é’¥å’Œç§é’¥ï¼Œç§é’¥æ”¾åœ¨æœ¬åœ°ï¼Œå…¬é’¥æ”¾åœ¨ Redis ç«¯ï¼Œå½“æˆ‘ä»¬ç™»å½•æ—¶æœåŠ¡å™¨ï¼Œå†ç™»å½•æ—¶å€™ï¼Œä»–ä¼šå»è§£æå…¬é’¥å’Œç§é’¥ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œåˆ™ä¸éœ€è¦åˆ©ç”¨ Redis çš„ç™»å½•ä¹Ÿèƒ½è®¿é—®ï¼Œè¿™ç§åšæ³•æœ¬èº«ä¹Ÿå¾ˆå¸¸è§ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªå‰æï¼Œå‰æå°±æ˜¯å…¬é’¥å¿…é¡»ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œæ‰è¡Œï¼Œä½†æ˜¯ Redis çš„æ¼æ´åœ¨äºåœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½æŠŠç§˜é’¥é€åˆ° Linux æœåŠ¡å™¨ï¼Œä»è€Œäº§ç”Ÿæ¼æ´ã€‚</p><br><p>æ¼æ´å‡ºç°çš„æ ¸å¿ƒçš„åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>Redis æœªè®¾ç½®å¯†ç </li><li>åˆ©ç”¨äº† Redis çš„config set å‘½ä»¤åŠ¨æ€ä¿®æ”¹ Redis é…ç½®</li><li>ä½¿ç”¨äº† Root è´¦å·æƒé™å¯åŠ¨ Redis</li></ul><p>æ‰€ä»¥ï¼šå¦‚ä½•è§£å†³å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¦‚ä¸‹å‡ ç§æ–¹æ¡ˆ</p><br><p>ä¸ºäº†é¿å…è¿™æ ·çš„æ¼æ´ï¼Œè¿™é‡Œç»™å‡ºä¸€äº›å»ºè®®ï¼š</p><ul><li>Redis ä¸€å®šè¦è®¾ç½®å¯†ç </li><li>ç¦æ­¢çº¿ä¸Šä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼škeysã€flushallã€flushdbã€config setç­‰å‘½ä»¤ã€‚ <ul><li>å¯ä»¥åˆ©ç”¨ rename-command ç¦ç”¨</li></ul></li><li>é…ç½® bindï¼šé™åˆ¶ç½‘å¡ï¼Œç¦æ­¢å¤–ç½‘ç½‘å¡è®¿é—®</li><li>å¼€å¯é˜²ç«å¢™ï¼Œå¹¶ä¸”ä¸è¦ä½¿ç”¨ Root è´¦æˆ·å¯åŠ¨ Redis</li><li>å°½é‡ä¸ä½¿ç”¨é»˜è®¤çš„ç«¯å£</li></ul><br><h3 id="å†…å­˜é…ç½®" tabindex="-1">å†…å­˜é…ç½® <a class="header-anchor" href="#å†…å­˜é…ç½®" aria-label="Permalink to &quot;å†…å­˜é…ç½®&quot;">â€‹</a></h3><p>å½“ Redis å†…å­˜ä¸è¶³æ—¶ï¼Œå¯èƒ½å¯¼è‡´ Key é¢‘ç¹è¢«åˆ é™¤ã€å“åº”æ—¶é—´å˜é•¿ã€QPS ä¸ç¨³å®šç­‰é—®é¢˜ã€‚å½“å†…å­˜ä½¿ç”¨ç‡è¾¾åˆ°90% ä»¥ä¸Šæ—¶å°±éœ€è¦æˆ‘ä»¬è­¦æƒ•ï¼Œå¹¶å¿«é€Ÿå®šä½åˆ°å†…å­˜å ç”¨çš„åŸå› ã€‚</p><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-169355136195431.png" alt="image-169355136195431" loading="lazy"></p><ul><li><strong>æœ‰å…³ç¢ç‰‡é—®é¢˜åˆ†æ</strong>ï¼šRedisåº•å±‚åˆ†é…å¹¶ä¸æ˜¯è¿™ä¸ªkeyæœ‰å¤šå¤§ï¼Œä»–å°±ä¼šåˆ†é…å¤šå¤§ï¼Œè€Œæ˜¯æœ‰ä»–è‡ªå·±çš„åˆ†é…ç­–ç•¥ï¼Œæ¯”å¦‚8,16,20ç­‰ç­‰ï¼Œå‡å®šå½“å‰keyåªéœ€è¦10ä¸ªå­—èŠ‚ï¼Œæ­¤æ—¶åˆ†é…8è‚¯å®šä¸å¤Ÿï¼Œé‚£ä¹ˆä»–å°±ä¼šåˆ†é…16ä¸ªå­—èŠ‚ï¼Œå¤šå‡ºæ¥çš„6ä¸ªå­—èŠ‚å°±ä¸èƒ½è¢«ä½¿ç”¨ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç¢ç‰‡é—®é¢˜</li><li><strong>è¿›ç¨‹å†…å­˜é—®é¢˜åˆ†æ</strong>ï¼šè¿™ç‰‡å†…å­˜ï¼Œé€šå¸¸æˆ‘ä»¬éƒ½å¯ä»¥å¿½ç•¥ä¸è®¡</li><li><strong>ç¼“å†²åŒºå†…å­˜é—®é¢˜åˆ†æ</strong>ï¼šä¸€èˆ¬åŒ…æ‹¬å®¢æˆ·ç«¯ç¼“å†²åŒºã€AOFç¼“å†²åŒºã€å¤åˆ¶ç¼“å†²åŒºç­‰ã€‚å®¢æˆ·ç«¯ç¼“å†²åŒºåˆåŒ…æ‹¬è¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒºä¸¤ç§ã€‚è¿™éƒ¨åˆ†å†…å­˜å ç”¨æ³¢åŠ¨è¾ƒå¤§ï¼Œæ‰€ä»¥è¿™ç‰‡å†…å­˜ä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦é‡ç‚¹åˆ†æçš„å†…å­˜é—®é¢˜ã€‚</li></ul><br><p><strong>æ•°æ®å†…å­˜é—®é¢˜</strong></p><p>äºæ˜¯æˆ‘ä»¬å°±éœ€è¦é€šè¿‡ä¸€äº›å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°Redisç›®å‰çš„å†…å­˜åˆ†é…çŠ¶æ€ï¼š</p><ul><li>info memoryï¼šæŸ¥çœ‹å†…å­˜åˆ†é…çš„æƒ…å†µ</li><li>memory statsï¼šæŸ¥çœ‹keyçš„ä¸»è¦å ç”¨æƒ…å†µ</li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹åˆ°äº†è¿™äº›é…ç½®ï¼Œæœ€å…³é”®çš„ç¼“å­˜åŒºå†…å­˜å¦‚ä½•å®šä½å’Œè§£å†³å‘¢ï¼Ÿ</p><br><p><strong>å†…å­˜ç¼“å­˜åŒºé…ç½®</strong></p><p>å†…å­˜ç¼“å†²åŒºå¸¸è§çš„æœ‰ä¸‰ç§ï¼š</p><ul><li>å¤åˆ¶ç¼“å†²åŒºï¼šä¸»ä»å¤åˆ¶çš„ <code>repl_backlog_buf</code>ï¼Œå¦‚æœå¤ªå°å¯èƒ½å¯¼è‡´é¢‘ç¹çš„å…¨é‡å¤åˆ¶ï¼Œå½±å“æ€§èƒ½ã€‚é€šè¿‡ <code>replbacklog-size</code> æ¥è®¾ç½®ï¼Œé»˜è®¤ 1MB</li><li>AOF ç¼“å†²åŒºï¼šAOF åˆ·ç›˜ä¹‹å‰çš„ç¼“å­˜åŒºåŸŸï¼ŒAOF æ‰§è¡Œ rewrite çš„ç¼“å†²åŒºã€‚æ— æ³•è®¾ç½®å®¹é‡ä¸Šé™</li><li>å®¢æˆ·ç«¯ç¼“å†²åŒºï¼šåˆ†ä¸ºè¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒºï¼Œè¾“å…¥ç¼“å†²åŒºæœ€å¤§ 1G ä¸”ä¸èƒ½è®¾ç½®ã€‚è¾“å‡ºç¼“å†²åŒºå¯ä»¥è®¾ç½®</li></ul><p>ä»¥ä¸Šå¤åˆ¶ç¼“å†²åŒºå’ŒAOFç¼“å†²åŒºä¸ä¼šæœ‰é—®é¢˜ï¼Œæœ€å…³é”®å°±æ˜¯å®¢æˆ·ç«¯ç¼“å†²åŒºçš„é—®é¢˜</p><br><p><strong>å®¢æˆ·ç«¯ç¼“å†²åŒº</strong>ï¼šæŒ‡çš„å°±æ˜¯æˆ‘ä»¬å‘é€å‘½ä»¤æ—¶ï¼Œå®¢æˆ·ç«¯ç”¨æ¥ç¼“å­˜å‘½ä»¤çš„ä¸€ä¸ªç¼“å†²åŒºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‘ Redis è¾“å…¥æ•°æ®çš„è¾“å…¥ç«¯ç¼“å†²åŒºå’Œ Redis å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®çš„å“åº”ç¼“å­˜åŒºï¼Œè¾“å…¥ç¼“å†²åŒºæœ€å¤§ 1G ä¸”ä¸èƒ½è®¾ç½®ï¼Œæ‰€ä»¥è¿™ä¸€å—æˆ‘ä»¬æ ¹æœ¬ä¸ç”¨æ‹…å¿ƒï¼Œå¦‚æœè¶…è¿‡äº†è¿™ä¸ªç©ºé—´ï¼ŒRedis ä¼šç›´æ¥æ–­å¼€ï¼Œå› ä¸ºæœ¬æ¥æ­¤æ—¶æ­¤åˆ»å°±ä»£è¡¨ç€ Redis å¤„ç†ä¸è¿‡æ¥äº†ï¼Œæˆ‘ä»¬éœ€è¦æ‹…å¿ƒçš„å°±æ˜¯è¾“å‡ºç«¯ç¼“å†²åŒº</p><p><img src="https://mugrain.oss-cn-hangzhou.aliyuncs.com/cswiki/image-20240315113715626.png" alt="image-20240315113715626" loading="lazy"></p><p>é»˜è®¤é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Both the hard or the soft limit can be disabled by setting them to zero.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">client-output-buffer-limit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> normal </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">client-output-buffer-limit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> replica </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">256</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mb </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mb </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">client-output-buffer-limit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pubsub </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mb </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">mb </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span></span></code></pre></div><br><p>æˆ‘ä»¬åœ¨ä½¿ç”¨ Redis è¿‡ç¨‹ä¸­ï¼Œå¤„ç†å¤§é‡çš„ big valueï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æˆ‘ä»¬çš„è¾“å‡ºç»“æœè¿‡å¤šï¼Œå¦‚æœè¾“å‡ºç¼“å­˜åŒºè¿‡å¤§ï¼Œä¼šå¯¼è‡´ Redis ç›´æ¥æ–­å¼€ï¼Œè€Œé»˜è®¤é…ç½®çš„æƒ…å†µä¸‹ï¼Œ å…¶å®ä»–æ˜¯æ²¡æœ‰å¤§å°çš„ï¼Œè¿™å°±æ¯”è¾ƒå‘äº†ï¼Œå†…å­˜å¯èƒ½ä¸€ä¸‹å­è¢«å æ»¡ï¼Œä¼šç›´æ¥å¯¼è‡´å’±ä»¬çš„ Redis æ–­å¼€ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ª</p><ul><li>è®¾ç½®ç¼“å†²åŒºå¤§å°ï¼Œé¿å… Redis å†…å­˜æº¢å‡ºå¯¼è‡´æœåŠ¡æ–­å¼€ã€‚</li><li>å¢åŠ æœåŠ¡å¸¦å®½ï¼Œé¿å…æˆ‘ä»¬å‡ºç°å¤§é‡æ•°æ®ä»è€Œç›´æ¥è¶…è¿‡äº† Redis çš„æ‰¿å—èƒ½åŠ›</li></ul><h2 id="é›†ç¾¤æœ€ä½³å®è·µ" tabindex="-1">é›†ç¾¤æœ€ä½³å®è·µ <a class="header-anchor" href="#é›†ç¾¤æœ€ä½³å®è·µ" aria-label="Permalink to &quot;é›†ç¾¤æœ€ä½³å®è·µ&quot;">â€‹</a></h2><p>é›†ç¾¤è™½ç„¶å…·å¤‡é«˜å¯ç”¨ç‰¹æ€§ï¼Œèƒ½å®ç°è‡ªåŠ¨æ•…éšœæ¢å¤ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ä¸å½“ï¼Œä¹Ÿä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>é›†ç¾¤å®Œæ•´æ€§é—®é¢˜</li><li>é›†ç¾¤å¸¦å®½é—®é¢˜</li><li>æ•°æ®å€¾æ–œé—®é¢˜</li><li>å®¢æˆ·ç«¯æ€§èƒ½é—®é¢˜</li><li>å‘½ä»¤çš„é›†ç¾¤å…¼å®¹æ€§é—®é¢˜</li><li>Lua å’Œäº‹åŠ¡é—®é¢˜</li></ul><br><p><strong>é—®é¢˜1ï¼šåœ¨Redisçš„é»˜è®¤é…ç½®ä¸­ï¼Œå¦‚æœå‘ç°ä»»æ„ä¸€ä¸ªæ’æ§½ä¸å¯ç”¨ï¼Œåˆ™æ•´ä¸ªé›†ç¾¤éƒ½ä¼šåœæ­¢å¯¹å¤–æœåŠ¡ï¼š</strong></p><p>å¤§å®¶å¯ä»¥è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæœ‰å‡ ä¸ª Slot ä¸èƒ½ä½¿ç”¨ï¼Œé‚£ä¹ˆæ­¤æ—¶æ•´ä¸ªé›†ç¾¤éƒ½ä¸èƒ½ç”¨äº†ï¼Œæˆ‘ä»¬åœ¨å¼€å‘ä¸­ï¼Œå…¶å®æœ€é‡è¦çš„æ˜¯å¯ç”¨æ€§ï¼Œæ‰€ä»¥éœ€è¦æŠŠå¦‚ä¸‹é…ç½®ä¿®æ”¹æˆ noï¼Œå³æœ‰ Slot ä¸èƒ½ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬çš„ Redis é›†ç¾¤è¿˜æ˜¯å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># By default Redis Cluster nodes stop accepting queries if they detect there</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># is at least a hash slot uncovered (no available node is serving it).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This way if the cluster is partially down (for example a range of hash slots</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># are no longer covered) all the cluster becomes, eventually, unavailable.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># It automatically returns available as soon as all the slots are covered again.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># However sometimes you want the subset of the cluster which is working,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># to continue to accept queries for the part of the key space that is still</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># covered. In order to do so, just set the cluster-require-full-coverage</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># option to no.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cluster-require-full-coverage yes</span></span></code></pre></div><br><p><strong>é—®é¢˜2ï¼šé›†ç¾¤å¸¦å®½é—®é¢˜</strong></p><p>é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´ä¼šä¸æ–­çš„äº’ç›¸ Ping æ¥ç¡®å®šé›†ç¾¤ä¸­å…¶å®ƒèŠ‚ç‚¹çš„çŠ¶æ€ã€‚æ¯æ¬¡Pingæºå¸¦çš„ä¿¡æ¯è‡³å°‘åŒ…æ‹¬ï¼š</p><ul><li>æ’æ§½ä¿¡æ¯</li><li>é›†ç¾¤çŠ¶æ€ä¿¡æ¯</li></ul><p>é›†ç¾¤ä¸­èŠ‚ç‚¹è¶Šå¤šï¼Œé›†ç¾¤çŠ¶æ€ä¿¡æ¯æ•°æ®é‡ä¹Ÿè¶Šå¤§ï¼Œ10 ä¸ªèŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯å¯èƒ½è¾¾åˆ° 1KBï¼Œæ­¤æ—¶æ¯æ¬¡é›†ç¾¤äº’é€šéœ€è¦çš„å¸¦å®½ä¼šéå¸¸é«˜ï¼Œè¿™æ ·ä¼šå¯¼è‡´é›†ç¾¤ä¸­å¤§é‡çš„å¸¦å®½éƒ½ä¼šè¢« Ping ä¿¡æ¯æ‰€å ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¯æ€•çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»è§£å†³è¿™æ ·çš„é—®é¢˜</p><p><strong>è§£å†³é€”å¾„ï¼š</strong></p><ul><li>é¿å…å¤§é›†ç¾¤ï¼Œé›†ç¾¤èŠ‚ç‚¹æ•°ä¸è¦å¤ªå¤šï¼Œæœ€å¥½å°‘äº1,000ï¼Œå¦‚æœä¸šåŠ¡åºå¤§ï¼Œåˆ™å»ºç«‹å¤šä¸ªé›†ç¾¤ã€‚</li><li>é¿å…åœ¨å•ä¸ªç‰©ç†æœºä¸­è¿è¡Œå¤ªå¤š Redis å®ä¾‹</li><li>é…ç½®åˆé€‚çš„ <code>cluster-node-timeou</code>t å€¼</li></ul><br><p><strong>é—®é¢˜3ï¼šå‘½ä»¤çš„é›†ç¾¤å…¼å®¹æ€§é—®é¢˜</strong></p><p>æœ‰å…³è¿™ä¸ªé—®é¢˜å’±ä»¬å·²ç»æ¢è®¨è¿‡äº†ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æ‰¹å¤„ç†çš„å‘½ä»¤æ—¶ï¼ŒRedis è¦æ±‚æˆ‘ä»¬çš„ Key å¿…é¡»è½åœ¨ç›¸åŒçš„ Slotä¸Šï¼Œç„¶åå¤§é‡çš„ Key åŒæ—¶æ“ä½œæ—¶ï¼Œæ˜¯æ— æ³•å®Œæˆçš„ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å¿…é¡»è¦å¯¹è¿™æ ·çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿™äº›æ–¹æ¡ˆæˆ‘ä»¬ä¹‹å‰å·²ç»æ¢è®¨è¿‡äº†ï¼Œæ‰€ä»¥ä¸å†è¿™ä¸ªåœ°æ–¹èµ˜è¿°äº†ã€‚</p><br><p><strong>é—®é¢˜4ï¼šLua å’Œäº‹åŠ¡çš„é—®é¢˜</strong></p><p>Lua å’Œäº‹åŠ¡éƒ½æ˜¯è¦ä¿è¯åŸå­æ€§é—®é¢˜ï¼Œå¦‚æœä½ çš„ Key ä¸åœ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ˜¯æ— æ³•ä¿è¯ Lua çš„æ‰§è¡Œå’Œäº‹åŠ¡çš„ç‰¹æ€§çš„ï¼Œæ‰€ä»¥åœ¨é›†ç¾¤æ¨¡å¼æ˜¯æ²¡æœ‰åŠæ³•æ‰§è¡Œ Lua å’Œäº‹åŠ¡çš„</p><br><p><strong>é‚£æˆ‘ä»¬åˆ°åº•æ˜¯é›†ç¾¤è¿˜æ˜¯ä¸»ä»</strong></p><p>å•ä½“Redisï¼ˆä¸»ä»Redisï¼‰å·²ç»èƒ½è¾¾åˆ°ä¸‡çº§åˆ«çš„QPSï¼Œå¹¶ä¸”ä¹Ÿå…·å¤‡å¾ˆå¼ºçš„é«˜å¯ç”¨ç‰¹æ€§ã€‚å¦‚æœä¸»ä»èƒ½æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯åœ¨ä¸‡ä¸å¾—å·²çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä¸æ­å»ºRedisé›†ç¾¤</p>`,220);function C(s,B,A,D,m,b){const k=n("ArticleMetadata"),t=n("ClientOnly");return h(),e("div",null,[c,E(t,null,{default:r(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(h(),y(k,{key:0,article:s.$frontmatter},null,8,["article"])):F("",!0)]}),_:1}),u])}const f=p(o,[["render",C]]);export{v as __pageData,f as default};
