import{_ as m,E as h,c as g,J as r,w as n,m as t,a as d,V as _,o as l,b as p,e as c}from"./chunks/framework.syB9hai_.js";const u="/cswiki/assets/20230725163100101.b9ZFzsjV.jpg",k="/cswiki/assets/20230725163059433.xVbT20-J.jpg",f="/cswiki/assets/20230725163059891.m1rnf6n4.jpg",y="/cswiki/assets/20230725163059380.9Bhb7K0f.jpg",b="/cswiki/assets/20230725163100530.AUZwcOZQ.jpg",C="/cswiki/assets/20230725163059537.Xh6ObAQs.jpg",N="/cswiki/assets/20230725163059419.DPozDdTr.jpg",R=JSON.parse('{"title":"0.背景说明","description":"","frontmatter":{},"headers":[],"relativePath":"src/project/college/00-内网穿透.md","filePath":"src/project/college/00-内网穿透.md","lastUpdated":1730648753000}'),T={name:"src/project/college/00-内网穿透.md"},v=t("h1",{id:"_0-背景说明",tabindex:"-1"},[d("0.背景说明 "),t("a",{class:"header-anchor",href:"#_0-背景说明","aria-label":'Permalink to "0.背景说明"'},"​")],-1),w=t("p",null,"项目中的支付模块在于第三方支付服务通信时，为了确保支付、退款等业务能及时得到业务执行结果，支持两种业务模式：",-1),V=t("ul",null,[t("li",null,"基于第三方的回调通知"),t("li",null,"主动轮询")],-1),j=t("p",null,"以上两种模式默认都已开启，但是回调模式依赖于内网穿透，需要大家配置内网穿透信息。当然，如果不配置也可以，此时走轮询模式，查询支付或退款结果可能会有一定的延时（一般延时不超过30秒）。",-1),M=t("p",null,"接下来，我们介绍一下项目中的内网穿透配置方式。",-1),z=t("h1",{id:"_1-注册并开通隧道",tabindex:"-1"},[d("1.注册并开通隧道 "),t("a",{class:"header-anchor",href:"#_1-注册并开通隧道","aria-label":'Permalink to "1.注册并开通隧道"'},"​")],-1),B=_('<p>项目中采用的内网穿透工具是Cpolar，完全免费：</p><p><a href="https://www.cpolar.com/" target="_blank" rel="noreferrer">https://www.cpolar.com/</a></p><p>大家首先登陆该网站，并注册一个账号：</p><p><img src="'+u+'" alt="img" loading="lazy"></p><p>注册成功后，会跳转到套餐购买页面：</p><p><img src="'+k+'" alt="img" loading="lazy"></p><p>选择免费套装，然后确定：</p><p><img src="'+f+'" alt="img" loading="lazy"></p><p>然后，会跳转到控制台页面：</p><p><img src="'+y+'" alt="img" loading="lazy"></p><p><strong>注意</strong>，第三步的<strong>authtoken</strong>是你的账户唯一标示，非常重要。<strong>其它几步大家无需操作</strong>，我已经在虚拟机中给大家安装好了cpolar.</p><h1 id="_2-配置cpolar" tabindex="-1">2.配置cpolar <a class="header-anchor" href="#_2-配置cpolar" aria-label="Permalink to &quot;2.配置cpolar&quot;">​</a></h1>',12),F=_(`<p>在我给大家提供的虚拟机环境中，已经安装好了cpolar，大家只需要完成token授权即可。</p><p>在虚拟机中执行命令：</p><div class="language-Bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 注意，将后面的token换成你的真实token</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cpolar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> authtoken MGYZYzBmMjTtM2E30C00MZjO....xxxx</span></span></code></pre></div><p>然后配置cpolar开启自启：</p><div class="language-Bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemcmtl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable cpolar</span></span></code></pre></div><p>接着，启动cpolar</p><div class="language-Bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start cpolar</span></span></code></pre></div><p>然后，访问Cpolar的控制台页面：<a href="http://192.168.150.101:9500" target="_blank" rel="noreferrer">http://192.168.150.101:9500</a>，会进入一个登录页面：</p><p><img src="`+b+'" alt="img" loading="lazy"></p><p>使用你自己的Cpolar账号登录即可。</p><p>然后进入控制台， 访问《状态》-《在线隧道状态》，即可看到我提前配置好的隧道以及对应的域名：</p><p><img src="https://b11et3un53m.feishu.cn/space/api/box/stream/download/asynccode/?code=NjQ3OWMxMDQ0YTczMmQ3YzI5MjNkZWFjMDZkMjUyNTRfVFVsN1ZaRjVqeWZhc0g3MzlSWkFKaTUzVkxIVWtQbmNfVG9rZW46QTB0UGJ5VmZob01NRVl4NkpiQ2NVRkNCbjJiXzE2OTAyNzM4NTc6MTY5MDI3NzQ1N19WNA" alt="img" loading="lazy"></p><p>上图中，<a href="https://20517c0c.r2.vip.cpolar.xn--cnhttp-qv7iqyz7xjyem5m2pmyqas62ip14k" target="_blank" rel="noreferrer">https://20517c0c.r2.vip.cpolar.cn这个域名就映射到了http</a>😕/localhost:10010，也就是本地的网关微服务。也就是说，以后我们访问这个域名就是在访问网关了，只要加上对应的接口路径，即可实现对微服务的访问。</p><p>注意，由于我们是免费的隧道，所以每次重启该域名都会变化。</p><h1 id="_3-设置穿透域名" tabindex="-1">3.设置穿透域名 <a class="header-anchor" href="#_3-设置穿透域名" aria-label="Permalink to &quot;3.设置穿透域名&quot;">​</a></h1>',15),A=t("p",null,"最后，我们还需要把内网穿透域名配置到支付微服务的配置参数（notif-url）中。由于我们是免费的隧道，所以每次重启该域名都会变化，都需要重新配置支付的参数。",-1),$=t("p",null,"为了便于大家配置，我将这个配置交给了Nacos管理：",-1),P=t("p",null,[t("img",{src:C,alt:"img",loading:"lazy"})],-1),Z=t("p",null,"点击编辑，进入配置：",-1),D=t("p",null,[t("img",{src:N,alt:"img",loading:"lazy"})],-1),E=t("p",null,"以后，每次重启虚拟机，都应该去cpolar的控制台查看最新的内网穿透域名，然后修改到这里。",-1);function Q(a,S,q,O,x,I){const i=h("ArticleMetadata"),o=h("ClientOnly");return l(),g("div",null,[v,r(o,null,{default:n(()=>{var e,s;return[(((e=a.$frontmatter)==null?void 0:e.aside)??!0)&&(((s=a.$frontmatter)==null?void 0:s.showArticleMetadata)??!0)?(l(),p(i,{key:0,article:a.$frontmatter},null,8,["article"])):c("",!0)]}),_:1}),w,V,j,M,z,r(o,null,{default:n(()=>{var e,s;return[(((e=a.$frontmatter)==null?void 0:e.aside)??!0)&&(((s=a.$frontmatter)==null?void 0:s.showArticleMetadata)??!0)?(l(),p(i,{key:0,article:a.$frontmatter},null,8,["article"])):c("",!0)]}),_:1}),B,r(o,null,{default:n(()=>{var e,s;return[(((e=a.$frontmatter)==null?void 0:e.aside)??!0)&&(((s=a.$frontmatter)==null?void 0:s.showArticleMetadata)??!0)?(l(),p(i,{key:0,article:a.$frontmatter},null,8,["article"])):c("",!0)]}),_:1}),F,r(o,null,{default:n(()=>{var e,s;return[(((e=a.$frontmatter)==null?void 0:e.aside)??!0)&&(((s=a.$frontmatter)==null?void 0:s.showArticleMetadata)??!0)?(l(),p(i,{key:0,article:a.$frontmatter},null,8,["article"])):c("",!0)]}),_:1}),A,$,P,Z,D,E])}const J=m(T,[["render",Q]]);export{R as __pageData,J as default};
