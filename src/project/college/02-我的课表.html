<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Day02-我的课表 | 知识小册子</title>
    <meta name="description" content="搭建个人的知识体系,一个好的知识体系和学习方法会让自己事半功倍">
    <meta name="generator" content="VitePress v1.0.0-rc.40">
    <link rel="preload stylesheet" href="/cswiki/assets/style.1gwXlvdp.css" as="style">
    
    <script type="module" src="/cswiki/assets/app.WLQlbd9D.js"></script>
    <link rel="preload" href="/cswiki/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/cswiki/assets/chunks/framework.syB9hai_.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/theme.20YxxJsd.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/c4Diagram-0115bee6._zoJIrPO.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/flowDiagram-786cd8ff.2XSavh6y.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/flowDiagram-v2-65161881.9mn_XxN6.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/erDiagram-de1b0455.sFlzW-wR.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/gitGraphDiagram-5269e1d6.Eh2d9BSy.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/ganttDiagram-f2041c70.RGQZdl7k.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/infoDiagram-3fa6ea12.7VqiecOI.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/pieDiagram-6d9582b9.glIRZuxf.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/quadrantDiagram-a1c81500.XkhiuIFI.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/requirementDiagram-3256a2fe.LpBfSDaT.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/sequenceDiagram-25152a15.ml6mRFut.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/classDiagram-819d3ad4.ghDVw7Dr.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/classDiagram-v2-c4607319.Fbm2nzpr.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/stateDiagram-693ac5fb.q1YlWMWJ.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/stateDiagram-v2-8f2bb0da.Wequ5Bhb.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/journeyDiagram-9f355b40.aD9Nz7qb.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/flowchart-elk-definition-3f2388fe.gBq0724t.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/timeline-definition-0c903a0d.91gedurf.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/mindmap-definition-35a1e92c.Bh8kxdFG.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/sankeyDiagram-ebb0d63f.bLK9ZrQ0.js">
    <link rel="modulepreload" href="/cswiki/assets/chunks/virtual_mermaid-config.AhCe4kHV.js">
    <link rel="modulepreload" href="/cswiki/assets/src_project_college_02-我的课表.md.afiNyrhG.lean.js">
    <link rel="icon" href="/favicon.ico">
    <meta name="author" content="mousse">
    <meta name="keywords" content="慕斯的知识小册子">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="theme-color" content="#3c8772">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:title" content="知识小册子">
    <meta property="og:description" content="搭建个人的知识体系,一个好的知识体系和学习方法会让自己事半功倍">
    <meta property="og:site_name" content="知识小册子">
    <meta property="og:image" content="/logo.svg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-83d41759><!--[--><!--]--><!--[--><span tabindex="-1" data-v-40879362></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-40879362> Skip to content </a><!--]--><!----><header class="VPNav" data-v-83d41759 data-v-0b69728b><div class="VPNavBar has-sidebar" data-v-0b69728b data-v-0ec8604f><div class="wrapper" data-v-0ec8604f><div class="container" data-v-0ec8604f><div class="title" data-v-0ec8604f><div class="VPNavBarTitle has-sidebar" data-v-0ec8604f data-v-e5f52478><a class="title" href="/cswiki/" data-v-e5f52478><!--[--><!--]--><!--[--><img class="VPImage logo" src="/cswiki/logo.svg" alt data-v-22195471><!--]--><!--[-->知识小册子<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-0ec8604f><div class="content-body" data-v-0ec8604f><!--[--><!--]--><div class="VPNavBarSearch search" data-v-0ec8604f><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-0ec8604f data-v-6ba9474d><span id="main-nav-aria-label" class="visually-hidden" data-v-6ba9474d>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/cswiki/" tabindex="0" data-v-6ba9474d data-v-5c7cab49><!--[--><span data-v-5c7cab49>📌 技术博客</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-6ba9474d data-v-8e60bb69><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-8e60bb69><span class="text" data-v-8e60bb69><!----><span data-v-8e60bb69>📝 基础知识</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-8e60bb69><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-8e60bb69><div class="VPMenu" data-v-8e60bb69 data-v-32b6ed9e><div class="items" data-v-32b6ed9e><!--[--><!--[--><div class="VPMenuGroup" data-v-32b6ed9e data-v-8b276347><!----><!--[--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/base/java/index" data-v-d8ac4ebe><!--[-->☕️ Java基础<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/base/jvm/index" data-v-d8ac4ebe><!--[-->🖥 JVM入门<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/base/juc/index" data-v-d8ac4ebe><!--[-->🔥 并发编程<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/base/netty/index" data-v-d8ac4ebe><!--[-->🌐 网络编程<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-32b6ed9e data-v-8b276347><!----><!--[--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/base/alg/index" data-v-d8ac4ebe><!--[-->🧩 数据结构<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/base/gof/index" data-v-d8ac4ebe><!--[-->📝 设计模式<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-32b6ed9e data-v-8b276347><!----><!--[--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/base/mysql/index" data-v-d8ac4ebe><!--[-->📊 数据库<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/base/linux/index" data-v-d8ac4ebe><!--[-->👨‍💻 服务器<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/base/spring/index" data-v-d8ac4ebe><!--[-->🌱 Spring<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/base/cloud/index" data-v-d8ac4ebe><!--[-->☁️ 微服务<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-6ba9474d data-v-8e60bb69><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-8e60bb69><span class="text" data-v-8e60bb69><!----><span data-v-8e60bb69>🛠️ 项目实战</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-8e60bb69><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-8e60bb69><div class="VPMenu" data-v-8e60bb69 data-v-32b6ed9e><div class="items" data-v-32b6ed9e><!--[--><!--[--><div class="VPMenuGroup" data-v-32b6ed9e data-v-8b276347><!----><!--[--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/project/redis/index" data-v-d8ac4ebe><!--[-->🔖️ 黑马点评<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/project/topnews/index" data-v-d8ac4ebe><!--[-->📰 黑马头条<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-32b6ed9e data-v-8b276347><!----><!--[--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/project/college/index" data-v-d8ac4ebe><!--[-->📚 天机学堂<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/project/express/index" data-v-d8ac4ebe><!--[-->🚚 神领物流<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/project/shop/index" data-v-d8ac4ebe><!--[-->🛒 谷粒商城<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-32b6ed9e data-v-8b276347><!----><!--[--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/project/takeout/index" data-v-d8ac4ebe><!--[-->🍜 谷粒外卖<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/project/health/index" data-v-d8ac4ebe><!--[-->🏄 谷粒健康<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/project/social/index" data-v-d8ac4ebe><!--[-->🧑‍🤝‍🧑 谷粒交友<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/project/rent/index" data-v-d8ac4ebe><!--[-->🏠 谷粒租房<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-8b276347 data-v-d8ac4ebe><a class="VPLink link" href="/cswiki/src/project/financial/index" data-v-d8ac4ebe><!--[-->📈 谷粒金融<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/cswiki/src/base/summarize/index" tabindex="0" data-v-6ba9474d data-v-5c7cab49><!--[--><span data-v-5c7cab49>💼 面试宝典</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-0ec8604f data-v-f8a5715e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-f8a5715e data-v-a55d2cd3 data-v-43317611><span class="check" data-v-43317611><span class="icon" data-v-43317611><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a55d2cd3><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a55d2cd3><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-0ec8604f data-v-9b69f4c1 data-v-0ed08415><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Charles7c/charles7c.github.io" aria-label="github" target="_blank" rel="noopener" data-v-0ed08415 data-v-c77ec717><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://gitee.com/Charles7c/charles7c" aria-label target="_blank" rel="noopener" data-v-0ed08415 data-v-c77ec717><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>码云</title><path d="M11.984 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.016 0zm6.09 5.333c.328 0 .593.266.592.593v1.482a.594.594 0 0 1-.593.592H9.777c-.982 0-1.778.796-1.778 1.778v5.63c0 .327.266.592.593.592h5.63c.982 0 1.778-.796 1.778-1.778v-.296a.593.593 0 0 0-.592-.593h-4.15a.592.592 0 0 1-.592-.592v-1.482a.593.593 0 0 1 .593-.592h6.815c.327 0 .593.265.593.592v3.408a4 4 0 0 1-4 4H5.926a.593.593 0 0 1-.593-.593V9.778a4.444 4.444 0 0 1 4.445-4.444h8.296Z"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-0ec8604f data-v-b9614353 data-v-8e60bb69><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8e60bb69><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-8e60bb69><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-8e60bb69><div class="VPMenu" data-v-8e60bb69 data-v-32b6ed9e><!----><!--[--><!--[--><!----><div class="group" data-v-b9614353><div class="item appearance" data-v-b9614353><p class="label" data-v-b9614353>切换日光/暗黑模式</p><div class="appearance-action" data-v-b9614353><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-b9614353 data-v-a55d2cd3 data-v-43317611><span class="check" data-v-43317611><span class="icon" data-v-43317611><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a55d2cd3><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a55d2cd3><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-b9614353><div class="item social-links" data-v-b9614353><div class="VPSocialLinks social-links-list" data-v-b9614353 data-v-0ed08415><!--[--><a class="VPSocialLink no-icon" href="https://github.com/Charles7c/charles7c.github.io" aria-label="github" target="_blank" rel="noopener" data-v-0ed08415 data-v-c77ec717><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://gitee.com/Charles7c/charles7c" aria-label target="_blank" rel="noopener" data-v-0ed08415 data-v-c77ec717><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>码云</title><path d="M11.984 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.016 0zm6.09 5.333c.328 0 .593.266.592.593v1.482a.594.594 0 0 1-.593.592H9.777c-.982 0-1.778.796-1.778 1.778v5.63c0 .327.266.592.593.592h5.63c.982 0 1.778-.796 1.778-1.778v-.296a.593.593 0 0 0-.592-.593h-4.15a.592.592 0 0 1-.592-.592v-1.482a.593.593 0 0 1 .593-.592h6.815c.327 0 .593.265.593.592v3.408a4 4 0 0 1-4 4H5.926a.593.593 0 0 1-.593-.593V9.778a4.444 4.444 0 0 1 4.445-4.444h8.296Z"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-0ec8604f data-v-a6fa7f77><span class="container" data-v-a6fa7f77><span class="top" data-v-a6fa7f77></span><span class="middle" data-v-a6fa7f77></span><span class="bottom" data-v-a6fa7f77></span></span></button></div></div></div></div><div class="divider" data-v-0ec8604f><div class="divider-line" data-v-0ec8604f></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-83d41759 data-v-f4225638><div class="container" data-v-f4225638><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-f4225638><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-f4225638><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-f4225638>文章</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-f4225638 data-v-560fa4a6><button data-v-560fa4a6>返回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-83d41759 data-v-93fad516><div class="curtain" data-v-93fad516></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-93fad516><span class="visually-hidden" id="sidebar-aria-label" data-v-93fad516> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-93fad516><section class="VPSidebarItem level-0 collapsible has-active" data-v-93fad516 data-v-d1e013f8><div class="item" role="button" tabindex="0" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><h2 class="text" data-v-d1e013f8>天机学堂</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-d1e013f8><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-d1e013f8><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-d1e013f8><!--[--><section class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" tabindex="0" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/01-%E5%88%9D%E8%AF%86%E9%A1%B9%E7%9B%AE" data-v-d1e013f8><!--[--><h3 class="text" data-v-d1e013f8>01-初识项目</h3><!--]--></a><!----></div><div class="items" data-v-d1e013f8><!--[--><div class="VPSidebarItem level-2 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/00-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AF%BC%E5%85%A5" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>虚拟机导入</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/00-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E7%BD%B2" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>自定义部署</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/00-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>内网穿透</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/02-%E6%88%91%E7%9A%84%E8%AF%BE%E8%A1%A8" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>02-我的课表</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/03-%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>03-学习计划</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/04-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>04-学习记录</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/05-%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>05-问答系统</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/06-%E7%82%B9%E8%B5%9E%E7%B3%BB%E7%BB%9F" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>06-点赞系统</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/07-%E7%A7%AF%E5%88%86%E7%B3%BB%E7%BB%9F" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>07-积分系统</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/08-%E6%8E%92%E8%A1%8C%E6%A6%9C%E5%8A%9F%E8%83%BD" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>08-排行榜功能</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/09-%E4%BC%98%E6%83%A0%E5%88%B8%E7%AE%A1%E7%90%86" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>09-优惠券管理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/10-%E9%A2%86%E5%8F%96%E4%BC%98%E6%83%A0%E5%88%B8" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>10-领取优惠券</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/11-%E4%BC%98%E6%83%A0%E5%88%B8%E4%BC%98%E5%8C%96" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>11-优惠券优化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/12-%E4%BC%98%E6%83%A0%E5%88%B8%E4%BD%BF%E7%94%A8" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>12-优惠券使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/13-%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>13-项目部署</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d1e013f8 data-v-d1e013f8><div class="item" data-v-d1e013f8><div class="indicator" data-v-d1e013f8></div><a class="VPLink link link" href="/cswiki/src/project/college/13-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98" data-v-d1e013f8><!--[--><p class="text" data-v-d1e013f8>14-项目实战</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-83d41759 data-v-7f2b530e><div class="VPDoc has-sidebar has-aside" data-v-7f2b530e data-v-7b451c74><!--[--><!--]--><div class="container" data-v-7b451c74><div class="aside" data-v-7b451c74><div class="aside-curtain" data-v-7b451c74></div><div class="aside-container" data-v-7b451c74><div class="aside-content" data-v-7b451c74><div class="VPDocAside" data-v-7b451c74 data-v-ae5a1c99><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-ae5a1c99 data-v-34b44e06><div class="content" data-v-34b44e06><div class="outline-marker" data-v-34b44e06></div><div class="outline-title" role="heading" aria-level="2" data-v-34b44e06>章节导航</div><nav aria-labelledby="doc-outline-aria-label" data-v-34b44e06><span class="visually-hidden" id="doc-outline-aria-label" data-v-34b44e06> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-34b44e06 data-v-ff6ff475><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-ae5a1c99></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-7b451c74><div class="content-container" data-v-7b451c74><!--[--><!--]--><main class="main" data-v-7b451c74><div style="position:relative;" class="vp-doc _cswiki_src_project_college_02-%E6%88%91%E7%9A%84%E8%AF%BE%E8%A1%A8" data-v-7b451c74><div><h1 id="day02-我的课表" tabindex="-1">Day02-我的课表 <a class="header-anchor" href="#day02-我的课表" aria-label="Permalink to &quot;Day02-我的课表&quot;">​</a></h1><!----><p>在昨天的学习中，我们解决了一个简单的BUG。并且演示了整个项目的核心业务流程。现在，你对项目有了基本的了解，是时候动手开发一些业务功能了。</p><br><p><strong>场景</strong>是这样的：</p><p>你进入公司以后，组长给你分配了一些简单的BUG修复功能，帮助你熟悉了整个项目。接下来你们小组接收了一个正式的开发任务：<strong>开发天机学堂项目的学习辅助相关功能</strong>。</p><p>不要小看这部分功能，作为一个在线教育项目，学习是核心。而怎样让学员有一个好的学习体验，持续有动力的学习，就显得非常关键。我们要实现的学习辅助功能，就是要起到激励、促进学员、帮助学员学习的功能，非常重要。</p><br><p>那么从哪里入手呢？</p><p>我们来回顾一下，在演示项目业务流程时，我们发现搜索课程、报名课程等流程都已经完成开发了。并且在《个人中心-我的订单》页面可以看到我们下单报名的课程：</p><p><img src="/cswiki/assets/20230725151652178.0A2idVIo.jpg" alt="img" loading="lazy"></p><p>然而，在我的课程页面中，却看不到这些课程：</p><p><img src="/cswiki/assets/20230725151651880.8ODTNMgS.jpg" alt="img" loading="lazy"></p><p>看不到课程自然就无法学习。所以今天我们要完成的任务就是开发学习中心的《我的课程表》相关接口，让学员看到课程，然后才可以学习课程。</p><br><p>但是，很多同学进入公司以后，接手一个任务，根本毫无头绪，不知道从何做起。事实上，接口开发是有一些固定套路的。</p><p>企业实际开发中，一般的流程是这样的：</p><p><img src="/cswiki/assets/20230725151652199.FsLZn7G1.jpg" alt="img" loading="lazy"></p><p>需要强调的一点是，开发中最重要的环节其实是前两步：</p><ul><li>原型分析、接口设计</li><li>数据库设计</li></ul><br><p>只要前两步分析完成，功能开发就比较简单了。</p><br><p>那为什么要先设计接口呢？原因有两点：</p><ul><li>第一：目前企业开发的模式往往是前后端分离，前后端并行开发。前端开发需要调用后端接口，后端需要开发接口返回数据给前端，要想并行开发，就必须有一套接口标准，前后端基于接口完成开发。</li><li>第二：设计接口的过程就是分析业务的过程，弄清楚了业务的细节，更有助于我们设计数据库结构，开发接口功能。</li></ul><p>因此，我们将遵循企业开发的流程，先分析原型、设计接口，再设计数据库结构，最后再开发接口功能。</p><br><p>通过今天的学习，我们要达成的目标如下：</p><ul><li>完成我的课程表相关功能</li><li>学会阅读产品原型，分析需求</li><li>能根据需求设计接口</li><li>能根据需求设计数据库表</li><li>学会跨微服务的业务开发</li></ul><h2 id="接口设计" tabindex="-1">接口设计 <a class="header-anchor" href="#接口设计" aria-label="Permalink to &quot;接口设计&quot;">​</a></h2><p>天机学堂是一个开发中的项目，前期的需求分析已经完成，并且产品经理也设计出了产品原型，地址：</p><p>天机学堂-管理后台：<a href="https://lanhuapp.com/link/#/invite?sid=qx03viNU" target="_blank" rel="noreferrer">https://lanhuapp.com/link/#/invite?sid=qx03viNU</a> 密码: Ssml</p><p>天机学堂-用户端：<a href="https://lanhuapp.com/link/#/invite?sid=qx0Fy3fa" target="_blank" rel="noreferrer">https://lanhuapp.com/link/#/invite?sid=qx0Fy3fa</a> 密码: ZsP3</p><p>我们可以基于产品原型来分析业务。</p><br><h3 id="分析业务流程" tabindex="-1">分析业务流程 <a class="header-anchor" href="#分析业务流程" aria-label="Permalink to &quot;分析业务流程&quot;">​</a></h3><p>在用户的《个人中心》，有一个《我的课程》列表页，如图：</p><p><img src="/cswiki/assets/20230725151651924.6lHRzgmh.jpg" alt="img" loading="lazy"></p><p>那么这些课程是从何而来的，原型的页面说明中有告诉我们：</p><p><img src="/cswiki/assets/20230725151651937.Bmrlyn1l.jpg" alt="img" loading="lazy"></p><p>从这里可以看出，凡是<strong>购买过的课程，都应该加入到课程列表</strong>中。</p><p>需要注意的是，刚刚加入课表的课程处于未学习状态，这个时候学员可以创建一个学习计划，规划后期的学习节奏：</p><p><img src="/cswiki/assets/20230725151652140.M74Vsho1.jpg" alt="img" loading="lazy"></p><p>所谓的学习计划，就是规划自己的学习频率：</p><p><img src="/cswiki/assets/20230725151652428.8g3xxRFF.jpg" alt="img" loading="lazy"></p><p>一旦有了计划，系统就可以统计学习进度，并且提示用户，督促用户抓紧时间学习：</p><p><img src="/cswiki/assets/20230725151652293.OwQBitiU.jpg" alt="img" loading="lazy"></p><p>当然，在学习的过程中，课程的状态会不断发生变化：</p><div class="tip custom-block"><p class="custom-block-title">🔖 页面开发规则：已购课程状态变化</p><ul><li>未学习，已购买课程还未开始学习，可以开始学习</li><li>已学习，已购买课程已开始学习，展示学习进度，可以继续学习</li><li>已学完，已购买课程已经学完，可以重新学习</li><li>已失效，已购买课程已过期，不可继续学习，只能删除课程操作</li></ul><p>由上述跟课程表有关的内容，我们可以推测出《课程表》的业务流转过程是这样的：</p></div><br><p><img src="/cswiki/assets/image-20240219092513360.1APyy68O.png" alt="image-20240219092513360" loading="lazy"></p><p>在今天的任务中，我们先完成《课程表》相关功能，《学习计划》暂放一边。</p><br><h3 id="接口统计" tabindex="-1">接口统计 <a class="header-anchor" href="#接口统计" aria-label="Permalink to &quot;接口统计&quot;">​</a></h3><p>我们来梳理一下在整个过程中学员可能要做哪些事情，这些事情将来就可能是我们要实现的服务端接口。梳理的方式就是查看原型图，分析哪里可能产生用户交互行为。</p><br><h4 id="加入课表" tabindex="-1">加入课表 <a class="header-anchor" href="#加入课表" aria-label="Permalink to &quot;加入课表&quot;">​</a></h4><p>首先，用户支付完成后，需要将购买的课程加入课表：</p><p><img src="/cswiki/assets/20230725151652411.zg7Cw3f2.jpg" alt="img" loading="lazy"></p><p>而支付成功后，交易服务会基于MQ通知的方式，通知学习服务来执行加入课表的动作。因此，我们要实现的第一个接口就是：</p><div class="warning custom-block"><p class="custom-block-title">✅ 支付或报名课程后，监听到MQ通知，将课程加入课表。</p></div><br><h4 id="分页查询课表" tabindex="-1">分页查询课表 <a class="header-anchor" href="#分页查询课表" aria-label="Permalink to &quot;分页查询课表&quot;">​</a></h4><p>在加入课表以后，用户就可以在个人中心查看到这些课程：</p><p><img src="/cswiki/assets/20230725151652692.L6H5m-ou.jpg" alt="img" loading="lazy"></p><p>因此，这里就需要第二个接口：</p><div class="warning custom-block"><p class="custom-block-title">✅ 分页查询我的课表</p></div><p>当然，在这个页面大家还能看到跟<strong>学习计划</strong>有关的按钮，不过本节课我们暂时不讨论学习计划的相关功能实现。</p><br><p>另外，当课程学完后，可以选择删除课程：</p><p><img src="/cswiki/assets/image-20240219092631213.OdK4UNMT.png" alt="image-20240219092631213" loading="lazy"></p><p>所以，还要有删除课程的接口：</p><div class="warning custom-block"><p class="custom-block-title">✅ 删除指定课程</p></div><p>除此以外，如果用户退款，也应该删除课表中的课程，这里同样是通过MQ通知来实现：</p><div class="warning custom-block"><p class="custom-block-title">✅ 退款后，监听到MQ通知，删除指定课程</p></div><br><h4 id="查询学习进度" tabindex="-1">查询学习进度 <a class="header-anchor" href="#查询学习进度" aria-label="Permalink to &quot;查询学习进度&quot;">​</a></h4><p>在个人中心，我的课表页面，还能看到用户最近的学习进度：</p><p><img src="/cswiki/assets/20230725151652844.U4xexZMJ.jpg" alt="img" loading="lazy"></p><div class="warning custom-block"><p class="custom-block-title">✅ 这里就包含两个接口：</p><ol><li>查询最近正在学习的课程</li><li>查询学习计划的进度（学习计划相关，暂不实现）</li></ol></div><br><h4 id="查询指定课程学习状态" tabindex="-1">查询指定课程学习状态 <a class="header-anchor" href="#查询指定课程学习状态" aria-label="Permalink to &quot;查询指定课程学习状态&quot;">​</a></h4><p>还有，在课程详情页面，如果当前课程已经购买，也要展示出课程的学习进度：</p><p><img src="/cswiki/assets/20230725151652678.Jg34Y7eg.jpg" alt="img" loading="lazy"></p><p>因此，这里还需要一个接口：</p><div class="warning custom-block"><p class="custom-block-title">✅ 根据id查询指定课程的学习状态</p></div><br><h4 id="内部访问接口" tabindex="-1">内部访问接口 <a class="header-anchor" href="#内部访问接口" aria-label="Permalink to &quot;内部访问接口&quot;">​</a></h4><p>除了页面原型中看到的接口以外，其它微服务也对<code>tj-learning</code>服务有数据需求，并且也定义了一些需要我们实现的Feign接口。</p><p>在天机学堂的项目中，所有Feign接口都定义在了<code>tj-api</code>模块下，<code>learning</code>服务的接口定义在<code>com.tianji.api.client.learning</code>模块下：</p><p><img src="/cswiki/assets/20230725151654000.J4r7vbU6.jpg" alt="img" loading="lazy"></p><div class="warning custom-block"><p class="custom-block-title">✅ 这里包含两个接口：</p><ol><li>统计某课程的报名人数：后台管理的某些地方需要知道课程的报名人数</li><li>校验当前用户是否报名了指定课程：用户学习课程的前提是报名了课程，某些业务中需要做校验</li></ol></div><br><h4 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h4><p>综上，与我的课表有关的接口有：</p><table><thead><tr><th style="text-align:center;"><strong>编号</strong></th><th style="text-align:center;"><strong>接口简述</strong></th><th style="text-align:center;"><strong>请求方式</strong></th><th style="text-align:center;"><strong>请求路径</strong></th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">支付或报名课程后，立刻加入课表</td><td style="text-align:center;">MQ通知</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">分页查询我的课表</td><td style="text-align:center;">GET</td><td style="text-align:center;">/lessons/page</td></tr><tr><td style="text-align:center;">3</td><td style="text-align:center;">查询我最近正在学习的课程</td><td style="text-align:center;">GET</td><td style="text-align:center;">/lessons/now</td></tr><tr courseId=""><td style="text-align:center;">4</td><td style="text-align:center;">根据id查询指定课程的学习状态</td><td style="text-align:center;">GET</td><td style="text-align:center;">/lessons/</td></tr><tr courseId=""><td style="text-align:center;">5</td><td style="text-align:center;">删除课表中的某课程</td><td style="text-align:center;">DELETE</td><td style="text-align:center;">/lessons/</td></tr><tr><td style="text-align:center;">6</td><td style="text-align:center;">退款后，立刻移除课表中的课程</td><td style="text-align:center;">MQ通知</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">7</td><td style="text-align:center;">校验指定课程是否是课表中的有效课程（Feign接口）</td><td style="text-align:center;">GET</td><td style="text-align:center;">/lessons/{courseId}/valid</td></tr><tr><td style="text-align:center;">8</td><td style="text-align:center;">统计课程学习人数（Feign接口）</td><td style="text-align:center;">GET</td><td style="text-align:center;">/lessons/{courseId}/count</td></tr></tbody></table><p>那么接下来，我们就一起来分析、设计、实现这些接口吧。</p><br><h3 id="接口分析设计" tabindex="-1">接口分析设计 <a class="header-anchor" href="#接口分析设计" aria-label="Permalink to &quot;接口分析设计&quot;">​</a></h3><p>那么问题来了，我们该如何分析、设计一个接口呢？</p><br><h4 id="接口分析和设计的一般方法" tabindex="-1">接口分析和设计的一般方法 <a class="header-anchor" href="#接口分析和设计的一般方法" aria-label="Permalink to &quot;接口分析和设计的一般方法&quot;">​</a></h4><p>企业开发中往往会通过一些工具来设计API接口，比如比较常见的一款API接口工具：YAPI</p><p><a href="http://yapi.smart-xwork.cn/" target="_blank" rel="noreferrer">http://yapi.smart-xwork.cn/</a></p><p>我们先来看一下这个工具的接口设计页面，它分成三大部分：</p><ul><li>基本设置</li><li>请求参数设置</li><li>返回数据设置</li></ul><br><p>首先是基本设置：</p><p><img src="/cswiki/assets/20230725151653026.enJWwUbA.jpg" alt="img" loading="lazy"></p><p>在这里要填写的是某个接口的基本信息，例如接口名字、分类（或者叫分组）、状态等。但其中最重要的就是接口的路径。路径中需要填写的核心有两部分：</p><ul><li>请求方式：也就是http请求的方式，本例中是GET</li><li>请求路径：也就是请求的资源路径，本例中是/users</li></ul><p>知道了这些信息，前端就知道该<strong>向哪里发送请求了</strong>。</p><br><p>然后是当前接口的请求参数设置：</p><p><img src="/cswiki/assets/20230725151653133.-97aAsqC.jpg" alt="img" loading="lazy"></p><p>这里主要描述查询参数的基本信息，包括：</p><ul><li>参数名称</li><li>参数是否必须</li><li>参数示例</li><li>参数描述</li></ul><p>由于这里是查询用户集合，请求方式是GET，因此查询参数就是普通的QUERY参数，也就是路径后的<code>?</code></p><p>拼接参数。如果是POST或者PUT请求，这里还可以传递更复杂的参数格式，比如FORM表单、JSON等</p><p>知道了这些，前端就知道<strong>发送请求时，要携带哪些参数</strong>了。</p><br><p>最后一部分就是返回数据设置：</p><p><img src="/cswiki/assets/20230725151653182.NyN2jQQ7.jpg" alt="img" loading="lazy"></p><p>这里就定义了返回的详细信息：</p><ul><li>字段名称</li><li>字段类型</li><li>字段示例</li></ul><p>知道了这些信息，前端就知道<strong>渲染时可以使用的字段</strong>了。</p><br><p>综上所述，接口设计的核心要素包括：</p><ul><li>请求方式</li><li>请求路径</li><li>请求参数格式</li><li>返回值格式</li></ul><br><p>知道了上述信息，前端就知道该向哪里发请求、请求要携带哪些参数、请求可以得到什么结果。而后端也能根据这些信息定义Controller接口、知道接口方式和路径、方法的参数、方法的返回值格式了。</p><br><p>但问题来了，上述要素我们该如何得知呢？</p><br><p>一般来说，可以按照下面的思路来设计：</p><ul><li><strong>请求方式</strong>和<strong>请求路径</strong>：这一部分只要遵循Restful风格即可</li><li><strong>请求参数</strong>和<strong>返回值格式</strong>：结合页面原型和需求，与前端、后端、产品的同事共同协商决定。</li></ul><br><div class="tip custom-block"><p class="custom-block-title">🔖 提示</p><p>这里比较复杂的就是参数和返回值，在分析的时候切忌自己臆想，<strong>不确定的地方一定要跟产品经理</strong>反复确认，最好邮件确认，避免以后扯皮。</p><p>然后与前端协商，或者跟调用你接口的后端同事协商。看页面渲染、其它服务需要哪些数据，而我们要查询这些数据需要哪些参数，最终确定接口的参数和返回值格式。</p><p>注意，上述过程不是一蹴而就的，很有可能会经过多次调整，这是非常正常的现象，核心思想就是<strong>一定要多沟通，多确认，不要自己任意妄为</strong>。</p></div><br><p>由于教学需要，我们的前端全部都已经开发完成，无法沟通协商来修改了。因此我们重点是根据页面原型来分析参数和返回值需要的字段。</p><p>具体到字段的名字，我会告诉大家，大家按照我给出的字段来设计即可（因为前端字段名称都已经固定）。</p><br><h4 id="分页查询我的课表" tabindex="-1">分页查询我的课表 <a class="header-anchor" href="#分页查询我的课表" aria-label="Permalink to &quot;分页查询我的课表&quot;">​</a></h4><p>按照Restful风格，查询请求应该使用<code>GET</code>方式。</p><br><p>请求路径一般是资源名称，比如这里资源是课表，所以资源名可以使用<code>lessons</code>，同时这里是分页查询，可以在路径后跟一个<code>/page</code>，代表分页查询</p><br><p>请求参数，因为是分页查询，首先肯定要包含分页参数，一般有两个：</p><ul><li>pageNo：页码</li><li>pageSize：每页大小</li></ul><p>同时还要看页面是否有其它过滤条件，查看原型：</p><p><img src="/cswiki/assets/20230725151653146.VyKgH-Oq.jpg" alt="img" loading="lazy"></p><p>可以发现，这里只有两个排序条件，没有过滤条件，因此加上两个排序字段即可：</p><ul><li>sortBy：排序方式</li><li>isAsc：是否升序</li></ul><br><p>而返回值则复杂一些，需要结合页面需要展示的信息来看：</p><p><img src="/cswiki/assets/20230725151653466.RTFVLjdt.jpg" alt="img" loading="lazy"></p><p>肉眼可见的字段就包含：</p><ul><li>课程名称</li><li>课程加入课表时间</li><li>课程有效期结束时间</li><li>课程状态</li><li>课程已学习小节数</li><li>课程总小节数</li><li>课程是否创建了学习计划</li></ul><br><p>还有一些字段是页面中没有的，但是可以从功能需要中推测出来，例如：</p><ul><li>课程id：因为我们点击卡片，需要跳转到对应课程页面，必须知道课程id</li><li>课程封面：页面渲染时为了美观，一定会展示一个课程的封面图片</li><li>学习计划频率：当用户点击修改学习计划时，需要回显目前的学习计划频率</li><li>课表id，当前课程在课表中的对应id，当用户点击继续学习，或创建集合，需要根据课表来操作</li></ul><br><p>综上，最终的接口信息如下：</p><p><img src="/cswiki/assets/image-20240219110206700.szTkeX_a.png" alt="image-20240219110206700" loading="lazy"></p><p>后续所有的接口设计都可以参考这种思路来做。</p><br><p>与这个接口对应的，我们需要定义一下几个实体：</p><ul><li>统一的分页请求Query实体</li><li>统一的分页结果DTO实体</li><li>课表分页VO实体</li></ul><p>由于分页请求、分页结果比较常见，我们提前在tj-common模块定义好了。</p><br><p>其中，统一分页请求实体，称为PageQuery：</p><p><img src="/cswiki/assets/20230725151655449.Mu51-kPg.jpg" alt="img" loading="lazy"></p><p>统一分页结果实体，称为PageDTO：</p><p><img src="/cswiki/assets/20230725151655124.kjRaVNHl.jpg" alt="img" loading="lazy"></p><p>最后，返回结果中的课表VO实体，在课前资料已经提供给大家了：</p><p><img src="/cswiki/assets/20230725151653374.Gl9WgWLK.jpg" alt="img" loading="lazy"></p><br><h4 id="添加课程到课表" tabindex="-1">添加课程到课表 <a class="header-anchor" href="#添加课程到课表" aria-label="Permalink to &quot;添加课程到课表&quot;">​</a></h4><p>当用户支付完成或者报名免费课程后，应该立刻将课程加入到课表中。交易服务会通过MQ通知学习服务，我们需要查看交易服务的源码，查看MQ通知的消息格式，来确定监听消息的格式。</p><br><p>我们以免费报名课程为例来看：</p><p>在<code>trade-service</code>的<code>OrderController</code>中，有一个报名免费课程的接口：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;免费课立刻报名接口&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PostMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/freeCourse/{courseId}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PlaceOrderResultVO </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enrolledFreeCourse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;免费课程id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PathVariable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;courseId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) Long courseId) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> orderService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enrolledFreeCourse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(courseId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>可以看到这里调用了<code>OrderService</code>的<code>enrolledFreeCourse()</code>方法：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PlaceOrderResultVO </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">enrolledFreeCourse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Long courseId) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Long userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UserContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1.查询课程信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; cIds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">singletonList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(courseId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CourseSimpleInfoDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; courseInfos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getOnShelfCourse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cIds);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(courseInfos)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 课程不存在</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BizIllegalException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(TradeErrorInfo.COURSE_NOT_EXISTS);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CourseSimpleInfoDTO courseInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> courseInfos.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">courseInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getFree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 非免费课程，直接报错</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BizIllegalException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(TradeErrorInfo.COURSE_NOT_FREE);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.创建订单</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Order order </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Order</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.1.基本信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setTotalAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setDiscountAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRealAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(OrderStatus.ENROLLED.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setFinishTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(OrderStatus.ENROLLED.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getProgressName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.2.订单id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Long orderId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IdWorker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(order);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(orderId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.订单详情</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    OrderDetail detail </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> packageOrderDetail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(courseInfo, order);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4.写入数据库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    saveOrderAndDetails</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(order, CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">singletonList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(detail));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 5.发送MQ消息，通知报名成功</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rabbitMqHelper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            MqConstants.Exchange.ORDER_EXCHANGE,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            MqConstants.Key.ORDER_PAY_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            OrderBasicDTO.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orderId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(orderId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">courseIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cIds).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 6.返回vo</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PlaceOrderResultVO.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orderId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(orderId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">payAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>其中，通知报名成功的逻辑是这部分：</p><p><img src="/cswiki/assets/20230725151654004.AS4O8py1.jpg" alt="img" loading="lazy"></p><p>由此，我们可以得知发送消息的Exchange、RoutingKey，以及消息体。消息体的格式是OrderBasicDTO，包含四个字段：</p><ul><li>orderId：订单id</li><li>userId：下单的用户id</li><li>courseIds：购买的课程id集合</li><li>finishTime：支付完成时间</li></ul><p>因此，在学习服务，我们需要编写的消息监听接口规范如下：</p><p><img src="/cswiki/assets/image-20240219111305320.BvsANlQp.png" alt="image-20240219111305320" loading="lazy"></p><p>其中的请求参数实体，由于是与交易服务公用的数据传递实体，也就是DTO，因此已经提前定义到了<code>tj-api</code>模块下的DTO包了。</p><p><img src="/cswiki/assets/20230725151655547.54ggDyss.jpg" alt="img" loading="lazy"></p><br><h4 id="查询正在学习的课程" tabindex="-1">查询正在学习的课程 <a class="header-anchor" href="#查询正在学习的课程" aria-label="Permalink to &quot;查询正在学习的课程&quot;">​</a></h4><p>页面原型中，有两个地方需要查看正在学习的课程。</p><p>第一个，在个人中心-我的课程：</p><p><img src="/cswiki/assets/20230725151654175.VKsXujQn.jpg" alt="img" loading="lazy"></p><p>另一个，在已登录情况下，首页的悬浮窗中：</p><p><img src="/cswiki/assets/20230725151654716.V8QzHpLA.jpg" alt="img" loading="lazy"></p><br><p>与之前类似，我们需要定义出：请求方式、请求路径、请求参数、返回值类型等信息。</p><ul><li>请求方式：Http请求，GET</li><li>请求路径：<code>/lessons/now</code>，代表的含义是正在学习的课表</li><li>请求参数：查询的是当前用户的课表，所以参数就是当前登录用户，无需传递，我们可以从登录凭证获取</li><li>返回值：返回的数据在页面就能看到： <ul><li>课程id</li><li>课程名称</li><li>课程封面</li><li>课程有效期（起始-终止）</li><li>课程总课时数</li><li>课程已学习课时数</li><li>课表中总课程数</li><li>正在学习的小节名称</li><li>正在学习的小节序号（让用户知道自己在学第几节）</li></ul></li></ul><p>因此，最终的接口规则如下：</p><p><img src="/cswiki/assets/image-20240219113449728.eblRA8Ww.png" alt="image-20240219113449728" loading="lazy"></p><p>可以看到返回值结果与分页查询的课表VO基本类似，因此这里可以复用LearningLessonVO实体，但是需要添加几个字段：</p><ul><li>courseAmount</li><li>latestSectionName</li><li>latestSectionIndex</li></ul><br><h4 id="根据id查询某课程学习状态" tabindex="-1">根据id查询某课程学习状态 <a class="header-anchor" href="#根据id查询某课程学习状态" aria-label="Permalink to &quot;根据id查询某课程学习状态&quot;">​</a></h4><p>在课程详情页，课程展示有两种不同形式：</p><ul><li>对于未购买的课程：展示为立刻购买或加入购物车</li></ul><p><img src="/cswiki/assets/20230725151654637.AdAc5lDv.jpg" alt="img" loading="lazy"></p><ul><li>对于已经购买的课程：展示为马上学习，并且显示学习的进度、有效期</li></ul><p><img src="/cswiki/assets/20230725151654339.mWkRjTH5.jpg" alt="img" loading="lazy"></p><p>因此，进入详情页以后，前端需要查询用户的课表中是否有该课程，如果有该课程则需要返回课程的学习进度、课程有效期等信息。</p><p>按照Restful风格，请求方式是GET，请求路径是资源名称lessons，不过这里要根据id查询，因此可以利用路径占位符传参，最终路径就变为：<code>/lessons/{courseId}</code></p><p>返回的字段如页面所示，包含：</p><ul><li>课程id</li><li>课程状态</li><li>已学习小节数</li><li>加入课表时间、有效期结束时间</li></ul><p>因此，最终的接口设计如下：</p><p><img src="/cswiki/assets/image-20240219113631869.d6-6Usd-.png" alt="image-20240219113631869" loading="lazy"></p><p>这里的返回值VO结构在之前定义的LearningLessonVO中都包含了，因此可以直接复用该VO，不再重复定义。</p><br><p>其它几个接口的设计就留给大家作为练习了。</p><h2 id="数据结构" tabindex="-1">数据结构 <a class="header-anchor" href="#数据结构" aria-label="Permalink to &quot;数据结构&quot;">​</a></h2><p>基于之前的分析，我们已经知道了业务基本流程、用户的交互行为。而用户的这些行为必然产生数据，需要保存到数据库中。这些数据在保存时必须有设定好的结构，这样才能支撑我们完成各种接口功能。</p><p>接下来，我们就分析一下课表相关的业务对应的数据结构。</p><br><h3 id="字段分析" tabindex="-1">字段分析 <a class="header-anchor" href="#字段分析" aria-label="Permalink to &quot;字段分析&quot;">​</a></h3><p>课表要记录的是用户的学习状态，所谓学习状态就是记录<strong>谁</strong>在学习<strong>哪个课程</strong>，<strong>学习的进度</strong>如何。</p><ul><li>其中，谁在学习哪个课程，就是一种关系。也就是说课表就是用户和课程的中间关系表。因此一定要包含三个字段： <ul><li>userId：用户id，也就是<strong>谁</strong></li><li>courseId：课程id，也就是学的<strong>课程</strong></li><li>id：唯一主键</li></ul></li><li>而学习进度，则是一些附加的功能字段，页面需要哪些功能就添加哪些字段即可： <ul><li><p>status：课程学习状态。0-未学习，1-学习中，2-已学完，3-已过期</p><p><img src="/cswiki/assets/20230725151654891.c81bzVZX.jpg" alt="img" loading="lazy"></p></li><li><p>planStatus：学习计划状态，0-没有计划，1-计划进行中</p></li><li><p>weekFreq：计划的学习频率</p><p><img src="/cswiki/assets/20230725151655549.vMz2Lv7H.jpg" alt="img" loading="lazy"></p></li><li><p>learnedSections：已学习小节数量，注意，课程总小节数、课程名称、封面等可由课程id查询得出，无需重复记录</p><p><img src="/cswiki/assets/20230725151655116.5FoOsn65.jpg" alt="img" loading="lazy"></p></li><li><p>latestSectionId：最近一次学习的小节id，方便根据id查询最近学习的课程正在学第几节</p><p><img src="/cswiki/assets/20230725151655425.wL8qRKyu.jpg" alt="img" loading="lazy"></p></li><li><p>latestLearnTime：最近一次学习时间，用于分页查询的排序：</p><p><img src="/cswiki/assets/20230725151655381.8Ndg9-if.jpg" alt="img" loading="lazy"></p></li><li><p>createTime和expireTime，也就是课程加入时间和过期时间</p><p><img src="/cswiki/assets/20230725151655546.9kQBV1gq.jpg" alt="img" loading="lazy"></p></li></ul></li></ul><br><h3 id="er图" tabindex="-1">ER图 <a class="header-anchor" href="#er图" aria-label="Permalink to &quot;ER图&quot;">​</a></h3><p>我们可以结合原型图中包含的信息来画一个ER图，分析我的课表包含的信息：</p><p><img src="/cswiki/assets/image-20240219113834467.tWOOOHZd.png" alt="image-20240219113834467" loading="lazy"></p><br><h3 id="表结构" tabindex="-1">表结构 <a class="header-anchor" href="#表结构" aria-label="Permalink to &quot;表结构&quot;">​</a></h3><p>基于ER图，课表对应的数据库结构应该是这样的：</p><div class="language-SQL vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> learning_lesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bigint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;主键&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  user_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bigint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;学员id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  course_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bigint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;课程id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> tinyint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;课程状态，0-未学习，1-学习中，2-已学完，3-已失效&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  week_freq </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">tinyint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;每周学习频率，每周3天，每天2节，则频率为6&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plan_status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">tinyint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;学习计划状态，0-没有计划，1-计划进行中&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  learned_sections </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;已学习小节数量&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  latest_section_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">bigint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;最近一次学习的小节id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  latest_learn_time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">datetime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;最近一次学习的时间&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  create_time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">datetime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;创建时间&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  expire_time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">datetime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;过期时间&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  update_time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">datetime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;更新时间&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  UNIQUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx_user_id (user_id,course_id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USING</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BTREE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ENGINE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">InnoDB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CHARSET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8mb4 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8mb4_0900_ai_ci COMMENT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;学生课表&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>我们要创建一个名为<code>tj_learning</code>的database，并且执行上面的SQL语句，创建<code>learning_lesson</code>表：</p><p><img src="/cswiki/assets/20230725151655730.DCGrQ2Ri.jpg" alt="img" loading="lazy"></p><p>当然，课前资料也提供了这张表对应的SQL语句：</p><p><img src="/cswiki/assets/20230725151655593.0mSOKMH5.jpg" alt="img" loading="lazy"></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- --------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 主机:                           192.168.150.101</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 服务器版本:                        8.0.29 - MySQL Community Server - GPL</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 服务器操作系统:                      Linux</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- HeidiSQL 版本:                  12.2.0.6576</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- --------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40101 SET NAMES utf8 */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!50503 SET NAMES utf8mb4 */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40103 SET TIME_ZONE=&#39;+00:00&#39; */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#39;NO_AUTO_VALUE_ON_ZERO&#39; */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 导出  表 tj_learning.learning_lesson 结构</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `learning_lesson`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `learning_lesson`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> bigint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;主键&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `user_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> bigint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;学员id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `course_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> bigint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;课程id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `status`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> tinyint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;课程状态，0-未学习，1-学习中，2-已学完，3-已失效&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `week_freq`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> tinyint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;每周学习频率，例如每周学习6小节，则频率为6&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `plan_status`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> tinyint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;学习计划状态，0-没有计划，1-计划进行中&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `learned_sections`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;已学习小节数量&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `latest_section_id`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> bigint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;最近一次学习的小节id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `latest_learn_time`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> datetime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;最近一次学习的时间&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `create_time`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> datetime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;创建时间&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `expire_time`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> datetime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;过期时间&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  `update_time`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> datetime</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP COMMENT </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;更新时间&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USING</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BTREE,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  UNIQUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> KEY</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `idx_user_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`user_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`course_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USING</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BTREE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) ENGINE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">InnoDB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CHARSET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8mb4 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COLLATE=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8mb4_0900_ai_ci ROW_FORMAT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=DYNAMIC</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMMENT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;学生课程表&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 正在导出表  tj_learning.learning_lesson 的数据：~4 rows (大约)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DELETE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `learning_lesson`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> `learning_lesson`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`user_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`course_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`status`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`week_freq`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`plan_status`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`learned_sections`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`latest_section_id`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`latest_learn_time`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`create_time`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`expire_time`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`update_time`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUES</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-04-11 22:34:45&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2022-08-05 20:02:50&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-08-05 20:02:29&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-04-19 10:29:29&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">31</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-04-19 11:42:50&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2022-08-06 15:16:48&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-08-06 15:16:37&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-04-19 11:42:50&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1585170299127607297</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">129</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-04-11 22:37:05&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2022-12-05 23:00:29&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-10-26 15:14:54&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-04-11 22:37:05&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1601061367207464961</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1549025085494521857</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1550383240983875589</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-04-11 16:34:44&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2022-12-09 11:49:11&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-12-09 11:49:11&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-04-11 16:34:43&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40103 SET TIME_ZONE=IFNULL(@OLD_TIME_ZONE, &#39;system&#39;) */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, &#39;&#39;) */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40014 SET FOREIGN_KEY_CHECKS=IFNULL(@OLD_FOREIGN_KEY_CHECKS, 1) */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*!40111 SET SQL_NOTES=IFNULL(@OLD_SQL_NOTES, 1) */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>LearningLessonVO</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.vo;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.enums.LessonStatus;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.enums.PlanStatus;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io.swagger.annotations.ApiModel;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io.swagger.annotations.ApiModelProperty;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lombok.Data;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.time.LocalDateTime;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;课程表信息&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LearningLessonVO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;主键lessonId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Long id;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;课程id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Long courseId;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;课程名称&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String courseName;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;课程封面&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String courseCoverUrl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;课程章节数量&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer sections;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;课程状态，0-未学习，1-学习中，2-已学完，3-已失效&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LessonStatus status;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;总已学习章节数&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer learnedSections;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;总已报名课程数&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer courseAmount;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;课程购买时间&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime createTime;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;课程过期时间，如果为null代表课程永久有效&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime expireTime;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;习计划状态，0-没有计划，1-计划进行中&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PlanStatus planStatus;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;计划的学习频率&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer weekFreq;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;最近学习的小节名&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String latestSectionName;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;最近学习的小节编号&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer latestSectionIndex;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>LessonStatus</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.enums;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.annotation.EnumValue;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.fasterxml.jackson.annotation.JsonCreator;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.fasterxml.jackson.annotation.JsonValue;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.enums.BaseEnum;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lombok.Getter;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Getter</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LessonStatus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseEnum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NOT_BEGIN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;未学习&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    LEARNING</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;学习中&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    FINISHED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;已学完&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    EXPIRED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;已过期&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">JsonValue</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EnumValue</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String desc;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    LessonStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">desc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.desc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> desc;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">JsonCreator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonCreator.Mode.DELEGATING)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LessonStatus </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Integer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (LessonStatus status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equalsValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(value)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>PlanStatus</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.enums;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.annotation.EnumValue;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.fasterxml.jackson.annotation.JsonCreator;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.fasterxml.jackson.annotation.JsonValue;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.enums.BaseEnum;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lombok.Getter;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Getter</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PlanStatus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseEnum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NO_PLAN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;没有计划&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    PLAN_RUNNING</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;计划进行中&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">JsonValue</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EnumValue</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String desc;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    PlanStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">desc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.desc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> desc;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">JsonCreator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonCreator.Mode.DELEGATING)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PlanStatus </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Integer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (PlanStatus status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equalsValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(value)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h3 id="创建分支" tabindex="-1">创建分支 <a class="header-anchor" href="#创建分支" aria-label="Permalink to &quot;创建分支&quot;">​</a></h3><p>一般开发新功能都需要创建一个feature类型分支，不能在DEV分支直接开发，因此这里我们新建一个功能分支。我们在项目目录中打开terminal控制台，输入命令：</p><div class="language-Shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkout -b feature-lessons</span></span></code></pre></div><p>发现整个项目都切换到了新的功能分支：</p><p><img src="/cswiki/assets/20230725151656373.tjxZFcKr.jpg" alt="img" loading="lazy"></p><br><h3 id="代码生成" tabindex="-1">代码生成 <a class="header-anchor" href="#代码生成" aria-label="Permalink to &quot;代码生成&quot;">​</a></h3><p>在天机学堂项目中，我们使用的是Mybatis作为持久层框架，并且引入了MybatisPlus来简化开发。因此，在创建据库以后，就需要创建对应的实体类、mapper、service等。</p><p>这些代码格式固定，编写起来又比较费时。好在IDEA中提供了一个MP插件，可以生成这些重复代码：</p><p><img src="/cswiki/assets/20230725151655870.YhUdQtmy.jpg" alt="img" loading="lazy"></p><p>安装完成以后，我们先配置一下数据库地址：</p><p><img src="/cswiki/assets/20230725151657602.-gg9fxGw.jpg" alt="img" loading="lazy"></p><p>特别注意，数据库名不要填写错误：</p><p><img src="/cswiki/assets/20230725151656024.4NOT3fe5.jpg" alt="img" loading="lazy"></p><div class="language-properties vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">jdbc:mysql://192.168.150.101:3306/tj_learning?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">useSSL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=false&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">useUnicode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=true&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">characterEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=UTF-8&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">serverTimezone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=UTC</span></span></code></pre></div><p>然后配置代码自动生成的设置：</p><p><img src="/cswiki/assets/20230725151656910.qSzjVRA4.jpg" alt="img" loading="lazy"></p><p>严格按照下图的模式去设置（图片放大后更清晰），不要填错项目名称和包名称：</p><p><img src="/cswiki/assets/20230725151656389.nI49xSDa.jpg" alt="img" loading="lazy"></p><p>最后，点击<code>code generatro</code>按钮，即可生成代码：</p><p><img src="/cswiki/assets/20230725151656796.ypIZApvN.jpg" alt="img" loading="lazy"></p><p>要注意的是，默认情况下PO的主键ID策略是自增长，而天机学堂项目默认希望采用雪花算法作为ID，因此这里需要对<code>LearningLesson</code>的ID策略做修改：</p><p><img src="/cswiki/assets/20230725151657123.qb-7xwyd.jpg" alt="img" loading="lazy"></p><p>除此之外，我们还要按照Restful风格，对请求路径做修改：</p><p><img src="/cswiki/assets/20230725151657255.x1l4fG2o.jpg" alt="img" loading="lazy"></p><br><h3 id="状态枚举" tabindex="-1">状态枚举 <a class="header-anchor" href="#状态枚举" aria-label="Permalink to &quot;状态枚举&quot;">​</a></h3><p>在数据结构中，课表是有学习状态的，学习计划也有状态：</p><p><img src="/cswiki/assets/20230725151657239.UrOvpkBW.jpg" alt="img" loading="lazy"></p><p>这些状态如果每次编码都手写很容易写错，因此一般都会定义出枚举：</p><p><img src="/cswiki/assets/20230725151656962.raiLc4bV.jpg" alt="img" loading="lazy"></p><p>在课前资料中已经提供给大家了：</p><p><img src="/cswiki/assets/20230725151657404.0yLWohhY.jpg" alt="img" loading="lazy"></p><p>首先是课表状态<code>LessonStatus</code>：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Getter</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LessonStatus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseEnum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NOT_BEGIN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;未学习&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    LEARNING</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;学习中&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    FINISHED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;已学完&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    EXPIRED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;已过期&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">JsonValue</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 指定JSON序列化枚举时用的值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EnumValue</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 指定与数据库交互时要做类型转换的值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String desc;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    LessonStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">desc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.desc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> desc;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">JsonCreator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonCreator.Mode.DELEGATING) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 指定JSON反序列化时使用的函数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LessonStatus </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Integer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (LessonStatus status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equalsValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(value)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>然后是学习计划的状态<code>PlanStatus</code>：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Getter</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PlanStatus</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BaseEnum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    NO_PLAN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;没有计划&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    PLAN_RUNNING</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;计划进行中&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">JsonValue</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 指定JSON序列化枚举时用的值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EnumValue</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 指定与数据库交互时要做类型转换的值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String desc;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    PlanStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">desc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> value;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.desc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> desc;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">JsonCreator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JsonCreator.Mode.DELEGATING) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 指定JSON反序列化时使用的函数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PlanStatus </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Integer </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (PlanStatus status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equalsValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(value)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>这样以来，我们就需要修改PO对象，用枚举类型替代原本的<code>Integer</code>类型：</p><p><img src="/cswiki/assets/20230725151657676.2pJX3qLR.jpg" alt="img" loading="lazy"></p><p><code>MybatisPlus</code>会在我们与数据库交互时实现自动的数据类型转换，无需我们操心。</p><h2 id="实现接口" tabindex="-1">实现接口 <a class="header-anchor" href="#实现接口" aria-label="Permalink to &quot;实现接口&quot;">​</a></h2><p>由于时间有限，这里我们只带着大家实现2个接口：</p><ul><li>添加课程到课表</li><li>分页查询我的课表</li></ul><br><h3 id="添加课程到课表-1" tabindex="-1">添加课程到课表 <a class="header-anchor" href="#添加课程到课表-1" aria-label="Permalink to &quot;添加课程到课表&quot;">​</a></h3><p>回顾一下接口信息：</p><p><img src="/cswiki/assets/image-20240219114822053.a9-v6SCy.png" alt="image-20240219114822053" loading="lazy"></p><p>其中的<code>Exchange</code>、<code>RoutingKey</code>都已经在<code>tj-common</code>中的<code>MqConstants</code>内定义好了：</p><p><img src="/cswiki/assets/20230725151657421.xoz1VkuS.jpg" alt="img" loading="lazy"></p><p>我们只需要定义消息监听器就可以了。</p><br><h4 id="定义消息监听器" tabindex="-1">定义消息监听器 <a class="header-anchor" href="#定义消息监听器" aria-label="Permalink to &quot;定义消息监听器&quot;">​</a></h4><p>我们在tj-learning服务中定义一个MQ的监听器：</p><p><img src="/cswiki/assets/20230725151657703.WieKh_XH.jpg" alt="img" loading="lazy"></p><p>代码如下：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.mq;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.api.dto.trade.OrderBasicDTO;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.constants.MqConstants;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.utils.CollUtils;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service.ILearningLessonService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lombok.RequiredArgsConstructor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lombok.extern.slf4j.Slf4j;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.amqp.core.ExchangeTypes;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.amqp.rabbit.annotation.Exchange;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.amqp.rabbit.annotation.Queue;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.amqp.rabbit.annotation.QueueBinding;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.amqp.rabbit.annotation.RabbitListener;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> org.springframework.stereotype.Component;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Component</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequiredArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LessonChangeListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ILearningLessonService lessonService;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 监听订单支付或课程报名的消息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> order</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 订单信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RabbitListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bindings</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QueueBinding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;learning.lesson.pay.queue&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">durable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            exchange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Exchange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MqConstants.Exchange.ORDER_EXCHANGE, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ExchangeTypes.TOPIC),</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MqConstants.Key.ORDER_PAY_KEY</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> listenLessonPay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(OrderBasicDTO </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">order</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1.健壮性处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(order </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCourseIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 数据有误，无需处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;接收到MQ消息有误，订单数据为空&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.添加课程</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;监听到用户{}的订单{}，需要添加课程{}到课表中&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOrderId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCourseIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        lessonService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addUserLessons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), order.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCourseIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>订单中与课表有关的字段就是userId、courseId，因此这里要传递的就是这两个参数。</p><br><p>注意，这里添加课程的核心逻辑是在<code>ILearningLessonService</code>中实现的，首先是接口声明：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.baomidou.mybatisplus.extension.service.IService;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.domain.po.LearningLesson;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> java.util.List;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 学生课程表 服务类</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * &lt;/p&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ILearningLessonService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LearningLesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addUserLessons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Long </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">courseIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>然后是对应的实现类：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Service</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LearningLessonServiceImpl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ServiceImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LearningLessonMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LearningLesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ILearningLessonService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addUserLessons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Long </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">courseIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // TODO 添加课程信息到用户课程表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h4 id="添加课表的流程分析" tabindex="-1">添加课表的流程分析 <a class="header-anchor" href="#添加课表的流程分析" aria-label="Permalink to &quot;添加课表的流程分析&quot;">​</a></h4><p>接下来，我们来分析一下添加课表逻辑的业务流程。首先来对比一下请求参数和数据库字段：</p><p>参数：</p><ul><li>Long userId</li><li><code>List&lt;Long&gt;</code> courseIds</li></ul><p>数据表：</p><p><img src="/cswiki/assets/20230725151658547.lklhTp17.jpg" alt="img" loading="lazy"></p><p>一个userId和一个courseId是learning_lesson表中的一条数据。而订单中一个用户可能购买多个课程。因此请求参数中的courseId集合就需要逐个处理，将来会有多条课表数据。</p><br><p>另外，可以发现参数中只有userId和courseId，表中的其它字段都需要我们想办法来组织：</p><ul><li>status：课程状态，可以默认为0，代表未学习</li><li>week_freq：学习计划频率，可以为空，代表没有设置学习计划</li><li>plan_status：学习计划状态，默认为0，代表没有设置学习计划</li><li>learned_sections：已学习小节数，默认0，代表没有学习</li><li>latest_section_id：最近学习小节id，可以为空，代表最近没有学习任何小节</li><li>latest_learn_time：最近学习时间，可以为空，代表最近没有学习</li><li>create_time：创建时间，也就是当前时间</li><li><strong>expire_time</strong>：<mark>过期时间，这个要结合课程来计算。每个课程都有自己的有效期（valid_duration），因此过期时间就是create_time加上课程的有效期</mark></li><li>update_time：更新时间，默认当前时间，有数据库实时更新，不用管</li></ul><br><p>可见在整张表中，需要我们在新增时处理的字段就剩下过期时间<code>expire_time</code>了。而要知道这个就必须根据courseId查询课程的信息，找到其中的课程有效期（<code>valid_duration</code>）。课程表结构如图：</p><p><img src="/cswiki/assets/20230725151702875.pIRyrVV_.jpg" alt="img" loading="lazy"></p><p>因此，我们要做的事情就是根据courseId集合查询课程信息，然后分别计算每个课程的有效期，组织多个LearingLesson的数据，形成集合。最终批量新增到数据库即可。</p><p>流程如图：</p><p><img src="/cswiki/assets/image-20240219115025409.VoX1VoVo.png" alt="image-20240219115025409" loading="lazy"></p><p>那么问题来了，我们该如何根据课程id查询课程信息呢？</p><br><h4 id="获取课程信息" tabindex="-1">获取课程信息 <a class="header-anchor" href="#获取课程信息" aria-label="Permalink to &quot;获取课程信息&quot;">​</a></h4><p>课程（course）的信息是由课程服务（course-service）来维护的，目前已经开发完成并部署到了虚拟机的开发环境中。</p><p>我们现在需要查询课程信息，自然需要调用课程服务暴露的Feign接口。如果没有这样的接口，则需要联系维护该服务的同事，<strong>协商</strong>开发相关接口。</p><br><p>在咱们的项目中，课程微服务已经暴露了一些接口。我们有三种方式可以查看已经开放的接口：</p><ul><li>与开发的同事<strong>交流沟通</strong></li><li>通过网关中的Swagger<strong>文档</strong>来查看</li><li>直接查看课程服务的<strong>源码</strong></li></ul><p>首先，我们来看一下swagger文档：</p><p><img src="/cswiki/assets/20230725151658402.uZJIJLWu.jpg" alt="img" loading="lazy"></p><p>不过这种方式查看到的接口数量非常多，有很多是给前端用的。不一定有对应的Feign接口。</p><br><p>要查看Feign接口，需要到<code>tj-api</code>中查看：</p><p><img src="/cswiki/assets/20230725151657780.vFkuOiYF.jpg" alt="img" loading="lazy"></p><p>检索其中的API，可以发现一个这样的接口：</p><p><img src="/cswiki/assets/20230725151658076.Ikr15pN4.jpg" alt="img" loading="lazy"></p><p>根据id批量查询课程的基本信息，而在课程基本信息（<code>CourseSimpleInfoDTO</code>）中，就有有效期信息：</p><p><img src="/cswiki/assets/20230725151659022.0Fq4cxwB.jpg" alt="img" loading="lazy"></p><br><h4 id="实现添加课程到课表" tabindex="-1">实现添加课程到课表 <a class="header-anchor" href="#实现添加课程到课表" aria-label="Permalink to &quot;实现添加课程到课表&quot;">​</a></h4><p>现在，我们正式实现<code>LearningLessonServiceImpl</code>中的<code>addUserLessons</code>方法：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.learning.service.impl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 略</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SuppressWarnings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ALL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Service</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequiredArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LearningLessonServiceImpl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ServiceImpl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LearningLessonMapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LearningLesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ILearningLessonService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CourseClient courseClient;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> addUserLessons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Long </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">courseIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1.查询课程有效期</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CourseSimpleInfoDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; cInfoList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> courseClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSimpleInfoList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(courseIds);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cInfoList)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 课程不存在，无法添加</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;课程信息不存在，无法添加到课表&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.循环遍历，处理LearningLesson数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LearningLesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ArrayList&lt;&gt;(cInfoList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CourseSimpleInfoDTO cInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cInfoList) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            LearningLesson lesson </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LearningLesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 2.1.获取过期时间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Integer validDuration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getValidDuration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (validDuration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> validDuration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                LocalDateTime now </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                lesson.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCreateTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(now);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                lesson.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setExpireTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(now.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">plusMonths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(validDuration));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 2.2.填充userId和courseId</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            lesson.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            lesson.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCourseId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lesson);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3.批量新增</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        saveBatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(list);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h3 id="分页查询我的课表-1" tabindex="-1">分页查询我的课表 <a class="header-anchor" href="#分页查询我的课表-1" aria-label="Permalink to &quot;分页查询我的课表&quot;">​</a></h3><p>首先回顾一下接口信息：</p><p><img src="/cswiki/assets/image-20240219115355639.2IzhfLvL.png" alt="image-20240219115355639" loading="lazy"></p><p><strong>接口描述</strong></p><ul><li>排序方式：create_time 过期时间，last_learn_time 最近学习时间</li><li>默认按照最近学习时间排序</li></ul><br><h4 id="实体" tabindex="-1">实体 <a class="header-anchor" href="#实体" aria-label="Permalink to &quot;实体&quot;">​</a></h4><p>在实现接口的时候，往往需要先把接口的<strong>请求参数</strong>、<strong>返回值</strong>对应的实体类声明出来。</p><br><p><strong>Query实体</strong></p><p>在这个接口中，请求参数是一个通用的分页参数，我们在<code>tj-common</code>已经声明了：</p><p><img src="/cswiki/assets/20230725151658864.szR_Bvyy.jpg" alt="img" loading="lazy"></p><p>主要的四个字段如下：</p><p><img src="/cswiki/assets/20230725151659638.OPKvpf01.jpg" alt="img" loading="lazy"></p><p>其中有几个方法，可以便捷的把PageQuery对象转换为MybatisPlus中的Page对象：</p><p><img src="/cswiki/assets/20230725151659265.hUo0BPoz.jpg" alt="img" loading="lazy"></p><br><p><strong>DTO实体</strong></p><p>返回值是一个分页结果，因为分页太常用了，所以我们在<code>tj-common</code>定义了一个通用的分页结果类：</p><p><img src="/cswiki/assets/20230725151658773.knUWuQeU.jpg" alt="img" loading="lazy"></p><p>其中的核心代码如下：</p><p><img src="/cswiki/assets/20230725151700614.7d5SHr_f.jpg" alt="img" loading="lazy"></p><br><p><strong>VO实体</strong></p><p>返回值的分页结果中有一个实体集合，也就是VO实体，我们在课前资料也提供好了：</p><p><img src="/cswiki/assets/20230725151653374.Gl9WgWLK.jpg" alt="img" loading="lazy"></p><p>将其复制到项目中：</p><p><img src="/cswiki/assets/20230725151659413.MxauneTi.jpg" alt="img" loading="lazy"></p><br><h4 id="接口声明" tabindex="-1">接口声明 <a class="header-anchor" href="#接口声明" aria-label="Permalink to &quot;接口声明&quot;">​</a></h4><p>万事具备，接下来根据我们分析的接口来定义和实现接口。</p><br><p>首先是controller，<code>tj-learning</code>服务的<code>LearningLessonController</code>：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;我的课表相关接口&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RestController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequestMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/lessons&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequiredArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LearningLessonController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ILearningLessonService lessonService;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;查询我的课表，排序字段 latest_learn_time:学习时间排序，create_time:购买时间排序&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/page&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PageDTO&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LearningLessonVO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryMyLessons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PageQuery </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lessonService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryMyLessons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>需要注意的是，这里添加了Swagger相关注解，标记接口信息。</p><br><p>然后是service的接口，<code>tj-learning</code>服务的<code>ILearningLessonService</code>：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PageDTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LearningLessonVO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> queryMyLessons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PageQuery query);</span></span></code></pre></div><br><p>最后是实现类，tj-learning服务的LearningLessonServiceImpl：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PageDTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LearningLessonVO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> queryMyLessons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PageQuery query) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // TODO 分页查询我的课表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h4 id="获取登录用户" tabindex="-1">获取登录用户 <a class="header-anchor" href="#获取登录用户" aria-label="Permalink to &quot;获取登录用户&quot;">​</a></h4><p>既然是分页查询我的课表，除了分页信息以外，我还必须知道当前登录的用户是谁。那么，该从哪里获取用户信息呢？</p><br><p><strong>实现思路</strong></p><p>天机学堂是基于JWT实现登录的，登录信息就保存在请求头的token中。因此要获取当前登录用户，只要获取请求头，解析其中的token即可。</p><br><p>但是，每个微服务都可能需要登录用户信息，在每个微服务都做token解析就属于重复编码了。因此我们的把token解析的行为放到了网关中，然后<strong>由网关把用户信息放入请求头，传递给下游</strong>微服务。</p><p><img src="/cswiki/assets/image-20240219115631146.KT9-7-Jk.png" alt="image-20240219115631146" loading="lazy"></p><p>每个微服务要从请求头拿出用户信息，在业务中使用，也比较麻烦，所以我们定义了一个HandlerInterceptor，拦截进入微服务的请求，并获取用户信息，存入UserContext（底层基于ThreadLocal）。这样后续的业务处理时就能直接从UserContext中获取用户了：</p><p><img src="/cswiki/assets/image-20240219115657441.Xu0zwW7N.png" alt="image-20240219115657441" loading="lazy"></p><p>以上就是天机学堂中获取用户信息的基本实现思路。</p><br><p><strong>网关鉴权</strong></p><p>接下来我们一起来看看具体实现的代码。</p><p>首先是网关登录校验、传递用户信息的逻辑，<code>tj-gateway</code>中的<code>AccountAuthFilter</code>：</p><p><img src="/cswiki/assets/20230725151700068.OLHP2CfA.jpg" alt="img" loading="lazy"></p><p>可以看到，网关将登录的<strong>用户信息放入请求头</strong>中传递到了下游的微服务。因此，我们只要在微服务中获取请求头，即可拿到登录的用户信息。</p><br><p><strong>用户信息上下文</strong></p><p>然后是微服务中的获取请求头中的用户信息的拦截器。由于这个拦截器在每个微服务中都需要，与其重复编写，不如抽取到一个模块中。</p><p>所以在<code>tj-auth</code>模块中，有一个<code>tj-auth-resource-sdk</code>模块，已经把拦截器定义好了:</p><p><img src="/cswiki/assets/20230725151659915.jgTalahW.jpg" alt="img" loading="lazy"></p><p>具体代码如下：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserInfoInterceptor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HandlerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> boolean</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> preHandle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpServletRequest </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, HttpServletResponse </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Exception {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 1.尝试获取头信息中的用户信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        String authorization </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> request.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(JwtConstants.USER_HEADER);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.判断是否为空</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (authorization </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 3.转为用户id并保存到UserContext中</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Long userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Long.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">valueOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(authorization);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            UserContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (NumberFormatException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            log.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;用户身份信息格式不正确，{}, 原因：{}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, authorization, e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> afterCompletion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpServletRequest </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, HttpServletResponse </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Object </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">handler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throws</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Exception {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 清理用户信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        UserContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">removeUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>在这个拦截器中，获取到用户信息后保存到了<code>UserContext</code>中，这是一个基于<code>ThreadLocal</code>的工具，可以确保不同的请求之间互不干扰，避免线程安全问题发生：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.tianji.common.utils;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UserContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadLocal&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; TL </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ThreadLocal&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 保存用户信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> userId</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 用户id</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Long </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TL.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 获取用户</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 用户id</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Long </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TL.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * 移除用户信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> removeUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        TL.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remove</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><p>梳理一下，登录信息传递的过程是这样的：</p><p><img src="/cswiki/assets/20230725151659875.sEBKUuCS.jpg" alt="img" loading="lazy"></p><p>所以，以后在开发业务的时候，只需要在通过<code>UserContext</code>提供的<code>getUser()</code>方法就可以拿到用户<code>id</code>了。</p><br><h4 id="实现查询我的课表" tabindex="-1">实现查询我的课表 <a class="header-anchor" href="#实现查询我的课表" aria-label="Permalink to &quot;实现查询我的课表&quot;">​</a></h4><p>修改之前的<code>tj-learning</code>中的<code>LearningLessonServiceImpl</code>的<code>queryMyLessons</code>方法：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PageDTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LearningLessonVO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> queryMyLessons</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PageQuery query) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1.获取当前登录用户</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Long userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UserContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.分页查询</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // select * from learning_lesson where user_id = #{userId} order by latest_learn_time limit 0, 5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Page&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LearningLesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; page </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lambdaQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LearningLesson</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getUserId, userId) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// where user_id = #{userId}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">page</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toMpPage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;latest_learn_time&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LearningLesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; records </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRecords</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(records)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PageDTO.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">empty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(page);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.查询课程信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CourseSimpleInfoDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; cMap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> queryCourseSimpleInfoList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(records);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4.封装VO返回</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LearningLessonVO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ArrayList&lt;&gt;(records.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4.1.循环遍历，把LearningLesson转为VO</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (LearningLesson r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> records) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.2.拷贝基础属性到vo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        LearningLessonVO vo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BeanUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">copyBean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(r, LearningLessonVO.class);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.3.获取课程信息，填充到vo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        CourseSimpleInfoDTO cInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCourseId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCourseName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCourseCoverUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCoverUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSectionNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        list.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(vo);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PageDTO.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">of</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(page, list);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Long, CourseSimpleInfoDTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> queryCourseSimpleInfoList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(List</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LearningLesson</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> records) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.1.获取课程id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Set&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; cIds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> records.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LearningLesson</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getCourseId).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Collectors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toSet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.2.查询课程信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CourseSimpleInfoDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; cInfoList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> courseClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSimpleInfoList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cIds);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cInfoList)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 课程不存在，无法添加</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BadRequestException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;课程信息不存在！&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.3.把课程集合处理成Map，key是courseId，值是course本身</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CourseSimpleInfoDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; cMap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cInfoList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Collectors.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CourseSimpleInfoDTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getId, c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cMap;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h3 id="查询正在学习的课程-1" tabindex="-1">查询正在学习的课程 <a class="header-anchor" href="#查询正在学习的课程-1" aria-label="Permalink to &quot;查询正在学习的课程&quot;">​</a></h3><p>首先回顾一下接口信息：</p><p><img src="/cswiki/assets/image-20240219135932141.thQiod4N.png" alt="image-20240219135932141" loading="lazy"></p><p>可以看到返回值结果与分页查询的课表VO基本类似，因此这里可以复用LearningLessonVO实体，但是需要添加几个字段：</p><ul><li>courseAmount</li><li>latestSectionName</li><li>latestSectionIndex</li></ul><br><h4 id="查询章节信息" tabindex="-1">查询章节信息 <a class="header-anchor" href="#查询章节信息" aria-label="Permalink to &quot;查询章节信息&quot;">​</a></h4><p>小节名称、序号信息都在课程微服务（course-service）中，因此可以通过课程微服务提供的接口来查询：</p><p><img src="/cswiki/assets/20230725151700070.3FKNoWR1.jpg" alt="img" loading="lazy"></p><p>接口：</p><p><img src="/cswiki/assets/20230725151700245.gToJj7L0.jpg" alt="img" loading="lazy"></p><p>其中<code>CataSimpleInfoDTO</code>中就包含了章节信息：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Data</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CataSimpleInfoDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;目录id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Long id;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;目录名称&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String name;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiModelProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;数字序号，不包含章序号&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Integer cIndex;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><br><h4 id="代码实现" tabindex="-1">代码实现 <a class="header-anchor" href="#代码实现" aria-label="Permalink to &quot;代码实现&quot;">​</a></h4><p>首先是controller，<code>tj-learning</code>服务的<code>LearningLessonController</code>：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Api</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;我的课表相关接口&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RestController</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequestMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/lessons&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RequiredArgsConstructor</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LearningLessonController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ILearningLessonService lessonService;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 。。。略</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/now&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ApiOperation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;查询我正在学习的课程&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LearningLessonVO </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryMyCurrentLesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lessonService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryMyCurrentLesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>需要注意的是，这里添加了 Swagger 相关注解，标记接口信息。</p><br><p>然后是 <code>service</code> 的接口，<code>tj-learning</code>服务的<code>ILearningLessonService</code>：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LearningLessonVO </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryMyCurrentLesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><br><p>最后是实现类，<code>tj-learning</code>服务的<code>LearningLessonServiceImpl</code>：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CatalogueClient catalogueClient;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LearningLessonVO </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryMyCurrentLesson</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1.获取当前登录的用户</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Long userId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> UserContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.查询正在学习的课程 select * from xx where user_id = #{userId} AND status = 1 order by latest_learn_time limit 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LearningLesson lesson </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lambdaQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LearningLesson</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getUserId, userId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LearningLesson</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getStatus, LessonStatus.LEARNING.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orderByDesc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LearningLesson</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getLatestLearnTime)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;limit 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">one</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (lesson </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.拷贝PO基础属性到VO</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LearningLessonVO vo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BeanUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">copyBean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lesson, LearningLessonVO.class);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4.查询课程信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    CourseFullInfoDTO cInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> courseClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCourseInfoById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lesson.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCourseId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (cInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BadRequestException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;课程不存在&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCourseName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCourseCoverUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCoverUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSectionNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 5.统计课表中的课程数量 select count(1) from xxx where user_id = #{userId}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    Integer courseAmount </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lambdaQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LearningLesson</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getUserId, userId)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setCourseAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(courseAmount);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 6.查询小节信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CataSimpleInfoDTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; cataInfos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            catalogueClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">batchQueryCatalogue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">singletonList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lesson.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getLatestSectionId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cataInfos)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        CataSimpleInfoDTO cataInfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cataInfos.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setLatestSectionName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cataInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        vo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setLatestSectionIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cataInfo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCIndex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vo;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="练习" tabindex="-1">练习 <a class="header-anchor" href="#练习" aria-label="Permalink to &quot;练习&quot;">​</a></h2><h3 id="删除课表中课程-练习" tabindex="-1">删除课表中课程（练习） <a class="header-anchor" href="#删除课表中课程-练习" aria-label="Permalink to &quot;删除课表中课程（练习）&quot;">​</a></h3><h4 id="业务分析" tabindex="-1">业务分析 <a class="header-anchor" href="#业务分析" aria-label="Permalink to &quot;业务分析&quot;">​</a></h4><p>删除课表中的课程有两种场景：</p><ul><li>用户直接删除已失效的课程</li><li>用户退款后触发课表自动删除</li></ul><br><p><strong>退款通知</strong></p><p>其中用户退款与用户报名课程类似，都是基于MQ通知的方式。具体代码是在<code>tj-trade</code>模块的<code>RefundApplySerivceImpl</code>类的<code>handleRefundResult</code>方法中：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleRefundResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RefundResultDTO result) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1.查询退款申请记录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RefundApply refundApply </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBizRefundOrderId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (refundApply </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    UserContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setUser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(refundApply.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getApprover</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.判断结果，支付宝支付有可能直接返回退款成功结果，微信只会返回退款中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    RefundApply r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RefundApply</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(refundApply.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRefundChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRefundChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRefundOrderNo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRefundOrderNo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.1.判断状态是否退款中</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RefundResultDTO.RUNNING){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 退款中，结果未知，将其它数据写入数据库即可</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        updateById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(r);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.2.判断退款成功还是失败</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RefundResultDTO.SUCCESS){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 退款成功，记录状态</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RefundStatus.SUCCESS.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RefundStatus.SUCCESS.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getProgressName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 2.3.退款失败，需要记录状态及退款失败原因</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RefundStatus.FAILED.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RefundStatus.FAILED.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getProgressName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setFailedReason</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMsg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2.4.更新数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setFinishTime</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(LocalDateTime.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    updateById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(r);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3.更新子订单状态</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    detailService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">updateRefundStatusById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(refundApply.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOrderDetailId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStatus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4.如果是退款成功，要取消用户报名的课程</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (status </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RefundResultDTO.SUCCESS) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.1.查询子订单信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        OrderDetail detail </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> detailService.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(refundApply.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOrderDetailId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 4.2.发送MQ消息，通知报名成功</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        rabbitMqHelper.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                MqConstants.Exchange.ORDER_EXCHANGE,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                MqConstants.Key.ORDER_REFUND_KEY,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                OrderBasicDTO.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orderId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(refundApply.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getOrderId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(refundApply.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getUserId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">courseIds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CollUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">singletonList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(detail.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCourseId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>发送通知的核心代码如下：</p><p><img src="/cswiki/assets/20230725151700784.OMYo_emQ.jpg" alt="img" loading="lazy"></p><p>与报名成功的通知类似，一样是OrderBasicDTO，参数信息包含三个：</p><ul><li>orderId：退款的订单id</li><li>userId：用户id</li><li>courseIds：退款的课程id</li></ul><p>请参考报名课程通知的处理逻辑来编写退款通知处理的功能。</p><br><p><strong>用户删除课程</strong></p><p>用户可以直接删除《已失效》的课程：</p><p><img src="/cswiki/assets/20230725151700503.L05sx9J3.jpg" alt="img" loading="lazy"></p><p>这里我们可以按照Restful的规范来定义这个删除接口：</p><ul><li>请求方式：删除业务的请求方式都是DELETE</li><li>请求路径：一般是资源名 + 标示，这里删除的是课表中的课程，因此：<code>/ls/lessons/{courseId}</code></li><li>请求参数：自然是路径中传递的课程id</li><li>返回值：无</li></ul><p>同学们可以尝试自己定义接口信息，实现接口功能</p><h4 id="接口信息" tabindex="-1">接口信息 <a class="header-anchor" href="#接口信息" aria-label="Permalink to &quot;接口信息&quot;">​</a></h4><p>同学们自行设计</p><h3 id="检查课程是否有效-练习-必做" tabindex="-1">检查课程是否有效（练习-必做） <a class="header-anchor" href="#检查课程是否有效-练习-必做" aria-label="Permalink to &quot;检查课程是否有效（练习-必做）&quot;">​</a></h3><p>这是一个微服务内部接口，当用户学习课程时，可能需要播放课程视频。此时提供视频播放功能的媒资系统就需要校验<code>用户是否有播放视频的资格</code>。所以，开发媒资服务（<code>tj-media</code>）的同事就请你提供这样一个接口。</p><h4 id="业务分析-1" tabindex="-1">业务分析 <a class="header-anchor" href="#业务分析-1" aria-label="Permalink to &quot;业务分析&quot;">​</a></h4><p>用户要想有播放视频的资格，那就必须满足两个条件：</p><ul><li>用户课表中是否有该课程</li><li>课程状态是否是有效的状态（未过期）</li></ul><p>所以这个接口很简单，就是查询用户课表，做一个非空和状态的判断即可。</p><br><h4 id="接口信息-1" tabindex="-1">接口信息 <a class="header-anchor" href="#接口信息-1" aria-label="Permalink to &quot;接口信息&quot;">​</a></h4><p>接口信息如下：</p><table><thead><tr><th><strong>接口说明</strong></th><th>根据课程id，检查当前用户的课表中是否有该课程，课程状态是否有效。</th></tr></thead><tbody><tr><td><strong>请求方式</strong></td><td>Http请求，GET</td></tr><tr><td><strong>请求路径</strong></td><td>/ls/lessons/{courseId}/valid</td></tr><tr><td><strong>请求参数格式</strong></td><td>课程id，请求路径占位符，参数名：courseId</td></tr><tr><td><strong>返回值格式</strong></td><td>课表lessonId，如果是报名了则返回lessonId，否则返回空</td></tr></tbody></table><p>具体参考<code>tj-api</code>模块下的<code>com.tianji.api.client.learning.LearningClient</code>接口：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 校验当前用户是否可以学习当前课程</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> courseId</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 课程id</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> lessonId，如果是报名了则返回lessonId，否则返回空</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/lessons/{courseId}/valid&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Long </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isLessonValid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PathVariable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;courseId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) Long courseId);</span></span></code></pre></div><br><h3 id="查询用户课表中指定课程状态-练习" tabindex="-1">查询用户课表中指定课程状态（练习） <a class="header-anchor" href="#查询用户课表中指定课程状态-练习" aria-label="Permalink to &quot;查询用户课表中指定课程状态（练习）&quot;">​</a></h3><h4 id="业务分析-2" tabindex="-1">业务分析 <a class="header-anchor" href="#业务分析-2" aria-label="Permalink to &quot;业务分析&quot;">​</a></h4><p>在课程详情页，课程展示有两种不同形式：</p><ul><li><p>对于已经购买的课程：展示为马上学习，并且显示学习的进度、有效期</p><p><img src="/cswiki/assets/20230725151700833.JEQPBfKz.jpg" alt="img" loading="lazy"></p></li><li><p>对于未购买的课程：展示为立刻购买或加入购物车</p><p><img src="/cswiki/assets/20230725151700603.rm70cSIt.jpg" alt="img" loading="lazy"></p></li></ul><p>因此，进入详情页以后，前端需要查询用户的课表中是否有该课程，如果有该课程则需要返回课程的学习进度、课程有效期等信息。</p><br><h4 id="接口信息-2" tabindex="-1">接口信息 <a class="header-anchor" href="#接口信息-2" aria-label="Permalink to &quot;接口信息&quot;">​</a></h4><p><img src="/cswiki/assets/image-20240219141036165.xTcn-rxf.png" alt="image-20240219141036165" loading="lazy"></p><br><h3 id="统计课程的学习人数-练习" tabindex="-1">统计课程的学习人数（练习） <a class="header-anchor" href="#统计课程的学习人数-练习" aria-label="Permalink to &quot;统计课程的学习人数（练习）&quot;">​</a></h3><p>课程微服务中需要统计每个课程的报名人数，同样是一个内部调用接口，在tj-api模块中已经定义好了：</p><div class="language-Java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 统计课程学习人数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> courseId</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 课程id</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 学习人数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GetMapping</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/lessons/{courseId}/count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Integer </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">countLearningLessonByCourse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PathVariable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;courseId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) Long courseId);</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-7b451c74 data-v-ffe8a71c><!--[--><!--]--><div class="edit-info" data-v-ffe8a71c><!----><div class="last-updated" data-v-ffe8a71c><p class="VPLastUpdated" data-v-ffe8a71c data-v-fc47d7a3>最后更新: <time datetime="2024-11-03T15:45:53.000Z" data-v-fc47d7a3></time></p></div></div><nav class="prev-next" data-v-ffe8a71c><div class="pager" data-v-ffe8a71c><a class="VPLink link pager-link prev" href="/cswiki/src/project/college/00-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F" data-v-ffe8a71c><!--[--><span class="desc" data-v-ffe8a71c>上一篇</span><span class="title" data-v-ffe8a71c>内网穿透</span><!--]--></a></div><div class="pager" data-v-ffe8a71c><a class="VPLink link pager-link next" href="/cswiki/src/project/college/03-%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92" data-v-ffe8a71c><!--[--><span class="desc" data-v-ffe8a71c>下一篇</span><span class="title" data-v-ffe8a71c>03-学习计划</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"src_base_alg_index.md\":\"MyjqLDYd\",\"src_base_alg_01-数据结构与算法.md\":\"swVJqwCL\",\"index.md\":\"f0C03zif\",\"src_base_cloud_00操作篇-安装docker.md\":\"ieGtpKRS\",\"src_base_cloud_00操作篇-多级缓存案例.md\":\"8_JwsqcT\",\"src_base_cloud_00操作篇-安装mq.md\":\"q6UQ4zdp\",\"src_base_cloud_00操作篇-安装nacos.md\":\"psz_g1rz\",\"src_base_cloud_00操作篇-安装elk.md\":\"7LTyXvCf\",\"src_base_cloud_00操作篇-安装redis.md\":\"yEapRJPQ\",\"src_base_cloud_00操作篇-安装seata.md\":\"xITEHdL7\",\"src_base_cloud_02实用篇-容器管理.md\":\"Gg4_8yMU\",\"src_base_cloud_03实用篇-异步通信.md\":\"M6EGZRsI\",\"src_base_cloud_01实用篇-微服务治理.md\":\"wZNaW1Dr\",\"src_base_cloud_04实用篇-文档数据库.md\":\"F9NZz0Xh\",\"src_base_cloud_06实用篇-分布式缓存.md\":\"7hBkVwHm\",\"src_base_cloud_07高级篇-微服务保护.md\":\"vVZ1Sc_-\",\"src_base_cloud_08高级篇-分布式事务.md\":\"YmY-tyOZ\",\"src_base_cloud_09高级篇-可靠消息服务.md\":\"ezluIOj5\",\"src_base_cloud_10高级篇-多级缓存技术.md\":\"zpvNe4F3\",\"src_base_gof_01-设计模式入门.md\":\"Twc37v3L\",\"src_base_cloud_index.md\":\"x6LZ6at3\",\"src_base_gof_02-uml类图.md\":\"sWH0206E\",\"src_base_gof_03-六大原则.md\":\"7RTrJ7i-\",\"src_base_cloud_05实用篇-分布式搜索.md\":\"F5pLbOP8\",\"src_base_gof_04-创建者模式.md\":\"b1frCBy4\",\"src_base_gof_05-结构者模式.md\":\"9g8L9w-C\",\"src_base_java_01-java基础.md\":\"md-1gUI3\",\"src_base_index.md\":\"CjSWuIry\",\"src_base_juc_index.md\":\"PaLiUrD8\",\"src_base_gof_index.md\":\"tdFYM8T2\",\"src_base_juc_juc-apply-exclusive.md\":\"bIP5b6BO\",\"src_base_java_index.md\":\"RuqkmUqQ\",\"src_base_juc_juc-apply-cache.md\":\"JNrm_IxU\",\"src_base_gof_07-设计模式实践.md\":\"3pM7Hysx\",\"src_base_java_02-java集合.md\":\"0n9EXxZ6\",\"src_base_juc_juc-apply-limit.md\":\"NCDUtiTQ\",\"src_base_juc_juc-apply-plan.md\":\"t-mDvOux\",\"src_base_juc_juc-apply-fork.md\":\"chWd-M1K\",\"src_base_cloud_11面试篇-微服务面试题.md\":\"6sbImYjw\",\"src_base_juc_juc-apply-sync-async.md\":\"eFEJlU6M\",\"src_base_gof_06-行为者模式.md\":\"NjgRVFuv\",\"src_base_juc_juc-model-balking.md\":\"o7YChNJS\",\"src_base_juc_juc-model-flyweight.md\":\"MeMO8A-2\",\"src_base_juc_juc-base.md\":\"HuMYr0-R\",\"src_base_juc_juc-model-order.md\":\"ww-G4t1Q\",\"src_base_juc_juc-model-product.md\":\"W3w4-A1W\",\"src_base_juc_juc-model-protect.md\":\"2pj_mSD9\",\"src_base_juc_juc-model-termination.md\":\"f73FDwtU\",\"src_base_juc_juc-practice-batch.md\":\"N5w5aatx\",\"src_base_juc_juc-model-work-queue.md\":\"XkDclUp4\",\"src_base_juc_juc-share-final.md\":\"DRG4E_3x\",\"src_base_juc_juc-share-memory.md\":\"4PMLcBuz\",\"src_base_juc_juc-share-nolock.md\":\"XNhUgHzY\",\"src_base_juc_juc-share-nosync.md\":\"IstEXNbk\",\"src_base_juc_juc-share-monitor.md\":\"xu3NsDnL\",\"src_base_juc_juc-theory-linked-blocking-queue.md\":\"R4XZm-5Q\",\"src_base_juc_juc-theory-reentrant-read-write-lock.md\":\"tbvcX5gF\",\"src_base_juc_juc-theory-semaphore.md\":\"FiAMhhzE\",\"src_base_juc_juc-theory-concurrent-map.md\":\"_SJqSKh9\",\"src_base_juc_juc-theory-reentrant-lock.md\":\"q33YKaIa\",\"src_base_juc_juc-theory-volatile.md\":\"X0JD0EVi\",\"src_base_juc_juc-tool-locks.md\":\"QqirRWne\",\"src_base_juc_juc-theory-synchronized.md\":\"ortKAKD1\",\"src_base_juc_juc-tool-collections.md\":\"AZ-r1bi3\",\"src_base_juc_juc-tool-tools.md\":\"mlDt0KWi\",\"src_base_jvm_index.md\":\"pG-O5aN6\",\"src_base_juc_juc-tools-atomic.md\":\"PtnZWSZA\",\"src_base_jvm_jvm-base.md\":\"P2eALBsa\",\"src_base_jvm_jvm-base-bytecode.md\":\"Eduzz1IX\",\"src_base_jvm_jvm-senior-graal-vm.md\":\"DAXKHlHc\",\"src_base_jvm_jvm-base-runtime.md\":\"SJFPW7gj\",\"src_base_jvm_jvm-base-gc.md\":\"yHGH2n2l\",\"src_base_jvm_jvm-senior-new-gc.md\":\"dpq5rMqs\",\"src_base_juc_juc-tools-pool.md\":\"eRDQSPZC\",\"src_base_jvm_jvm-senior-java-agent.md\":\"DJX5UP0-\",\"src_base_jvm_jvm-tuning-gc.md\":\"4pZlx7pb\",\"src_base_mysql_02-mysql进阶-innodb引擎.md\":\"30d9HhSj\",\"src_base_mysql_02-mysql进阶-索引.md\":\"REsen0SR\",\"src_base_linux_01-初始linux.md\":\"StuIZGWa\",\"src_base_mysql_02-mysql进阶-sql优化.md\":\"20xgs4Kx\",\"src_base_linux_index.md\":\"Ua07q16P\",\"src_base_mysql_01-mysql基础.md\":\"pSdd5XcZ\",\"src_base_mysql_02-mysql进阶-数据库架构.md\":\"YLupdM1c\",\"src_base_mysql_02-mysql进阶-事务.md\":\"l0NBH66L\",\"src_base_mysql_02-mysql进阶-锁.md\":\"PMNnnXzf\",\"src_base_jvm_jvm-summarize.md\":\"lXUmnuJu\",\"src_base_jvm_jvm-tuning-function.md\":\"PcqhGm4c\",\"src_base_jvm_jvm-theory.md\":\"x8DndpNx\",\"src_base_mysql_index.md\":\"gBKktBqs\",\"src_base_mysql_03-mysql运维-分库分表.md\":\"ZPVC0_Nv\",\"src_base_mysql_04-mysql实践-sql练习.md\":\"nR54OvyS\",\"src_base_mysql_03-mysql运维-主从复制.md\":\"0NeuLHW7\",\"src_base_mysql_04-mysql实践-sql记录.md\":\"zDd4TSxB\",\"src_base_mysql_03-mysql运维-读写分离.md\":\"1F8rT23t\",\"src_base_mysql_03-mysql运维-日志文件.md\":\"EVJyUbT0\",\"src_base_mysql_03-mysql运维-管理工具.md\":\"xRHTtOaI\",\"src_base_netty_index.md\":\"LXYE7ddD\",\"src_base_mysql_03-mysql运维-性能优化.md\":\"pfkINVF5\",\"src_base_jvm_jvm-tuning-memory.md\":\"YHGnaTrS\",\"src_base_netty_netty-code.md\":\"Grh9C4dp\",\"src_base_netty_netty-base.md\":\"D6_0Bxi7\",\"src_base_mysql_02-mysql进阶.md\":\"T5tdgmYR\",\"src_base_spring_spring-aop.md\":\"egWS7_n6\",\"src_base_spring_index.md\":\"EM8AQAEi\",\"src_base_spring_spring-other.md\":\"OtlMdl2o\",\"src_base_spring_spring-boot.md\":\"lwm3hvPj\",\"src_base_spring_spring-mvc.md\":\"5rWSZLcQ\",\"src_base_summarize_java-base.md\":\"N6OvBOHs\",\"src_base_summarize_interview.md\":\"uYScr83e\",\"src_base_summarize_index.md\":\"9WidSbmW\",\"src_base_summarize_gof.md\":\"T4cskmPR\",\"src_base_spring_spring-bean.md\":\"_YU0p9zf\",\"src_base_netty_netty-senior.md\":\"uOf6JuG2\",\"src_base_summarize_java-collection.md\":\"TPwn8ugY\",\"src_base_netty_non-blocking-io.md\":\"DFxvqtOp\",\"src_base_summarize_java-netty.md\":\"x2pFfzzl\",\"src_base_summarize_message-queue.md\":\"Ell0PlTC\",\"src_base_summarize_project-practice.md\":\"30CvZcCs\",\"src_base_summarize_mysql.md\":\"DMXSPE9L\",\"src_base_summarize_java-virtual.md\":\"hz7oczTc\",\"src_base_summarize_spring-cloud.md\":\"O0nrcLKs\",\"src_base_summarize_redis.md\":\"-eW65bjn\",\"src_project_college_00-自定义部署.md\":\"0qnGyG9p\",\"src_project_college_00-内网穿透.md\":\"5epNi5lB\",\"src_base_summarize_java-concurrent.md\":\"Y7QmmZhT\",\"src_base_summarize_spring.md\":\"Z0vIZkYE\",\"src_project_college_00-虚拟机导入.md\":\"BtH_ekVp\",\"src_project_college_01-初识项目.md\":\"N-RietTZ\",\"src_project_college_04-学习记录.md\":\"-_Tk7_j3\",\"src_project_college_13-项目部署.md\":\"xn_xcUER\",\"src_project_college_05-问答系统.md\":\"6sGCsZA2\",\"src_project_college_10-领取优惠券.md\":\"yV-JqecF\",\"src_project_college_09-优惠券管理.md\":\"U9eTVbeF\",\"src_project_college_03-学习计划.md\":\"4Z-MQRjM\",\"src_project_college_14-项目实战.md\":\"4YLTJHkc\",\"src_project_college_06-点赞系统.md\":\"q1yTK1XB\",\"src_project_college_index.md\":\"L3og0vVF\",\"src_project_express_00-基础服务.md\":\"376SObFF\",\"src_project_college_02-我的课表.md\":\"afiNyrhG\",\"src_project_express_00-常见问题.md\":\"CUeyIsM4\",\"src_project_express_00-基础工具.md\":\"a8pWbL0u\",\"src_project_college_08-排行榜功能.md\":\"w4I0TgA_\",\"src_project_college_11-优惠券优化.md\":\"HRTnYaCG\",\"src_project_college_07-积分系统.md\":\"QODLJGwf\",\"src_project_college_12-优惠券使用.md\":\"Y4bejsfW\",\"src_project_express_01-初识项目.md\":\"GbRCqzxN\",\"src_project_express_03-运费服务.md\":\"QyKspbxC\",\"src_project_express_02-支付服务.md\":\"rPszblZo\",\"src_project_express_04-路线服务.md\":\"TLkJQBID\",\"src_project_express_05-调度服务.md\":\"nnBYTdYo\",\"src_project_express_06-运输任务.md\":\"LwysKUvo\",\"src_project_express_07-作业范围.md\":\"OoM_JyMv\",\"src_project_express_08-派件调度.md\":\"z8faVzxd\",\"src_project_express_09-物流服务.md\":\"qs-XdeKm\",\"src_project_express_10-持续集成.md\":\"qHyIEOH-\",\"src_project_health_index.md\":\"MOoLLfU7\",\"src_project_index.md\":\"-uzkkdVO\",\"src_project_financial_index.md\":\"_dipptdR\",\"src_project_express_12-项目实战.md\":\"fA_7fIIF\",\"src_project_express_index.md\":\"GDw4KM25\",\"src_project_express_11-项目运维.md\":\"p0kc39qy\",\"src_project_redis_02-redis实战-黑马点评.md\":\"8LxFzK1e\",\"src_project_redis_03-redis实战-短信登录.md\":\"bEoJ6kN_\",\"src_project_redis_01-redis基础.md\":\"WBJYPgIp\",\"src_project_redis_04-redis实战-商户查询.md\":\"pZWuWyzt\",\"src_project_redis_08-redis实战-附近商户.md\":\"jvOX54uo\",\"src_project_redis_06-redis实战-达人探店.md\":\"ofOd3WsL\",\"src_project_redis_07-redis实战-好友关注.md\":\"j-rgE_B_\",\"src_project_redis_10-redis实战-uv统计.md\":\"GavO2Vq4\",\"src_project_redis_09-redis实战-用户签到.md\":\"6BYgiJ-G\",\"src_project_redis_12-redis原理-数据结构.md\":\"hN1W-Abs\",\"src_project_social_index.md\":\"_llU1edg\",\"src_project_shop_index.md\":\"kVFuNBWp\",\"src_project_takeout_index.md\":\"kGycznV8\",\"src_project_redis_index.md\":\"wSkhV2NJ\",\"src_project_rent_index.md\":\"Iybh37Ms\",\"src_project_redis_14-redis原理-内存策略.md\":\"brnCtCg0\",\"src_project_redis_13-redis原理-网络模型.md\":\"j5UYhDcX\",\"src_project_redis_05-redis实战-优惠券秒杀.md\":\"JZ34CXjc\",\"src_project_redis_11-redis实践.md\":\"fKvuEAZv\",\"src_project_topnews_00-虚拟机导入.md\":\"BYKu4wH1\",\"src_project_topnews_00-自定义部署.md\":\"t__659DY\",\"src_project_topnews_01-初识项目.md\":\"HwhS9NNx\",\"src_project_topnews_00-自定义服务.md\":\"cakq0AAd\",\"src_project_topnews_03-文章发布.md\":\"b7gsko2z\",\"src_project_topnews_02-文章查看.md\":\"Lfi0FXnC\",\"src_project_topnews_04-文章审核.md\":\"9ehA9QUe\",\"src_project_topnews_06-文章上架.md\":\"_rXw-Qjr\",\"src_project_topnews_09-用户行为.md\":\"o98DyDMW\",\"src_project_topnews_08-平台管理.md\":\"kCaSxZN0\",\"src_project_topnews_12-多级缓存.md\":\"OEkgLTv_\",\"src_project_topnews_05-延迟发布.md\":\"sVaq0_ZS\",\"src_project_topnews_10-定时计算.md\":\"Xev9SMdC\",\"src_project_topnews_07-文章搜索.md\":\"M9jsEy7e\",\"src_project_topnews_index.md\":\"DjOImstG\",\"src_study_english_01-英语学习.md\":\"26mQ_RqO\",\"src_study_book_01-图书学习.md\":\"8q-i_wqh\",\"src_project_topnews_11-实时计算.md\":\"JpQNVF9K\",\"src_study_index.md\":\"3lPmpv7w\",\"src_study_method_04-提升专注力.md\":\"la1bup_b\",\"src_study_movie_01-电影影片.md\":\"YJ6rn4p5\",\"src_study_method_05-面试技巧.md\":\"Qer4h2XN\",\"src_study_method_02-养成好习惯.md\":\"kMBM7_Fu\",\"src_study_method_03-结构思维.md\":\"MIYiCZwc\",\"src_project_topnews_13-持续集成.md\":\"McstQZye\",\"src_study_method_01-高效搜索.md\":\"FtdLWAQk\",\"src_project_topnews_14-项目实战.md\":\"n0RxpO08\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"知识小册子\",\"description\":\"搭建个人的知识体系,一个好的知识体系和学习方法会让自己事半功倍\",\"base\":\"/cswiki/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"📌 技术博客\",\"link\":\"/\"},{\"text\":\"📝 基础知识\",\"items\":[{\"items\":[{\"text\":\"☕️ Java基础\",\"link\":\"/src/base/java/index\"},{\"text\":\"🖥 JVM入门\",\"link\":\"/src/base/jvm/index\"},{\"text\":\"🔥 并发编程\",\"link\":\"/src/base/juc/index\"},{\"text\":\"🌐 网络编程\",\"link\":\"/src/base/netty/index\"}]},{\"items\":[{\"text\":\"🧩 数据结构\",\"link\":\"/src/base/alg/index\"},{\"text\":\"📝 设计模式\",\"link\":\"/src/base/gof/index\"}]},{\"items\":[{\"text\":\"📊 数据库\",\"link\":\"/src/base/mysql/index\"},{\"text\":\"👨‍💻 服务器\",\"link\":\"/src/base/linux/index\"},{\"text\":\"🌱 Spring\",\"link\":\"/src/base/spring/index\"},{\"text\":\"☁️ 微服务\",\"link\":\"/src/base/cloud/index\"}]}]},{\"text\":\"🛠️ 项目实战\",\"items\":[{\"items\":[{\"text\":\"🔖️ 黑马点评\",\"link\":\"/src/project/redis/index\"},{\"text\":\"📰 黑马头条\",\"link\":\"/src/project/topnews/index\"}]},{\"items\":[{\"text\":\"📚 天机学堂\",\"link\":\"/src/project/college/index\"},{\"text\":\"🚚 神领物流\",\"link\":\"/src/project/express/index\"},{\"text\":\"🛒 谷粒商城\",\"link\":\"/src/project/shop/index\"}]},{\"items\":[{\"text\":\"🍜 谷粒外卖\",\"link\":\"/src/project/takeout/index\"},{\"text\":\"🏄 谷粒健康\",\"link\":\"/src/project/health/index\"},{\"text\":\"🧑‍🤝‍🧑 谷粒交友\",\"link\":\"/src/project/social/index\"},{\"text\":\"🏠 谷粒租房\",\"link\":\"/src/project/rent/index\"},{\"text\":\"📈 谷粒金融\",\"link\":\"/src/project/financial/index\"}]}],\"activeMatch\":\"/src/project\"},{\"text\":\"💼 面试宝典\",\"link\":\"/src/base/summarize/index\",\"activeMatch\":\"/src/base/summarize\"}],\"sidebar\":{\"/src/study\":[{\"text\":\"学习方法\",\"link\":\"\",\"items\":[{\"text\":\"高效搜索\",\"link\":\"/src/study/method/01-高效搜索\"},{\"text\":\"养成好习惯\",\"link\":\"/src/study/method/02-养成好习惯\"},{\"text\":\"结构思维\",\"link\":\"/src/study/method/03-结构思维\"},{\"text\":\"提升专注力\",\"link\":\"/src/study/method/04-提升专注力\"}]}],\"/src/base/java\":[{\"text\":\"Java基础\",\"base\":\"/src/base/java/\",\"link\":\"01-Java基础\"},{\"text\":\"Java集合\",\"base\":\"/src/base/java/\",\"link\":\"02-Java集合\"}],\"/src/base/jvm\":[{\"text\":\"JVM\",\"base\":\"/src/base/jvm/\",\"collapsed\":false,\"items\":[{\"text\":\"虚拟机基础\",\"items\":[{\"text\":\"JVM入门\",\"link\":\"jvm-base\"},{\"text\":\"字节码与类的加载\",\"link\":\"jvm-base-bytecode\"},{\"text\":\"运行时数据区\",\"link\":\"jvm-base-runtime\"},{\"text\":\"垃圾回收\",\"link\":\"jvm-base-gc\"}]},{\"text\":\"虚拟机实战\",\"items\":[{\"text\":\"内存调优\",\"link\":\"jvm-tuning-memory\"},{\"text\":\"GC调优\",\"link\":\"jvm-tuning-gc\"},{\"text\":\"性能调优\",\"link\":\"jvm-tuning-function\"}]},{\"text\":\"虚拟机高级\",\"items\":[{\"text\":\"GraalVM\",\"link\":\"jvm-senior-graal-vm\"},{\"text\":\"新一代GC\",\"link\":\"jvm-senior-new-gc\"},{\"text\":\"Java工具\",\"link\":\"jvm-senior-java-agent\"}]},{\"text\":\"虚拟机原理\",\"link\":\"jvm-theory\",\"items\":[]},{\"text\":\"虚拟机总结\",\"link\":\"jvm-summarize\"}]}],\"/src/base/juc\":[{\"text\":\"并发编程\",\"base\":\"/src/base/juc/\",\"collapsed\":false,\"items\":[{\"text\":\"并发编程基础\",\"link\":\"juc-base\"},{\"text\":\"并发编程理论\",\"base\":\"/src/base/juc/juc-share-\",\"items\":[{\"text\":\"共享模型之管程\",\"link\":\"monitor\"},{\"text\":\"共享模型之内存\",\"link\":\"memory\"},{\"text\":\"共享模型之无锁\",\"link\":\"nolock\"},{\"text\":\"共享模型之不可变\",\"link\":\"final\"},{\"text\":\"共享模型之无同步方案\",\"link\":\"nosync\"}]},{\"text\":\"并发编程工具\",\"base\":\"/src/base/juc/juc-tool-\",\"items\":[{\"text\":\"线程池\",\"link\":\"pool\"},{\"text\":\"Locks\",\"link\":\"locks\"},{\"text\":\"Tools\",\"link\":\"tools\"},{\"text\":\"Atomic\",\"link\":\"atomic\"},{\"text\":\"Collections\",\"link\":\"collections\"}]},{\"text\":\"并发编程应用\",\"base\":\"/src/base/juc/juc-apply-\",\"items\":[{\"text\":\"同步和异步\",\"link\":\"sync-async\"},{\"text\":\"限制\",\"link\":\"limit\"},{\"text\":\"互斥\",\"link\":\"exclusive\"},{\"text\":\"缓存\",\"link\":\"cache\"},{\"text\":\"分治\",\"link\":\"fork\"},{\"text\":\"统筹\",\"link\":\"plan\"}]},{\"text\":\"并发编程模式\",\"base\":\"/src/base/juc/juc-model\",\"items\":[{\"text\":\"同步模式之保护者暂停\",\"link\":\"protect\"},{\"text\":\"同步模式之顺序控制\",\"link\":\"order\"},{\"text\":\"同步模式之Balking\",\"link\":\"balking\"},{\"text\":\"异步模式之生产者消费者\",\"link\":\"product\"},{\"text\":\"异步模式之工作线程\",\"link\":\"work-queue\"},{\"text\":\"终止模式之两阶段终止\",\"link\":\"termination\"},{\"text\":\"共享模式之享元\",\"link\":\"flyweight\"}]},{\"text\":\"* 并发编程原理\",\"base\":\"/src/base/juc/juc-theory-\",\"items\":[{\"text\":\"synchronized原理\",\"link\":\"synchronized\"},{\"text\":\"volatile原理\",\"link\":\"volatile\"},{\"text\":\"ReentrantLock原理\",\"link\":\"reentrant-lock\"},{\"text\":\"读写锁原理\",\"link\":\"reentrant-read-write-lock\"},{\"text\":\"Semaphore原理\",\"link\":\"semaphore\"},{\"text\":\"ConcurrentMap原理\",\"link\":\"concurrent-map\"},{\"text\":\"LinkedBlockingQueue原理\",\"link\":\"linked-blocking-queue\"}]},{\"text\":\"并发编程场景\",\"base\":\"/src/base/juc/juc-practice\",\"items\":[{\"text\":\"批量数据导入\",\"link\":\"batch\"}]}]}],\"/src/base/netty\":[{\"text\":\"网络编程\",\"collapsed\":false,\"base\":\"/src/base/netty/\",\"items\":[{\"text\":\"Java NIO\",\"link\":\"non-blocking-io\"},{\"text\":\"Netty\",\"items\":[{\"text\":\"Netty 基础\",\"link\":\"netty-base\"},{\"text\":\"Netty 高级\",\"link\":\"netty-senior\"},{\"text\":\"*Netty 源码\",\"link\":\"netty-code\"}]},{\"text\":\"Nginx\"}]}],\"/src/base/mysql\":[{\"text\":\"数据库\",\"base\":\"/src/base/mysql/\",\"items\":[{\"text\":\"MySQL基础\",\"link\":\"01-MySQL基础\"},{\"text\":\"MySQL进阶\",\"base\":\"/src/base/mysql/02-\",\"link\":\"MySQL进阶\",\"items\":[{\"text\":\"数据库架构\",\"link\":\"MySQL进阶-数据库架构\"},{\"text\":\"索引\",\"link\":\"MySQL进阶-索引\"},{\"text\":\"SQL优化\",\"link\":\"MySQL进阶-SQL优化\"},{\"text\":\"锁\",\"link\":\"MySQL进阶-锁\"},{\"text\":\"InnoDB引擎\",\"link\":\"MySQL进阶-InnoDB引擎\"}]},{\"text\":\"MySQL运维\",\"base\":\"/src/base/mysql/03-MySQL运维-\",\"items\":[{\"text\":\"管理工具\",\"link\":\"管理工具\"},{\"text\":\"日志文件\",\"link\":\"日志文件\"},{\"text\":\"主从复制\",\"link\":\"主从复制\"},{\"text\":\"分库分表\",\"link\":\"分库分表\"},{\"text\":\"读写分离\",\"link\":\"读写分离\"}]},{\"text\":\"MySQL实践\",\"base\":\"/src/base/mysql/04-MySQL实践-\",\"items\":[{\"text\":\"SQL记录\",\"link\":\"SQL记录\"},{\"text\":\"SQL练习\",\"link\":\"SQL练习\"}]}]}],\"/src/base/gof\":[{\"text\":\"设计模式\",\"collapsed\":false,\"base\":\"/src/base/gof/\",\"items\":[{\"text\":\"设计模式入门\",\"link\":\"01-设计模式入门\"},{\"text\":\"UML类图\",\"link\":\"02-UML类图\"},{\"text\":\"六大原则\",\"link\":\"03-六大原则\"},{\"text\":\"创建者模式\",\"link\":\"04-创建者模式\"},{\"text\":\"结构者模式\",\"link\":\"05-结构者模式\"},{\"text\":\"行为者模式\",\"link\":\"06-行为者模式\"},{\"text\":\"设计模式实践\",\"link\":\"07-设计模式实践\"}]}],\"/src/base/spring\":[{\"text\":\"Spring原理篇\",\"collapsed\":false,\"base\":\"/src/base/spring/\",\"items\":[{\"text\":\"Spring-Bean\",\"link\":\"01-Spring-Bean\"},{\"text\":\"Spring-AOP\",\"link\":\"02-Spring-AOP\"},{\"text\":\"Spring-Boot\",\"link\":\"03-Spring-Boot\"},{\"text\":\"Spring-MVC\",\"link\":\"04-Spring-MVC\"},{\"text\":\"Spring-Other\",\"link\":\"05-Spring-Other\"}]},{\"text\":\"Spring集成篇\",\"collapsed\":false}],\"/src/base/cloud\":[{\"text\":\"Cloud 实用篇\",\"base\":\"/src/base/cloud/\",\"collapsed\":false,\"items\":[{\"text\":\"微服务治理\",\"link\":\"01实用篇-微服务治理\"},{\"text\":\"容器管理\",\"link\":\"02实用篇-容器管理\"},{\"text\":\"异步通信\",\"link\":\"03实用篇-异步通信\"},{\"text\":\"文档数据库\",\"link\":\"04实用篇-文档数据库\"},{\"text\":\"分布式缓存\",\"link\":\"06实用篇-分布式缓存\"}]},{\"text\":\"Cloud 高级篇\",\"base\":\"/src/base/cloud/\",\"collapsed\":false,\"items\":[{\"text\":\"分布式搜索\",\"link\":\"05实用篇-分布式搜索\"},{\"text\":\"分布式事务\",\"link\":\"08高级篇-分布式事务\"},{\"text\":\"微服务保护\",\"link\":\"07高级篇-微服务保护\"},{\"text\":\"可靠消息服务\",\"link\":\"09高级篇-可靠消息服务\"},{\"text\":\"多级缓存技术\",\"link\":\"10高级篇-多级缓存技术\"},{\"text\":\"微服务面试题\",\"link\":\"11面试篇-微服务面试题\"}]},{\"text\":\"Cloud 操作篇\",\"base\":\"/src/base/cloud¡/00操作篇-\",\"collapsed\":false,\"items\":[{\"text\":\"安装Nacos\",\"link\":\"安装Nacos\"},{\"text\":\"安装Seata\",\"link\":\"安装Seata\"},{\"text\":\"安装Docker\",\"link\":\"安装Docker\"},{\"text\":\"安装Redis\",\"link\":\"安装Redis\"},{\"text\":\"安装MQ\",\"link\":\"安装MQ\"},{\"text\":\"安装ELK\",\"link\":\"安装ELK\"},{\"text\":\"多级缓存案例\",\"link\":\"多级缓存案例\"}]}],\"/src/project/redis\":[{\"text\":\"黑马点评\",\"collapsed\":false,\"base\":\"/src/project/redis/\",\"items\":[{\"text\":\"Redis基础\",\"link\":\"01-Redis基础\"},{\"text\":\"Redis实战\",\"base\":\"/src/project/redis/\",\"items\":[{\"text\":\"黑马点评\",\"link\":\"02-Redis实战-黑马点评\"},{\"text\":\"短信登录\",\"link\":\"03-Redis实战-短信登录\"},{\"text\":\"商户查询\",\"link\":\"04-Redis实战-商户查询\"},{\"text\":\"* 优惠券秒杀\",\"link\":\"05-Redis实战-优惠券秒杀\"},{\"text\":\"达人探店\",\"link\":\"06-Redis实战-达人探店\"},{\"text\":\"好友关注\",\"link\":\"07-Redis实战-好友关注\"},{\"text\":\"附近商户\",\"link\":\"08-Redis实战-附近商户\"},{\"text\":\"用户签到\",\"link\":\"09-Redis实战-用户签到\"},{\"text\":\"UV统计\",\"link\":\"10-Redis实战-UV统计\"}]},{\"text\":\"* Redis实践\",\"link\":\"11-Redis实践\"},{\"text\":\"* Redis原理\",\"base\":\"/src/project/redis/\",\"items\":[{\"text\":\"数据结构\",\"link\":\"12-Redis原理-数据结构\"},{\"text\":\"网络模型\",\"link\":\"13-Redis原理-网络模型\"},{\"text\":\"内存策略\",\"link\":\"14-Redis原理-内存策略\"}]}]}],\"/src/project/topnews\":[{\"text\":\"黑马点评\",\"collapsed\":false,\"base\":\"/src/project/topnews/\",\"items\":[{\"text\":\"Day01-初识项目\",\"link\":\"01-初识项目\",\"items\":[{\"text\":\"虚拟机导入\",\"link\":\"00-虚拟机导入\"},{\"text\":\"自定义部署\",\"link\":\"00-自定义部署\"},{\"text\":\"自定义服务\",\"link\":\"00-自定义服务\"}]},{\"text\":\"Day02-文章查看\",\"link\":\"02-文章查看\"},{\"text\":\"Day03-文章发布\",\"link\":\"03-文章发布\"},{\"text\":\"Day04-文章审核\",\"link\":\"04-文章审核\"},{\"text\":\"Day05-延迟发布\",\"link\":\"05-延迟发布\"},{\"text\":\"Day06-文章上架\",\"link\":\"06-文章上架\"},{\"text\":\"Day07-文章搜索\",\"link\":\"07-文章搜索\"},{\"text\":\"Day08-平台管理\",\"link\":\"08-平台管理\"},{\"text\":\"Day09-用户行为\",\"link\":\"09-用户行为\"},{\"text\":\"Day10-定时计算\",\"link\":\"10-定时计算\"},{\"text\":\"Day11-实时计算\",\"link\":\"11-实时计算\"},{\"text\":\"Day12-多级缓存\",\"link\":\"12-多级缓存\"},{\"text\":\"Day13-持续集成\",\"link\":\"13-持续集成\"},{\"text\":\"Day14-项目实战\",\"link\":\"14-项目实战\"}]}],\"/src/project/college\":[{\"text\":\"天机学堂\",\"collapsed\":false,\"base\":\"/src/project/college/\",\"items\":[{\"text\":\"01-初识项目\",\"link\":\"01-初识项目\",\"items\":[{\"text\":\"虚拟机导入\",\"link\":\"00-虚拟机导入\"},{\"text\":\"自定义部署\",\"link\":\"00-自定义部署\"},{\"text\":\"内网穿透\",\"link\":\"00-内网穿透\"}]},{\"text\":\"02-我的课表\",\"link\":\"02-我的课表\"},{\"text\":\"03-学习计划\",\"link\":\"03-学习计划\"},{\"text\":\"04-学习记录\",\"link\":\"04-学习记录\"},{\"text\":\"05-问答系统\",\"link\":\"05-问答系统\"},{\"text\":\"06-点赞系统\",\"link\":\"06-点赞系统\"},{\"text\":\"07-积分系统\",\"link\":\"07-积分系统\"},{\"text\":\"08-排行榜功能\",\"link\":\"08-排行榜功能\"},{\"text\":\"09-优惠券管理\",\"link\":\"09-优惠券管理\"},{\"text\":\"10-领取优惠券\",\"link\":\"10-领取优惠券\"},{\"text\":\"11-优惠券优化\",\"link\":\"11-优惠券优化\"},{\"text\":\"12-优惠券使用\",\"link\":\"12-优惠券使用\"},{\"text\":\"13-项目部署\",\"link\":\"13-项目部署\"},{\"text\":\"14-项目实战\",\"link\":\"13-项目实战\"}]}],\"/src/project/express\":[{\"text\":\"神领物流\",\"collapsed\":false,\"base\":\"/src/project/express/\",\"items\":[{\"text\":\"01-初识项目\",\"link\":\"01-初识项目\",\"items\":[{\"text\":\"基础服务\",\"link\":\"00-基础服务\"},{\"text\":\"基础工具\",\"link\":\"00-基础工具\"},{\"text\":\"常见问题\",\"link\":\"00-常见问题\"}]},{\"text\":\"02-支付服务\",\"link\":\"02-支付服务\"},{\"text\":\"03-运费服务\",\"link\":\"03-运费服务\"},{\"text\":\"04-路线服务\",\"link\":\"04-路线服务\"},{\"text\":\"05-调度服务\",\"link\":\"05-调度服务\"},{\"text\":\"06-运输任务\",\"link\":\"06-运输任务\"},{\"text\":\"07-作业范围\",\"link\":\"07-作业范围\"},{\"text\":\"08-派件调度\",\"link\":\"08-派件调度\"},{\"text\":\"09-物流服务\",\"link\":\"09-物流服务\"},{\"text\":\"10-持续集成\",\"link\":\"10-持续集成\"},{\"text\":\"11-项目运维\",\"link\":\"11-项目运维\"},{\"text\":\"12-项目实战\",\"link\":\"12-项目实战\"}]}],\"/src/base/summarize\":[{\"text\":\"基础知识\",\"collapsed\":false,\"base\":\"/src/base/summarize/\",\"items\":[{\"text\":\"Java基础\",\"link\":\"java-base\"},{\"text\":\"Java集合\",\"link\":\"java-collection\"},{\"text\":\"Java虚拟机\",\"link\":\"java-virtual\"},{\"text\":\"并发编程篇\",\"link\":\"java-concurrent\"},{\"text\":\"网络编程篇\",\"link\":\"java-netty\"}]},{\"text\":\"服务框架\",\"collapsed\":false,\"base\":\"/src/base/summarize/\",\"items\":[{\"text\":\"数据库篇\",\"link\":\"mysql\"},{\"text\":\"缓存篇\",\"link\":\"redis\"},{\"text\":\"框架篇\",\"link\":\"spring\"},{\"text\":\"微服务篇\",\"link\":\"spring-cloud\"},{\"text\":\"中间件篇\",\"link\":\"message-queue\"}]},{\"text\":\"场景技术\",\"collapsed\":false,\"base\":\"/src/base/summarize/\",\"items\":[{\"text\":\"设计模式篇\",\"link\":\"gof\"},{\"text\":\"场景技术篇\",\"link\":\"project-practice\"},{\"text\":\"知识点汇总\",\"link\":\"index\"},{\"text\":\"面试准备篇\",\"link\":\"interview\"}]}]},\"logo\":\"/logo.svg\",\"outline\":{\"level\":\"deep\",\"label\":\"章节导航\"},\"darkModeSwitchLabel\":\"切换日光/暗黑模式\",\"sidebarMenuLabel\":\"文章\",\"returnToTopLabel\":\"返回顶部\",\"lastUpdatedText\":\"最后更新\",\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"search\":{\"provider\":\"local\",\"options\":{\"locales\":{\"root\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}}}},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Charles7c/charles7c.github.io\"},{\"icon\":{\"svg\":\"<svg role=\\\"img\\\" viewBox=\\\"0 0 24 24\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><title>码云</title><path d=\\\"M11.984 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.016 0zm6.09 5.333c.328 0 .593.266.592.593v1.482a.594.594 0 0 1-.593.592H9.777c-.982 0-1.778.796-1.778 1.778v5.63c0 .327.266.592.593.592h5.63c.982 0 1.778-.796 1.778-1.778v-.296a.593.593 0 0 0-.592-.593h-4.15a.592.592 0 0 1-.592-.592v-1.482a.593.593 0 0 1 .593-.592h6.815c.327 0 .593.265.593.592v3.408a4 4 0 0 1-4 4H5.926a.593.593 0 0 1-.593-.593V9.778a4.444 4.444 0 0 1 4.445-4.444h8.296Z\\\"/></svg>\"},\"link\":\"https://gitee.com/Charles7c/charles7c\"}],\"commentConfig\":{\"type\":\"gitalk\",\"showComment\":false},\"footerConfig\":{\"showFooter\":true,\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2019-2024 Cookie Mousse\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>